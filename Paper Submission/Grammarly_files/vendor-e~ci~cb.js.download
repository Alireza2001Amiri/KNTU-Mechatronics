"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[2900],{15966:(e,t,n)=>{n.d(t,{eu:()=>k});var r,o=n(10334),s=n(17171),i=n(38886),p=n(84647),a=n(88105),l=n(38832),u=n(66202),c=n(65390),d=n(13110),h=n(63967),m=n(86562),y=n(23988),f=n(66799),I=n(23121),g=n(72017);function T(e,{text:t,ops:n}){n.reduce(((t,n,r)=>l.hI.isInsertString(n)?(e.insertString(n.insert,n,r),t):l.hI.isInsertGap(n)?(e.insertGap("",n,r),t):l.hI.isInsert(n)?t:l.hI.isDelete(n)?(e.remove(t.slice(0,n.delete),n,r),t.slice(n.delete)):l.hI.isRetain(n)?(e.retain(t.slice(0,n.retain),n,r),t.slice(n.retain)):(0,m.xb)(n)),t)}function x(e){return 0===e.replace(/ /g,"").length}function w(e,t){(0,p.pipe)(e,i.HV,c.fold((()=>{x(t.text)||e.push(t)}),(n=>{n.type===t.type?n.text+=t.text:e.push(t)})))}function v(e){return!0===e.italic?!0===e.bold?"boldItalic":"italic":!0===e.bold?"bold":void 0}function b(e){const{substitutions:t,longestSubstitution:n,inserts:o}=e.reduce(((e,[t,n])=>{const r=t.map((e=>e.text)).join("");return e.substitutions.push(r),e.inserts.push(n),r.length>e.longestSubstitution.length&&(e.longestSubstitution=r),e}),{substitutions:[],inserts:[],longestSubstitution:""}),s=(0,p.pipe)(t,d.Tj((e=>n.split(e).join(""))));return(0,p.pipe)(i.OY(o,s,((e,t)=>(t&&e.push({type:g.Iq.Text,text:t,shouldBeCollapsed:!1}),e))),d.ci,u.fromOption((()=>new Error("Substitution processing error"))),u.map((e=>({type:r.Type.Substitution,remove:[{type:g.Iq.Delete,text:n,shouldBeCollapsed:!1}],inserts:e}))))}function S(e){return(0,p.pipe)(I.zb((()=>(0,p.pipe)(e,d.Tj((t=>{const n=[[],[]];return T({insertString(e){w(n[1],{type:g.Iq.Insert,text:"\n"===e?"¶ ":e,shouldBeCollapsed:!1})},insertGap(){throw new G("Substitution transform contains gap insert",e)},remove(e){w(n[0],{type:g.Iq.Delete,text:e,shouldBeCollapsed:!1})},retain(e,{type:t,attributes:r}){if(!l.hI.isOptionalType(t)||0!==n[0].length){const t={type:g.Iq.Text,text:e,style:v(r),shouldBeCollapsed:!1};n[0].push(t),n[1].push(t)}}},t),(0,m.V1)(n[0].length>0,"Substituted part is empty"),(0,m.V1)(n[1].length>0,"Inserts are empty"),n}))))),u.chain(b),u.mapLeft(G.fromError(e)))}function C(e){if(!("list"in e))return c.none;switch(e.list){case"bullet":case"dashed":case"ordered":return c.some({kind:e.list,indent:"number"==typeof e.indent&&Number.isInteger(e.indent)?e.indent:0});default:return c.none}}!function(e){let t;!function(e){e[e.Remove=0]="Remove",e[e.RemoveOr=1]="RemoveOr",e[e.Insert=2]="Insert",e[e.Substitution=3]="Substitution",e[e.Drilldown=4]="Drilldown",e[e.FullSentence=5]="FullSentence",e[e.OneGap=6]="OneGap",e[e.ShortenIt=7]="ShortenIt",e[e.ToneAI=8]="ToneAI",e[e.Citation=9]="Citation",e[e.WritingExpert=10]="WritingExpert"}(t=e.Type||(e.Type={})),(t=e.Type||(e.Type={})).parse=function(e,n){const r=e[0];if(r.isFullSentence)return t.FullSentence;if(c.isSome(n.drilldown))return t.Drilldown;if(r.isCitation)return t.Citation;if(r.isShortenIt)return t.ShortenIt;if(r.isToneAI)return t.ToneAI;if(r.isWritingExpert)return t.WritingExpert;switch(r.type){case l.EF.Type.Insert:return t.Insert;case l.EF.Type.Remove:return e.length>1?t.RemoveOr:t.Remove;case l.EF.Type.Substitution:return r.ops.find(l.hI.isInsertGap)?t.OneGap:t.Substitution;default:return(0,m.xb)(r.type)}},e.create=function(e){return t=>{const n=r.Type.parse(t,e);switch(n){case r.Type.Remove:return function(e,t){return(0,p.pipe)(I.zb((()=>(0,p.pipe)(e,d.Tj((n=>{const r=[];return T({insertString(t,{type:n}){if(n===l.hI.Type.Main)throw new G("Remove transform contains main insert",e)},insertGap(){throw new G("Remove transform contains gap insert",e)},retain(e,{type:t,attributes:n}){l.hI.isOptionalType(t)||w(r,{type:g.Iq.Text,text:e,style:v(n),shouldBeCollapsed:!1})},remove(e,{type:n}){w(r,{type:n!==l.hI.Type.Main||x(e)&&t?g.Iq.Text:g.Iq.Delete,text:e,shouldBeCollapsed:!1})}},n),r})),i.Bq))),u.chain((0,p.flow)(u.fromPredicate((e=>e.length>0),(()=>new G("Remove transform contains no data",e))),u.map((e=>({type:r.Type.Remove,remove:e}))))))}(t,e.ignoreWhitespaceRemoves);case r.Type.RemoveOr:return function(e,t){return(0,p.pipe)(I.zb((()=>(0,p.pipe)(e,d.Tj((n=>{const r=[];return T({insertString(t,{type:n}){if(n===l.hI.Type.Main)throw new G("Multi-remove transform contains main insert",e)},insertGap(){throw new G("Multi-remove transform contains gap insert",e)},retain(e,{type:t,attributes:n}){l.hI.isOptionalType(t)||w(r,{type:g.Iq.Text,text:e,style:v(n),shouldBeCollapsed:!1})},remove(e,{type:n}){w(r,{type:n!==l.hI.Type.Main||x(e)&&t?g.Iq.Text:g.Iq.Delete,text:e,shouldBeCollapsed:!1})}},n),r}))))),u.chain((0,p.flow)(u.fromPredicate((e=>e.length>=2&&e.every((e=>e.length>=2))),(()=>new G("Incomplete multi-remove",e))),u.map((e=>({type:r.Type.RemoveOr,removes:e}))))))}(t,e.ignoreWhitespaceRemoves);case r.Type.Insert:return function(e){return(0,p.pipe)(I.zb((()=>(0,p.pipe)(e,d.Tj((t=>{const n=[];return T({insertString(e,{type:t}){w(n,{type:l.hI.isOptionalType(t)?g.Iq.Text:g.Iq.Insert,text:e,shouldBeCollapsed:!1})},insertGap(){throw new G("Insert transform contains gap insert",e)},retain(e,{type:t,attributes:r}){(!l.hI.isOptionalType(t)||n.length>0)&&w(n,{type:g.Iq.Text,text:e,style:v(r),shouldBeCollapsed:!1})},remove(t,{type:n}){if(n===l.hI.Type.Main)throw new G("Insert transform contains main delete",e)}},t),n}))))),u.chain((0,p.flow)(d.ci,u.fromOption((()=>new G("Incomplete insert",e))),u.map((e=>({type:r.Type.Insert,inserts:e}))))))}(t);case r.Type.Substitution:return S(t);case r.Type.Drilldown:return function(e,t){return(0,p.pipe)(S(e),u.chain((n=>(0,p.pipe)(I.zb((()=>((0,m.V1)(t.length>0,"Drilldown transform - empty drilldown tree"),{inserts:(0,p.pipe)(t,d.Tj((function e([t,r]){return(0,m.V1)(void 0!==n.inserts[t],"Drilldown transform - alternative insert not found"),{alternativeId:t,label:n.inserts[t],subLabels:r.map(e)}}))),remove:n.remove,type:r.Type.Drilldown}))),u.mapLeft(G.fromError(e))))))}(t,(0,p.pipe)(e.drilldown,c.getOrElse((()=>f.cq.empty))));case r.Type.FullSentence:return function(e){return(0,p.pipe)(e,u.fromPredicate((e=>1===e.length),(()=>new G("Expected full-sentence transform to have 1 alternative",e))),u.map((0,p.flow)(d.d5,(t=>{let n={blockStart:0,ops:[],kind:g.lW.PlainText};return T({insertString(e,t){const r=e.split("\n");if(1===r.length)n.ops.push({type:g.Iq.Insert,text:e,shouldBeCollapsed:!1});else{const e=(0,p.pipe)(t.attributes,C,c.fold((()=>p.constVoid),(({kind:e,indent:t})=>()=>{n.ops.splice(n.blockStart,1,{type:g.Iq.List,kind:e,indent:t}),n={kind:g.lW.WithFormatting,ops:n.ops,blockStart:n.blockStart}})));for(let t=0,o=r.length-1;t<=o;t++){const s=r[t];s&&n.ops.push({type:g.Iq.Insert,text:s,shouldBeCollapsed:!1}),t<o&&(e(),n.blockStart=n.ops.length,n.ops.push({type:g.Iq.Insert,text:"\n",shouldBeCollapsed:!1}))}}},insertGap(){throw new G("Full sentence transform contains gap insert",e)},retain(e,t){n.ops.push({type:g.Iq.Text,text:e,shouldBeCollapsed:q(t.type,e)})},remove(e,t){n.ops.push({type:g.Iq.Delete,text:e,shouldBeCollapsed:q(t.type,e)})}},t),n}))),u.chain((0,p.flow)(c.fromPredicate((e=>e.ops.length>0)),u.fromOption((()=>new G("Got empty full sentence transform",e))),u.map((({ops:e,kind:t})=>({type:r.Type.FullSentence,ops:e,kind:t}))))))}(t);case r.Type.OneGap:return function(e){return(0,p.pipe)(I.zb((()=>((0,m.V1)(1===e.length,"One gap transform does not contain exactly one alternative"),(0,p.pipe)(e,d.d5,(e=>{const t=[],n=[];let r=!1;return T({insertString(e,{type:o}){w(r?n:t,{type:l.hI.isOptionalType(o)?g.Iq.Text:g.Iq.Insert,text:e,shouldBeCollapsed:!1})},insertGap(){(0,m.V1)(!r,"One gap transform does not contain exactly one gap insert"),r=!0},retain(e,{type:o}){const s=r?n:t;(!l.hI.isOptionalType(o)||s.length>0)&&w(s,{type:g.Iq.Text,text:e,shouldBeCollapsed:!1})},remove:p.constVoid},e),(0,m.V1)(r,"One gap transform does not contain exactly one gap insert"),(0,m.V1)(t.length>0||n.length>0,"One gap transform does not contain at least one text insert"),{left:t,right:n}}))))),u.bimap(G.fromError(e),(({left:e,right:t})=>({type:r.Type.OneGap,left:e,right:t}))))}(t);case r.Type.ShortenIt:return function(e){return(0,p.pipe)(e,u.fromPredicate((e=>1===e.length),(()=>new G("Expected shorten-it transform to have 1 alternative",e))),u.chain(d.hV(u.either)(B)),u.map(d.d5),u.map((e=>({type:r.Type.ShortenIt,ops:e}))))}(t);case r.Type.ToneAI:return function(e){return(0,p.pipe)(I.zb((()=>(0,p.pipe)(e,d.Tj((t=>{const n=[];return T({insertString(e){w(n,{type:g.Iq.Insert,text:e,shouldBeCollapsed:!1})},insertGap(){throw new G("ToneAI transform should not include gap insert",e)},retain(e){w(n,{type:g.Iq.Text,text:e,shouldBeCollapsed:!1})},remove(e){w(n,{type:g.Iq.Delete,text:e,shouldBeCollapsed:!1})}},t),n}))))),u.chain((0,p.flow)(d.ci,u.fromOption((()=>new G("Incomplete ToneAI transform",e))),u.map((e=>({type:r.Type.ToneAI,transformParts:e}))))))}(t);case r.Type.Citation:return function(e){return(0,p.pipe)(e,u.fromPredicate((e=>1===e.length),(()=>new G("Expected citation transform to have 1 alternative",e))),u.map(d.d5),u.chain(u.fromPredicate((e=>e.isCitation),(()=>new G("Expected citation to have isCitation set to true",e)))),u.chain(E),u.map((e=>({ops:e,type:r.Type.Citation}))))}(t);case r.Type.WritingExpert:return function(e){return(0,p.pipe)(e,u.fromPredicate((e=>1===e.length),(()=>new G("Expected citation transform to have 1 alternative",e))),u.map(d.d5),u.chain(u.fromPredicate((e=>e.isWritingExpert),(()=>new G("Expected citation to have isWritingExpert set to true",e)))),u.chain(O),u.map((e=>({ops:e,type:r.Type.WritingExpert}))))}(t);default:return(0,m.xb)(n)}}}}(r||(r={}));const q=(e,t)=>e===l.hI.Type.Optional&&t.length>3;function B(e){const t=[];return T({insertString(e,{group:n}){t.push({type:g.Iq.Insert,text:e,group:n,shouldBeCollapsed:!1})},insertGap(){throw new G("ShortenIt transform contains gap insert",[e])},retain(e,{group:n}){t.push({type:g.Iq.Text,text:e,group:n,shouldBeCollapsed:!1})},remove(e,{group:n}){t.push({type:g.Iq.Delete,text:e,shouldBeCollapsed:!0,group:n})}},e),(0,p.pipe)(t,u.fromPredicate((e=>e.length>0),(()=>new G("Got empty ShortenIt transform",[e]))))}function E(e){const t=[];return T({insertString(e){t.push({type:g.Iq.Insert,text:e,shouldBeCollapsed:!1})},insertGap(){throw new G("Citation transform contains gap insert",[e])},retain(e,{attributes:n}){t.push({type:g.Iq.Text,text:e,style:v(n),shouldBeCollapsed:!1})},remove(e){t.push({type:g.Iq.Delete,text:e,shouldBeCollapsed:!1})}},e),(0,p.pipe)(t,u.fromPredicate((e=>e.length>0),(()=>new G("Got empty Citation transform",[e]))))}function O(e){const t=[];return T({insertString:e=>{t.push({type:g.Iq.Insert,text:e,shouldBeCollapsed:!1})},insertGap:()=>{throw new G("Citation transform contains gap insert",[e])},retain:(e,{attributes:n})=>{t.push({type:g.Iq.Text,text:e,style:v(n),shouldBeCollapsed:!1})},remove:p.constVoid},e),(0,p.pipe)(t,u.fromPredicate((e=>e.length>0),(()=>new G("Got empty Citation transform",[e]))))}class G extends m.eo{static fromError(e){return t=>{const n=new G(t.message,e);return n.stack=t.stack,n}}toString(){return`Hydration error: ${this.message}\n  ops: ${this.alternatives.map((e=>e.ops.map(l.hI.anonymize)))}`}constructor(e,t){super(e),(0,y._)(this,"alternatives",void 0),this.alternatives=t}}var W=n(51069);const R={ignoreWhitespaceRemoves:!0},k=(0,p.flow)((function(e,t=R){return n=>(0,p.pipe)(n.alternatives,function(e,t){const n=A(e);return(0,p.flow)(function(e,{isFullSentence:t,isShortenIt:n,isToneAI:r,isCitation:o,isWritingExpert:s}){return a=>(0,p.pipe)(a,i.x1((i=>(0,p.pipe)(i.type,c.map((p=>{if(l.EF.hasOptionalContext(i.ops)){const[a,...u]=i.ops,c=l.hI.length(a);return{text:e(c,i.lengthAffected-c),ops:u,type:p,isFullSentence:t,isShortenIt:n,isToneAI:r,isCitation:o,isWritingExpert:s}}return{text:e(0,i.lengthAffected),ops:i.ops,type:p,isFullSentence:t,isShortenIt:n,isToneAI:r,isCitation:o,isWritingExpert:s}}))))),d.ci)}(n,t),u.fromOption((()=>new Error("Alternative array is empty"))))}(e,{isFullSentence:h.bU.isFullSentence(n.cardType),isShortenIt:h.bU.isShortenIt(n.cardType),isToneAI:h.bU.isToneAI(n.cardType),isCitation:h.bU.isCitation(n.cardType),isWritingExpert:h.bU.isWritingExpert(n.cardType)}),u.chain(r.create((0,s._)((0,o._)({},t),{drilldown:n.drilldown}))))}),(e=>t=>(0,p.pipe)(t.content,u.fold((e=>u.right((0,W.$)(e,t.todo))),(0,p.flow)(e,u.bimap((e=>({kind:"default",error:e})),(e=>function(e,t){switch(e.type){case r.Type.Drilldown:return g.hx.create(e.remove,e.inserts,t);case r.Type.Substitution:return g.vY.create(e.remove,e.inserts,t);case r.Type.Insert:return 2===e.inserts.length?g.V_.create(e.inserts[0],e.inserts[1],t):g.Us.create(e.inserts,t);case r.Type.Remove:return g.u.create([e.remove],t);case r.Type.RemoveOr:return g.JV.create(e.removes,t);case r.Type.FullSentence:return function(e,t){switch(e.kind){case g.lW.WithFormatting:return g.tG.createWithFormatting(e.ops,t);case g.lW.PlainText:return g.tG.createPlainText(e.ops,t);default:return(0,m.xb)(e)}}(e,t);case r.Type.Citation:return function(e,t){return{type:g.pJ.Type.Citation,tooltipText:t,labels:e.ops}}(e,t);case r.Type.OneGap:return g.vH.create(e,t);case r.Type.ShortenIt:return function(e,t){return{type:g.pJ.Type.ShortenIt,tooltipText:t,labels:e.ops}}(e,t);case r.Type.ToneAI:return function(e,t){return{type:g.pJ.Type.ToneAI,tooltipText:t,labels:e.transformParts}}(e,t);case r.Type.WritingExpert:return function(e,t){return{type:g.pJ.Type.WritingExpert,tooltipText:t,labels:e.ops}}(e,t);default:return(0,m.xb)(e)}}(e,t.todo)))))))),A=e=>(0,p.flow)(e,(e=>e.delta.reduce(((e,t)=>a.E.isInsertString(t)?e+t.insert:e),"")))},51069:(e,t,n)=>{n.d(t,{$:()=>p});var r=n(60575),o=n(86562),s=n(36840),i=n(72017);const p=(e,t)=>{switch(e.kind){case"replacement":return function(e,t){(0,o.V1)((0,s.z2)(e),"transforms should have at least one element");const[n]=e;return a(n)>-1?i.vY.create(l(n),e.map(u),t,!0):i.Us.create(e,t)}(e.content.map((e=>[{type:i.Iq.Insert,text:e,shouldBeCollapsed:!1}])),t);case"transform":return function(e,t){(0,o.V1)((0,s.z2)(e),"transforms should have at least one element");const[n]=e;return a(n)>-1?i.vY.create(l(n),e.map(u),t):function(e){return 2===e.length&&d(e)}(e)?i.V_.create(e[0],e[1],t):d(e)?i.Us.create(e,t):i.u.create(e,t)}(e.content.map(y),t);default:return(0,o.xb)(e.kind)}};function a(e){return e.findIndex((e=>"arrow"===e.type))}function l(e){return e.slice(0,a(e))}function u(e){return e.slice(a(e)+1)}function c(e){return e.every((e=>"delete"!==e.type))}function d(e){return e.every(c)}function h(e,t){return{re:new RegExp(`^(${e})([\\s\\S]*)$`),createResult:t}}const m=[h("(?:\\<span class='gr_grammar_del'\\>([\\S\\s]*?)\\</span\\>)",(e=>({type:i.Iq.Delete,text:e[2],shouldBeCollapsed:!1}))),h("(?:\\<span class='gr_grammar_ins'\\>([\\S\\s]*?)\\</span\\>)",(e=>({type:i.Iq.Insert,text:e[2],shouldBeCollapsed:!1}))),h("(→)",(e=>({type:i.Iq.Arrow}))),h("([^<>→]+)",(e=>({type:i.Iq.Text,text:e[1],shouldBeCollapsed:!1})))];function y(e){function t(e){for(const t of m){const n=e.match(t.re);if(null!==n)return[t.createResult(n),n[n.length-1]]}}function n(t){let n=["<span class='gr_grammar_del'>","<span class='gr_grammar_ins'>","→"].map((e=>t.indexOf(e)));if(n.findIndex((e=>0===e))>0)throw new Error(`Couldn't parse transform: ${e}`);if(n=n.filter((e=>e>0)),(0,s.z2)(n)){const e=Math.min(...n);return[{type:i.Iq.Text,text:t.substring(0,e),shouldBeCollapsed:!1},t.substring(e)]}return[{type:i.Iq.Text,text:t,shouldBeCollapsed:!1},""]}const o=[];let p,a=e,l=!1,u=0;for(;(0,s.z2)(a);){const e=t(a);void 0===e&&(l=!0);const[r,s]=e||n(a);p&&p.type===i.Iq.Text&&r.type===i.Iq.Text?p.text+=r.text:(p&&p.type===i.Iq.Delete&&r.type===i.Iq.Insert&&(o.push({type:i.Iq.Arrow}),u++),o.push(r)),r.type===i.Iq.Arrow&&u++,p=o[o.length-1],a=s}return(l||!(0,s.z2)(o)||u>1)&&r.Bx.Logging.getLogger("model.editor.alert_replacement").warn("Bad parsing of transform",{transformHtml:e,transformPartCount:o.length,arrowCount:u}),o}}}]);