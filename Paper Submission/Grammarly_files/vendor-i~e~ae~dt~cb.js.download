"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[8203],{77396:(e,t,n)=>{n.d(t,{NQ:()=>p,h8:()=>l,hq:()=>c,qI:()=>u,uC:()=>h});var r=n(46238),i=n(94855),o=n(84647),s=n(23121),a=n(65390);function c(e){return e().then(s.$v)}var u=i.cy,l=function(e){return r.map(s.qI(e))};function p(e,t,n){return(0,o.pipe)(e,(0,i.AU)((function(s){var c=(0,o.pipe)((0,i.kb)(s),r.delay(n));return(0,o.pipe)(t(s),a.fold((function(){return(0,i.kb)(s)}),(function(t){var n=(0,o.pipe)(t,r.chain((function(){return(0,i.pG)(void 0)}))),s=r.getRaceMonoid().concat(c,n);return(0,o.pipe)(s,(0,i.cy)((function(){return e})))})))}),(function(e){return(0,i.pG)(e)})))}var h=function(e){return function(){return Promise.resolve(e())}}},817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0;var n={prod:"grammarly.com",preprod:"ppgr.io",qa:"qagr.io"};t.config=function(e){var t=n[e];return{url:{properties:"https://properties."+t,treatment:"https://treatment."+t,gates:"https://gates."+t}}}},89995:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExperimentClient=t.Gate=t.Experiment=void 0;var o=n(38008),s=n(86616),a=n(96620),c=function(){function e(e,t){this.name=e,this._experiences=t}return Object.defineProperty(e.prototype,"experiences",{get:function(){return Object.fromEntries(this._experiences.map((function(e){return[e,e]})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"experiencesArray",{get:function(){return this._experiences},enumerable:!1,configurable:!0}),e}();t.Experiment=c;t.Gate=function(e,t){void 0===t&&(t="enabled"),this.name=e,this.experience=t};t.ExperimentClient=function(e,t,n,c,u){var l=this;void 0===u&&(u={}),this._treatmentService=e,this._experiments=t,this._gatesService=n,this._gates=c,this._config=u,this._experimentTreatments=new Map,this._gateTreatments=new Map,this._initialFetched=!1,this.setPrefetchedTreatments=function(e){if(l._startRefreshIfNeeded(),!s.validateTreatmentsWithType(e))throw new Error("Not valid treatments");l._updateTreatmentForExpAndGates(e)},this._updateTreatmentForExpAndGates=function(e){l._treatmentService.refresh&&l._treatmentService.refresh(),l._experimentTreatments=new Map(e.filter((function(e){return e.type===a.ExperimentType.experiment})).map((function(e){return[e.experimentName,e]}))),l._gateTreatments=new Map(e.filter((function(e){return e.type===a.ExperimentType.gate})).map((function(e){return[e.experimentName,e]})))},this.fetchTreatments=function(e){return void 0===e&&(e={}),r(l,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._startRefreshIfNeeded(),[4,this._fetchTreatments(e.clearCacheOnError)];case 1:return t.sent(),[2]}}))}))},this._fetchTreatments=function(e){return r(l,void 0,void 0,(function(){var t,n,r,o,s,a,c;return i(this,(function(i){switch(i.label){case 0:t=null,n=null,i.label=1;case 1:return i.trys.push([1,3,,4]),r=this._experiments.concat(this._gates),[4,this._treatmentService.getTreatment(r.map((function(e){return e.name})))];case 2:return t=i.sent(),[3,4];case 3:return o=i.sent(),n=o,e&&this._experimentTreatments.clear(),[3,4];case 4:if(t)return this._updateTreatmentForExpAndGates(t),[2];s=null,a=null,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this._gatesService.getTreatment(this._gates.map((function(e){return e.name})))];case 6:return s=i.sent(),[3,8];case 7:return c=i.sent(),a=c,e&&this._gateTreatments.clear(),[3,8];case 8:if(s&&(this._gateTreatments=new Map(s.map((function(e){return[e.experimentName,e]})))),a||n)throw a||n;return[2]}}))}))},this._startRefreshIfNeeded=function(){l._initialFetched||(l._config.ttl&&(l._refreshTreatment=setInterval((function(){return r(l,void 0,void 0,(function(){var e,t=this;return i(this,(function(n){switch(n.label){case 0:return e=function(){return r(t,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._fetchTreatments()];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},this._config.ttl&&this._config.useRefreshJitter?(this._delayedRefreshTreatment=setTimeout(e,.1*this._config.ttl*Math.random()),[3,3]):[3,1];case 1:return[4,e()];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}),l._config.ttl)),l._initialFetched=!0)},this.dispose=function(){l._refreshTreatment&&clearInterval(l._refreshTreatment),l._delayedRefreshTreatment&&clearTimeout(l._delayedRefreshTreatment)},this.getTreatment=function(e){var t=l.peekTreatment(e);return null!==t&&l.logTreatment(e,t).catch((function(){})),t},this.peekTreatment=function(e){var t=l._experimentTreatments.get(e.name)||l._gateTreatments.get(e.name),n=null==t?void 0:t.groupName;if(n){var r=e.experiencesArray.find((function(e){return o.getGroupNames(e).includes(n)}));if(r)return r}return null},this.logTreatment=function(e,t){if(l._config.ssrDisableLogging)return Promise.resolve();var n=l._experimentTreatments.get(e.name)||l._gateTreatments.get(e.name);if(!n||o.getExperienceName(n.groupName)!==t)throw new Error("Cannot find associated treatment");return(void 0!==n.needLog?n.needLog:n.type!==a.ExperimentType.gate)?l._treatmentService.logTreatment(n):Promise.resolve()},this.isGateEnabled=function(e){return l._getExperienceOfEnabledGate(e.name)===e.experience},this._getExperienceOfEnabledGate=function(e){var t=l._gateTreatments.get(e);return t?o.getExperienceName(t.groupName):null},this.getDynamicConfiguration=function(e){var t=l._experimentTreatments.get(e.name)||l._gateTreatments.get(e.name);return t&&t.dynamicConfiguration?t.dynamicConfiguration:null}}},83172:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.GatesService=void 0;var o=n(817),s=n(31940),a=n(86616),c=function(){function e(e,t,n){this.type="gate",this._httpClient=new s.HttpClient(e,t),this._gatesUrl=o.config(n).url.gates+"/gates/get"}return e.prototype.getTreatment=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this._httpClient.post(this._gatesUrl,e)];case 1:if(t=n.sent(),a.validateTreatmentsWithType(t))return[2,t];throw new Error("Did not get valid gate treatments")}}))}))},e}();t.GatesService=c},31940:function(e,t){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=void 0;var o=function(){function e(e,t){var n=this;this._fetch=e,this._config=t,this._fetchWithTimeout=this._config.timeout?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.race([n._fetch.apply(n,e),new Promise((function(e,t){return setTimeout((function(){return t(new Error("Timeout"))}),n._config.timeout)}))])}:this._fetch}return e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return[4,this._getHeaders()];case 1:return t=r.sent(),[4,this._fetchWithTimeout(e,{credentials:"include",mode:"cors",headers:t})];case 2:return n=r.sent(),[2,this._parseResponse(n)]}}))}))},e.prototype.post=function(e,t){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return[4,this._getHeaders()];case 1:return r=i.sent(),[4,this._fetchWithTimeout(e,{method:"POST",credentials:"include",mode:"cors",headers:n(n({},r),{"Content-Type":"application/json"}),body:JSON.stringify(t)})];case 2:return o=i.sent(),[2,this._parseResponse(o)]}}))}))},e.prototype._filterHeaders=function(e){var t={};return Object.entries(e).forEach((function(e){var n=e[0],r=e[1];r&&(t[n]=r)})),t},e.prototype._getHeaders=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this._config.getApplicationHeaders?(e=this._filterHeaders,[4,this._config.getApplicationHeaders()]):[3,2];case 1:return[2,e.apply(this,[t.sent()])];case 2:throw new Error("Cannot get application headers")}}))}))},e.prototype._parseResponse=function(e){if(!e.ok)throw new Error("Network response was not ok, status "+e.status);return"application/json"===e.headers.get("Content-Type")?e.json():e.text()},e}();t.HttpClient=o},60251:(e,t,n)=>{t.mP=t.eb=t.Re=t.iD=t.aj=void 0;var r=n(89995);Object.defineProperty(t,"aj",{enumerable:!0,get:function(){return r.Experiment}}),Object.defineProperty(t,"iD",{enumerable:!0,get:function(){return r.Gate}}),Object.defineProperty(t,"Re",{enumerable:!0,get:function(){return r.ExperimentClient}});var i=n(96620);Object.defineProperty(t,"eb",{enumerable:!0,get:function(){return i.TreatmentService}});var o=n(83172);Object.defineProperty(t,"mP",{enumerable:!0,get:function(){return o.GatesService}});n(16305)},16305:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropertiesClient=void 0;var r=n(817),i=n(31940),o=function(){function e(e,t,n){this._propertiesUrl=r.config(t).url.properties+"/properties",this._httpClient=new i.HttpClient(e,n)}return e.prototype.getAll=function(){return this._httpClient.get(this._propertiesUrl)},e.prototype.getOne=function(e){var t=this._propertiesUrl+"/"+e;return this._httpClient.get(t)},e.prototype.set=function(e){return this._httpClient.post(this._propertiesUrl,e)},e}();t.PropertiesClient=o},38008:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupNames=t.getExperienceName=void 0,t.getExperienceName=function(e){return e.endsWith("_1")||e.endsWith("_2")?e.slice(0,-2):null},t.getGroupNames=function(e){return[e+"_1",e+"_2"]}},86616:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateTreatmentsWithType=void 0;var n=function(e){return"string"==typeof e};t.validateTreatmentsWithType=function(e){return Array.isArray(e)&&e.reduce((function(e,t){return e&&n((r=t).experimentName)&&n(r.groupName)&&n(r.experimentId)&&n(r.type);var r}),!0)}},96620:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TreatmentService=t.ExperimentType=void 0;var o,s=n(817),a=n(31940),c=n(86616);(o=t.ExperimentType||(t.ExperimentType={})).experiment="experiment",o.gate="gate";var u=function(e){var t=function(e){return e.holdoutTreatment?":"+e.holdoutTreatment.experimentId+t(e.holdoutTreatment):""};return e.groupName+":"+e.userId+":"+e.experimentId+t(e)},l=function(){function e(e,t,n,r){this._persistentStorageOpts=r,this.type="experiment",this._throttleLogs=new Map,this._sentLogs={},this._httpClient=new a.HttpClient(e,t),this._treatmentUrl=s.config(n).url.treatment+"/treatment"}return e.prototype.getTreatment=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=this._treatmentUrl+"/get",n=e,[4,this._httpClient.post(t,n)];case 1:if(r=i.sent(),c.validateTreatmentsWithType(r))return[2,r];throw new Error("Did not get valid treatments")}}))}))},e.prototype.logTreatment=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._checkShouldThrottle(e)||this._checkSent(e)?[2]:[4,this._sendLogTreatment(e)];case 1:return t.sent(),this._setSentLogs(e),[2]}}))}))},e.prototype.refresh=function(){this._throttleLogs.clear()},e.prototype.initSentLogsStorage=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return i(this,(function(r){switch(r.label){case 0:if(!this._persistentStorageOpts)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._persistentStorageOpts.get(this._sentLogsStorageKey)];case 2:return e=r.sent()||{},t=new Set(this._persistentStorageOpts.experimentNames),Object.entries(e).forEach((function(e){var r=e[0],i=e[1];t.has(r)&&n._updateSentLogs(r,i)})),[3,4];case 3:return r.sent(),[3,4];case 4:return[2]}}))}))},Object.defineProperty(e.prototype,"_sentLogsStorageKey",{get:function(){var t;return e.STORAGE_KEY_PREFIX+(null===(t=this._persistentStorageOpts)||void 0===t?void 0:t.clientName)},enumerable:!1,configurable:!0}),e.prototype._checkShouldThrottle=function(e){var t=u(e),n=this._throttleLogs.get(e.experimentName)===t;return n||this._throttleLogs.set(e.experimentName,t),n},e.prototype._checkSent=function(e){var t=u(e);return this._sentLogs[e.experimentName]===t},e.prototype._setSentLogs=function(e){var t=u(e);this._updateSentLogs(e.experimentName,t,!0)},e.prototype._updateSentLogs=function(e,t,n){void 0===n&&(n=!1),(n||void 0===this._sentLogs[e])&&(this._sentLogs[e]=t),n&&this._persistSentLogs()},e.prototype._persistSentLogs=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),this._persistentStorageOpts?[4,this._persistentStorageOpts.set(this._sentLogsStorageKey,this._sentLogs)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[3,4];case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},e.prototype._sendLogTreatment=function(e){var t=this._treatmentUrl+"/log";return this._httpClient.post(t,e)},e.STORAGE_KEY_PREFIX="TreatmentServiceStorage_",e}();t.TreatmentService=l},85791:(e,t,n)=>{n.d(t,{DI:()=>k,SK:()=>O,it:()=>w,v0:()=>r,yB:()=>s});var r,i,o,s,a,c,u=n(44869),l=n(95934),p=n(86562),h=n(11550),f=n(16683),d=n(12584),m=n(90220);(i=r||(r={})).codec=l.NW({currency:l.Yj,value:l.ai},"Money"),i.eq=u.OW({currency:u.kK,value:u.US}),(o||(o={})).codec=l.NW({price:l.ai,priceMoney:r.codec,fromSeats:l.ai,toSeats:l.ai},"PriceTier"),(s||(s={})).codec=l.E$([l.NW({id:l.ai,title:l.Yj,description:l.Yj,periodMonths:l.ai,price:l.ai,priceMoney:r.codec,regularPlanId:l.ai,regularPrice:l.ai,regularPriceMoney:r.codec}),l.OH({nextPaymentPrice:l.ai,numberOfSeats:l.ai,renewalPrice:l.ai,renewalPriceMoney:r.codec,hasTrial:l.zM,priceTiers:l.YO(o.codec),trialDays:l.ai,renewalPlanId:l.ai})],"PaymentPlan"),(a||(a={})).codec=l.NW({nextPayDate:l.Yj,plan:s.codec},"HardChangePaymentPlan"),(c||(c={})).codec=l.KC([l.eu("payPal"),l.eu("creditCard"),l.eu("stripe"),l.Vx],"PaymentMethod");var _,g,y,v,b,T,x,E,w,I=(e=>(e.mastercard="MasterCard",e.visa="Visa",e.americanExpress="American Express",e.jcb="JCB",e.maestro="Maestro",e.discover="Discover",e.dinersClub="Diners Club",e.unionPay="UnionPay",e.mir="Mir",e.elo="Elo",e.hiper="Hiper",e))(I||{});(_||(_={})).codec=l.KC([m.Z.createStringEnum(I,"KnownCardType"),l.Yj],"CreditCardType"),(g||(g={})).codec=l.KC([l.E$([l.NW({cardType:_.codec}),l.OH({cardSuffix:l.Yj,expirationMonth:l.ai,expirationYear:l.ai})]),l.Vx],"CreditCard"),(y||(y={})).codec=l.NW({id:l.Yj,description:l.Yj,discountPercent:l.ai,isLifelong:l.zM}),(v||(v={})).codec=l.KC([l.eu("INCLUSIVE"),l.eu("EXCLUSIVE")],"RenewalPriceType"),(b||(b={})).codec=l.E$([l.NW({discountSuppressed:l.zM}),l.OH({countryCode:l.Yj,renewalPriceType:v.codec})],"PricingOptions"),(T||(T={})).codec=l.NW({payPalDisabled:l.zM,americanExpressDisabled:l.zM,disabledCardTypes:l.YO(_.codec)},"PaymentMethodOptions"),(x||(x={})).codec=l.KC([l.eu("RENEWAL"),l.eu("SEAT_EXPANSION"),l.eu("INITIAL_CHARGE"),l.eu("UNKNOWN")],"InvoiceType"),(E||(E={})).codec=l.NW({amount:r.codec,numberOfSeats:l.ai,dueDate:l.Yj,hostedLink:l.Yj,chargeable:l.zM,invoiceType:x.codec},"StripeInvoiceInfo"),(w||(w={})).codec=l.OH({state:l.KC([l.eu("DEFAULT"),l.eu("FROZEN"),l.eu("TRIAL"),l.eu("BILLING_FLOW_MIGRATION_STARTED"),l.eu("BILLING_FLOW_MIGRATION_ENDED")]),paymentMethod:c.codec,creditCard:g.codec,billingFlowMigrationMethod:l.KC([l.eu("DEFAULT"),l.eu("INVOICING")]),usePaymentsApi:l.zM,isPremium:l.zM,nextPayDate:l.Yj,nextRenewalInvoiceDate:l.Yj,lastSubscribedDate:l.Yj,expirationDate:l.Yj,isAppleSubscription:l.zM,isGooglePlaySubscription:l.zM,isCancelled:l.zM,isDunning:l.zM,isPaymentMethodFailed:l.zM,isFree:l.zM,isFreebie:l.zM,isPremiumConversion:l.zM,isLegacyPayPal:l.zM,canCancelPlanSwitch:l.zM,hasInstitutionSubscription:l.zM,currentPlan:s.codec,queuedPlan:s.codec,plans:l.YO(s.codec),hardChangePlans:l.YO(a.codec),institutionDynamicPlans:l.YO(s.codec),institutionPlans:l.YO(s.codec),institutionEduPlans:l.YO(s.codec),proPlans:l.YO(s.codec),pricingOptions:b.codec,paymentMethodOptions:T.codec,payPalEmail:l.Yj,isOnTrial:l.zM,companyInfo:l.Yj,dunningEndDate:l.Yj,dunningDeactivationDate:l.Yj,campaign:y.codec,stripeInvoiceInfo:E.codec,countryCode:l.Yj,regionCode:l.Yj,isUngatedTrialDisabled:l.zM},"SubscriptionStatus");const P=l.KC([l.eu("NO_ACTIVE_SUBSCRIPTION"),l.eu("ON_TRIAL"),l.eu("RENEWAL_IN_PROGRESS"),l.eu("MOBILE_SUBSCRIPTION"),l.eu("NOT_MATURE_ENOUGH")],"ReferrerNotEligibleReason");var C,j,O;(C||(C={})).codec=l.NW({referralLink:l.E$([l.NW({notEligibleReason:P}),l.OH({key:l.ch})]),canReferUsersStatus:l.eu("NOT_ELIGIBLE")},"ReferralInfoNoLink"),(j||(j={})).codec=l.E$([l.NW({referralLink:l.NW({key:l.Yj}),referralRewardsLimit:l.ai,referralRewardsReceived:l.ai}),l.OH({canReferUsersStatus:l.KC([l.eu("OK"),l.eu("NOT_ELIGIBLE_FOR_REWARD")]),rewardNotEligibleReason:l.KC([l.ch,P,l.eu("REWARD_LIMIT_EXCEEDED")]),referralHistory:l.YO(l.NW({refereeName:l.Yj,createdAt:l.Yj}))})],"ReferralInfoHasLink"),(O||(O={})).codec=l.KC([C.codec,j.codec],"ReferralInfo");const S=class extends f.K.Base{constructor(e,t,n){super(),this._url=e,this._ajaxFactory=t,this._fingerprints=n,this._ajax=this._ajaxFactory({requestExtender:d.UV.toHeaderAppender(this._fingerprints)})}static getDefaultUrl(e){return`https://subscription${e}/api/v1`}getStatus(){const e=h.tM.get(this._url,"/subscription");return this._ajax.json(e)}getIndividualStatus(){const e=h.tM.get(this._url,"/individual-subscription");return this._ajax.json(e)}getFrozenProSubscriptionStatus(){const e=h.tM.get(this._url,"/subscriptions/frozen/grammarly-pro");return this._ajax.json(e)}getIndividualPlans(e){const t=h.tM.get(this._url,"/individual-plans").queryParam("billingCountryCode",e);return this._ajax.json(t)}getInstitutionalPlans(e){const t=h.tM.get(this._url,"/institutional-plans").queryParam("billingCountryCode",e);return this._ajax.json(t)}cancelSubscription(){const e=h.tM.post(this._url,"/cancel");return this._ajax.empty(e)}renewSubscription(){const e=h.tM.post(this._url,"/renew");return this._ajax.empty(e)}ackPremiumConversion(){const e=h.tM.post(this._url,"/ack-premium-conversion");return this._ajax.empty(e)}generateClientToken(){const e=h.tM.post(this._url,"/token/generateClientToken");return this._ajax.json(e)}getAvailablePlans(){const e=h.tM.get(this._url,"/pricing");return this._ajax.json(e)}changePlan(e){const t=h.tM.post(this._url,"/set-plan").pathParam(e.toString());return this._ajax.empty(t)}changeCurrentPlan(e){const t=h.tM.post(this._url,"/hard-change-plan").pathParam(e.toString());return this._ajax.empty(t)}subscribe(e,t,n,r,i,o){const s=h.tM.post(this._url,"/subscribe").formParam("nonce",t).formParam("planId",e.toString()).formParam("sessionId",n);return r&&s.formParam("billingZip",r),i&&s.formParam("billingCountryCode",i),o&&s.formParam("billingRegionCode",o),this._ajax.empty(s)}getSetupStatus(e){const t=h.tM.get(this._url,`/setup/${e}`);return this._ajax.json(t)}subscribeCard(e,t,n,r){return this.subscribe(e,t,n,r)}subscribeCardSandbox(e="1"){const t=h.tM.post(this._url,"/subscribe").formParam("planId",e).formParam("nonce","fake-valid-nonce").formParam("sessionId","test-session").formParam("billingZip","12345");return this._ajax.empty(t)}updateCreditCard(e,t,n,r){const i=h.tM.post(this._url,"/update-card").formParam("nonce",e);return t&&i.formParam("billingZip",t),n&&i.formParam("billingCountryCode",n),r&&i.formParam("billingRegionCode",r),this._ajax.empty(i)}generateTokenPaypal({cancelUrl:e,returnUrl:t}){const n=h.tM.post(this._url,"/token/paypal").formParam("cancelUrl",e).formParam("returnUrl",t);return this._ajax.json(n)}downloadSingleReceipt(e){const t=h.tM.get(this._url,`/receipt/${e}`);return this._ajax.file(t)}downloadBillingReceipts(){const e=h.tM.get(this._url,"/receipt");return this._ajax.file(e)}downloadSingleProReceipt(e){const t=h.tM.get(this._url,`/grammarly-pro/receipt//${e}`);return this._ajax.file(t)}downloadProBillingReceipts(){const e=h.tM.get(this._url,"/grammarly-pro/receipt");return this._ajax.file(e)}setCompanyInfo(e){const t=h.tM.post(this._url,"/set-company-info").formParam("companyInfo",e);return this._ajax.empty(t)}setProCompanyInfo(e){const t=h.tM.post(this._url,"/grammarly-pro/set-company-info").formParam("companyInfo",e);return this._ajax.empty(t)}getProCompanyInfo(){const e=h.tM.get(this._url,"/grammarly-pro/company-info");return this._ajax.json(e)}subscribeNewInstitution(e){return this._subscribeNewInstitutionInternal(e)}sendInvoice(e){return this._subscribeNewInstitutionInternal({...e,stripeInvoice:!0})}subscribeNewInstitutionForNgo(e){return this._subscribeNewInstitutionInternal(e)}subscribeNewInstitutionUsingIndividualPremium(e){return this._subscribeNewInstitutionInternal(e)}isEligibleForBusinessTrial(){const e=h.tM.get(this._url,"/is-eligible-for-business-trial");return this._ajax.json(e)}getInstitutionPlans(){const e=h.tM.get(this._url,"/get-institution-plans");return this._ajax.json(e)}getInstitutionPlansForNgo(){const e=h.tM.get(this._url,"/get-institution-plans-for-ngo");return this._ajax.json(e)}isVoucherValid(e){const t=h.tM.get(this._url,"/voucher",e,"valid");return this._ajax.empty(t)}applyVoucher(e){const t=h.tM.post(this._url,"/voucher",e,"apply");return this._ajax.empty(t)}getPaymentHistory(){const e=h.tM.get(this._url,"/payment-history");return this._ajax.json(e)}updateInstitutionSeats({numberOfSeats:e}){const t=h.tM.post(this._url,"/set-number-of-seats").formParam("numberOfSeats",e.toString());return this._ajax.empty(t)}updateInstitutionPlan({numberOfSeats:e,plan:t}){const n=h.tM.post(this._url,"/change-institution-subscription");return e&&n.formParam("numberOfSeats",e.toString()),t&&n.formParam("plan",t.toString()),this._ajax.empty(n)}getAdjustedVolumePricing(e){const t=h.tM.get(this._url,"/volume-adjust-pricing").pathParam(e.toString());return this._ajax.json(t)}getInstitutionAdjustedPricing(e,t){const n=h.tM.get(this._url,"/institution-subscription-adjust-pricing").queryParam("numberOfSeats",e.toString()).queryParam("plan",t.toString());return this._ajax.json(n)}isPaymentMethodExpired(){const e=h.tM.get(this._url,"/isPaymentMethodExpired");return this._ajax.json(e)}getIndividualPaymentHistory(){const e=h.tM.get(this._url,"/individual/payment-history");return this._ajax.json(e)}getProPaymentHistory(){const e=h.tM.get(this._url,"/grammarly-pro/payment-history");return this._ajax.json(e)}requestRefund(){const e=h.tM.post(this._url,"/individual-subscription/refund");return this._ajax.empty(e)}requestFrozenProSubscriptionRefund(){const e=h.tM.post(this._url,"subscriptions/frozen/grammarly-pro/refund");return this._ajax.empty(e)}validateUSZipCode(e){const t=h.tM.post(this._url,"/zip-code/validate").json({zipCode:e});return this._ajax.json(t)}sendInvoiceDraft(e){const t=h.tM.post(this._url,"/submit-draft-invoice");return Object.entries(e).forEach((([e,n])=>t.formParam(e,n))),this._ajax.empty(t)}getInvoiceDraft(){const e=h.tM.get(this._url,"/get-draft-invoice");return this._ajax.json(e)}voidDraftInvoice(){const e=h.tM.post(this._url,"void-unpaid-invoice");return this._ajax.empty(e)}getCountriesConfiguration(){const e=h.tM.get(this._url,"/country-config");return this._ajax.json(e)}getTaxInformation(e,t,{billingPostalCode:n,billingRegionCode:r,numberOfSeats:i}={}){const o=h.tM.get(this._url,"/tax-info").queryParam("planId",e.toString()).queryParam("billingCountryCode",t);return n&&o.queryParam("billingZip",n),r&&o.queryParam("billingRegionCode",r),i&&o.queryParam("numberOfSeats",i.toString()),this._ajax.json(o)}getOrderStatus(e){const t=h.tM.get(this._url,`/order/${e}`);return this._ajax.json(t)}getReferralInfo(){const e=h.tM.post(this._url,"/referrals/info");return this._ajax.json(e)}createOrder(e,t,n,r){const i=h.tM.post(this._url,"/order/individual").formParam("planId",e.toString()).formParam("billingCountryCode",t);return void 0!==n&&i.formParam("billingZip",n),void 0!==r&&i.formParam("billingRegionCode",r),this._ajax.json(i)}createInstitutionalOrder({planId:e,volume:t,institutionName:n,countryCode:r,postalCode:i,regionCode:o}){const s=h.tM.post(this._url,"/order").formParam("planId",e.toString()).formParam("volume",t.toString()).formParam("institutionName",n).formParam("billingCountryCode",r);return void 0!==i&&s.formParam("billingZip",i),void 0!==o&&s.formParam("billingRegionCode",o),this._ajax.json(s)}updatePaymentMethod(e,t,n){const r=h.tM.post(this._url,"/setup/payment-methods").json({billingCountry:e,billingPostalCode:t,billingRegion:n});return this._ajax.json(r)}getPaymentMethodUpdateStatus(e){const t=h.tM.get(this._url,`/setup/update/payment-methods/${e}`);return this._ajax.json(t)}_subscribeNewInstitutionInternal(e){const t=h.tM.post(this._url,"/subscribe-new-institution").formParam("institutionName",e.institutionName).formParam("numberOfSeats",e.numberOfSeats.toString());return"sessionId"in e&&e.sessionId&&t.formParam("sessionId",e.sessionId),"billingCountryCode"in e&&e.billingCountryCode&&t.formParam("billingCountryCode",e.billingCountryCode),"billingRegionCode"in e&&e.billingRegionCode&&t.formParam("billingRegionCode",e.billingRegionCode),"billingZip"in e&&e.billingZip&&t.formParam("billingZip",e.billingZip),"nonce"in e&&e.nonce&&t.formParam("nonce",e.nonce),e.planId&&t.formParam("planId",e.planId.toString()),"voxEnabled"in e&&e.voxEnabled&&t.formParam("voxEnabled",e.voxEnabled.toString()),"stripeInvoice"in e&&e.stripeInvoice&&t.formParam("stripeInvoice",e.stripeInvoice.toString()),"brandTonesEnabled"in e&&e.brandTonesEnabled&&t.formParam("brandTonesEnabled",e.brandTonesEnabled.toString()),"specialOfferName"in e&&e.specialOfferName&&t.formParam("specialOfferName",e.specialOfferName.toString()),this._ajax.json(t)}};S.targetTag="subscription";let k=S;p.eo},37578:(e,t,n)=>{n.d(t,{j:()=>w});const r=/%([0-9A-Fa-f]{2})/g,i=/[^\x20-\x7e\xa0-\xff]/g,o=/\\([\u0000-\u007f])/g,s=/;[\x09\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*=[\x09\x20]*("(?:[\x20!\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*/g,a=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/,c=/^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*(?:$|;)/,u=e=>String(e).replace(i,"?");class l{constructor(e,t){this.type=e,this.parameters=t}}const p=(e,t)=>String.fromCharCode(parseInt(t,16));function h(e){const t=a.exec(e);if(!t)throw new TypeError("invalid extended field value");const n=t[1].toLowerCase(),i=t[2];let o;switch(n){case"iso-8859-1":o=u(i.replace(r,p));break;case"utf-8":try{o=decodeURIComponent(i)}catch(e){throw new TypeError("invalid encoded utf-8")}break;default:throw new TypeError("unsupported charset in extended field")}return o}function f(e){let t=c.exec(e);if(!t)throw new TypeError("invalid type format");let n=t[0].length;const r=t[1].toLowerCase();let i;const a=[],u={};let p;for(n=s.lastIndex=";"===t[0].slice(-1)?n-1:n;t=s.exec(e);){if(t.index!==n)throw new TypeError("invalid parameter format");if(n+=t[0].length,i=t[1].toLowerCase(),p=t[2],-1!==a.indexOf(i))throw new TypeError("invalid duplicate parameter");a.push(i),i.indexOf("*")+1!==i.length?"string"!=typeof u[i]&&('"'===p[0]&&(p=p.slice(1,p.length-1).replace(o,"$1")),u[i]=p):(i=i.slice(0,-1),p=h(p),u[i]=p)}if(-1!==n&&n!==e.length)throw new TypeError("invalid parameter format");return new l(r,u)}var d=n(46238),m=n(84647),_=n(69779),g=n(60608),y=n(94855),v=n(58193),b=n(91817),T=n(22835),x={URI:"Promise",map:function(e,t){return e.then(t)},of:Promise.resolve.bind(Promise),ap:function(e,t){return Promise.all([e,t]).then((function(e){var t=(0,b._)(e,2);return(0,t[0])(t[1])}))},chain:function(e,t){return e.then(t)},mapLeft:function(e,t){return e.catch((function(e){return Promise.reject(t(e))}))},bimap:function(e,t,n){return e.then(n,(function(e){return Promise.reject(t(e))}))},throwError:function(e){return Promise.reject(e)}};function E(e){return function(t){return t.catch(e)}}var w,I=T.h1(x,{ap:function(e,t){return e.then((function(e){return t.then(e)}))}}),P=(0,_.pipeable)(x),C=(P.ap,P.apFirst,P.apSecond,P.chain,P.chainFirst,P.map,n(77396)),j=n(66202),O=n(36840),S=n(11550),k=n(32955);(e=>{let t,n,r;var i;let o;e.create=function(e){return(0,_.pipe)(e,t.fromFetch,n.fromExecutor,g.Tj(r.forPromise))},e.createTE=function(e){return(0,_.pipe)(e,t.fromFetch,n.fromExecutor,g.Tj(r.forTaskEither))},(t||(t={})).fromFetch=e=>(t,n,r)=>i=>{return(0,_.pipe)(y.TX((()=>e(i.url,{body:v.y0(i.body),method:i.method,headers:i.headers,keepalive:i.keepalive,mode:t,credentials:n})),s("request failed on client side")),y.cy((o=i,a=r,e=>e.ok?y.pG(e):(0,_.pipe)((()=>e.text()),y.rT,y.qE((t=>a(t,e,o)))))));var o,a},(n||(n={})).fromExecutor=function(e){return g.zW((({credentials:t="include",errorMapper:n=S.dj.mapToHTTPError,requestExtender:r=S.tM.Extender.identity})=>i=>o=>(0,_.pipe)(i,S.tM.Extender.compose(r,o),d.map((e=>e.build())),y.M1,y.cy(e("cors",t,n)))))},(i=r||(r={})).forTaskEither=g.zW((e=>({...(0,_.pipeable)(y.bP),of:y.bP.of,throwError:y.bP.throwError,ApplicativePar:y.bP,ApplicativeSeq:y.yE,orElse:y.NW,retry:c,...o.forTaskEither(e)}))),i.forPromise=g.zW((e=>{const t=o.forTaskEither(e);return{...(0,_.pipeable)(x),of:x.of,throwError:x.throwError,ApplicativePar:x,ApplicativeSeq:I,orElse:E,retry:a,json:(0,m.flow)(t.json,C.hq),file:(0,m.flow)(t.file,C.hq),text:(0,m.flow)(t.text,C.hq),empty:(0,m.flow)(t.empty,C.hq),jsonWithHeaders:(0,m.flow)(t.jsonWithHeaders,C.hq),fileWithHeaders:(0,m.flow)(t.fileWithHeaders,C.hq),textWithHeaders:(0,m.flow)(t.textWithHeaders,C.hq),headers:(0,m.flow)(t.headers,C.hq)}})),(e=>{e.forTaskEither=function(e){function t(t,i){return(0,_.pipe)(t,e,n(S.dj.MimeType.json),r((e=>e.json())),C.h8(i?e=>(0,_.pipe)(i.decode(e.result),j.bimap((e=>new S.dj.ParseError("json parse error",e)),(t=>({headers:e.headers,result:t})))):j.right))}function i(t){return(0,_.pipe)(t,e,n(S.dj.MimeType.txt,S.dj.MimeType.stream,S.dj.MimeType.vnd,S.dj.MimeType.pdf,S.dj.MimeType.json,S.dj.MimeType.zip),r((e=>e.blob())),y.Tj((({headers:e,result:t})=>({headers:e,result:{title:f(e.get("Content-Disposition")||"downloadedDocument").parameters.filename,data:t}}))))}function o(t){return(0,_.pipe)(t,e,n(S.dj.MimeType.any),r((e=>e.text())))}function s(t){return(0,_.pipe)(t,e,n(S.dj.MimeType.any),y.Tj((e=>({headers:e.headers}))))}return{json:function(e,n){return(0,_.pipe)(t(e,n),y.Tj((({result:e})=>e)))},file:function(e){return(0,_.pipe)(e,i,y.Tj((({result:e})=>e)))},text:function(e){return(0,_.pipe)(e,o,y.Tj((({result:e})=>e)))},empty:function(e){return(0,_.pipe)(e,s,y.Tj(O.Yi))},jsonWithHeaders:t,fileWithHeaders:i,textWithHeaders:o,headers:s}};const t=e=>e.headers.get("Content-Type")||e.headers.get("content-type");function n(...e){const n=("Accept",r=e.join(","),e=>d.task.of(e.header("Accept",r)));var r;return r=>(0,_.pipe)(r(n),y.cy(function(...e){return y.aN((n=>{if(201===n.status||204===n.status)return!0;{const r=t(n)||S.dj.MimeType.any;return Boolean(r)&&e.some((e=>e===S.dj.MimeType.any||r.indexOf(e)>-1))}}),(n=>new S.Hl({code:-1,message:"Unexpected Content-Type",status:`Expected: ${e.join()}\nActual: ${t(n)}`})))}(...e)))}function r(e){return y.cy((t=>y.TX((()=>e(t).then((e=>({result:e,headers:t.headers})))),s("client parse error"))))}})(o||(o={}));const s=e=>t=>{if("string"==typeof t)return new S.GI(e,t);if(t instanceof Error||null!=(n=t).name||null!=n.code)return S.GI.fromError(e,t);{let n="";try{n=JSON.stringify(t)}catch(e){n=String(t)}return new S.GI(e,`unexpected result: ${n}`)}var n};function a(...e){return t=>(0,_.pipe)(y.TX(t,m.identity),(0,k.L5)(e),C.hq)}function c(...e){return t=>(0,_.pipe)(t(),(0,k.L5)(e))}})(w||(w={}))},16683:(e,t,n)=>{var r;n.d(t,{K:()=>r}),(r||(r={})).Base=class{}},32955:(e,t,n)=>{n.d(t,{L5:()=>f,Xb:()=>h});var r=n(53397),i=n(69779),o=n(58508),s=n(72804),a=n(86562),c=n(65390),u=n(94855),l=n(66202),p=n(60575);a.eo,a.eo,a.eo;class h extends a.eo{constructor(e){super(e||"Not Connected to WS"),this.name="NotConnectedError"}static isNotConnectedError(e){return e instanceof h}}function f(e,t=(()=>!0)){const n=r.fold(o.$H)(e);let a;return e=>(0,s.retrying)(n,(t=>(0,i.pipe)(t.previousDelay,c.fold((()=>e),(n=>(0,i.pipe)(d(t.iterNumber,n),u.g$(e),u.qE((e=>{var n;return null!==(n=e)&&"object"==typeof n&&"stack"in n&&void 0!==n.stack&&(1===t.iterNumber?a=e.stack:void 0!==a&&(e.stack=a)),e}))))))),(e=>l.isLeft(e)&&t(e.left)))}a.eo;const d=(e,t)=>u.BK((()=>p.Bx.Logging.root.getLogger("coreclients.utils").trace(`retryWithDelay: count ${e}, timeout: ${t}`)))},88661:(e,t,n)=>{n.d(t,{dN:()=>D});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o,s,a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)};function c(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.HTTP_EXCEPTION=1]="HTTP_EXCEPTION",e[e.INVALID_STATE=2]="INVALID_STATE",e[e.LOCK_TIMEOUT=3]="LOCK_TIMEOUT",e[e.STORAGE_CACHE_SET_ERROR=4]="STORAGE_CACHE_SET_ERROR",e[e.STORAGE_CACHE_REMOVE_ERROR=5]="STORAGE_CACHE_REMOVE_ERROR"}(s||(s={}));var l,p=((o={})[s.UNKNOWN]="Unknown error",o[s.HTTP_EXCEPTION]="HTTP Exception",o[s.INVALID_STATE]="Invalid State",o[s.LOCK_TIMEOUT]="Lock Timeout",o[s.STORAGE_CACHE_SET_ERROR]="Error storing tokens",o[s.STORAGE_CACHE_REMOVE_ERROR]="Error removing tokens",o),h=function(e){function t(n,r){void 0===n&&(n=s.UNKNOWN),void 0===r&&(r=p[n]);var i=e.call(this,r)||this;return i.code=n,Object.setPrototypeOf(i,t.prototype),i}return i(t,e),t.codes=s,t}(Error);!function(e){e.INVALID_AUTHORIZATION_CODE="Invalid authorization code",e.INVALID_CLIENT_TYPE="Invalid client type",e.INVALID_CODE_VERIFIER="Invalid code verifier",e.INVALID_ORIGIN="Invalid origin",e.INVALID_PUBLIC_KEY="Invalid public key",e.INVALID_REDIRECT_URI="Invalid redirect uri",e.INVALID_SCOPE="Invalid scope",e.INVALID_GRANT_TYPE="Invalid grant type",e.INVALID_REFRESH_TOKEN="Invalid refresh token",e.ACCESS_DENIED="Access is denied",e.INVALID_CLIENT="Invalid client",e.REVOKE_ERROR="Revoke error",e.NOT_ENABLED="Oauth not enabled",e.NOT_IMPLEMENTED="Not implemented"}(l||(l={}));var f,d,m=function(e){function t(n,r,i){void 0===r&&(r="unknown");var o=e.call(this,h.codes.HTTP_EXCEPTION,i)||this;return o.serverCode=r,o.response=n,Object.setPrototypeOf(o,t.prototype),o}return i(t,e),Object.defineProperty(t.prototype,"status",{get:function(){return this.response.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statusText",{get:function(){return this.response.statusText},enumerable:!1,configurable:!0}),t}(h),_="grammarly.lock.getAccessToken";function g(e,t){return void 0===t&&(t=3),c(this,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:n=0,r.label=1;case 1:return n<t?[4,e()]:[3,4];case 2:if(r.sent())return[2,!0];r.label=3;case 3:return n++,[3,1];case 4:return[2,!1]}}))}))}function y(e){return void 0===e&&(e=0),c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:return t.sent(),[2]}}))}))}function v(e){var t=Math.floor(100*Math.pow(2,e));return Math.floor(Math.random()*(t-100+1))+100}function b(e){return c(this,void 0,void 0,(function(){var t,n,r,i,o,s,l,p,h=this;return u(this,(function(f){switch(f.label){case 0:t=a({backoffFn:function(e){var t=e.tryNo;return c(h,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,y(Math.round(v(t)))];case 1:return e.sent(),[2]}}))}))},maxRetries:10},e),n=0,r=!1,i=null,o=null,s=Date.now(),l=function(){r=!0},f.label=1;case 1:if(!(n<=t.maxRetries))return[3,8];f.label=2;case 2:return f.trys.push([2,4,,7]),[4,t.fn({tryNo:n,startedAt:s,abort:l})];case 3:return[2,{result:o=f.sent(),error:null}];case 4:return p=f.sent(),i=p,++n,r?[3,8]:n<=t.maxRetries?[4,t.backoffFn({tryNo:n,startedAt:s,abort:l})]:[3,6];case 5:f.sent(),f.label=6;case 6:return[3,7];case 7:return[3,1];case 8:return[2,{error:i,result:o}]}}))}))}function T(e){return c(this,void 0,void 0,(function(){var t=this;return u(this,(function(n){switch(n.label){case 0:return[4,b({maxRetries:1,fn:function(n){return c(t,void 0,void 0,(function(){var t;return u(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e(n)];case 1:return[2,r.sent()];case 2:throw(t=r.sent())instanceof m&&(i=t.status)>=f.BAD_REQUEST&&i<f.INTERNAL_SERVER_ERROR&&t.status!==f.TOO_MANY_REQUESTS&&n.abort(),t;case 3:return[2]}var i}))}))}})];case 1:return[2,n.sent()]}}))}))}!function(e){e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR"}(f||(f={})),function(e){e.APPLICATION_JSON="application/json"}(d||(d={}));var x=function(){function e(e,t){this._fetch=e,this._config=t}return e.prototype.get=function(e){return c(this,void 0,void 0,(function(){var t,n,r,i,o,s=this;return u(this,(function(a){switch(a.label){case 0:return[4,this._getHeaders()];case 1:return t=a.sent(),n=function(){return c(s,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:return[4,this._fetchWithTimeout(e,{credentials:"include",mode:"cors",headers:t})];case 1:return n=r.sent(),[2,this._parseResponse(e,n)]}}))}))},[4,T(n)];case 2:if(r=a.sent(),i=r.result,o=r.error,null!=i)return[2,i];if(null!=o)throw o;throw new Error("Unexpected HttpClient error")}}))}))},e.prototype.post=function(e,t){return c(this,void 0,void 0,(function(){var n,r,i,o,s,l=this;return u(this,(function(p){switch(p.label){case 0:return[4,this._getHeaders()];case 1:return n=p.sent(),r=function(){return c(l,void 0,void 0,(function(){var r;return u(this,(function(i){switch(i.label){case 0:return[4,this._fetchWithTimeout(e,{method:"post",credentials:"include",mode:"cors",headers:a(a({},n),{"Content-Type":d.APPLICATION_JSON}),body:JSON.stringify(t)})];case 1:return r=i.sent(),[2,this._parseResponse(e,r)]}}))}))},[4,T(r)];case 2:if(i=p.sent(),o=i.result,s=i.error,null!=o)return[2,o];if(null!=s)throw s;throw new Error("Unexpected HttpClient error")}}))}))},e.prototype._fetchWithTimeout=function(e,t){return void 0===t&&(t={}),c(this,void 0,void 0,(function(){var n,r=this;return u(this,(function(i){return n=this._fetch(e,t),this._config.timeout?[2,Promise.race([n,new Promise((function(e,t){return setTimeout((function(){return t(new Error("Fetch Timeout"))}),r._config.timeout)}))])]:[2,n]}))}))},e.prototype._getHeaders=function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return this._config.applicationHeaders?[2,this._config.applicationHeaders]:this._config.getApplicationHeaders?[4,this._config.getApplicationHeaders()]:[3,2];case 1:return[2,e.sent()];case 2:throw new Error("Cannot get application headers")}}))}))},e.prototype._parseResponse=function(e,t){return c(this,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:if(t.status>=f.INTERNAL_SERVER_ERROR)throw new m(t,"unknown","HTTP server error ".concat(t.status,". Unable to fetch ").concat(e));return[4,t.clone().json().catch((function(e){return{error:"unknown",message:e.message}}))];case 1:if(n=i.sent(),r=n.message||"HTTP error. Unable to fetch ".concat(e),!t.ok)throw new m(t,n.error,r);return[4,t.json()];case 2:return[2,i.sent()]}}))}))},e}(),E=function(){function e(e,t,n){this._tokensUrl=e,this._httpClient=new x(t,n)}return e.prototype.getTokens=function(e){return this._httpClient.post(this._tokensUrl+"/oauth2/token",e)},e.prototype.exchangeTokens=function(e){return this._httpClient.post(this._tokensUrl+"/oauth2/exchange",e)},e}();function w(e){var t=e.tokensClient,n=e.clientId,r=e.grantType,i=e.codeVerifier,o=e.authorizationCode,s=e.refreshToken;return c(this,void 0,void 0,(function(){var e;return u(this,(function(c){switch(e={client_id:n,grant_type:r},r){case"refresh_token":e=a(a({},e),{refresh_token:s});break;case"authorization_code":e=a(a({},e),{code_verifier:i,authorization_code:o});break;case"urn:ietf:params:oauth:grant-type:token-exchange":return e=a(a({},e),{subject_token_type:"urn:grammarly:params:oauth:token-type:grauth"}),[2,t.exchangeTokens(e)]}return[2,t.getTokens(e)]}))}))}function I(e){if(e&&e.expires_at&&e.access_token&&e.refresh_token){var t=(new Date).getTime();return e.expires_at-t<=0?null:e}return null}function P(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function C(e){return void 0===e&&(e=0),c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:return t.sent(),[2]}}))}))}var j=P();function O(e){return"".concat(j,":").concat(e,":").concat(Math.floor(1e6*(1+Math.random())))}function S(){return Math.floor(1+9*Math.random())}function k(e,t,n,r,i){return c(this,void 0,void 0,(function(){function o(t){return c(this,void 0,void 0,(function(){var n,i;return u(this,(function(o){switch(o.label){case 0:return[4,e.getItem(t)];case 1:return null==(n=o.sent())?[2,!1]:n===f?[2,!0]:(i=parseInt(String(n.split(":")[1]),10),[2,!Number.isFinite(i)||i+r<Date.now()])}}))}))}function s(){return c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,o(l)];case 1:return t.sent()?[4,e.removeItem(l)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[4,o(p)];case 4:return t.sent()?[4,e.removeItem(p)]:[3,6];case 5:t.sent(),t.label=6;case 6:return[2]}}))}))}var a,l,p,f,d;return u(this,(function(r){switch(r.label){case 0:a=Date.now(),l="".concat(t,"__$$MUTEX_x"),p="".concat(t,"__$$MUTEX_y"),f=O(a),r.label=1;case 1:return[4,s()];case 2:if(r.sent(),Date.now()-a>n)throw new h(h.codes.LOCK_TIMEOUT,'"Mutex on '.concat(t," was not achieved in ").concat(n,"ms"));return[4,e.getItem(l)];case 3:return null==r.sent()?[3,5]:[4,C(S())];case 4:return r.sent(),[3,1];case 5:return[4,e.setItem(l,f)];case 6:return r.sent(),[4,e.getItem(p)];case 7:return null==r.sent()?[3,9]:[4,C(S())];case 8:return r.sent(),[3,1];case 9:return[4,e.setItem(p,f)];case 10:return r.sent(),[4,C(S())];case 11:return r.sent(),[4,e.getItem(l)];case 12:return r.sent()===f?[3,17]:[4,C(S())];case 13:return r.sent(),[4,e.getItem(p)];case 14:return r.sent()===f?[3,16]:[4,C(S())];case 15:r.sent(),r.label=16;case 16:return[3,1];case 17:return r.trys.push([17,,21,24]),d=O(Date.now()),[4,e.setItem(l,d)];case 18:return r.sent(),[4,e.setItem(p,d)];case 19:return r.sent(),[4,i()];case 20:return r.sent(),[3,24];case 21:return[4,e.removeItem(l)];case 22:return r.sent(),[4,e.removeItem(p)];case 23:return r.sent(),[7];case 24:return[3,25];case 25:return[2]}}))}))}var N,M=function(){function e(e){this.locks=new Map,this.storage=e}return e.prototype.acquireLock=function(e){return c(this,void 0,void 0,(function(){var t=this;return u(this,(function(n){return[2,new Promise((function(n){return c(t,void 0,void 0,(function(){var t=this;return u(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,k(this.storage,e,6e4,5e3,(function(){return c(t,void 0,void 0,(function(){var t=this;return u(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r){t.locks.set(e,r),n(!0)}))];case 1:return r.sent(),[2]}}))}))}))];case 1:return r.sent(),[3,3];case 2:return r.sent(),n(!1),[3,3];case 3:return[2]}}))}))}))]}))}))},e.prototype.releaseLock=function(e){return c(this,void 0,void 0,(function(){var t;return u(this,(function(n){return null!=(t=this.locks.get(e))&&t(),this.locks.delete(e),[2]}))}))},e}(),R=function(){function e(e,t){this._storage=e,this._storageKey=t}return e.prototype.set=function(e){return c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._storage.setItem(this._storageKey,JSON.stringify(e))];case 1:return t.sent(),[2,e];case 2:throw t.sent(),new h(s.STORAGE_CACHE_SET_ERROR);case 3:return[2]}}))}))},e.prototype.get=function(){return c(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._storage.getItem(this._storageKey)];case 1:return[2,(e=t.sent())?JSON.parse(e):null];case 2:return t.sent(),[2,null];case 3:return[2]}}))}))},e.prototype.remove=function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._storage.removeItem(this._storageKey)];case 1:return e.sent(),[3,3];case 2:throw e.sent(),new h(s.STORAGE_CACHE_REMOVE_ERROR);case 3:return[2]}}))}))},e}(),A=function(){function e(){this.cache=new Map}return Object.defineProperty(e.prototype,"length",{get:function(){return this.cache.size},enumerable:!1,configurable:!0}),e.prototype.getItem=function(e){return this.cache.has(e)?this.cache.get(e):null},e.prototype.setItem=function(e,t){this.cache.set(e,String(t))},e.prototype.removeItem=function(e){this.cache.delete(e)},e.prototype.key=function(e){return function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([],function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}(this.cache.keys()),!1)[e]||null},e.prototype.clear=function(){this.cache=new Map},e}(),L=function(){function e(e){var t;this._promiseMap=new Map,this._clientId=e.clientId,this._anonymousTokenClientType=e.anonymousTokenClientType,this._redirectUri=e.redirectUri,this._domain=(t=e.domain,/^https?:\/\//.test(t)?t:"https://".concat(t)),this._tokensClient=new E(this._domain,e.fetch,e.httpClientOptions),this._storageKey=e.storageKey||"grammarly.".concat(this._clientId,".tokens"),this._storage=e.storage||new A,this._lock=e.lock||new M(this._storage),this._cache=new R(this._storage,this._storageKey),this._tracking=e.tracking}return e.prototype._exchangeToken=function(e){var t=this,n=e.orAnonymous;return function(e){return w({tokensClient:e.tokensClient,clientId:e.clientId,grantType:"urn:ietf:params:oauth:grant-type:token-exchange"})}({tokensClient:this._tokensClient,clientId:this._clientId}).catch((function(e){if(!(e instanceof m))throw e;if(n&&e.status===f.UNAUTHORIZED)return function(e){var t=e.tokensClient,n=e.clientId,r=e.clientType;return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,w({tokensClient:t,clientId:n,grantType:"Web"===r?"urn:ietf:params:oauth:grant-type:origin":"urn:ietf:params:oauth:grant-type:client_id"})];case 1:return[2,e.sent()]}}))}))}({tokensClient:t._tokensClient,clientId:t._clientId,clientType:t._anonymousTokenClientType});throw e}))},e.prototype._refresh=function(e,t){var n=this;return function(e){var t=e.tokensClient,n=e.clientId,r=e.refreshToken;return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,w({tokensClient:t,clientId:n,grantType:"refresh_token",refreshToken:r})];case 1:return[2,e.sent()]}}))}))}({tokensClient:this._tokensClient,clientId:this._clientId,refreshToken:e}).catch((function(e){if(e instanceof m&&e.status===f.UNAUTHORIZED)return n._exchangeToken(t);throw e}))},e.prototype._getAccessToken=function(e){var t,n,r,i,o;return c(this,void 0,void 0,(function(){var a,c,l,p,f,d,m=this;return u(this,(function(u){switch(u.label){case 0:return u.trys.push([0,16,,17]),(a=e.ignoreCache)?[3,2]:(c=I,[4,this._cache.get()]);case 1:if(p=c.apply(void 0,[u.sent()]))return[2,p.access_token];u.label=2;case 2:return[4,g((function(){return m._lock.acquireLock(_,5e3)}),10)];case 3:if(!u.sent())return[3,14];u.label=4;case 4:return u.trys.push([4,,11,13]),[4,this._cache.get()];case 5:return l=u.sent(),!a&&(p=I(l))?[2,p.access_token]:(f=void 0,!a&&l&&l.refresh_token?[3,7]:(null===(t=this._tracking)||void 0===t||t.getTokensAttemptWithoutRefreshToken(),[4,this._exchangeToken(e)]));case 6:return f=u.sent(),[3,9];case 7:return null===(n=this._tracking)||void 0===n||n.getTokensAttemptWithRefreshToken(),[4,this._refresh(l.refresh_token,e)];case 8:f=u.sent(),u.label=9;case 9:return null===(r=this._tracking)||void 0===r||r.getTokensSuccess(),[4,this._cache.set((y=f,{expires_at:(new Date).getTime()+1e3*y.expires_in,access_token:y.access_token,refresh_token:y.refresh_token,refresh_token_expires_at:(new Date).getTime()+1e3*y.refresh_token_expires_in}))];case 10:return[2,u.sent().access_token];case 11:return[4,this._lock.releaseLock(_)];case 12:return u.sent(),[7];case 13:return[3,15];case 14:throw null===(i=this._tracking)||void 0===i||i.lockTimeout(),new h(s.LOCK_TIMEOUT);case 15:return[3,17];case 16:throw d=u.sent(),null===(o=this._tracking)||void 0===o||o.getTokensFailure(d),d;case 17:return[2]}var y}))}))},e.prototype.getAccessToken=function(e){var t=this;void 0===e&&(e={orAnonymous:!1,ignoreCache:!1});var n="".concat(e.orAnonymous,"::").concat(e.ignoreCache),r=this._promiseMap.get(n);return r||(r=this._getAccessToken(e).finally((function(){t._promiseMap.delete(n),r=void 0})),this._promiseMap.set(n,r)),r},e.prototype.logout=function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this._cache.remove()];case 1:return e.sent(),[2]}}))}))},e}(),D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(L);i((function(){return null!==N&&N.apply(this,arguments)||this}),N=L),function(e){i((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(L)}}]);