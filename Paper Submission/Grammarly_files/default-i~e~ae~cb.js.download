"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[9098],{34681:(e,t,i)=>{i.d(t,{n:()=>h,r:()=>p});var s=i(83531),n=i(23988),r=i(65011),o=i(84647),a=i(80172),d=i(60575),l=i(38886),u=i(93712);class h{get withoutAccessToken(){return{csrfToken:this.csrfToken,containerId:this.containerId,clientName:this.clientName,clientVersion:this.clientVersion}}constructor(e,t,i,r){(0,n._)(this,"_gnarClient",void 0),(0,n._)(this,"_config",void 0),(0,n._)(this,"_env",void 0),(0,n._)(this,"_getAccessToken",void 0),(0,n._)(this,"_cookieStorage",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"csrfToken",void 0),(0,n._)(this,"containerId",void 0),(0,n._)(this,"clientName",void 0),(0,n._)(this,"clientVersion",void 0),(0,n._)(this,"accessToken",void 0),this._gnarClient=e,this._config=t,this._env=i,this._getAccessToken=r,this._cookieStorage=new a.W6(this._config.domains.cookie),this._log=d.Bx.Logging.root.getLogger("base.fingerprints"),this.csrfToken=()=>this._cookieStorage.safeGetValue("csrf-token").then((e=>(Boolean(e)||this._log.warn("Missing CSRF token: token is empty"),e))).catch((e=>{throw this._log.warn("Missing CSRF token: error",e),e})),this.containerId=this._gnarClient.getContainerId(),this.clientName=this._env.names.auth,this.clientVersion=this._env.buildVersion;var o,l=this;this.accessToken=(o=this._env.platform)===u.OH.Platform.MACEDITOR||o===u.OH.Platform.IPAD||o===u.OH.Platform.WEB?void 0:(0,s._)((function*(){try{return yield l._getAccessToken(l.withoutAccessToken)}catch(e){return}}))}}const c=(0,o.flow)(l.yU(["X-CSRF-Token","X-Container-Id","X-Client-Version","X-Client-Type","Authorization"]),l.pb((e=>void 0!==e[0])),l.Tj(r.wg),l.TS({},((e,[t,i])=>(e[t]=i,e))));function p(e){return()=>Promise.all([e.csrfToken(),e.containerId.catch(o.constUndefined),e.clientVersion.toString(),e.clientName,Promise.resolve("function"==typeof e.accessToken?e.accessToken():e.accessToken).then((e=>void 0===e?e:`Bearer ${e}`))]).then(c)}},98969:(e,t,i)=>{i.d(t,{b:()=>s});var s,n=i(65390),r=i(84647),o=i(95934),a=i(90220),d=i(43922),l=i(22835);!function(e){var t;e.codec=o.YO(o.E$([o.NW({featureReference:a.Z.createStringEnum(d.t.Feature,"PassportFeature")}),o.OH({entitlement:o.OH({stringValue:o.Yj,numberValue:o.ai,boolValue:o.zM})})])),e.fromPassport=e=>{var i;return null!==(t=null===(i=e.passport.featureVisa)||void 0===i?void 0:i.map((({featureReference:e,entitlement:t})=>({featureReference:e,entitlement:t}))))&&void 0!==t?t:[]},e.has=e=>t=>t.some((({featureReference:t,entitlement:i})=>{var s,n,r;const o=Boolean(null===(s=i)||void 0===s?void 0:s.boolValue)||Boolean(null===(n=i)||void 0===n?void 0:n.stringValue)||Boolean(null===(r=i)||void 0===r?void 0:r.numberValue);return t===e&&o}));const i=(e,t)=>i=>(0,r.pipe)(i.find((({featureReference:t})=>t===e)),n.fromNullable,n.chain((0,r.flow)(l.Up("entitlement"),n.fromNullable)),n.chain((0,r.flow)(l.Up(t),n.fromNullable)));e.getString=e=>i(e,"stringValue"),e.getNumber=e=>i(e,"numberValue"),e.getBoolean=e=>i(e,"boolValue"),e.getBrandingSet=(0,r.unsafeCoerce)(s.getString(d.t.Feature.BrandingSet))}(s||(s={}))},92622:(e,t,i)=>{i.d(t,{gG:()=>n,j1:()=>r,kz:()=>S,ut:()=>s,x:()=>b});var s,n,r,o=i(84647),a=i(95934),d=i(90220),l=i(82293),u=i(30676),h=i(5692),c=i(65390),p=i(21538),_=i(40464),m=i(98969),g=i(37107);!function(e){e.free="free",e.premium="premium"}(s||(s={})),function(e){e.work="work",e.school="school",e.otherProjects="other projects"}(n||(n={})),function(e){e.student="student"}(r||(r={}));const f=a.NW({id:a.Yj,email:a.Yj,fullName:a.Yj}),v=a.E$([f,a.NW({institutionInfo:d.Z.option(l.KJ.InstitutionInfo.codec),confirmed:a.zM,anonymous:a.zM,type:d.Z.createStringEnum(s,"UserType"),role:d.Z.option(a.Yj),roles:a.YO(l.KJ.Role.codec),isTest:a.zM,canUseEditor:a.zM,groups:d.Z.set(a.Yj),loginType:d.Z.createStringEnum(l.Gb,"LoginType"),registrationDate:d.Z.option(d.Z.date()),editorFeatures:l.KJ.EditorFeatures.codec,isPaymentSandbox:a.zM}),a.OH({newEmail:a.Yj})]);var b,S;!function(e){var t=e.sharedCodec=a.NW({userProfile:v,subscription:h.j.valueCodec(_.E2,a.L5,a.L5),experiments:d.Z.set(a.Yj),entitlements:d.Z.option(m.b.codec)});e.codec=a.E$([t,a.NW({settings:g.tl.dapiPropsCodec})])}(b||(b={})),function(e){e.codec=d.Z.option(a.E$([p.O.codec,a.OH(u.k.ReadConfigIOType.props)]))}(S||(S={})),function(e){e.getDLPConfig=(0,o.flow)((e=>e.clientControls),c.map((e=>e.dlpConfiguration)))}(S||(S={}))},4155:(e,t,i)=>{i.d(t,{$t:()=>d,nS:()=>r.nS,ut:()=>o.ut,yD:()=>a});var s=i(23988),n=i(37107),r=i(40884),o=i(92622);const a={DESKTOP_APP_INSTALLED_MAC:"macExtension",DESKTOP_APP_INSTALLED_WINDOWS:"windowsExtension",MOBILE_INSTALLED:["keyboard-installed","mobile-app","mobile-android","mobile-ios"],FREEBIE_USER:"freebie",PREMIUM_CONVERSION:"premium-conversion",MOBILE_IOS_INSTALLED:"mobile-ios",MOBILE_ANDROID_INSTALLED:"mobile-android"};class d{constructor(e,t,i,r,o){(0,s._)(this,"_state",void 0),(0,s._)(this,"_save",void 0),(0,s._)(this,"_experimentClient",void 0),(0,s._)(this,"_router",void 0),(0,s._)(this,"_environment",void 0),(0,s._)(this,"profile",void 0),(0,s._)(this,"settings",void 0),(0,s._)(this,"entitlements",void 0),this._state=e,this._save=t,this._experimentClient=i,this._router=r,this._environment=o,this.profile=this._state.view("userProfile"),this.settings=new n.ZJ(this._state.lens("settings"),((e,t)=>this._save(e,t)),this._state.lens("userProfile").get().id),this.entitlements=this._state.view("entitlements")}}},39781:(e,t,i)=>{i.d(t,{ZP:()=>s,nS:()=>_.nS,Aj:()=>m,yD:()=>_.yD,ut:()=>_.ut});var s,n=i(23988),r=i(84647),o=i(80074),a=i(5692),d=i(95168),l=i(65390),u=i(94855),h=i(40884),c=i(37107),p=i(40464),_=i(4155);class m extends _.$t{constructor(e,t,i,s,o,c,_,m,g,f,v,b,S,y){super(e,((e,t)=>s.save(e,t)),o,_,g),(0,n._)(this,"_subscriptionApi",void 0),(0,n._)(this,"_authApi",void 0),(0,n._)(this,"_clientControls",void 0),(0,n._)(this,"_config",void 0),(0,n._)(this,"_platformEnvironment",void 0),(0,n._)(this,"_upgradeHook",void 0),(0,n._)(this,"_logoutRD",void 0),(0,n._)(this,"_vitoClient",void 0),(0,n._)(this,"_onLogout",void 0),(0,n._)(this,"logout",void 0),(0,n._)(this,"updateUserRole",void 0),(0,n._)(this,"updateUserNativeLanguage",void 0),(0,n._)(this,"getUserNativeLanguage",void 0),(0,n._)(this,"clientControls",void 0),(0,n._)(this,"subscription",void 0),(0,n._)(this,"features",void 0),this._subscriptionApi=t,this._authApi=i,this._clientControls=c,this._config=m,this._platformEnvironment=f,this._upgradeHook=v,this._logoutRD=b,this._vitoClient=S,this._onLogout=y,this.logout=this._logoutRD.pipe(d.M(this._onLogout)),this.updateUserRole=e=>a.j.modifyRemoteStateOptimistic(this._state.lens("userProfile","role"),(()=>l.some(e)),this._authApi.setUserData({role:e})),this.updateUserNativeLanguage=e=>this._authApi.setUserData({primaryLanguage:e}),this.getUserNativeLanguage=(0,r.pipe)(this._authApi.getUser(),u.Tj((e=>l.fromNullable(e.customFields.frontend_primaryLanguage)))),this.clientControls=this._clientControls,this.subscription=new p.H0(this._state.lens("subscription"),this._subscriptionApi,this._config,this._platformEnvironment,this._upgradeHook,this._state.lens("userProfile").view("isPaymentSandbox").get()),this.features=new h.nS(this._experimentClient,this._state.view("experiments"),l.some(this.subscription.state),this.profile,this.settings,this._clientControls,this._environment,this._router,l.some(this._vitoClient))}}!function(e){class t extends c.wq.Mock{constructor(...e){super(...e),(0,n._)(this,"dialect",o.s.create(l.some("american"))),(0,n._)(this,"dialectOrDefault",o.s.create("american")),(0,n._)(this,"setDialect",(()=>Promise.resolve("american"))),(0,n._)(this,"setDialectWeak",(()=>Promise.resolve("american")))}}e.Mock=class{constructor(){(0,n._)(this,"subscription",void 0),(0,n._)(this,"profile",o.s.create({id:"1",fullName:"test",email:"test@test.com"}).view()),(0,n._)(this,"features",new h.ZI.DenaliPageFeaturesMock(!1,new h.ZI.DenaliFeaturesMock)),(0,n._)(this,"settings",new t),(0,n._)(this,"entitlements",o.s.create(l.none)),(0,n._)(this,"getUserNativeLanguage",u.pG(l.none)),(0,n._)(this,"updateUserNativeLanguage",(()=>u.pG(void 0)))}}}(s||(s={}))},19160:(e,t,i)=>{i.d(t,{t2:()=>n,E4:()=>T,ki:()=>A,pq:()=>O,Gd:()=>M});var s,n,r=i(23988),o=i(10334),a=i(17171),d=i(69384),l=i(60251),u=i(80172),h=i(82293),c=i(37578),p=i(88661),_=i(60575),m=i(48581),g=i(36840),f=i(86562),v=i(60172),b=i(20739),S=i(74056),y=i(34681),w=i(60269),x=i(65141),k=i(62822),P=i(54988);class C{constructor(){(0,r._)(this,"generalActivity",w.h(x.R(window.document,"mousemove",{capture:!0,passive:!0}).pipe(k.u(void 0)),x.R(window.document,"wheel",{capture:!0,passive:!0}).pipe(k.u(void 0)),x.R(window.document,"keydown",{capture:!0,passive:!0}).pipe(k.u(void 0))))}}!function(e){e.Mock=class{constructor(){(0,r._)(this,"generalActivity",P.w)}}}(s||(s={})),function(e){e.create=({appState:e,env:t,platformEnv:i,config:s,router:n,telemetryPageContext:r,productMetricsClient:a,createGnarStorages:d=T})=>{const l=A(s,t,d),u=O(window.location.origin,s.api.tokensUrl),h=M(new y.n(l,s,t,(e=>u(e).getAccessToken({orAnonymous:!0}))),l,s,t,i,n,r,a);return t=>t((0,o._)({appState:e},h))}}(n||(n={}));class D{nextPingDateReadError(e){this._metric.getCounter("nextPingDate.read.failure").increment(),this._logger.warn("nextPingDate.read.failed",e)}nextPingDateWriteError(e){this._metric.getCounter("nextPingDate.write.failure").increment(),this._logger.warn("nextPingDate.write.failed",e)}sendError(){this._metric.getCounter("send.failure").increment()}trackBeforeSetUser(e){this._metric.getCounter("trackBeforeSetUser").increment(),this._logger.debug("trackBeforeSetUser",e)}constructor(e,t){(0,r._)(this,"_logger",void 0),(0,r._)(this,"_metric",void 0),this._logger=e,this._metric=t}}const E={ga:e=>(0,g.Yi)(),setUserId:e=>(0,g.Yi)(),getClientId:()=>Promise.resolve("disabled_GA")};function T(e){return{primaryStorage:new u.W6(e.domains.cookie),altStorages:[new u.DT,new u.XG]}}function A(e,t,i=T){if("disabled"!==e.tracking.state){const{primaryStorage:s,altStorages:n}=i(e);return function(e,t,i,s,n){const r=e.api.gnarApi.url,o=new u.q2(i,s,new u.Mj(_.Bx.Logging.root.getLogger("gnar.containerIdManager"),_.Bx.TimeSeries.rootFemetrics.getMetric("gnar.containerIdManager")));return new u.Ob(r,n.names.tracking,n.buildVersion.toString(),t,o,new D(_.Bx.Logging.root.getLogger("gnar"),_.Bx.TimeSeries.rootFemetrics.getMetric("gnar")),!1,E)}(e,m.pM.request({target:"gnar",cache:"default"}),s,n,t)}{const e=new u.Aj;return e.getContainerId=()=>Promise.resolve("dummyContainerId"),e}}const O=(e,t)=>(0,g.Bj)((i=>new p.dN({anonymousTokenClientType:"Web",clientId:i.clientName,redirectUri:e,domain:t,fetch:m.pM.request({target:"oauth",cache:"no-cache"}),httpClientOptions:{getApplicationHeaders:(0,y.r)(i)}})),((...e)=>{const[t]=e;return t.clientName}));function M(e,t,i,s,n,r,u,p){_.Bx.Logging.root.debug(`Constructing model for ${i.env} on the client`),t.getContainerId().then((e=>_.Bx.Logging.root.context.add({containerId:e}))).catch((e=>_.Bx.Logging.root.debug("cant get containerId",e)));const w=new C,x=function(e,t){switch(e){case S.OH.Platform.IPAD:return new b.BO(t);case S.OH.Platform.MACEDITOR:return new b.qb(t);case S.OH.Platform.WEB:return new b.vp(t);default:return(0,f.xb)(e)}}(s.platform,function(e){const t=_.Bx.Logging.root.getLogger("gnar.events");return(0,a._)((0,o._)({},e),{track:i=>{const{eventName:s}=i,n=(0,d._)(i,["eventName"]);return t.info(s,n),e.track(i).catch((e=>(t.error("Failed to track gnar event (modern)",{eventName:s,props:i,error:e}),Promise.resolve())))}})}(t)),k=new b.Y$(t,w,i.pingMaybeGnarDelay,s);(0,g.hJ)("getEnv",(()=>s));const P=s.has(S.OH.Flag.useForceNoCacheOption)?"no-cache":"default",D=[m.pM.request({target:"manakin",cache:P}),{getApplicationHeaders:(0,y.r)(e)},i.env===v.OH.fb||i.env===v.OH.dev?"prod":i.env];return{authApi:new h.Nj(i.api.authUrl,c.j.createTE(m.pM.request({target:h.Nj.targetTag,cache:P})),e.withoutAccessToken),treatmentService:new l.eb(...D),gateService:new l.mP(...D),telemetry:(0,a._)((0,o._)({gnarSpec:x},u),{bootstrap:k,getContainerId:t.getContainerId.bind(t)}),gnarClient:t,userActivity:w,env:s,platformEnv:n,router:r,config:i,fingerprints:e,cache:P,productMetricsClient:p}}},50794:(e,t,i)=>{i.d(t,{G:()=>r});var s=i(23988),n=i(14650);class r{getAppsItems(){return this._clientsState.supportedApps}onInstallClicked(e){this._handleInstallClick(e,"install")}onReInstallClicked(e){this._handleInstallClick(e,"reInstall")}onMoreClicked(e){this._telemetry.learnMoreClicked(this._appToTracking(e))}_handleInstallClick(e,t){n.X.App.isExtension(e)&&this._extension.install(),this._telemetry.installAppClicked(this._appToTracking(e),t)}_appToTracking(e){return e===n.X.App.extensionEdgeChromium?n.X.App.extensionEdge:e}constructor(e,t,i){(0,s._)(this,"_clientsState",void 0),(0,s._)(this,"_extension",void 0),(0,s._)(this,"_telemetry",void 0),this._clientsState=e,this._extension=t,this._telemetry=i}}},97015:(e,t,i)=>{i.d(t,{Ah:()=>n,DJ:()=>o,Ps:()=>j,RO:()=>r,S:()=>a,VF:()=>z,Wq:()=>s,Wy:()=>d,fN:()=>G,q8:()=>H});var s,n,r,o,a,d,l=i(23988),u=i(10334),h=i(17171),c=i(68823),p=i(84647),_=i(84906),m=i(99002),g=i(80074),f=i(97864),v=i(60575),b=i(68594),S=i(40027),y=i(95168),w=i(6987),x=i(60269),k=i(83541),P=i(62822),C=i(80837),D=i(86562),E=i(44869),T=i(65390),A=i(34717),O=i(23121),M=i(66202),I=i(36840),U=i(74056),B=i(40884),N=i(14650),F=i(37107);!function(e){e.is=e=>F.tl.extensionBanners.some((t=>t===e))}(s||(s={})),function(e){e.is=e=>r.is(e)||o.isPopup(e)}(n||(n={})),function(e){e.popups=F.tl.extensionAppPopups,e.is=e=>F.tl.extensionAppPopups.some((t=>t===e))}(r||(r={})),function(e){e.popups=F.tl.extensionAutoCitationsPopups,e.isBanner=e=>F.tl.extensionAutoCitationsBanners.some((t=>t===e)),e.isPopup=e=>F.tl.extensionAutoCitationsPopups.some((t=>t===e))}(o||(o={})),function(e){e.is=e=>F.tl.llamaBanners.some((t=>t===e)),e.isMac=e=>"llama-mac-download-banner"===e}(a||(a={})),function(e){e.is=e=>F.tl.llamaPopups.some((t=>t===e)),e.isMac=e=>"llama-mac-download-popup"===e}(d||(d={}));const L={active:null};function R(e){switch(e){case N.X.App.extensionChrome:return"chrome-popup";case N.X.App.extensionFirefox:return"firefox-popup";case N.X.App.extensionSafari:return"safari-popup";case N.X.App.extensionEdge:return"edge-popup";case N.X.App.extensionEdgeChromium:return"edge-chromium-popup";case N.X.App.desktopMac:return"llama-mac-download-popup";case N.X.App.desktopWindows:return"llama-windows-download-popup";default:return(0,D.xb)(e)}}function H(e){switch(e){case"llama-mac-download-popup":return N.X.App.desktopMac;case"llama-windows-download-popup":return N.X.App.desktopWindows;default:return(0,D.xb)(e)}}function G(e){switch(e){case"chrome-popup":return N.X.App.extensionChrome;case"safari-popup":return N.X.App.extensionSafari;case"firefox-popup":return N.X.App.extensionFirefox;case"edge-popup":case"edge-chromium-popup":return N.X.App.extensionEdge;case"chrome-autoCitations-popup":return"chrome-autoCitations-popup";case"safari-autoCitations-popup":case"firefox-autoCitations-popup":return"safari-autoCitations-popup";case"edge-chromium-autoCitations-popup":return"edge-chromium-autoCitations-popup";default:return(0,D.xb)(e)}}function j(e){switch(e){case"true-up":return"gbTrueUpReminder";case"llama-mac-download-banner":return N.X.App.desktopMac;case"llama-windows-download-banner":return N.X.App.desktopWindows;case"chrome-extension":return N.X.App.extensionChrome;case"firefox-extension":return N.X.App.extensionFirefox;case"safari-extension":return N.X.App.extensionSafari;case"edge-extension":case"edge-chromium-extension":return N.X.App.extensionEdge;case"mobile-keyboard":return N.X.App.mobileKeyboard;case"campaign-end":return"campaignEnd";case"proofit-cancelled":return"proofitCancel";case"proofit-completed":return"proofitComplete";case"invite-members":case"invite-members-pro":return"inviteMembers";case"style-guide":case"style-guide-pro":return"styleGuide";case"chrome-autoCitations":return"chrome-autoCitations";case"edge-chromium-autoCitations":return"edge-chromium-autoCitations";case"safari-autoCitations":return"safari-autoCitations";case"firefox-autoCitations":return"firefox-autoCitations";case"de-deprecation-banner":return"deDeprecationBanner";case"de-deprecation-popup":return"deDeprecationPopup";case"desktop-mac":return"desktopMac";case"desktop-windows":return"desktopWindows";default:return(0,D.xb)(e)}}var W,Z,q,V;(Z=W||(W={})).eq=E.OW({type:m.Eq,expire:_.Eq}),Z.has=e=>t=>Array.from(t.values()).some((t=>W.eq.equals(t,e))),function(e){e.empty=()=>({dismiss:new Set,shown:new Set,later:new Set,cancelled:new Set}),e.show={show:e=>{const t=JSON.stringify({dismiss:Array.from(e.dismiss),shown:Array.from(e.shown),later:Array.from(e.later),cancelled:Array.from(e.cancelled)});return`length: ${t.length}\n${t}`}}}(q||(q={})),function(e){function t(e){return(0,p.pipe)(e.llamaDiscoverabilityType,T.toUndefined)}function i(e){return N.X.isNotInstalled(e)?function(e){switch(e){case N.X.App.extensionChrome:return"chrome-extension";case N.X.App.extensionFirefox:return"firefox-extension";case N.X.App.extensionSafari:return"safari-extension";case N.X.App.extensionEdge:return"edge-extension";case N.X.App.extensionEdgeChromium:return"edge-chromium-extension";case N.X.App.mobileKeyboard:return"mobile-keyboard";case N.X.App.iOS:case N.X.App.android:case N.X.App.desktopMac:case N.X.App.desktopWindows:return null;default:return(0,D.xb)(e)}}(e.name):null}function s(e){return t=>null===t||e.dismiss.has(t)||(0,p.pipe)(e.later,c.zN((e=>e.type===t)))?null:t}function n(e){return t=>{switch(t){case"chrome-extension":case"chrome-popup":case"chrome-autoCitations":case"chrome-autoCitations-popup":return e.includes(N.X.App.extensionChrome)?null:t;case"safari-extension":case"safari-popup":case"safari-autoCitations":case"safari-autoCitations-popup":return e.includes(N.X.App.extensionSafari)?null:t;case"edge-chromium-extension":case"edge-chromium-popup":case"edge-chromium-autoCitations":case"edge-chromium-autoCitations-popup":return e.includes(N.X.App.extensionEdgeChromium)?null:t;case"edge-extension":case"edge-popup":return e.includes(N.X.App.extensionEdge)?null:t;case"firefox-extension":case"firefox-popup":case"firefox-autoCitations":case"firefox-autoCitations-popup":return e.includes(N.X.App.extensionFirefox)?null:t;case"mobile-keyboard":return e.includes(N.X.App.iOS)||e.includes(N.X.App.android)?null:t;default:return t}}}e.getActiveBanner=function(e,r,o,a){const d=r.desktopApp.state===U.OH.ClientState.INSTALLED&&o.showAutoCitationsBannerPromotion&&(f=r.extension,N.X.isNotInstalled(f)?function(e){switch(e){case N.X.App.extensionChrome:return"chrome-autoCitations";case N.X.App.extensionFirefox:return"firefox-autoCitations";case N.X.App.extensionSafari:return"safari-autoCitations";case N.X.App.extensionEdgeChromium:return"edge-chromium-autoCitations";case N.X.App.extensionEdge:default:return null}}(f.name):null),l=N.X.isSupported(r.desktopApp)&&N.X.App.isLlama(r.desktopApp.name)&&t(o)===B.d6.Banner&&(r.desktopApp.name===N.X.App.desktopWindows?"llama-windows-download-banner":"llama-mac-download-banner"),u=T.isNone(o.llamaDiscoverabilityType)&&o.showAppBanners&&(0,p.pipe)(i(r.extension),s(e),n(r.blockedApps)),h=o.showAppBanners&&(0,p.pipe)(i(r.desktopApp),s(e),n(r.blockedApps)),c=o.showInviteMembersBanner&&(0,p.pipe)(a,T.fold((()=>(0,p.pipe)("invite-members",s(e))),(t=>(0,p.pipe)("PRO"===t?"invite-members-pro":"invite-members",s(e))))),_=o.showStyleGuideBanner&&(0,p.pipe)(a,T.fold((()=>(0,p.pipe)("style-guide",s(e))),(t=>(0,p.pipe)("PRO"===t?"style-guide-pro":"style-guide",s(e))))),m=o.showAppBanners&&(0,p.pipe)(i(r.iOS),s(e),n(r.blockedApps))&&(0,p.pipe)(i(r.android),s(e),n(r.blockedApps)),g=o.showTrueUpBanner&&(0,p.pipe)("true-up",s(e));var f;return c||_||l||d||u||h||m||g||null},e.getActivePopup=function(e,i,r){return(0,p.pipe)(function(e,i){const{extension:s,desktopApp:n}=e;return N.X.isSupported(n)&&N.X.App.isLlama(n.name)&&t(i)===B.d6.Modal?R(n.name):i.extensionInstallPromotion&&i.showAppBanners&&N.X.isNotInstalled(s)&&N.X.App.isExtension(s.name)?R(s.name):Boolean(i.showAutoCitationsPopupPromotion)&&s.state===U.OH.ClientState.INSTALLED&&N.X.App.isExtension(s.name)?function(e){switch(e){case N.X.App.extensionChrome:return"chrome-autoCitations-popup";case N.X.App.extensionFirefox:return"firefox-autoCitations-popup";case N.X.App.extensionSafari:return"safari-autoCitations-popup";case N.X.App.extensionEdgeChromium:return"edge-chromium-autoCitations-popup";case N.X.App.extensionEdge:return null;default:return(0,D.xb)(e)}}(s.name):null}(i,r),function(e){return t=>null===t||e.shown.has(t)?null:t}(e),s(e),n(i.blockedApps))}}(V||(V={}));class z{get bannerFeatures(){return(0,p.pipe)(this._features,T.getOrElse((()=>B.LU.empty)))}_updateLaterBanners(e){const{later:t}=e,i=Date.now(),s=(0,p.pipe)(t,c.pb((e=>i<=e.expire)));s.size!==t.size&&(e=(0,h._)((0,u._)({},e),{later:s}));const n=(0,u._)({},q.empty(),e);if(F.tl.bannersType.is(n))return this._banners.set(n),n;{this._log.error("Initialized with corrupt banner type, resetting banners",{parsedBanners:n,banners:f.OA.of(n)});const e=q.empty();return this._updateBanners(e),e}}_getActiveBanner(){return V.getActiveBanner(this._banners.get(),this._clientsState,this.bannerFeatures,this._brandingSet)}_getActivePopup(){return V.getActivePopup(this._banners.get(),this._clientsState,this.bannerFeatures)}_getAppsPopupsToMarkAsShown(){return F.tl.extensionAppPopups.filter((e=>!this.getBannerState(e).includes("shown")))}_markPopupsShown(e,t){e.length>0&&this._updateBanners({shown:new Set([...Array.from(t.shown),...e])})}_getAutoCitationsPopupsToMarkShown(){const e=this.state.get().active;return e&&F.tl.isExtensionAutoCitationsPopup(e)?F.tl.extensionAutoCitationsPopups.filter((e=>!this.getBannerState(e).includes("shown"))):[]}remind(e){this.getBannerState(e).includes("cancelled")?this.dismiss(e):(this._cancel(e),this._remind(e,A.ei))}cancel(e){this.remind(e)}install(e){s.is(e)||n.is(e)?this._extension.install().then((e=>e&&this.state.set(L))):this.state.set(L)}dispose(){this._subs.dispose()}_resetState(){this.state.set(L)}_updateBanners(e){this._banners.modify((t=>(0,u._)({},t,e)))}constructor(e,t,i,s,n){(0,l._)(this,"_clientsState",void 0),(0,l._)(this,"_extension",void 0),(0,l._)(this,"_features",void 0),(0,l._)(this,"_brandingSet",void 0),(0,l._)(this,"state",void 0),(0,l._)(this,"_log",void 0),(0,l._)(this,"_subs",void 0),(0,l._)(this,"initialize",void 0),(0,l._)(this,"_banners",void 0),(0,l._)(this,"dismiss",void 0),(0,l._)(this,"shown",void 0),(0,l._)(this,"getBannerState",void 0),(0,l._)(this,"_cancel",void 0),(0,l._)(this,"_remind",void 0),(0,l._)(this,"_addBanner",void 0),this._clientsState=e,this._extension=t,this._features=i,this._brandingSet=n,this.state=g.s.create(L),this._log=v.Bx.Logging.getLogger("BannersModel"),this._subs=new C.y.Keeper,this.initialize=e=>{const t=this._updateLaterBanners(e);var i;this.state.set({active:null!==(i=this._getActivePopup())&&void 0!==i?i:this._getActiveBanner()}),this._markPopupsShown([...this._getAppsPopupsToMarkAsShown(),...this._getAutoCitationsPopupsToMarkShown()],t)},this._banners=g.s.create(q.empty()),this.dismiss=e=>{this._addBanner({type:"dismiss",banner:e}),this._resetState()},this.shown=e=>{this._addBanner({type:"shown",banner:e})},this.getBannerState=e=>{const t=this._banners.get();return(0,p.pipe)(O.zb((()=>Object.keys(t).filter((i=>"later"===i?(0,p.pipe)(t[i],c.zN((t=>t.type===e))):t[i].has(e))))),M.fold((i=>(this._log.error("Failed to get banner state",{name:i.name,message:i.message,banners:f.OA.of(t),parsedBanners:t,banner:e}),[])),p.identity))},this._cancel=e=>{this._addBanner({type:"cancelled",banner:e}),this._resetState()},this._remind=(e,t)=>{this._addBanner({type:"later",lateBanner:{type:e,expire:Date.now()+t}}),this._resetState()},this._addBanner=e=>{const t=this._banners.get();switch(e.type){case"shown":case"cancelled":const i=t[e.type];if(i.has(e.banner))return;this._updateBanners({[e.type]:new Set([...Array.from(i),e.banner])});break;case"later":this._updateBanners({later:new Set([...Array.from(t.later),e.lateBanner])});break;case"dismiss":this._updateBanners({dismiss:new Set([...Array.from(t.dismiss),e.banner])});break;default:(0,D.xb)(e)}},this._banners.pipe(b.i(1),S.Z(100)).subscribe(s),(0,I.hJ)("resetBanners",(()=>{this._updateBanners(q.empty())})),(0,I.hJ)("remindBanner",((e,t)=>{this._remind(e,t)})),(0,I.hJ)("listBanners",(()=>{console.debug(JSON.stringify(this._banners.get(),null,2))})),this._subs.push(this._banners.pipe(y.M((e=>this._log.debug("Banners updated",{banners:q.show.show(e)}))),w.n((e=>x.h(...Array.from(e.later).map((e=>k.timer(e.expire-Date.now()).pipe(P.u(e.type))))).pipe(y.M((t=>{this._log.debug("Showing banner scheduled for later",t),this.state.set({active:t}),this._updateLaterBanners(e)})))))).subscribe())}}},21538:(e,t,i)=>{i.d(t,{O:()=>s,q:()=>l});var s,n=i(10334),r=i(17171),o=i(95934),a=i(49165);!function(e){e.codec=o.NW({dlpEnabled:o.zM,docsDisabled:o.zM,dlpConfiguration:a.fW.codec,clients:o.YO(o.NW({client:o.Yj,blocked:o.zM}))})}(s||(s={}));const d="editor";function l(e){var t;if(!e.clientControls.clientControlsEnabled)return(0,r._)((0,n._)({},e.clientControls),{dlpEnabled:!1,docsDisabled:!1,dlpConfiguration:a.Wm,clients:[]});const i=(null===(t=e.blockedClients)||void 0===t?void 0:t.blockedClients.map((e=>({client:e.client,blocked:e.enabled}))))||[],s=i.some((e=>e.client===d&&e.blocked));return(0,r._)((0,n._)({},e.clientControls),{dlpEnabled:e.clientControls.dlpEnabled,dlpConfiguration:e.clientControls.dlpConfiguration,docsDisabled:s,clients:i})}},14650:(e,t,i)=>{i.d(t,{X:()=>s});var s,n=i(23988),r=i(84647),o=i(65390),a=i(74056),d=i(39781);!function(e){let t;var i;!function(e){e.desktopMac="macDesktop",e.desktopWindows="winDesktop",e.extensionChrome="chromeExt",e.extensionFirefox="firefoxExt",e.extensionSafari="safariExt",e.extensionEdge="edgeExt",e.extensionEdgeChromium="edgeChromiumExt",e.iOS="iOS",e.android="android",e.mobileKeyboard="mobileKeyboard"}(t=e.App||(e.App={})),(i=t=e.App||(e.App={})).isExtension=e=>[t.extensionChrome,t.extensionFirefox,t.extensionSafari,t.extensionEdge,t.extensionEdgeChromium].some((t=>t===e)),i.isLlama=e=>[t.desktopMac,t.desktopWindows].some((t=>t===e)),i.isExternalDownloadSource=e=>[t.iOS,t.android].some((t=>t===e)),e.isSupported=function(e){return e.state!==a.OH.ClientState.NOT_SUPPORTED},e.isNotInstalled=function(e){return e.state===a.OH.ClientState.NOT_INSTALLED};var l=e.unsupported={state:a.OH.ClientState.NOT_SUPPORTED};e.Impl=class{getAsArray(){return this._defaultSupportedArray.filter(s.isSupported).filter((e=>!Boolean(this.blockedApps.includes(e.name))))}_getExtensionName(e){switch(e){case"chrome":return t.extensionChrome;case"firefox":return t.extensionFirefox;case"safari":return t.extensionSafari;case"edge":return Number(this._environment.info.version)>18?t.extensionEdgeChromium:t.extensionEdge;default:throw new Error("unsupported browser "+e)}}constructor(e,i){(0,n._)(this,"_environment",void 0),(0,n._)(this,"_userProfile",void 0),(0,n._)(this,"_isWin",void 0),(0,n._)(this,"_isMac",void 0),(0,n._)(this,"_getDesktopAppMac",void 0),(0,n._)(this,"_getDesktopAppWindows",void 0),(0,n._)(this,"extension",void 0),(0,n._)(this,"desktopApp",void 0),(0,n._)(this,"iOS",void 0),(0,n._)(this,"android",void 0),(0,n._)(this,"_defaultSupportedArray",void 0),(0,n._)(this,"blockedApps",void 0),(0,n._)(this,"supportedApps",void 0),(0,n._)(this,"isEditorBlocked",void 0),this._environment=e,this._userProfile=i,this._isWin="windows"===this._environment.info.os,this._isMac="mac"===this._environment.info.os,this._getDesktopAppMac=()=>({name:t.desktopMac,state:this._userProfile.profile.view((({groups:e})=>e.has(d.yD.DESKTOP_APP_INSTALLED_MAC))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED}),this._getDesktopAppWindows=()=>({name:t.desktopWindows,state:this._userProfile.profile.view((({groups:e})=>e.has(d.yD.DESKTOP_APP_INSTALLED_WINDOWS))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED}),this.extension=this._environment.extension===a.OH.ClientState.NOT_SUPPORTED?l:{name:this._getExtensionName(this._environment.info.browser),state:this._environment.extension},this.desktopApp=this._isWin?this._getDesktopAppWindows():this._isMac?this._getDesktopAppMac():l,this.iOS={name:t.iOS,state:this._userProfile.profile.view((({groups:e})=>e.has(d.yD.MOBILE_IOS_INSTALLED))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED},this.android={name:t.android,state:this._userProfile.profile.view((({groups:e})=>e.has(d.yD.MOBILE_ANDROID_INSTALLED))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED},this._defaultSupportedArray=[this.desktopApp,this.extension,this.iOS,this.android],this.blockedApps=(0,r.pipe)(this._userProfile.clientControls,o.fold((()=>[]),(({clients:e})=>e.filter((e=>e.blocked)).map((e=>{switch(e.client){case"extensionChrome":return s.App.extensionChrome;case"extensionEdge":return s.App.extensionEdgeChromium;case"extensionFirefox":return s.App.extensionFirefox;case"macExtension":return s.App.desktopMac;case"windowsExtension":return s.App.desktopWindows;case"IOS_NATIVE_EDITOR":return s.App.iOS;case"MOBILE_ANDROID":return s.App.android;default:return}})).filter((e=>void 0!==e))))),this.supportedApps=this.getAsArray().map((({name:e,state:t})=>({app:e,installed:t===a.OH.ClientState.INSTALLED}))),this.isEditorBlocked=(0,r.pipe)(this._userProfile.clientControls,o.fold((()=>!1),(({docsDisabled:e})=>e)))}},e.Mock=class{getAsArray(){return[this.desktopApp,this.extension,this.iOS,this.android]}constructor(e={name:t.desktopMac,state:a.OH.ClientState.NOT_INSTALLED},i={name:t.extensionChrome,state:a.OH.ClientState.NOT_INSTALLED},r={name:t.android,state:a.OH.ClientState.NOT_INSTALLED},o={name:t.iOS,state:a.OH.ClientState.NOT_INSTALLED}){(0,n._)(this,"desktopApp",void 0),(0,n._)(this,"extension",void 0),(0,n._)(this,"android",void 0),(0,n._)(this,"iOS",void 0),(0,n._)(this,"supportedApps",void 0),(0,n._)(this,"blockedApps",void 0),(0,n._)(this,"isEditorBlocked",void 0),this.desktopApp=e,this.extension=i,this.android=r,this.iOS=o,this.supportedApps=this.getAsArray().filter(s.isSupported).map((({name:e,state:t})=>({app:e,installed:t===a.OH.ClientState.INSTALLED}))),this.blockedApps=[],this.isEditorBlocked=!1}}}(s||(s={}))},22438:(e,t,i)=>{i.d(t,{k:()=>s});const s="online"},78408:(e,t,i)=>{i.d(t,{H:()=>h});var s=i(23988),n=i(10334),r=i(17171),o=i(80074),a=i(65621),d=i(15491),l=i(86562),u=i(22438);class h{setState({type:e,state:t}){this._wsState.modify((i=>(0,r._)((0,n._)({},i),{[e]:t})))}_wasChanged(e,t,i){return e[i].type!==t[i].type}constructor(e,t){(0,s._)(this,"_connectivity",void 0),(0,s._)(this,"_wsHandlers",void 0),(0,s._)(this,"_wsState",void 0),(0,s._)(this,"_getChangedState",void 0),(0,s._)(this,"_handleStateChange",void 0),this._connectivity=e,this._wsHandlers=t,this._wsState=o.s.create({wsDox:{type:u.k},wsCapi:{type:u.k}}),this._getChangedState=([e,t])=>{const i=Object.keys(e).find((i=>this._wasChanged(e,t,i)));return(0,l.V1)(!!i,"WsState must be changed"),{type:i,state:t[i]}},this._handleStateChange=({type:e,state:t})=>{t.type===u.k?this._connectivity.setState({type:e,state:{type:"online"}}):((0,l.V1)(null!=this._wsHandlers[e],"WsErrorHandler must be defined"),this._wsHandlers[e].handle(t))},this._wsState.pipe(a.J(),d.T(this._getChangedState)).subscribe(this._handleStateChange)}}},53782:(e,t,i)=>{i.d(t,{M:()=>p,j:()=>_});var s=i(23988),n=i(10334),r=i(17171),o=i(84647),a=i(58508),d=i(11550),l=i(32955),u=i(15618),h=i(60575),c=i(94855);const p=e=>e instanceof d.Hl&&403===e.code;class _{createDocument(e,t,i){const s=(0,o.pipe)(c.TX((()=>this._doxApi.createDocument(u.Jo.Create.textFull((0,r._)((0,n._)({},Boolean(e)?{doc:{ops:[{insert:e}]}}:{},i?{extra_params:i}:{}),{title:t})))),(e=>e)));let d=1;return(0,o.pipe)(s,(0,l.L5)([a.Oh(4),a.Ed(1e3)],(e=>!p(e)&&(this._log.error("DOX: createDocument error",e,{attempt:d++}),!0))))}constructor(e){(0,s._)(this,"_doxApi",void 0),(0,s._)(this,"_log",void 0),this._doxApi=e,this._log=h.Bx.Logging.getLogger("model.documents.actions")}}},54179:(e,t,i)=>{i.r(t),i.d(t,{FileMaxSize:()=>P,UploadModelImpl:()=>E,UploadModelMock:()=>D,ValidationError:()=>n});var s,n,r=i(23988),o=i(38886),a=i(84647),d=i(80074),l=i(15618),u=i(60575),h=i(5692),c=i(80837),p=i(78339),_=i(92051),m=i(95168),g=i(54988),f=i(36840),v=i(94855),b=i(65390),S=i(77396),y=i(86562),w=i(36644),x=i(53782),k=i(78018);!function(e){e.clientError="clientError",e.serverError="serverError"}(s||(s={})),function(e){e.documentTypeUnsupported="documentTypeUnsupported",e.documentIsEmpty="documentIsEmpty",e.documentSizeExceeded="documentSizeExceeded",e.noFileToUpload="noFileToUpload",e.onlyOneDocumentAllowed="onlyOneDocumentAllowed"}(n||(n={}));const P=4194304,C=()=>h.j.defaultValue(),D=()=>({upload:()=>Promise.resolve([]),navigated:f.Yi,state:d.s.create(h.j.defaultValue()),uploadingCount:d.s.create(0),dispose:f.Yi});class E{dispose(){this._subs.dispose()}upload(e){this._inBackground=!1;const{files:t,notify:i,allowMultiple:n,isDragNDrop:r}=e,d=this._validateFiles(t,n);return d.length<=0?(this._state.set(C()),Promise.resolve([])):(this._state.modify(h.j.begin),this._uploadingCount.set(d.length),(0,a.pipe)(d.map((e=>(0,a.pipe)(v.TX((()=>{try{return this._upload(e)}catch(e){return Promise.reject(e)}}),(e=>{const t=(e=>({kind:s.serverError,error:e}))(e);return this._state.modify(h.j.fatal(t)),t})),v.Tj((t=>({id:String(t.id),uploadedFileType:e.type||"UNKNOWN_FILE_TYPE",uploadedFileName:e.name||"UNKNOWN_FILE_NAME"})))))),o.Ql.sequence(v.ys),v.Tj((e=>(this._telemetry.gnarSpec.uploadDocumentFormSubmit(r,!0,this._telemetry.pageId),(0,w.Wd)({source:"upload"}),this._state.modify(h.j.success({navigateTo:e.length>1||e.length!==t.length?b.none:(0,o.d5)(e),notify:i})),this._state.set(C()),this._uploadingCount.set(0),e))),S.hq,(e=>e.catch((()=>[])))))}navigated(){this._inBackground=!0}_handleServerError({error:e}){const t=e=>this._telemetry.gnarSpec.uploadDocumentFormSubmit(!1,!1,this._telemetry.pageId,e,"serverError");return e instanceof l.hB.FileSizeOutOfRangeError?(t(n.documentSizeExceeded),this._notificationsManager.enqueue("documentSizeExceeded",{os:this._environment.info.os,officeAddinUrl:""})):e instanceof l.hB.EmptyFileError?(t(n.documentIsEmpty),this._notificationsManager.enqueue("documentIsEmpty")):e instanceof l.hB.UnsupportedFileTypeError?(t(n.documentTypeUnsupported),this._notificationsManager.enqueue("documentTypeUnsupported")):e instanceof l.hB.TrackedChangesIsUnsupported?(t(e.message),this._notificationsManager.enqueue("trackedChangesIsUnsupported",{link:this._config.support.documentAcceptTrackedChanges})):e instanceof l.hB.TooManyRequestsError?(t(e.message),this._notificationsManager.enqueue("error")):(0,x.M)(e)?this._notificationsManager.enqueue("byokKeyInaccessible"):(t(e.message),u.Bx.Logging.getLogger("document.upload").error("uploadDocument failed",e),this._notificationsManager.enqueue("documentUploadGeneralError"))}_handleClientError({errorType:e}){switch(this._telemetry.gnarSpec.uploadDocumentFormSubmit(!1,!1,this._telemetry.pageId,n[e],s.clientError),e){case n.documentTypeUnsupported:return this._notificationsManager.enqueue("documentTypeUnsupported");case n.documentIsEmpty:return this._notificationsManager.enqueue("documentIsEmpty");case n.documentSizeExceeded:return this._notificationsManager.enqueue("documentSizeExceeded",{os:this._environment.info.os,officeAddinUrl:""});case n.noFileToUpload:return this._notificationsManager.enqueue("noFileToUpload");case n.onlyOneDocumentAllowed:return this._notificationsManager.enqueue("oneDocumentIsAllowed");default:return(0,y.xb)(e)}}_emitClientError(e){this._state.modify(h.j.error((e=>({kind:s.clientError,errorType:e}))(e)))}_validateFiles(e,t){return e.length<=0?(this._emitClientError(n.noFileToUpload),[]):!t&&e.length>1?(this._emitClientError(n.onlyOneDocumentAllowed),[]):(i=e,Array.from(i)).reduce(((e,t)=>{var i;return Boolean((i=t.name)&&k.$G.some((e=>i.toLowerCase().endsWith(e))))?t.size?t.size>P?this._emitClientError(n.documentSizeExceeded):e.push(t):this._emitClientError(n.documentIsEmpty):this._emitClientError(n.documentTypeUnsupported),e}),[]);var i}constructor(e,t,i,s,n,o){(0,r._)(this,"_upload",void 0),(0,r._)(this,"_navigateToDocument",void 0),(0,r._)(this,"_telemetry",void 0),(0,r._)(this,"_notificationsManager",void 0),(0,r._)(this,"_environment",void 0),(0,r._)(this,"_config",void 0),(0,r._)(this,"_state",void 0),(0,r._)(this,"_uploadingCount",void 0),(0,r._)(this,"_inBackground",void 0),(0,r._)(this,"_subs",void 0),(0,r._)(this,"state",void 0),(0,r._)(this,"uploadingCount",void 0),this._upload=e,this._navigateToDocument=t,this._telemetry=i,this._notificationsManager=s,this._environment=n,this._config=o,this._state=d.s.create(C()),this._uploadingCount=d.s.create(0),this._inBackground=!1,this._subs=new c.y.Keeper,this.state=this._state.view(),this.uploadingCount=this._uploadingCount.view(),this._subs.push(this._state.pipe(p.p((e=>h.j.isTerminated(e)||h.j.isError(e))),_.ZZ((e=>{if(h.j.isOk(e)){const{navigateTo:t,notify:i}=e.value,s=(0,a.pipe)(t,b.fold((()=>f.Yi),(e=>()=>this._navigateToDocument(e.id,{uploadedFileType:e.uploadedFileType,uploadedFileName:e.uploadedFileName,openSidebar:!0,showDocumentUploadedNotification:i}))));if(this._inBackground&&b.isSome(t))return this._notificationsManager.enqueue("documentUploaded").pipe(p.p((e=>"navigateToDocument"===e)),m.M(s));s()}else{if(h.j.isFatal(e))return this._handleServerError(e.error);if(h.j.isError(e))return this._handleClientError(e.error)}return g.w}))).subscribe())}}},78018:(e,t,i)=>{i.d(t,{$G:()=>B,Pm:()=>F,l1:()=>j,n6:()=>R,rv:()=>V});var s=i(83531),n=i(23988),r=i(84647),o=i(80074),a=i(11550),d=i(60442),l=i(15618),u=i(90875),h=i(60575),c=i(5692),p=i(42543),_=i(21662),m=i(78339),g=i(36735),f=i(6987),v=i(54988),b=i(60269),S=i(15491),y=i(58347),w=i(8433),x=i(19711),k=i(36094),P=i(95168),C=i(86562),D=i(65390),E=i(36840),T=i(59592),A=i(94855),O=i(77396),M=i(81870),I=i(39982),U=i(53782);const B=["doc","docx","odt","rtf","htm","html","txt"].map((e=>"."+e));var N;!function(e){e.doc="application/msword",e.docx="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.odt="application/vnd.oasis.opendocument.text",e.rtf="text/rtf",e.html="text/html",e.txt="text/plain"}(N||(N={}));const F=[N.doc,N.docx,N.odt,N.rtf,N.html,N.txt];var L;!function(e){e.empty={soft:[],hard:[]}}(L||(L={}));const R={searchText:"",wsConnection:c.j.defaultValue(),proofitResults:{},deletedDocumentIds:L.empty,first100:c.j.defaultValue(),remoteSearch:c.j.defaultValue(),documentKind:I.j.Kind.existing},H=100,G=new Date(15653592e5);var j;!function(e){let t;!function(e){e.compatibility="compatibility",e.on="on",e.off="off"}(t=e.FormattingMode||(e.FormattingMode={})),e.fromDocument=(e,t)=>({id:e.id,rtfMode:i(e.originalFilename,e.createdAt,t)});var i=e.getFormattingMode=(e,t,i)=>i.rtf?"string"==typeof e&&null!==t&&t>G?j.FormattingMode.compatibility:j.FormattingMode.on:j.FormattingMode.off}(j||(j={}));class W{init(){(0,C.V1)(null===this._operation,"Expect operation to be not established"),this._operation=c.j.OperationRetrier.create((()=>this._connect()),this.wsConnection)}reset(){const e=this.wsConnection.get();c.j.isOk(e)?this._terminate(e.value):this._operation&&this._operation.unsubscribe(),this._operation=null,this.wsConnection.set(R.wsConnection)}_connect(){return this._doxApi.openDocumentsList({metadataChangeHandler:(e,t)=>{(0,r.pipe)(t.proofit,D.fold(E.Yi,(t=>{this.results.modify((i=>Object.assign({},i,{[e]:t}))),t.status===u.c.JobStatus.cancelled&&this.cancelled.next({id:e})})))}}).then((e=>({unsubscribe:e.remoteConnection.close.bind(e.remoteConnection)})))}_terminate(e){var t=this;return(0,s._)((function*(){try{t.results.set(R.proofitResults),t.cancelled.next({id:null}),yield e.unsubscribe()}catch(e){throw t._log.error("Failed to close dox session",e),e}}))()}constructor(e,t){(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_state",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_operation",void 0),(0,n._)(this,"results",void 0),(0,n._)(this,"cancelled",void 0),(0,n._)(this,"wsConnection",void 0),this._doxApi=e,this._state=t,this._log=h.Bx.Logging.getLogger("model.documents.proofit"),this._operation=null,this.results=this._state.lens("proofitResults"),this.cancelled=new p.B7,this.wsConnection=this._state.lens("wsConnection")}}class Z{_reset(){this.searchText.set(R.searchText),this._isLocalSearch.set(!1),this._remoteSearch.set(c.j.defaultValue()),this._first100.set(c.j.defaultValue()),this.deletedDocumentIds.set(L.empty)}_loadDocuments(e,t){const i=o.s.create(!1);this._documentSubs=[c.j.OperationRetrier.create((()=>this._documentKind.get()===I.j.Kind.existing?this._doxApi.listDocuments(H,l.R1.OrderBy.Updated,!this._settings.firstCall.get(),l.R1.DocumentFilter.all,e,t):this._doxApi.listDeleted(H,l.R1.OrderBy.Updated,e,t)),this._first100,c.j.OperationRetrier.RetryStrategy.conditional(this._retryWhen,c.j.OperationRetrier.RetryStrategy.linear(3,3e3))),this._trimmedSearchText.pipe(_.E(this._first100,i),m.p((([e])=>!e)),g.c(1e3),m.p((([e,t,i])=>c.j.isTerminated(t)&&!i))).subscribe((()=>{i.set(!0),(this._documentKind.get()===I.j.Kind.deleted?this._doxApi.listDeleted(H,l.R1.OrderBy.Updated,e,t):this._doxApi.listDocuments(H,l.R1.OrderBy.Updated,!1,l.R1.DocumentFilter.all,e,t)).then((e=>this._first100.set(c.j.ok(e)))).catch((e=>{e instanceof a.Hl&&this._handleHttpDoxError(e,"Failed to refresh document list"),this._log.info("Failed to refresh document list",e)})).then((()=>{i.set(!1)}))})),this._isLocalSearch.pipe(f.n((e=>e?v.w:b.h(this._trimmedSearchText.pipe(S.T((e=>T.u.left(e)))),this._trimmedSearchText.pipe(y.B(500),S.T((e=>T.u.right(e))))).pipe(f.n((e=>(this._remoteSearch.set(c.j.defaultValue()),T.u.isLeft(e)||!e.value?v.w:w.v((()=>c.j.OperationRetrier.create((()=>this._doxApi.searchDocument(l.Jo.Search.contains(e.value),H,l.R1.OrderBy.Any,this._documentKind.get()===I.j.Kind.deleted?l.R1.DocumentFilter.trash:l.R1.DocumentFilter.all)),this._remoteSearch,c.j.OperationRetrier.RetryStrategy.conditional(this._retryWhen,c.j.OperationRetrier.RetryStrategy.linear(3,3e3)))),(()=>this._remoteSearch.pipe(m.p(c.j.isTerminated),x.$())))))))))).subscribe()]}_localSearch(e,t,i,s){const n=new RegExp(s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");return t.concat(e.filter((e=>!s||n.test(e.firstContent)||n.test(e.title))).filter((e=>-1===t.findIndex((t=>t.id===e.id))))).filter((e=>!i.includes(e.id)))}constructor(e,t,i,s,r){(0,n._)(this,"_state",void 0),(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_settings",void 0),(0,n._)(this,"_connectivity",void 0),(0,n._)(this,"_handleHttpDoxError",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_isLocalSearch",void 0),(0,n._)(this,"_first100",void 0),(0,n._)(this,"_remoteSearch",void 0),(0,n._)(this,"_documentKind",void 0),(0,n._)(this,"deletedDocumentIds",void 0),(0,n._)(this,"load",void 0),(0,n._)(this,"reset",void 0),(0,n._)(this,"searchText",void 0),(0,n._)(this,"_trimmedSearchText",void 0),(0,n._)(this,"isFirstTimeLoaded",void 0),(0,n._)(this,"isSearching",void 0),(0,n._)(this,"searchResults",void 0),(0,n._)(this,"_retryWhen",void 0),(0,n._)(this,"_documentSubs",void 0),this._state=e,this._doxApi=t,this._settings=i,this._connectivity=s,this._handleHttpDoxError=r,this._log=h.Bx.Logging.getLogger("model.documents.list"),this._isLocalSearch=o.s.create(!1),this._first100=this._state.lens("first100"),this._remoteSearch=this._state.lens("remoteSearch"),this._documentKind=this._state.lens("documentKind"),this.deletedDocumentIds=this._state.lens("deletedDocumentIds"),this.load=(e,t)=>{this.reset(),this._loadDocuments(e,t)},this.reset=()=>{this._documentSubs.forEach((e=>e.unsubscribe())),this._documentSubs=[],this._reset()},this.searchText=this._state.lens("searchText"),this._trimmedSearchText=this.searchText.view((e=>e.trim())),this.isFirstTimeLoaded=this._first100.view(c.j.isOk),this.isSearching=this._remoteSearch.view((e=>c.j.isInProgress(e)||c.j.isError(e))),this.searchResults=o.s.combine(this._documentKind,this._first100,this._remoteSearch,this.deletedDocumentIds,this._trimmedSearchText,((e,t,i,s,n)=>c.j.flatMap(t,(t=>{const r=e===I.j.Kind.existing?s.soft:s.hard;return c.j.isTerminated(i)?c.j.flatMap(i,(e=>c.j.ok(this._localSearch(t,Boolean(e)?e:[],r,n)))):c.j.ok(this._localSearch(t,[],r,n))})))),this._retryWhen=e=>!(e instanceof a.Hl)||(0,C.z3)(e.code),this._documentSubs=[],this._settings.firstCall.get()||this._first100.pipe(m.p(c.j.isOk),x.$()).subscribe((()=>this._settings.firstCallDone())),this._first100.pipe(m.p((e=>c.j.isOk(e)))).subscribe((e=>this._isLocalSearch.set(e.value.length<H))),this.searchResults.pipe(m.p((e=>c.j.isError(e)||c.j.isFatal(e))),f.n(k._F.rafScheduler)).subscribe((e=>{c.j.isFatal(e)?(e.error instanceof a.Hl?this._handleHttpDoxError(e.error,"DOX: Cannot load document list"):this._connectivity.setState({type:"dox",state:{type:(0,C.z3)(e.error.code)?"serverError":"unknownConnectionError"}}),this._log.error("DOX: Cannot load document list",e.error)):c.j.isError(e)&&this._log.warn("DOX: Attempt to load document list failed",e.error,{attempt:e.attempt})}))}}class q extends U.j{createDocumentAndNavigate(e){return(0,r.pipe)(this.createDocument(),A.wu(this.handleCreateDocumentError,(t=>{e.get()?this.navigateToDocument(t.id):this._editorTsNotifications.show(this._editorTsNotifications.create.newDocumentCreated((()=>this.navigateToDocument(t.id))))})),O.hq)}deleteDocument(e){const{request:t,lens:i}=this._state.view("documentKind").get()===I.j.Kind.deleted?{request:this._doxApi.forceDelete(e),lens:this._deletedDocumentIds.lens("hard")}:{request:this._doxApi.deleteDocumentById(e),lens:this._deletedDocumentIds.lens("soft")};return i.modify((t=>t.concat([e]))),t.catch((t=>{throw i.modify((t=>t.filter((t=>t!==e)))),t}))}emptyBin(){return this._doxApi.emptyBin().then(this._reset)}downloadOriginal(e){return this._log.info("downloadOriginal.initiated"),(e.rtfMode===j.FormattingMode.on?this._doxApi.downloadInFormat(e.id,"docx"):this._doxApi.downloadOriginal(e.id)).then(d.F.saveToFS).catch(this.handleDownloadDocumentError)}downloadProofread(e,t,i=!1){var n=this;return(0,s._)((function*(){n._log.info("downloadProofread.initiated");try{yield n._doxApi.downloadProofread(e,i).then(d.F.saveToFS).then((()=>{t&&n._editorTsNotifications.show(t)}))}catch(e){n.handleDownloadDocumentError(e)}}))()}navigateToDocument(e){this._navigateToDocument(`${e}`)}handleDeleteDocumentError(e){this._handleError(e,`Failed to delete ${this._state.view("documentKind").get()} document`)}handleEmptyBinError(e){this._handleError(e,"Failed to empty trash")}handleRestoreError(e){this._handleError(e,"Failed to restore a document")}_handleError(e,t){e instanceof a.Hl&&(this._handleHttpDoxError(e,t),this._log.error(t,e))}constructor(e,t,i,s,d,u){super(t),(0,n._)(this,"_state",void 0),(0,n._)(this,"_navigateToDocument",void 0),(0,n._)(this,"_editorTsNotifications",void 0),(0,n._)(this,"_handleHttpDoxError",void 0),(0,n._)(this,"_reset",void 0),(0,n._)(this,"_deletedDocumentIds",void 0),(0,n._)(this,"restoreDocument",void 0),(0,n._)(this,"documentUploadProgress",void 0),(0,n._)(this,"uploadDocument",void 0),(0,n._)(this,"handleDownloadDocumentError",void 0),(0,n._)(this,"handleCreateDocumentError",void 0),this._state=e,this._navigateToDocument=i,this._editorTsNotifications=s,this._handleHttpDoxError=d,this._reset=u,this._deletedDocumentIds=this._state.lens("deletedDocumentIds"),this.restoreDocument=e=>(this._deletedDocumentIds.lens("soft").modify((t=>t.filter((t=>t!==e)))),this._deletedDocumentIds.lens("hard").modify((t=>t.concat([e]))),(0,r.pipe)(A.TX((()=>this._doxApi.restoreDocumentById(e)),(e=>e)),A.wu((t=>(this._deletedDocumentIds.lens("soft").modify((t=>t.concat([e]))),t instanceof a.Hl&&this._handleHttpDoxError(t,"Failed to restore document"),t)),(()=>e)))),this.documentUploadProgress=o.s.create(null),this.uploadDocument=(e,t)=>this._doxApi.createDocument(l.Jo.Create.file(e,t)).then((e=>(this._state.lens("first100").modify((t=>c.j.isOk(t)?c.j.ok(new Array(e).concat(t.value)):t)),e))),this.handleDownloadDocumentError=e=>{this._log.error("downloadDocument failed",e);const t=e instanceof l.hB.UnauthorizedError,i=e instanceof l.hB.DocumentNotFoundError,s=e instanceof l.hB.TooManyRequestsError||e instanceof l.hB.ConnectionError;t?this._editorTsNotifications.show(this._editorTsNotifications.create.unauthorizedError()):i?this._editorTsNotifications.show(this._editorTsNotifications.create.downloadDocumentNotFoundError()):s?this._editorTsNotifications.show(this._editorTsNotifications.create.isTemporaryDownloadError()):this._editorTsNotifications.show(this._editorTsNotifications.create.error())},this.handleCreateDocumentError=e=>{e instanceof a.Hl?(this._handleHttpDoxError(e,"Failed to create new document"),this._log.warn("Failed to create new document",e)):(0,C.eK)(e)?(this._log.warn("Failed to create new document",e),this._editorTsNotifications.showError(`Failed to create new document: ${Boolean(e)?e.message:e}`)):(this._log.error("Failed to create new document",e),this._editorTsNotifications.showError(`Failed to create new document: ${Boolean(e)?e.message:e}`))}}}class V{constructor(e,t,i,s,r,o,a,d){(0,n._)(this,"_state",void 0),(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_doxWSApi",void 0),(0,n._)(this,"_settings",void 0),(0,n._)(this,"_connectivity",void 0),(0,n._)(this,"_notifications",void 0),(0,n._)(this,"_navigateToDocument",void 0),(0,n._)(this,"_router",void 0),(0,n._)(this,"proofit",void 0),(0,n._)(this,"_doxHttpErrorHandler",void 0),(0,n._)(this,"list",void 0),(0,n._)(this,"actions",void 0),this._state=e,this._doxApi=t,this._doxWSApi=i,this._settings=s,this._connectivity=r,this._notifications=o,this._navigateToDocument=a,this._router=d,this.proofit=new W(this._doxWSApi,this._state),this._doxHttpErrorHandler=e=>{switch(e.code){case l.hB.HttpCodes.UNAUTHORIZED:this._connectivity.setState({type:"dox",state:{type:"unauthorized"}});break;case l.hB.HttpCodes.BYOK_KEY_UNAVAILABLE:this._notifications.show(this._notifications.create.byokKeyInaccessible());break;case l.hB.HttpCodes.TOO_MANY_REQUESTS:this._notifications.show(this._notifications.create.error());break;default:this._notifications.showError(e.message)}},this.list=new Z(this._state,this._doxApi,this._settings,this._connectivity,this._doxHttpErrorHandler),this.actions=new q(this._state,this._doxApi,this._navigateToDocument,this._notifications,this._doxHttpErrorHandler,this.list.load),this._router.isActive(M.Lz.routes.documents.href()).pipe(P.M((e=>this._state.lens("documentKind").set(e?I.j.Kind.existing:I.j.Kind.deleted)))).subscribe()}}},18711:(e,t,i)=>{i.r(t),i.d(t,{ChecklistSteps:()=>b,ChecklistUseCase:()=>S,CheetahOggyEditorInternal:()=>D,FeatureAwareness:()=>w,FreeTrial:()=>p,GDocsTour:()=>a,GetStartedChecklist:()=>_,GetStartedPriority:()=>o,GrammarlyPro:()=>M,InProductDiscounts:()=>U,InlinePremiumPreviews:()=>r,LlamaAdoption:()=>y,LlamaEntryPointsV3:()=>f,LockedUIUXExperiment:()=>A,LongFormPremiumFeed:()=>I,OnboardingTourA11y:()=>v,PlagiarismUphook:()=>T,PremiumChecklistNoTrial:()=>m,PremiumChecklistTrial:()=>g,PremiumFreeTrialEuUk:()=>C,PremiumFreeTrialForNewUsers:()=>P,RedirectUphookToUpgradePage:()=>k,RemoveWelcomeTour:()=>c,SharedAssistant:()=>E,TopSitesTours:()=>d,TrueUp:()=>x,UphookCard:()=>n,WritingProgress:()=>l,WritingProgressV2:()=>u,WritingProgressV3:()=>h,lockedUI:()=>O});var s=i(60251);const n=new s.aj("denali_uphook_card",["test","control"]),r=new s.aj("inline_premium_previews_denali",["control","experiment"]),o=new s.aj("get_started_priority",["test","control"]),a=new s.aj("gdoc_tour",["test","control"]),d=new s.aj("top_sites_tours",["test","control"]),l=new s.aj("learning_hub_mvp",["control","test"]),u=new s.aj("writing_progress_v2",["control","test"]),h=new s.aj("writing_progress_v3",["control","dashboard","ipm"]),c=new s.aj("remove_welcome_tour",["control","test"]),p=new s.aj("premium_free_trial_v3",["trial","differentiated"]),_=new s.aj("get_started_checklist",["control","test"]),m=new s.aj("premium_checklist_no_trial",["control","test"]),g=new s.aj("premium_checklist_trial",["control","test"]),f=new s.aj("llama_entry_points_v3",["control","one_day_delay","three_day_delay"]),v=new s.aj("editor_onboarding_tour_a11y_v2",["control","test"]),b=new s.aj("checklist_steps",["control","test"]),S=new s.aj("checklist_use_case",["control","test"]),y=new s.aj("checklist_llama_editor",["control","test"]),w=new s.aj("feature_awareness",["control","test"]),x=new s.aj("true_up_billing",["control","test"]),k=new s.aj("editor_redirect_uphook_to_upgrade_page",["control","test"]),P=new s.aj("premium_free_trial_for_new_users",["control","test"]),C=new s.aj("premium_free_trial_eu_uk",["control","test"]),D=new s.aj("cheetah_oggy_editor",["control","test"]),E=new s.aj("sharedassistant_editor",["control","mergedSharedAssistant","splitSharedAssistants"]),T=new s.aj("smart_plagiarism_uphook",["control","test"]),A=new s.aj("locked_ui_iteration_1",["control","published_limit","non_published_limit"]),O=new s.aj("locked_ui_editor_2",["control","unlimited_pool"]),M=new s.aj("grammarly_pro_m3_ga_v1",["control","test"]),I=new s.aj("long_form_premium_feed",["control","test"]),U=new s.aj("in_product_discount_m1",["control","test"])},16843:(e,t,i)=>{i.r(t),i.d(t,{AiDetectorEnabled:()=>R,BackendManagedStorageMacEditor:()=>S,BackendManagedStorageWebEditor:()=>b,CPRA:()=>C,CheetahProfuseEventsTracking:()=>I,CheetahStudentsOnboarding:()=>y,GDPRInverted:()=>P,GDebugger:()=>L,GetStartedChecklistPermanentDismiss:()=>F,ReferralsGate:()=>M,SelectionContextUpdatesClient:()=>x,SelectionContextUpdatesServer:()=>k,TrafficThroughGatewayForCapi:()=>U,TrafficThroughInternalCapi:()=>B,VersionHistory:()=>N,WritingExpertFeedback:()=>D,WritingExpertInAssistantExternalNative:()=>O,WritingExpertInAssistantExternalOggy:()=>A,WritingExpertInAssistantInternal:()=>T,WritingExpertPullMode:()=>E,WritingExpertVbarsGlobal:()=>w,cheetahInlineRewrite:()=>_,cheetahMagicRewrite:()=>p,cheetahOnboarding:()=>m,cheetahOrgContext:()=>g,cheetahStudentBTS:()=>f,cheetahStudentPromptsInternal:()=>v,citationBuilder:()=>a,citationBuilderBannersChrome:()=>l,citationBuilderBannersEdge:()=>h,citationBuilderBannersFirefox:()=>c,citationBuilderBannersSafari:()=>u,citationBuilderInternal:()=>d,citationsRollout:()=>n,citationsRolloutInternal:()=>r,proofitNoteToEditor:()=>o});var s=i(60251);const n=new s.iD("citations_rollout","enabled"),r=new s.iD("citations_rollout_internal","enabled"),o=new s.iD("proofit_note_to_editor","enabled"),a=new s.iD("citation_builder","enabled"),d=new s.iD("citation_builder_internal","enabled"),l=new s.iD("citation_builder_banners_chrome","enabled"),u=new s.iD("citation_builder_banners_safari","enabled"),h=new s.iD("citation_builder_banners_edge","enabled"),c=new s.iD("citation_builder_banners_firefox","enabled"),p=new s.iD("cheetah_editor_feature_flag_magic_rewrite"),_=new s.iD("cheetah_editor_feature_flag_inline_rewrite"),m=new s.iD("cheetah_editor_feature_flag_product_onboarding"),g=new s.iD("gbgo_knowledge_share_web"),f=new s.iD("ggo_student_bts"),v=new s.iD("ggo_student_prompts_internal"),b=new s.iD("editor_feature_flag_capi_client_storage"),S=new s.iD("mac_editor_feature_flag_capi_client_storage"),y=new s.iD("ggo_students_onboarding"),w=new s.iD("vbars_global"),x=new s.iD("cheetah_selection_context_updates"),k=new s.iD("cheetah_selection_context_updates_server"),P=new s.iD("gdpr_inverted","enabled"),C=new s.iD("cpra"),D=new s.iD("writing_expert_feedback"),E=new s.iD("editor_writing_expert_pull_mode"),T=new s.iD("writing_expert_in_assistant"),A=new s.iD("writing_expert_in_assistant_oggy"),O=new s.iD("writing_expert_in_assistant_native"),M=new s.iD("growth_referrals"),I=new s.iD("cheetah_profuse_events_tracking"),U=new s.iD("capi_traffic_through_cthulhu"),B=new s.iD("capi_traffic_through_internal_capi"),N=new s.iD("editor_version_history"),F=new s.iD("get_started_checklist_permanent_dismiss"),L=new s.iD("g_debugger_enabled"),R=new s.iD("plagiarism_ai_detector_cheetah_web")},71449:(e,t,i)=>{i.d(t,{c:()=>a});var s=i(83531),n=i(23988),r=i(63403),o=i(80029);class a{install(){var e=this;return(0,s._)((function*(){switch(e._environment.info.browser){case"firefox":return r.vL((0,o.W)().domains.cookie),window.location.href=e._firefoxUrl,!0;case"chrome":case"safari":case"edge":return!0;default:throw new TypeError("Unexpected input in browser variable: "+e._environment.info.browser)}}))()}constructor(e,t){(0,n._)(this,"_environment",void 0),(0,n._)(this,"_firefoxUrl",void 0),this._environment=e,this._firefoxUrl=t}}},40884:(e,t,i)=>{var s,n,r,o;i.d(t,{yK:()=>H,LU:()=>Z,Wk:()=>L,fO:()=>N,DY:()=>o,ZI:()=>q,nS:()=>$,Vd:()=>G,d6:()=>j,kH:()=>R,vI:()=>W,bz:()=>M,Fh:()=>U,fx:()=>B,SA:()=>I}),function(e){e.Business="BUSINESS",e.Edu="EDU",e.Gov="GOV",e.K12="K12",e.Ngo="NGO"}(s||(s={})),function(e){e.Admin="admin",e.Member="member"}(n||(n={})),function(e){e.Free="free",e.Premium="premium",e.Business="business",e.Edu="edu"}(r||(r={})),function(e){e.isFree=e=>e.type===r.Free,e.isPremium=e=>e.type===r.Premium||e.type===r.Business||e.type===r.Edu,e.isPremiumConsumer=e=>e.type===r.Premium,e.isPro=e=>"isPro"in e&&e.isPro;var t=e.isBusiness=e=>e.type===r.Business,i=e.isEdu=e=>e.type===r.Edu,s=e.isInstitutionUser=e=>"institutionType"in e;e.isConsumerUser=e=>!s(e),e.isBusinessAdmin=e=>t(e)&&e.institutionType===n.Admin,e.isEduAdmin=e=>i(e)&&e.institutionType===n.Admin,e.isBusinessTeamMember=e=>t(e)&&e.institutionType===n.Member,e.isEduTeamMember=e=>i(e)&&e.institutionType===n.Member,e.isAdmin=e=>s(e)&&e.institutionType===n.Admin,e.isGrammarlyUser=e=>e.email.indexOf("@grammarly.com")>-1,e.isTestUser=e=>e.isTest}(o||(o={}));var a=i(23988),d=i(84011),l=i(84647),u=i(80074),h=i(60575),c=i(44781),p=i(34717),_=i(65390),m=i(58193),g=i(22835),f=i(36840),v=i(56134),b=i(81870),S=i(92622),y=i(18711),w=i(16843),x=i(37107),k=i(74056);const P=new Date(15259968e5),C=new Date(15488856e5),D=new Date(15995736e5),E={[c.k.BulkAccept]:{releaseDate:new Date(16091064e5),isNewFor:4*p.ks},trashbin:{releaseDate:new Date(1656324189130),isNewFor:5*p.ks},versionHistory:{releaseDate:new Date(17177112e5),isNewFor:3*p.ks}};var T;!function(e){e.is=e=>E.hasOwnProperty(e)}(T||(T={}));const A=new Date(16855776e5),O="llamaDiscoverabilityType";var M,I,U,B,N,F,L,R,H,G,j,W,Z,q;!function(e){let t;!function(e){e.on="on",e.force="force"}(t=e.UserRolePopupMode||(e.UserRolePopupMode={}))}(M||(M={})),function(e){e.layoutGroup="layoutGroup",e.benefits="benefits"}(I||(I={})),function(e){e.enabled="enabled",e.upgradeIsNeeded="upgradeIsNeeded",e.disabled="disabled"}(U||(U={})),function(e){e.plansPage="plansPage",e.upgradePage="upgradePage"}(B||(B={})),function(e){let t;!function(e){e.migration="migration",e.welcome="welcome"}(t=e.TourType||(e.TourType={})),e.isTourType=function(e){return e===t.migration||e===t.welcome}}(N||(N={})),function(e){e.withoutDiscount="withoutDiscount"}(F||(F={})),function(e){e.none="none",e.documentSettings="documentSettings"}(L||(L={})),function(e){e.mergedSharedAssistant="mergedSharedAssistant",e.splitSharedAssistants="splitSharedAssistants"}(R||(R={})),function(e){e[e.CRITICAL_ADVANCED=0]="CRITICAL_ADVANCED",e[e.FREE_PREMIUM=1]="FREE_PREMIUM"}(H||(H={})),function(e){e.List="List",e.Checklist="Checklist",e.PremiumChecklist="PremiumChecklist"}(G||(G={})),function(e){e.Banner="Banner",e.Modal="Modal"}(j||(j={})),function(e){let t,i;!function(e){e.Full="Full",e.Oggy="Oggy",e.OggySplit="OggySplit",e.WithoutInlineCards="WithoutInlineCards"}(t=e.Content||(e.Content={})),function(e){e.Forced="Forced",e.Standard="Standard",e.Hidden="Hidden"}(i=e.Kind||(e.Kind={})),e.isForced=function(e){return e.kind===i.Forced},e.isHidden=function(e){return e.kind===i.Hidden}}(W||(W={})),function(e){e.empty={extensionInstallPromotion:!1,showAppBanners:!1,showInviteMembersBanner:!1,showStyleGuideBanner:!1,mockedBannersState:_.none,showAutoCitationsPopupPromotion:!1,showAutoCitationsBannerPromotion:!1,llamaDiscoverabilityType:_.none,showTrueUpBanner:!1},e.BannersFeaturesImpl=class{get showAppBanners(){return!o.isEdu(this.denaliUserType)&&!o.isBusinessAdmin(this.denaliUserType)}get showInviteMembersBanner(){return this._router.query.has("gbInviteMembersBanner")||o.isBusinessAdmin(this.denaliUserType)&&!this._isUserRegisteredBefore(D)&&!this._settings.memberInviteOnboardingPassed.get()}get showStyleGuideBanner(){return this._router.query.has("gbStyleGuideBanner")||o.isAdmin(this.denaliUserType)&&(0,l.pipe)(this._userProfile.get().institutionInfo,_.exists((e=>e.voxEnabled)))&&_.isNone(this.voxInfo)}get showTrueUpBanner(){return this._exp.isQuery("true_up")||this._exp.isManakin(y.TrueUp,"test")&&o.isBusinessAdmin(this.denaliUserType)&&(0,l.pipe)(this._userProfile.get().institutionInfo,_.exists((e=>(0,l.pipe)(e.trueUpSchedule,_.exists((e=>Boolean(e.isTrueUpEligible)&&e.overageSeats>0&&_.isSome(e.nextTrueUpBillingDate)))))))}get mockedBannersState(){return(0,l.pipe)(this._router.query.get("mockedBannersState"),_.chain((0,l.flow)((e=>JSON.parse(e)),x.tl.bannersType.decode,_.fromEither)))}_shouldSeeAutoCitationPromotion(){return Date.now()>16632414e5&&(0,l.pipe)(this._userProfile.get().role,m.Lw((e=>e===S.gG.school||e===S.j1.student)))&&!o.isBusiness(this.denaliUserType)}get showAutoCitationsPopupPromotion(){return!!this._exp.isQuery("autoCitations")||!!this._shouldSeeAutoCitationPromotion()&&(this._exp.isManakin(w.citationBuilderInternal)||this._exp.isManakin(w.citationBuilder))}get showAutoCitationsBannerPromotion(){return!!this._exp.isQuery("autoCitations")||!!this._shouldSeeAutoCitationPromotion()&&("chrome"===this._browser&&this._exp.isManakin(w.citationBuilderBannersChrome)||"safari"===this._browser&&this._exp.isManakin(w.citationBuilderBannersSafari)||"edge"===this._browser&&this._exp.isManakin(w.citationBuilderBannersEdge)||"firefox"===this._browser&&this._exp.isManakin(w.citationBuilderBannersFirefox))}get llamaDiscoverabilityType(){return this._llamaDiscoverabilityType}constructor(e,t,i,s,n,r,o,d,u){(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"denaliUserType",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"voxInfo",void 0),(0,a._)(this,"_browser",void 0),(0,a._)(this,"_llamaDiscoverabilityType",void 0),(0,a._)(this,"extensionInstallPromotion",void 0),this._userProfile=e,this._exp=t,this._settings=i,this._router=s,this.denaliUserType=n,this._isUserRegisteredBefore=r,this.voxInfo=o,this._browser=d,this._llamaDiscoverabilityType=u,this.extensionInstallPromotion=!this._isUserRegisteredBefore(C)&&!this._exp.isDapi(...z.disabled)&&!this._exp.isQuery("disable_ext_promo")&&_.isNone(this._llamaDiscoverabilityType)||(0,l.pipe)(this._router.query.get("ext_promo"),_.exists((e=>"show"===e)))}}}(Z||(Z={}));class V{showNewLabel(e){const t=E[e];return!o.isTestUser(this._userProfile.get())&&(new Date).getTime()<t.isNewFor+t.releaseDate.getTime()}get cheetah(){return this._environment.platform===k.OH.Platform.WEB||this._environment.platform===k.OH.Platform.MACEDITOR}get cheetahMagicRewrite(){return(0,l.pipe)(this._router.query.get("cheetahMagicRewrite"),_.map((e=>"on"===e)),_.getOrElse((()=>this._exp.isManakin(w.cheetahMagicRewrite))))}get cheetahInlineRewrite(){return(0,l.pipe)(this._router.query.get("cheetahInlineRewrite"),_.map((e=>"on"===e)),_.getOrElse((()=>this._exp.isManakin(w.cheetahInlineRewrite))))}get cheetahOnboarding(){return this._environment.platform===k.OH.Platform.WEB&&(this._exp.isManakin(w.cheetahOnboarding)||this._exp.isQuery("cheetahOnboarding"))}get cheetahOrgContextEnabled(){return this._exp.isManakin(w.cheetahOrgContext)||this._exp.isQuery("cheetahOrgContext")}get cheetahBTSOnboardingEnabled(){return this._exp.isManakin(w.CheetahStudentsOnboarding)&&(this._exp.isManakin(w.cheetahStudentBTS)||this._exp.isManakin(w.cheetahStudentPromptsInternal))||(0,l.pipe)(this._router.query.get("cheetahBTSOnboarding"),_.isSome)}get writingExpertVbarsEnabled(){return this._exp.isManakin(w.WritingExpertVbarsGlobal)||this._exp.isQuery("writingExpertVbars")}get isEligibleForGtm(){const e=this._userProfile.get().email;return!["fcps.edu","fcpsschools.net","winclusion.org","test.fcpstechlab.org","grammarlian.com"].some((t=>e.endsWith(`@${t}`)))&&this._exp.isManakin(w.GDPRInverted)&&!this._exp.isManakin(w.CPRA)}get cheetahPromptsUsed(){return(0,l.pipe)(this._router.query.get("cheetahPromptsUsed"),_.map((e=>Number.parseInt(e,10))),_.filter((e=>!Number.isNaN(e))))}get backendManagedStorageEnabled(){return!(void 0===window.indexedDB||!(this._environment.platform===k.OH.Platform.WEB&&this._exp.isManakin(w.BackendManagedStorageWebEditor)||this._environment.platform===k.OH.Platform.MACEDITOR&&this._exp.isManakin(w.BackendManagedStorageMacEditor)||this._exp.isQuery("backendManagedStorage")))}get mutedAlerts(){return!(0,l.pipe)(this._router.query.get("mutedAlerts"),_.exists((e=>"off"===e)))&&((0,l.pipe)(this._router.query.get("mutedAlerts"),_.exists((e=>"on"===e)))||o.isPremium(this._userMeta.denaliUserType))}get enforceFeaturesOnboarding(){const e=new Set;return this._isUserTestingMutedAlerts&&e.add(c.k.CardMute),this._forceMuteQuotedAlertsAdvice&&e.add(c.k.MuteQuotedAdvice),e}get safariExtActivationWeb(){return this._exp.isQuery("safariExt")||"safari"===this._environment.info.browser&&!this._settings.seenSafariExtNotification.get()&&this._settings.safariDeactivatedWeb.get()}get getStartedPriority(){return this._exp.isManakin(y.GetStartedPriority,"test")}get gDocsTour(){return this._exp.isManakin(y.GDocsTour,"test")}get topSitesTours(){return this._exp.isQuery("topSitesTours")||this._exp.isManakin(y.TopSitesTours,"test")}get supportUkraineCardAppearanceLimit(){return(0,l.pipe)(this._router.query.get("supportUkraineCardAppearanceLimit"),_.map((e=>parseInt(e,10))),_.getOrElse((()=>4)))}get isStudentsOFE(){return!_.exists((e=>"off"===e))(this._router.query.get("students"))&&(this._exp.isManakin(w.citationsRollout)||this._exp.isManakin(w.citationsRolloutInternal)||(0,l.pipe)(this._router.query.get("students"),_.exists((e=>"on"===e))))}get proofitNoteToEditor(){return this._exp.isManakin(w.proofitNoteToEditor)}get isInternalUser(){return this._userMeta.isInternalUser}get showSignoutSurvey(){return(0,l.pipe)(this._router.query.get("signOutSurvey"),_.exists((e=>"on"===e)))||!this._settings.seenSignOutSurvey.get()}get showSignOutConfirmationPopup(){return!(0,l.pipe)(this._router.query.get("signOutConfirmation"),_.exists((e=>"off"===e)))}get removeWelcomeTour(){return this._exp.isQuery("removeWelcomeTour")||this._exp.isManakin(y.RemoveWelcomeTour,"test")}get showOnboardingTourA11yUpdates(){return this._exp.isQuery("showDemoDocOnboardingA11y")||this._exp.isManakin(y.OnboardingTourA11y,"test")}get removeAccountCreationSection(){return this._exp.isManakin(y.ChecklistSteps,"test")}get tailorTryInWebsitesSection(){return this._exp.isManakin(y.ChecklistUseCase,"test")}get replaceViewAppsSection(){return this._exp.isManakin(y.LlamaAdoption,"test")}get replaceTakeATourSection(){return this._exp.isManakin(y.FeatureAwareness,"test")}get selectionContextUpdatesClient(){return this._exp.isManakin(w.SelectionContextUpdatesClient,"enabled")}get selectionContextUpdatesServer(){return this._exp.isManakin(w.SelectionContextUpdatesServer,"enabled")}get writingExpertPullMode(){return(0,l.pipe)(this._router.query.get("writingExpertPullMode"),_.map((e=>"on"===e)),_.getOrElse((()=>!!this._exp.isManakin(w.WritingExpertPullMode,"enabled")&&(this._exp.isManakin(w.WritingExpertInAssistantExternalOggy,"enabled")||this._exp.isManakin(w.WritingExpertInAssistantExternalNative,"enabled")||this._exp.isManakin(w.WritingExpertInAssistantInternal,"enabled")))))}get oggy(){return(0,l.pipe)(this._router.query.get("oggy"),_.map((e=>"merged"===e?R.mergedSharedAssistant:R.splitSharedAssistants)),_.getOrElse((0,l.constant)(R.splitSharedAssistants)))}get isLockedUIEnabled(){return o.isFree(this._userMeta.denaliUserType)&&this._exp.peekManakinExperiment(y.lockedUI,"unlimited_pool")}get lockedUIUXExperimentTreatment(){return this.isLockedUIEnabled&&(this._exp.peekManakinExperiment(y.LockedUIUXExperiment,"published_limit")||this._exp.peekManakinExperiment(y.LockedUIUXExperiment,"non_published_limit"))}get uphookDestination(){if(this._exp.isQuery("redirectUphookToUpgradePage"))return _.some(B.upgradePage);const e=this._exp.getManakinExperimentTreatment(y.RedirectUphookToUpgradePage);return"test"===e?_.some(B.upgradePage):"control"===e?_.some(B.plansPage):_.none}get writingExpertFeedback(){return this._exp.isQuery("writingExpertFeedback")||o.isGrammarlyUser(this._userProfile.get())&&this._exp.isManakin(w.WritingExpertFeedback)}get isGetStartedChecklistPermanentDismissEnabled(){return this._isGetStartedChecklistPermanentDismissEnabled}get versionHistory(){return this._exp.isQuery("version_history")||this._exp.isManakin(w.VersionHistory,"enabled")}get _isFreeClarityAlertsEnabled(){return this._exp.isQuery("free-clarity-enabled")}get _isFreeClarityAlertsControl(){return this._exp.isQuery("free-clarity-control")}get _isProofitSurvey(){return this._userProfile.get().type===S.ut.premium||this._exp.isQuery("proofit_promo")}get _isPremiumOnboardingSurvey(){return!1}get _isGBSatisfactionSurvey(){const e=this._exp.isQuery("gb_satisfaction_survey_enabled"),t=(0,l.pipe)(this._userProfile.get().institutionInfo,_.fold(l.constFalse,(e=>e.business&&e.admin)));return e&&t}get _isPowerUserSurvey(){return _.isSome(this._router.query.get("powerUser"))}get _isUserTestingFullSentence(){return this._exp.isQuery("ut-fullSentence")}get _isAnnotator(){return this._exp.isQuery("ut-annotator")}get _isUserTestingMutedAlerts(){return this._exp.isQuery("ut-mutedAlerts")}get _isUserTestingListTransform(){return this._exp.isQuery("ut-listTransform")}get _forceMuteQuotedAlertsAdvice(){return(0,l.pipe)(this._router.query.get("muteQuotedAlerts"),_.exists((e=>"force"===e)))}_dismissedGetStartedChecklist(e){var t,i;const s="premium"===e?null===(t=this._settings.getStartedPremiumChecklistSettings)||void 0===t?void 0:t.get().dismissal:null===(i=this._settings.getStartedChecklistSettings)||void 0===i?void 0:i.get().dismissal;return(0,l.pipe)(s,_.exists((e=>{const{type:t,timestamp:i}=e;return t===x.RM.HardDismiss||t===x.RM.SoftDismiss&&Date.now()-i.getTime()<2*p.ei})))}get _viewedOrDismissedLlamaModal(){const e=this._settings.llamaDiscoverabilitySettings.get().modalDismissalTimestamp;return _.isSome(e)}get _dismissedLlamaBanner(){const e=this._settings.llamaDiscoverabilitySettings.get().bannerDismissalTimestamp;return _.isSome(e)}get _hideGetStarted(){return _.isSome(this._router.query.get("hideGetStarted"))}get _showGetStartedChecklist(){return this._userProfile.get().type===S.ut.free&&!this._dismissedGetStartedChecklist("free")&&(0,l.pipe)(this._userProfile.get().registrationDate,_.exists((e=>Date.now()-e.getTime()<p.ks)))}get _isInFreeTrialExperiment(){return this._userMeta.isOnFreeTrial.get()&&this._exp.isManakin(y.PremiumChecklistTrial,"test")}get _isInNonTrialExperiment(){return!this._userMeta.isOnFreeTrial.get()&&this._exp.isManakin(y.PremiumChecklistNoTrial,"test")}get _isInPremiumChecklistExperiment(){return this._isInNonTrialExperiment||this._isInFreeTrialExperiment}get _forceShowPremiumGetStartedChecklist(){return this._exp.isQuery("premiumGetStartedChecklist")}get _isGetStartedChecklistPermanentDismissEnabled(){return this._exp.isManakin(w.GetStartedChecklistPermanentDismiss,"enabled")}get _showPremiumGetStartedChecklist(){const e=(0,l.pipe)(this._userMeta.lastSubscribedDateString.get(),_.exists((e=>{const t=new Date(e);return Date.now()-t.getTime()<p.ks})));return this._forceShowPremiumGetStartedChecklist||this._userProfile.get().type===S.ut.premium&&!o.isInstitutionUser(this._userMeta.denaliUserType)&&e&&!this._dismissedGetStartedChecklist("premium")&&this._isInPremiumChecklistExperiment}get _showGetStartedList(){return this._userProfile.get().type===S.ut.premium&&(0,l.pipe)(this._userProfile.get().registrationDate,_.exists((e=>Date.now()-e.getTime()<p.ei)))}get _hasInstalledLlama(){const e=this._userProfile.get().groups;return e.has("windowsExtension")||e.has("macExtension")}get _isFromOnboarding(){return(0,l.pipe)(this._router.query.get("isFromOnboarding"),_.exists((e=>"true"===e)))}get _hasOneWeekPassedSinceRegistration(){const e=new Date;return this._isUserRegisteredBefore(new Date(e.getTime()-p.ks))}get _assignLlamaEntryPointType(){return this._exp.getManakinExperimentTreatment(y.LlamaEntryPointsV3)}get _showLlamaDiscoverabilityModal(){if((0,l.pipe)(this._router.query.get(O),_.exists((e=>"modal"===e))))return!0;if(!this._hasInstalledLlama&&!this._viewedOrDismissedLlamaModal){const e=new Date,t=this._assignLlamaEntryPointType;return"one_day_delay"===t?this._isUserRegisteredBefore(new Date(e.getTime()-p.ei)):"three_day_delay"===t?this._isUserRegisteredBefore(new Date(e.getTime()-3*p.ei)):!this._isFromOnboarding&&this._hasOneWeekPassedSinceRegistration}return!1}get _showLlamaDiscoverabilityBanner(){if((0,l.pipe)(this._router.query.get(O),_.exists((e=>"banner"===e))))return!0;if(!this._hasInstalledLlama&&!this._dismissedLlamaBanner){const e=this._assignLlamaEntryPointType;return"one_day_delay"===e||"three_day_delay"===e||this._hasOneWeekPassedSinceRegistration}return!1}_getAssignedSurveys(){const e=new Array;return this._surveyTypeAssignments.forEach(((t,i)=>{t&&e.push(i)})),e}get requirePaymentCheck(){return _.isSome(this._router.query.get("fraud"))}get documentToolbar(){return this._isIPad||this._isMacEditor?L.none:L.documentSettings}get showUploadInPlaceholderText(){return!this._isMacEditor}get voxInfo(){return(0,l.pipe)(this._userProfile.get().institutionInfo,_.chain((e=>e.vox)),m.NW(_.none))}get instType(){return this._instType.get()}get alertGroupNames(){return this._userMeta.isFree.get()?H.FREE_PREMIUM:H.CRITICAL_ADVANCED}get llamaDiscoverabilityType(){return this._showLlamaDiscoverabilityModal?_.some(j.Modal):this._showLlamaDiscoverabilityBanner?_.some(j.Banner):_.none}get isLlamaDiscoverabilityTest(){return(0,l.pipe)(this._settings.llamaDiscoverabilitySettings.get().modalDismissalTimestamp,_.exists((e=>e>A)))||(0,l.pipe)(this._settings.llamaDiscoverabilitySettings.get().bannerDismissalTimestamp,_.exists((e=>e>A)))}get getStartedType(){return this._hideGetStarted?_.none:this._showPremiumGetStartedChecklist?_.some(G.PremiumChecklist):this._showGetStartedChecklist?_.some(G.Checklist):!this._dismissedGetStartedChecklist("premium")&&this._showGetStartedList?_.some(G.List):_.none}get tour(){return this.removeWelcomeTour?_.none:(0,l.pipe)(this._router.query.get("tour"),_.filter(N.isTourType),_.fold((()=>this._settings.seenDenaliWelcome.get()||this._isIPad||!(0,l.pipe)(this._userProfile.get().registrationDate,_.exists((e=>e>P)))?_.none:_.some(this._settings.seenWelcome.get()?N.TourType.migration:N.TourType.welcome)),_.some))}get alertsUpdate(){return(0,l.pipe)(this._router.query.get("alertsUpdate"),_.exists((e=>"true"===e)))}get autoJumpSettings(){return{isDisabledByDefault:!0}}get sidebarOpenedByDefault(){return!this._exp.isQuery("disableSidebarByDefault")}get globalExperimentDemoText(){return this._isUserTestingFullSentence?_.some("fullSentenceDemoText"):this._isUserTestingMutedAlerts?_.some("mutedAlertsDemoText"):this._isUserTestingListTransform?_.some("listTransformDemoText"):this._isAnnotator?_.some("annotatorEmptyDocument"):_.none}get showcaseNewFeaturesOnStartup(){return _.isNone(this.tour)&&!this._isIPad&&((0,l.pipe)(this._router.query.get("showNews"),_.exists((e=>"true"===e)))||!o.isTestUser(this._userProfile.get())&&g.HP(this.newsConfig).some((e=>!this._settings.newsSeen.get().has(e)&&this.newsConfig[e].visible()&&this.newsConfig[e].showcaseOnStartup())))}get rtf(){return!this._exp.isQuery("no_rtf")}get toneDetector(){return this._exp.isQuery("toneDetector")}get changePlanHook(){return this._settings.changePlanHook.view((e=>{if((0,f.Ub)(o.isFree,o.isInstitutionUser)(this._userMeta.denaliUserType))return _.none;if(this._exp.isQuery(this._changePlanHook.query.withoutDiscount))return _.some(F.withoutDiscount);const t=p.Yr.daysAgo(p.Yr.now(),3),i=(0,l.pipe)(e.latestDismissAt,_.fold((()=>!0),(e=>e.getTime()<t))),s=e.latestAppearances.filter((e=>t<e.getTime())).length;return i&&s<3?_.some(F.withoutDiscount):_.none}))}get gbBillingMigrationNotification(){return(0,l.pipe)(this._router.query.get("gb_billing_migration"),_.fold((()=>u.s.combine(this._userProfile,this._settings.gbBillingMigrationSettings,((e,t)=>(0,l.pipe)(e.institutionInfo,_.chain((({admin:e,subscriptionInfo:{migrationState:i,expirationDate:s}})=>e&&"BILLING_FLOW_MIGRATION_STARTED"===i?(0,l.pipe)(_.fromEither(p.Yr.parseDate(s)),_.chain((e=>{const i=p.Yr.now(),s=p.Yr.monthsAgo(e,1);if(p.Yr.toTimestamp(i)<s||i>e)return _.none;const n=p.Yr.daysAgo(i,5);return(0,l.pipe)(t.latestDismissAt,_.exists((e=>e.getTime()>n)))?_.none:_.some({expiryDate:e})}))):_.none)))))),(()=>u.s.create(_.some({expiryDate:new Date})))))}get premiumUngatingRenewalNotification(){if(this._userMeta.isFree.get())return u.s.create(_.none);if(this._exp.isQuery("premium_ungating_renewal_notification"))return u.s.create(_.some(p.Yr.now()));const e=p.Yr.toTimestamp(p.Yr.now()),t=p.Yr.Timestamp.add(e,2*p.ei);return u.s.combine(this._settings.ungatedTrialEndDate,this._settings.ungatedRenewalNotificationSettings,((i,s)=>s.wasDismissed||(0,l.pipe)(s.latestAppearance,_.exists((e=>e.getDate()===(new Date).getDate())))?_.none:(0,l.pipe)(i,_.filter((i=>e<i.getTime()&&i.getTime()<t)))))}get recordCapiMessages(){return(0,l.pipe)(this._router.query.get("recordCapiMessages"),_.fold((()=>"off"),(e=>"messages-and-mock"===e?"messages-and-mock":"messages")))}get gDebugger(){return(0,l.pipe)(this._router.query.get("gdebugger"),_.fold((()=>this._exp.isManakin(w.GDebugger,"enabled")),(e=>"on"===e)))}get dlp(){return(0,l.pipe)(this._clientControls,_.exists((({dlpEnabled:e})=>e)))}get uphookFormat(){return this._exp.isDapi(...this._uphookFormat.layoutGroups)||this._exp.isQuery(this._uphookFormat.layoutGroupsQuery)?_.some(I.layoutGroup):this._exp.isDapi(...this._uphookFormat.benefits)||this._exp.isQuery(this._uphookFormat.benefitsQuery)?_.some(I.benefits):_.none}get gbPrompt(){return(0,l.pipe)(this._userProfile.get().institutionInfo,_.exists((e=>e.voxEnabled)))}get sendProfuseGnarEvents(){return this._exp.isManakin(w.CheetahProfuseEventsTracking,"enabled")}get isAiDetectorEnabled(){return this._exp.isManakin(w.AiDetectorEnabled,"enabled")}get isSmartPlagiarismUphookEnabled(){return this._exp.peekManakinExperiment(y.PlagiarismUphook,"test")}get trafficThroughGatewayForCapi(){return this._exp.isManakin(w.TrafficThroughGatewayForCapi,"enabled")}get trafficThroughInternalCapi(){return this._exp.isQuery("internalCapi")||this._exp.isManakin(w.TrafficThroughInternalCapi,"enabled")}constructor(e,t,i,s,n,r,o,u,c,m){(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_clientControls",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_environment",void 0),(0,a._)(this,"_instType",void 0),(0,a._)(this,"_proofit",void 0),(0,a._)(this,"_userMeta",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"onboardingSeen",void 0),(0,a._)(this,"markFeatureOnboarded",void 0),(0,a._)(this,"newsConfig",void 0),(0,a._)(this,"_log",void 0),(0,a._)(this,"_changePlanHook",void 0),(0,a._)(this,"_uphookFormat",void 0),(0,a._)(this,"_isIPad",void 0),(0,a._)(this,"_isMacEditor",void 0),(0,a._)(this,"_surveyTypeAssignments",void 0),(0,a._)(this,"surveyType",void 0),(0,a._)(this,"appInitedFromDenaliPage",void 0),(0,a._)(this,"dismissFeedbackFormSuppressed",void 0),this._userProfile=e,this._settings=t,this._clientControls=i,this._router=s,this._exp=n,this._environment=r,this._instType=o,this._proofit=u,this._userMeta=c,this._isUserRegisteredBefore=m,this.onboardingSeen=e=>this._settings.featuresOnboardingSeen.view((t=>t.has(e))),this.markFeatureOnboarded=e=>{this._settings.markFeatureOnboarded(e)},this.newsConfig={[x.Ks.VersionHistory]:{visible:()=>this.versionHistory,showcaseOnStartup:l.constTrue},[x.Ks.Trash]:{visible:l.constTrue,showcaseOnStartup:()=>this._isUserRegisteredBefore(new Date(E.trashbin.releaseDate.getTime()-p.ks))},[x.Ks.MutedAlerts]:{visible:()=>this.mutedAlerts,showcaseOnStartup:l.constFalse},[x.Ks.RTF]:{visible:()=>this.rtf,showcaseOnStartup:l.constFalse},[x.Ks.PDF]:{visible:l.constTrue,showcaseOnStartup:l.constFalse},[x.Ks.ProofitClarity]:{visible:()=>this._proofit.get()===U.enabled,showcaseOnStartup:l.constFalse}},this._log=h.Bx.Logging.getLogger("DenaliFeaturesImpl",h.y7.$.DEBUG),this._changePlanHook={query:{withoutDiscount:"change-plan-without-discount"}},this._uphookFormat={control:["uphook_formats_control_1","uphook_formats_control_2"],layoutGroups:["uphook_formats_experiment_layout_group_1","uphook_formats_experiment_layout_group_2"],layoutGroupsQuery:"uphook_formats_layout",benefits:["uphook_formats_experiment_benefits_1","uphook_formats_experiment_benefits_2"],benefitsQuery:"uphook_formats_benefits"},this._isIPad=this._environment.platform===k.OH.Platform.IPAD,this._isMacEditor=this._environment.platform===k.OH.Platform.MACEDITOR,this._surveyTypeAssignments=new Map([[x.L0.FreeClarityAlertsControl,this._isFreeClarityAlertsControl],[x.L0.FreeClarityAlertsEnabled,this._isFreeClarityAlertsEnabled],[x.L0.GBSatisfaction,this._isGBSatisfactionSurvey],[x.L0.MostActiveUsers,this._isPowerUserSurvey],[x.L0.PremiumOnboarding,this._isPremiumOnboardingSurvey],[x.L0.ProofitPromo,this._isProofitSurvey]]),this.surveyType=(0,l.pipe)(this._router.query.get("survey"),_.filter((e=>Object.values(x.L0).includes(e))),_.fold((()=>{if(this._userMeta.isInternalUser&&_.isNone(this._router.query.get("exp")))return _.none;const e=this._getAssignedSurveys();return e.length>1&&(2!==e.length||!e.includes(x.L0.ProofitPromo))&&this._log.error("User has been assigned to multiple surveys. Check all finished experiments have been closed",e.join(", ")),_.fromNullable(e[0])}),_.some),_.filter((e=>!this._isIPad))),this.appInitedFromDenaliPage=this._router.isActive(b.Lz.routes.denali_editor.href({docId:"*"})).get(),this.dismissFeedbackFormSuppressed=(0,l.pipe)((()=>this._router.query.get("suppressFeedbackForm")),v.K.map((e=>"true"===e)),d.Tj(_.getOrElse(l.constFalse))),(0,f.hJ)("getSurveyType",(()=>this.surveyType)),(0,f.hJ)("getRecordCapiMessagesMode",(()=>this.recordCapiMessages))}}!function(e){e.BannersFeaturesMock=class{constructor(e=!1){(0,a._)(this,"extensionInstallPromotion",void 0),(0,a._)(this,"showAppBanners",void 0),(0,a._)(this,"showInviteMembersBanner",void 0),(0,a._)(this,"showStyleGuideBanner",void 0),(0,a._)(this,"showAutoCitationsPopupPromotion",void 0),(0,a._)(this,"showAutoCitationsBannerPromotion",void 0),(0,a._)(this,"mockedBannersState",void 0),(0,a._)(this,"llamaDiscoverabilityType",void 0),(0,a._)(this,"showTrueUpBanner",void 0),this.extensionInstallPromotion=e,this.showAppBanners=!0,this.showInviteMembersBanner=!1,this.showStyleGuideBanner=!1,this.showAutoCitationsPopupPromotion=!1,this.showAutoCitationsBannerPromotion=!1,this.mockedBannersState=_.none,this.llamaDiscoverabilityType=_.none,this.showTrueUpBanner=!1}};class t{constructor(){(0,a._)(this,"newsConfig",void 0),(0,a._)(this,"sidebarOpenedByDefault",!1),(0,a._)(this,"newExtensionBanner",!1),(0,a._)(this,"alertsUpdate",!1),(0,a._)(this,"tour",_.none),(0,a._)(this,"enabled",!0),(0,a._)(this,"showSwitchToDenaliBtn",void 0),(0,a._)(this,"alertGroupNames",H.CRITICAL_ADVANCED),(0,a._)(this,"appInitedFromDenaliPage",!1),(0,a._)(this,"instType",_.none),(0,a._)(this,"surveyType",_.none),(0,a._)(this,"autoJumpSettings",{title:"",isDisabledByDefault:!1}),(0,a._)(this,"getStartedType",_.none),(0,a._)(this,"toneDetector",!1),(0,a._)(this,"enforceFeaturesOnboarding",new Set),(0,a._)(this,"premiumOnboardingSurvey",!1),(0,a._)(this,"recordCapiMessages","messages"),(0,a._)(this,"ideas",_.none),(0,a._)(this,"showSignoutSurvey",!1),(0,a._)(this,"showSignOutConfirmationPopup",!1),(0,a._)(this,"proofitNoteToEditor",!1),(0,a._)(this,"isInternalUser",!1),(0,a._)(this,"globalExperimentDemoText",_.none),(0,a._)(this,"showcaseNewFeaturesOnStartup",!1),(0,a._)(this,"rtf",!0),(0,a._)(this,"voxInfo",_.none),(0,a._)(this,"documentToolbar",L.documentSettings),(0,a._)(this,"showUploadInPlaceholderText",!0),(0,a._)(this,"requirePaymentCheck",!1),(0,a._)(this,"iPad",!0),(0,a._)(this,"changePlanHook",u.s.create(_.none)),(0,a._)(this,"gbUpHook",u.s.create(_.none)),(0,a._)(this,"mutedAlerts",!1),(0,a._)(this,"premiumUngatingRenewalNotification",u.s.create(_.none)),(0,a._)(this,"dismissFeedbackFormSuppressed",d.of(!1)),(0,a._)(this,"showNewLabel",l.constFalse),(0,a._)(this,"onboardingSeen",(0,l.constant)(u.s.create(!1))),(0,a._)(this,"markFeatureOnboarded",f.Yi),(0,a._)(this,"gbBillingMigrationNotification",u.s.create(_.none)),(0,a._)(this,"safariExtActivationWeb",!1),(0,a._)(this,"safariExtActivationNative",!1),(0,a._)(this,"lockedUIUXExperimentTreatment",!1),(0,a._)(this,"isLockedUIEnabled",!1),(0,a._)(this,"dlp",!1),(0,a._)(this,"uphookFormat",_.none),(0,a._)(this,"gbPrompt",!1),(0,a._)(this,"getStartedPriority",!1),(0,a._)(this,"gDocsTour",!1),(0,a._)(this,"topSitesTours",!1),(0,a._)(this,"isStudentsOFE",!1),(0,a._)(this,"supportUkraineCardAppearanceLimit",0),(0,a._)(this,"llamaDiscoverabilityType",_.none),(0,a._)(this,"removeWelcomeTour",!1),(0,a._)(this,"cheetah",!1),(0,a._)(this,"cheetahMagicRewrite",!1),(0,a._)(this,"cheetahInlineRewrite",!1),(0,a._)(this,"cheetahOnboarding",!1),(0,a._)(this,"cheetahPromptsUsed",_.none),(0,a._)(this,"cheetahOrgContextEnabled",!1),(0,a._)(this,"removeAccountCreationSection",!1),(0,a._)(this,"tailorTryInWebsitesSection",!1),(0,a._)(this,"replaceViewAppsSection",!1),(0,a._)(this,"replaceTakeATourSection",!1),(0,a._)(this,"trueUpSchedule",_.none),(0,a._)(this,"backendManagedStorageEnabled",!1),(0,a._)(this,"cheetahBTSOnboardingEnabled",!1),(0,a._)(this,"showDemoDocOnboardingA11yUpdates",!1),(0,a._)(this,"demoDocOnboardingA11yUpdatesTreatment",_.none),(0,a._)(this,"writingExpertVbarsEnabled",!1),(0,a._)(this,"writingExpertPullMode",!1),(0,a._)(this,"isEligibleForGtm",!1),(0,a._)(this,"showOnboardingTourA11yUpdates",!1),(0,a._)(this,"selectionContextUpdatesClient",!1),(0,a._)(this,"selectionContextUpdatesServer",!1),(0,a._)(this,"oggy",R.splitSharedAssistants),(0,a._)(this,"uphookDestination",_.none),(0,a._)(this,"writingExpertFeedback",!1),(0,a._)(this,"sendProfuseGnarEvents",!1),(0,a._)(this,"isAiDetectorEnabled",void 0),(0,a._)(this,"isSmartPlagiarismUphookEnabled",!1),(0,a._)(this,"trafficThroughGatewayForCapi",!1),(0,a._)(this,"trafficThroughInternalCapi",!1),(0,a._)(this,"versionHistory",!1),(0,a._)(this,"isGetStartedChecklistPermanentDismissEnabled",!0),(0,a._)(this,"gDebugger",!1)}}e.DenaliFeaturesMock=t,e.SDUIDenaliFeaturesMock=class extends t{constructor(...e){super(...e),(0,a._)(this,"sdui",!0)}},e.DenaliPageFeaturesMock=class{get isFree(){return"boolean"==typeof this._isFree?u.s.create(this._isFree):this._isFree}get isPremium(){return"boolean"==typeof this._isFree?u.s.create(!this._isFree):this._isFree.view((e=>!e))}get denaliUserType(){return{type:("boolean"==typeof this._isFree?this._isFree:this._isFree.get())?r.Free:r.Premium}}constructor(e,t,i=!1){(0,a._)(this,"_isFree",void 0),(0,a._)(this,"denali",void 0),(0,a._)(this,"hideOnboarding",void 0),(0,a._)(this,"disableAppsPromotion",void 0),(0,a._)(this,"enableTrackingOnDownload",void 0),(0,a._)(this,"onboardingMode",void 0),(0,a._)(this,"plagiarism",void 0),(0,a._)(this,"proofit",void 0),(0,a._)(this,"demoMode",void 0),(0,a._)(this,"proofitTest",void 0),(0,a._)(this,"proofitLastJob",void 0),(0,a._)(this,"preventAnimation",void 0),(0,a._)(this,"voxInfo",void 0),(0,a._)(this,"track3rdPartyExtensionsInjection",void 0),(0,a._)(this,"subscriptionCampaign",void 0),(0,a._)(this,"lastSubscribedDateString",void 0),(0,a._)(this,"isOnFreeTrial",void 0),(0,a._)(this,"isMacEditor",void 0),(0,a._)(this,"isEligibleForFreeTrial",void 0),(0,a._)(this,"isEligibleForFreeTrialEuUk",void 0),(0,a._)(this,"proVsPremiumExperiment",void 0),(0,a._)(this,"assignProVsPremiumExperiment",void 0),(0,a._)(this,"inProductDiscountsExperiment",void 0),(0,a._)(this,"assignInProductDiscountExperiment",void 0),(0,a._)(this,"isSmartPlagiarismUphookEnabled",void 0),(0,a._)(this,"isLongFormPremiumFeedEnabled",void 0),(0,a._)(this,"assignSmartPlagiarismUphookExperiment",void 0),this._isFree=e,this.denali=t,this.hideOnboarding=i,this.disableAppsPromotion=!1,this.enableTrackingOnDownload=u.s.create(!1),this.plagiarism=u.s.create(U.disabled),this.proofit=u.s.create(U.disabled),this.proofitTest=_.none,this.proofitLastJob=_.none,this.voxInfo=_.none,this.track3rdPartyExtensionsInjection=!1,this.subscriptionCampaign=u.s.create(_.none),this.lastSubscribedDateString=u.s.create(_.none),this.isOnFreeTrial=u.s.create(!1),this.proVsPremiumExperiment=!1,this.assignProVsPremiumExperiment=f.Yi,this.inProductDiscountsExperiment=!1,this.assignInProductDiscountExperiment=f.Yi,this.isSmartPlagiarismUphookEnabled=!1,this.isLongFormPremiumFeedEnabled=!1,this.assignSmartPlagiarismUphookExperiment=f.Yi}}}(q||(q={}));const z={disabled:["disable_extension_installation_disabled"]};var X=i(90875),K=i(5692),Y=i(83531),Q=i(60251);class J{isDapi(...e){return e.some((e=>this._experiments.has(e)))}isQuery(e){return(0,l.pipe)(this._router.query.get("exp"),_.exists((t=>t.split(",").includes(e))))}isManakin(e,...t){if(e instanceof Q.iD){const t=this._experimentClient.isGateEnabled(e);return t&&this.storeKnown(e.name,e.experience),t}{const i=this._experimentClient.getTreatment(e);if(null===i)return!1;{const s=t.includes(i);return this.storeKnown(e.name,i),s}}}isManakinWithExplicitLog(e,...t){var i=this;return(0,Y._)((function*(){if(e instanceof Q.iD)return i.storeKnown(e.name,e.experience),Promise.resolve(i._experimentClient.isGateEnabled(e));{const s=i._experimentClient.peekTreatment(e);if(null===s)return Promise.resolve(!1);try{yield i._experimentClient.logTreatment(e,s);const n=t.includes(s);return i.storeKnown(e.name,s),n}catch(e){}return!1}}))()}getManakinExperimentTreatment(e){const t=this._experimentClient.getTreatment(e);return null!==t&&this.storeKnown(e.name,t),t}peekManakinExperiment(e,...t){const i=this._experimentClient.peekTreatment(e);if(null===i)return!1;{const s=t.includes(i);return this.storeKnown(e.name,i),s}}constructor(e,t,i){(0,a._)(this,"_experimentClient",void 0),(0,a._)(this,"_experiments",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"storeKnown",void 0),(0,a._)(this,"_knownExperiments",void 0),this._experimentClient=e,this._experiments=t,this._router=i,this.storeKnown=(e,t)=>{this._knownExperiments[e]||(this._knownExperiments[e]=t)},this._knownExperiments={},h.Bx.Logging.root.context.add({manakinExperiments:this._knownExperiments})}}class ${get _forceEligibleForFreeTrial(){return this._exp.isQuery("forceEligibleForFreeTrial")}get isEligibleForFreeTrial(){return!_.isNone(this._vitoClient)&&(!!this._forceEligibleForFreeTrial||!(!this._vitoClient.value.getFreeTrialForNewUsersEligibility()||!this._exp.peekManakinExperiment(y.PremiumFreeTrialForNewUsers,"test"))||!(!this._vitoClient.value.getFreeTrialEuUkEligibility()||!this._exp.peekManakinExperiment(y.PremiumFreeTrialEuUk,"test"))||this._vitoClient.value.getFreeTrialEligibility())}get isEligibleForFreeTrialEuUk(){return!_.isNone(this._vitoClient)&&this._vitoClient.value.getFreeTrialEuUkEligibility()}get isOnFreeTrial(){return _.isNone(this._subscription)?u.s.create(!1):this._subscription.value.view((e=>K.j.isOk(e)&&Boolean(e.value.isOnTrial)))}get isOnProPlan(){return _.isNone(this._subscription)?u.s.create(!1):this._subscription.value.view((e=>K.j.isOk(e)&&!!e.value.proPlans&&!!e.value.currentPlan&&e.value.proPlans.some((t=>t.id===e.value.currentPlan.id))))}get showBusinessBanner(){return!this._institution.view(_.isSome).get()&&(this._router.query.has("gbBannerTesting")||!this.isInternalUser)}get isInternalUser(){return o.isGrammarlyUser(this._userProfile.get())||o.isTestUser(this._userProfile.get())}get trueUpSchedule(){return(0,l.pipe)(this._userProfile.get().institutionInfo,_.chain((e=>e.trueUpSchedule)))}get subscriptionIsLoaded(){return _.isNone(this._subscription)?u.s.create(!1):this._subscription.value.view((e=>K.j.isOk(e)))}get denaliUserType(){return this.isFree.get()?{type:r.Free}:this.isPremium.get()?this._instType.view(_.toNullable).view((e=>e===s.Business)).get()?this.isOnProPlan.get()?{type:r.Business,isPro:!0,institutionType:m.$v(this._instUserType.get())}:{type:r.Business,institutionType:m.$v(this._instUserType.get())}:this._instType.view(_.toNullable).view((e=>e===s.Edu)).get()?{type:r.Edu,institutionType:m.$v(this._instUserType.get())}:{type:r.Premium}:{type:r.Free}}onboardingMode(){const e=this._router.query.get("onboarding"),t=(0,l.pipe)(e,m.gR("show")),i=(0,l.pipe)(e,m.gR("hide")),s=this.denali.showOnboardingTourA11yUpdates,n=W.Content.Oggy;return t?{kind:W.Kind.Forced,content:this.denali.oggy===R.mergedSharedAssistant?W.Content.Oggy:W.Content.OggySplit}:i||o.isTestUser(this._userProfile.get())||this._isIPad?{kind:W.Kind.Hidden}:s?{kind:W.Kind.Standard,content:W.Content.WithoutInlineCards}:{kind:W.Kind.Standard,content:n}}get proofit(){return _.isNone(this._subscription)||this._isIPad?u.s.create(U.disabled):u.s.combine(this._subscription.value.view((e=>K.j.isOk(e)&&Boolean(e.value.paymentMethod))),this._userProfile,this.isFree,((e,{editorFeatures:{proofit:t}},i)=>this.demoMode?U.disabled:i&&!t?U.upgradeIsNeeded:t&&(e||this.isInternalUser||!_.isNone(this._institution.get()))?U.enabled:U.disabled))}get preventAnimation(){return(0,l.pipe)(this._router.query.get("preventAnimation"),_.exists((e=>"true"===e)))}get demoMode(){return _.isSome(this.denali.globalExperimentDemoText)}get track3rdPartyExtensionsInjection(){const e=this._router.query.get("3rdPartyExtensionsInjections"),t=_.exists((e=>"false"===e)),i=_.exists((e=>"true"===e));return!t(e)&&(Math.random()<.1||i(e))&&!o.isTestUser(this._userProfile.get())}get disableAppsPromotion(){return(0,l.pipe)(this._router.query.get("disableAppsPromotion"),_.exists((e=>"true"===e)))}get isSmartPlagiarismUphookEnabled(){return this._exp.peekManakinExperiment(y.PlagiarismUphook,"test")}get banners(){return this.disableAppsPromotion||!_.isNone(this._institution.get())&&!o.isBusiness(this.denaliUserType)?_.none:_.some(new Z.BannersFeaturesImpl(this._userProfile,this._exp,this._settings,this._router,this.denaliUserType,this._isUserRegisteredBefore,this.denali.voxInfo,this._environment.info.browser,this.denali.llamaDiscoverabilityType))}get userRolePopup(){const e=new Date;e.setFullYear(e.getFullYear()-1);const t=this._userProfile.get().role,i=_.isNone(this._institution.get());return this._exp.isQuery("user_role_popup")?_.some(M.UserRolePopupMode.force):"msie"!==this._environment.info.browser&&i&&(_.isNone(t)||this._isUserRegisteredBefore(e)&&(0,l.pipe)(t,_.exists((e=>e===S.gG.school||e===S.j1.student))))?_.some(M.UserRolePopupMode.on):_.none}get lastSubscribedDateString(){return _.isNone(this._subscription)?u.s.create(_.none):this._subscription.value.view((e=>K.j.isOk(e)&&void 0!==e.value.lastSubscribedDate?_.some(e.value.lastSubscribedDate):_.none))}get subscriptionCampaign(){return _.isNone(this._subscription)?u.s.create(_.none):this._subscription.value.view((e=>K.j.isOk(e)&&void 0!==e.value.campaign?_.some(e.value.campaign):_.none))}get writingProgress(){return{enabled:this._exp.isQuery("learning_hub_mvp")||this._exp.isQuery("writing_progress_v2")||this._exp.isQuery("writing_progress_v3")||this._exp.isManakin(y.WritingProgress,"test")||this._exp.isManakin(y.WritingProgressV2,"test")||this._exp.isManakin(y.WritingProgressV3,"dashboard")||this._exp.isManakin(y.WritingProgressV3,"ipm")||o.isGrammarlyUser(this._userProfile.get())}}get goPremium(){return{enabled:this.isFree.get()}}get premiumBadge(){return{enabled:this.isPremium.get()}}get premiumCounter(){return{enabled:!this.isFree.get()}}get upgradeButton(){return{enabled:this.isFree.get()}}get trackWebVitals(){const e=this._router.query.get("webVitals");return this._environment.has(k.OH.Flag.supportsWebVitals)&&(0,l.pipe)(e,_.fold((()=>Math.random()<.01),(e=>"true"===e)))}get isReferralsEnabled(){return _.isNone(this._subscription)?u.s.create(!1):this._exp.isManakin(w.ReferralsGate,"enabled")?this._subscription.value.view((e=>{return K.j.isOk(e)&&!((i=e.value).isAppleSubscription||i.isGooglePlaySubscription)&&!!e.value.referralInfo.referralLink.key&&("OK"===(t=e.value.referralInfo).canReferUsersStatus||null!=t.referralHistory&&t.referralHistory.length>0);var t,i})):u.s.create(!1)}get proVsPremiumExperiment(){return!!this._exp.isQuery("grammarly_pro_m3")||this._exp.peekManakinExperiment(y.GrammarlyPro,"test")}get inProductDiscountsExperiment(){return!!this._exp.isQuery("in_product_discount")||this._exp.peekManakinExperiment(y.InProductDiscounts,"test")}assignSmartPlagiarismUphookExperiment(){this._exp.getManakinExperimentTreatment(y.PlagiarismUphook)}get isLongFormPremiumFeedEnabled(){return this.denaliUserType.type===r.Free&&(this._exp.isQuery("long_form_premium_feed")||this._exp.peekManakinExperiment(y.LongFormPremiumFeed,"test"))}constructor(e,t,i,r,o,d,h,c,m){(0,a._)(this,"_experimentClient",void 0),(0,a._)(this,"_experiments",void 0),(0,a._)(this,"_subscription",void 0),(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_clientControls",void 0),(0,a._)(this,"_environment",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"_vitoClient",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_institution",void 0),(0,a._)(this,"_instUserFeature",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"_nonInstUserFeature",void 0),(0,a._)(this,"isFree",void 0),(0,a._)(this,"isPremium",void 0),(0,a._)(this,"_isIPad",void 0),(0,a._)(this,"isMacEditor",void 0),(0,a._)(this,"instUserFeature",void 0),(0,a._)(this,"_instType",void 0),(0,a._)(this,"_instUserType",void 0),(0,a._)(this,"denali",void 0),(0,a._)(this,"proofitTest",void 0),(0,a._)(this,"proofitLastJob",void 0),(0,a._)(this,"plagiarism",void 0),(0,a._)(this,"tour",void 0),(0,a._)(this,"showChangeEmail",void 0),(0,a._)(this,"eduAdminPanelLink",void 0),(0,a._)(this,"appsSection",void 0),(0,a._)(this,"score",void 0),(0,a._)(this,"copyPasteMenuItems",void 0),(0,a._)(this,"quickReplacementsInCard",void 0),(0,a._)(this,"hideTitleInInstCard",void 0),(0,a._)(this,"showFullCards",void 0),(0,a._)(this,"defaultAcademicGenre",void 0),(0,a._)(this,"enableTrackingOnDownload",void 0),(0,a._)(this,"assignProVsPremiumExperiment",void 0),(0,a._)(this,"assignInProductDiscountExperiment",void 0),this._experimentClient=e,this._experiments=t,this._subscription=i,this._userProfile=r,this._settings=o,this._clientControls=d,this._environment=h,this._router=c,this._vitoClient=m,this._exp=new J(this._experimentClient,this._experiments.get(),this._router),this._institution=this._userProfile.view("institutionInfo"),this._instUserFeature=this._institution.view((e=>({enabled:this._router.query.has("instType")||_.isSome(e)}))),this._isUserRegisteredBefore=e=>(0,l.pipe)(this._userProfile.get().registrationDate,_.exists((t=>t<e))),this._nonInstUserFeature=this._instUserFeature.view((e=>({enabled:!e.enabled}))),this.isFree=this._userProfile.view((e=>e.type===S.ut.free||this._router.query.has("isFree"))),this.isPremium=this._userProfile.view((e=>e.type===S.ut.premium&&!this._router.query.has("isFree"))),this._isIPad=this._environment.platform===k.OH.Platform.IPAD,this.isMacEditor=this._environment.platform===k.OH.Platform.MACEDITOR,this.instUserFeature=this._instUserFeature,this._instType=this._institution.view((e=>(0,l.pipe)(this._router.query.get("instType"),_.filter((e=>Object.values(s).indexOf(e)>=0)),_.fold((()=>(0,l.pipe)(e,_.map((e=>["BUSINESS","NGO","GOV"].includes(e.organizationType)?s.Business:s.Edu)))),_.some)))),this._instUserType=this._institution.view(_.map((e=>e.admin?n.Admin:n.Member))),this.denali=new V(this._userProfile,this._settings,this._clientControls,this._router,this._exp,this._environment,this._instType,this.proofit,this,this._isUserRegisteredBefore),this.proofitTest=(0,l.pipe)(this._router.query.get("proofit"),_.map(X.c.stringToJobStatus)),this.proofitLastJob=(0,l.pipe)(this._router.query.get("proofitLastJob"),_.map(p.Yr.create)),this.plagiarism=u.s.combine(this._userProfile,this.isFree,((e,t)=>this.demoMode?U.disabled:e.editorFeatures.plagiarismDisabled?t?this.isSmartPlagiarismUphookEnabled?U.enabled:U.upgradeIsNeeded:U.disabled:U.enabled)),this.tour=this._nonInstUserFeature,this.showChangeEmail=this._nonInstUserFeature,this.eduAdminPanelLink=this._institution.view((e=>({enabled:(0,l.pipe)(e,_.map((e=>e.admin)),_.getOrElse(l.constFalse))}))),this.appsSection=u.s.create({enabled:!this.disableAppsPromotion}),this.score=this._userProfile.view((e=>({enabled:!e.editorFeatures.scoreDisabled}))),this.copyPasteMenuItems={enabled:!0},this.quickReplacementsInCard=this._userProfile.view((e=>({enabled:e.editorFeatures.quickReplacement}))),this.hideTitleInInstCard=u.s.combine(this._institution,this._userProfile,((e,t)=>({enabled:!_.isSome(e)||!t.editorFeatures.quickReplacement}))),this.showFullCards=this._userProfile.view((e=>({enabled:e.editorFeatures.fullCards}))),this.defaultAcademicGenre=u.s.create({enabled:!1}),this.enableTrackingOnDownload=u.s.create(!1),this.assignProVsPremiumExperiment=()=>{this._exp.getManakinExperimentTreatment(y.GrammarlyPro)},this.assignInProductDiscountExperiment=()=>{this._exp.getManakinExperimentTreatment(y.InProductDiscounts)}}}},98719:(e,t,i)=>{i.d(t,{gD:()=>r,uJ:()=>s,DJ:()=>y,jj:()=>w,aF:()=>x,yk:()=>k,$0:()=>P,ru:()=>n,YT:()=>O.Y,Sy:()=>S});var s={};i.r(s),i.d(s,{$:()=>b});var n={};i.r(n),i.d(n,{mV:()=>A});var r=i(39781),o=(i(50794),i(97015),i(23988)),a=i(10334),d=i(17171),l=i(80074),u=i(42543),h=i(65621),c=i(15491),p=i(78339),_=i(6987),m=i(54988),g=i(28600),f=i(86562),v=i(22438);class b{setState({type:e,state:t}){this.onlineState.modify((i=>(0,d._)((0,a._)({},i),{[e]:t})))}_getNextOfflineKey(e){if("offline"===e.network.type)return"network";if(e.wsProtocol.type!==v.k)return"wsProtocol";if(e.dox.type!==v.k)return"dox";if(e.wsDox.type!==v.k)return"wsDox";if(e.wsCapi.type!==v.k)return"wsCapi";if("slow"===e.network.type)return"network";const t=Object.keys(e).find((t=>"online"!==e[t].type));if(Boolean(t))throw new f.zU(`Expected that state is online but got '${t}' is '${e[t].type}'`);return null}constructor(e){(0,o._)(this,"_handlers",void 0),(0,o._)(this,"_subscription",void 0),(0,o._)(this,"_dispose",void 0),(0,o._)(this,"onlineState",void 0),(0,o._)(this,"networkOnline",void 0),this._handlers=e,this._dispose=new u.B7,this.onlineState=l.s.create({network:{type:v.k},dox:{type:v.k},wsProtocol:{type:v.k},wsDox:{type:v.k},wsCapi:{type:v.k}}),this.networkOnline=this.onlineState.view((e=>"offline"!==e.network.type)),(0,f.V1)(!this._subscription,"ConnectivityModel already subscribed"),this.onlineState.pipe(h.J(),c.T((([e,t])=>{const i=this._getNextOfflineKey(e),s=this._getNextOfflineKey(t);return{prevKey:i,prevState:Boolean(i)?e[i]:{type:v.k},nextKey:s,nextState:Boolean(s)?t[s]:{type:v.k}}})),p.p((({prevKey:e,prevState:t,nextKey:i,nextState:s})=>e!==i||t.type!==s.type||null===i)),_.n((({nextKey:e,nextState:t})=>(this._dispose.next(),null===e||t.type===v.k?m.w:this._handlers[e].handle(t).pipe(g.Q(this._dispose)))))).subscribe()}}var S=i(78408),y=i(54179),w=i(78018),x=(i(71449),i(76901)),k=i(99334),P=i(89096),C=i(95168),D=i(68533),E=i(46669);i(62822);class T{dismiss(){this._cancel()}remind(){this._cancel()}cancel(){this._cancel()}_cancel(){this._dismissStream.next(!1)}shown(){}constructor(){(0,o._)(this,"_dismissStream",new u.B7),(0,o._)(this,"getBannerState",void 0)}}class A extends T{install(){this.cancel(),Boolean(this._id)&&this._goToDocument(this._id)}constructor(e,t){super(),(0,o._)(this,"_proofit",void 0),(0,o._)(this,"_goToDocument",void 0),(0,o._)(this,"_id",void 0),(0,o._)(this,"_proofitStream",void 0),(0,o._)(this,"state",void 0),this._proofit=e,this._goToDocument=t,this._proofitStream=this._proofit.pipe(C.M((({id:e})=>this._id=e)),c.T((({id:e})=>null!==e))),this.state=this._dismissStream.pipe(D.h(this._proofitStream),E.F())}}i(37107),i(40464);var O=i(1424)},76901:(e,t,i)=>{i.d(t,{LF:()=>o,Rs:()=>r,n6:()=>n});var s=i(23988);const n={visible:!1,opts:{type:null}};class r{show(e){this._state.set({visible:!0,opts:e})}hide(){this._state.set(n)}constructor(e,t){(0,s._)(this,"_state",void 0),(0,s._)(this,"editorTsNotifications",void 0),(0,s._)(this,"state",void 0),this._state=e,this.editorTsNotifications=t,this.state=this._state.view()}}class o{show(){this._state.set({visible:!0})}hide(){this._state.set({visible:!1})}constructor(e){(0,s._)(this,"_state",void 0),(0,s._)(this,"state",void 0),this._state=e,this.state=this._state.view()}}},16432:(e,t,i)=>{i.d(t,{QN:()=>r,QS:()=>n,XH:()=>g,q3:()=>s});var s,n,r,o=i(23988),a=i(10334),d=i(17171),l=i(80074),u=i(68594),h=i(40027),c=i(86562),p=i(22835),_=i(36840);function m(e,t,i){return t.filter((t=>e(t)!==i))}!function(e){e.UserRole="userRole",e.SignOut="signOut",e.PremiumTopFeatures="premiumTopFeatures",e.ClientsComparison="clientsComparison",e.GrammarlyGoOnboarding="grammarlyGoOnboarding"}(s||(s={})),function(e){e.empty={dismiss:[],later:[],shown:[]}}(n||(n={})),function(e){e.Shown="shown",e.Dismiss="dismiss",e.Later="later"}(r||(r={}));class g{initialize(e){this._modals.set(e)}notHidden(e){return function(e,t){return!Boolean(e.dismiss.find((e=>e===t)))&&!e.later.find((e=>e.type===t&&e.expire>Date.now()))}(this._modals.get(),e)}notLater(e){return function(e,t){return!e.later.find((e=>e.type===t))}(this._modals.get(),e)}dispatch(e,t){switch(t.type){case r.Dismiss:return this._updateState({later:m((e=>e.type),this._modals.get().later,e),dismiss:[...m((e=>e),this._modals.get().dismiss,e),e]});case r.Shown:return this._updateState({shown:[...m((e=>e),this._modals.get().shown,e),e]});case r.Later:return this._updateState({later:[...m((e=>e.type),this._modals.get().later,e),{type:e,expire:Date.now()+t.expire}]});default:(0,c.xb)(t)}}_updateState(e){this._modals.modify((t=>p.yo(t,e)))}constructor(e){(0,o._)(this,"_settings",void 0),(0,o._)(this,"_modals",void 0),this._settings=e,this._modals=l.s.create(n.empty),(0,_.hJ)("resetModals",(()=>{this._settings.updateModals({shown:[],later:[],dismiss:[]})})),(0,_.hJ)("remindModal",(e=>{const t=this._settings.modals.get();this._settings.updateModals((0,d._)((0,a._)({},t),{later:[...t.later.filter((t=>t.type!==e)),{type:e,expire:Date.now()}]}))})),this._modals.pipe(u.i(1),h.Z(100)).subscribe((e=>{Boolean(this._settings)&&this._settings.updateModals(e)}))}}},99334:(e,t,i)=>{i.d(t,{d:()=>r});var s=i(23988),n=i(14650);class r{getNotInstalledAppsCount(){return this._clientsState.getAsArray().filter(n.X.isNotInstalled).length}isAppsVisible(){return this._appsSection&&this._getSupportedAppsCount()>0}isMyGrammarlyVisible(){return!this._clientsState.isEditorBlocked}_getSupportedAppsCount(){return this._clientsState.getAsArray().filter(n.X.isSupported).length}constructor(e,t,i){(0,s._)(this,"features",void 0),(0,s._)(this,"_clientsState",void 0),(0,s._)(this,"brandingSet",void 0),(0,s._)(this,"_appsSection",void 0),this.features=e,this._clientsState=t,this.brandingSet=i,this._appsSection=this.features.appsSection.get().enabled}}},37107:(e,t,i)=>{i.d(t,{$u:()=>$,CH:()=>Y,Jf:()=>V,Ks:()=>K,L0:()=>R,RM:()=>W,Z4:()=>z,ZJ:()=>ie,Zb:()=>ne,pK:()=>X,tl:()=>J,uD:()=>j,wq:()=>re,xR:()=>G});var s=i(83531),n=i(23988),r=i(10334),o=i(17171),a=i(69384),d=i(93267),l=i(82094),u=i(84647),h=i(95934),c=i(88041),p=i(85060),_=i(80074),m=i(60575),g=i(45887),f=i(63724),v=i(44781),b=i(89011),S=i(75363),y=i(5692),w=i(1717),x=i(83194),k=i(86562),P=i(65390),C=i(66202),D=i(23121),E=i(44869),T=i(34717),A=i(22835),O=i(77396),M=i(58193),I=i(94855),U=i(36840),B=i(80029),N=i(31373),F=i(16432);const L=(0,B.W)();var R,H,G,j,W,Z,q,V,z,X,K,Y,Q,J,$,ee,te;!function(e){e.ProofitPromo="proofit_promo",e.FreeClarityAlertsEnabled="free_clarity_alerts",e.FreeClarityAlertsControl="free_clarity_alerts_control",e.PremiumOnboarding="premium_onboarding",e.GBSatisfaction="gb_satisfaction",e.MostActiveUsers="most_active_users"}(R||(R={})),function(e){e.SuperScrollWithAutoJump="super_scroll_with_auto_jump",e.SuperScrollWithoutAutoJump="super_scroll_without_auto_jump"}(H||(H={})),function(e){e.AccountCreation="accountCreation",e.Tour="tour",e.TryWebsite="tryWebsite",e.ViewApps="viewApps",e.CustomizeSettings="customizeSettings"}(G||(G={})),function(e){e.UnlockPremium="unlockPremium",e.TopFeatures="topFeatures",e.ExploreAllProducts="exploreAllProducts"}(j||(j={})),function(e){e.HardDismiss="hardDismiss",e.SoftDismiss="softDismiss"}(W||(W={})),function(e){e.mapBySurveyType=function(e,t,i,s,n){switch(e){case R.ProofitPromo:return t(e);case R.FreeClarityAlertsEnabled:case R.FreeClarityAlertsControl:case R.MostActiveUsers:return i(e);case R.PremiumOnboarding:return s(e);case R.GBSatisfaction:return n(e);default:return(0,k.xb)(e)}}}(Z||(Z={})),function(e){e.Work="work",e.StrongTeams="strongTeams",e.StepUp="stepUp",e.FreeStyleGuide="freeStyleGuide",e.EveryTeammate="everyTeammate",e.Expensing="expensing",e.ViewPerformance="viewPerformance",e.ForWorkTrial="forWorkTrial",e.PremiumStyleGuide="premiumStyleGuide"}(q||(q={})),function(e){e.wordsCount="wordsCount",e.charsCount="charsCount",e.readingTime="readingTime",e.speakingTime="speakingTime",e.readabilityScore="readabilityScore"}(V||(V={})),function(e){e.Normal="Normal",e.Large="Large"}(z||(z={})),(z||(z={})).match=(e,t)=>i=>{switch(i){case z.Normal:return e;case z.Large:return t;default:return(0,k.xb)(i)}},function(e){e.Default="Default",e.Accessible="Accessible"}(X||(X={})),function(e){e.RTF="rtf",e.PDF="pdf",e.ProofitClarity="proofitClarity",e.MutedAlerts="mutedAlerts",e.Trash="trash",e.VersionHistory="versionHistory"}(K||(K={})),function(e){e.smbSpecificProfessionalism="smbSpecificProfessionalism",e.styleGuides="styleGuides"}(Y||(Y={})),function(e){e.prefix="cheetah",e.propertyName="onboardingState:editor"}(Q||(Q={})),function(e){var t=e.empty={firstCall:!1,seenWelcome:!1,suppressedWelcome:!1,dialectStrong:P.none,dialectWeak:P.none,banners:{dismiss:new Set,shown:new Set,later:new Set,cancelled:new Set},modals:F.QS.empty,businessBanner:{latestCloseTime:P.none,closed:[]},denaliLens:{},onboardingPassed:new Set,[Q.propertyName]:p.V.State.empty,showExitNotification:!0,showSetGoalsLoader:!0,seenDenaliWelcome:!1,seenSignOutSurvey:!1,footerCounterType:V.wordsCount,editorPreferences:{autoScrollToNextAlert:P.none,fontSize:z.Normal,suggestionsVisualMode:X.Default},survey:{},news:new Set,changePlanHook:{latestDismissAt:P.none,latestAppearances:[]},gbBannersUpHook:{[Y.smbSpecificProfessionalism]:{latestAppearances:[],latestDismissAt:P.none,dismissesCount:0},[Y.styleGuides]:{latestAppearances:[],latestDismissAt:P.none,dismissesCount:0}},dunningSettings:{dunningDismissCount:0,latestDismissAt:P.none},gbBillingMigrationSettings:{latestDismissAt:P.none},dunning_billing_status:P.none,featuresOnboardingSeen:new Set,ungated_trial_end_date:P.none,ungatedRenewalNotificationSettings:{latestAppearance:P.none,wasDismissed:!1},memberInviteOnboardingPassed:!1,safariDeactivatedWeb:!1,safariDeactivatedNative:!1,seenSafariExtNotification:!1,supportUkraineCardAppearanceCount:0,getStartedChecklistSettings:{dismissal:P.none,completedItems:new Set([G.AccountCreation])},getStartedPremiumChecklistSettings:{dismissal:P.none,completedItems:new Set([j.UnlockPremium])},llamaDiscoverabilitySettings:{modalDismissalTimestamp:P.none,bannerDismissalTimestamp:P.none},firstSeenTrashBin:P.none},i=e.extensionAutoCitationsBanners=g.n(["chrome-autoCitations","edge-chromium-autoCitations","safari-autoCitations","firefox-autoCitations"]),s=e.llamaBanners=g.n(["llama-mac-download-banner","llama-windows-download-banner"]),n=e.llamaPopups=g.n(["llama-mac-download-popup","llama-windows-download-popup"]),r=e.extensionBanners=g.n(["safari-extension","firefox-extension","chrome-extension","edge-extension","edge-chromium-extension",...i]),o=e.extensionAutoCitationsPopups=g.n(["chrome-autoCitations-popup","edge-chromium-autoCitations-popup","safari-autoCitations-popup","firefox-autoCitations-popup"]),a=e.extensionAppPopups=g.n(["chrome-popup","safari-popup","firefox-popup","edge-popup","edge-chromium-popup"]);e.isExtensionAutoCitationsPopup=function(e){return o.some((t=>t===e))};var d=e.extensionPopups=g.n([...a,...o]),l=e.gbBanners=g.n(["invite-members","invite-members-pro","style-guide","style-guide-pro","true-up"]),_=e.deDeprecationPopup="de-deprecation-popup",f=e.deDeprecationBanner="de-deprecation-banner";const y=g.n(["desktop-windows","desktop-mac",_,f]);var w=e.banners=g.n(["campaign-end","proofit-cancelled","proofit-completed","mobile-keyboard",...l,...r,...d,...s,...n,...y]);const x=g.Z.literalUnion("banner",w);var k=e.bannersType=h.qO({dismiss:g.Z.set(x),shown:g.Z.set(x),later:g.Z.fallback(g.Z.set(h.qO({type:x,expire:h.ai})),new Set),cancelled:g.Z.fallback(g.Z.set(x),new Set)});const E=h.zz(h.Yj,h.OH({dismissAllCounter:h.ai,important:h.zM})),T=g.Z.properties({firstCall:g.Z.withDefault(h.zM,t.firstCall),seenWelcome:g.Z.withDefault(h.zM,t.seenWelcome),suppressedWelcome:g.Z.withDefault(h.zM,t.suppressedWelcome),dialectStrong:g.Z.option(S.p.dialectType),dialectWeak:g.Z.option(S.p.dialectType),banners:g.Z.withDefault(k,t.banners),denaliLens:g.Z.fallback(E,t.denaliLens),onboardingPassed:g.Z.fallback(g.Z.set(g.Z.createStringEnum(b.E.StepId,"Onboarding")),t.onboardingPassed),showExitNotification:g.Z.withDefault(h.zM,t.showExitNotification)},"","legacyProps"),A=g.Z.properties({dunning_billing_status:g.Z.fallback(g.Z.option(h.Yj),t.dunning_billing_status),ungated_trial_end_date:g.Z.option(g.Z.date()),memberInviteOnboardingPassed:g.Z.fallback(h.zM,t.memberInviteOnboardingPassed),safariDeactivatedWeb:g.Z.fallback(h.zM,t.safariDeactivatedWeb),safariDeactivatedNative:g.Z.fallback(h.zM,t.safariDeactivatedNative),firstSeenTrashBin:g.Z.option(h.ai)},"","sharedProps"),O=h.qO({counter:h.ai,actual:h.zM,wasClosedAt:g.Z.option(g.Z.date())}),M=g.Z.properties({businessBanner:g.Z.withDefault(h.NW({latestCloseTime:g.Z.fallback(g.Z.option(h.ai),t.businessBanner.latestCloseTime),closed:g.Z.fallback(h.QZ(g.Z.createStringEnum(q,"string")),t.businessBanner.closed)}),t.businessBanner),modals:g.Z.withDefault(h.qO({dismiss:h.YO(g.Z.createStringEnum(F.q3,"string")),shown:h.YO(g.Z.createStringEnum(F.q3,"string")),later:h.YO(h.qO({expire:h.ai,type:g.Z.createStringEnum(F.q3,"string")}))}),t.modals),seenDenaliWelcome:g.Z.withDefault(h.zM,t.seenDenaliWelcome),seenSignOutSurvey:g.Z.withDefault(h.zM,t.seenSignOutSurvey),showSetGoalsLoader:g.Z.withDefault(h.zM,t.showSetGoalsLoader),footerCounterType:g.Z.fallback(g.Z.createStringEnum(V,"string"),V.wordsCount),editorPreferences:g.Z.fallback(h.NW({autoScrollToNextAlert:g.Z.fallback(g.Z.option(h.zM),t.editorPreferences.autoScrollToNextAlert),fontSize:g.Z.fallback(g.Z.createStringEnum(z,"FontSize"),t.editorPreferences.fontSize),suggestionsVisualMode:g.Z.fallback(g.Z.createStringEnum(X,"SuggestionsVisualMode"),t.editorPreferences.suggestionsVisualMode)}),t.editorPreferences),survey:g.Z.fallback(h.OH({[R.FreeClarityAlertsEnabled]:O,[R.FreeClarityAlertsControl]:O,[R.ProofitPromo]:h.qO({actual:h.zM})}),t.survey),news:g.Z.fallback(g.Z.set(g.Z.createStringEnum(K,"NewsItemId")),t.news),changePlanHook:g.Z.fallback(h.qO({latestAppearances:h.YO(g.Z.date()),latestDismissAt:g.Z.option(g.Z.date())}),t.changePlanHook),gbBannersUpHook:g.Z.fallback(h.NW({[Y.smbSpecificProfessionalism]:h.qO({latestAppearances:h.YO(g.Z.date()),latestDismissAt:g.Z.option(g.Z.date()),dismissesCount:h.ai}),[Y.styleGuides]:h.qO({latestAppearances:h.YO(g.Z.date()),latestDismissAt:g.Z.option(g.Z.date()),dismissesCount:h.ai})}),t.gbBannersUpHook),dunningSettings:g.Z.fallback(h.qO({dunningDismissCount:h.ai,latestDismissAt:g.Z.option(g.Z.date())}),t.dunningSettings),gbBillingMigrationSettings:g.Z.fallback(h.qO({latestDismissAt:g.Z.option(g.Z.date())}),t.gbBillingMigrationSettings),featuresOnboardingSeen:g.Z.fallback(g.Z.set(g.Z.createStringEnum(v.k,"FeatureOnboardingItemId")),t.featuresOnboardingSeen),ungatedRenewalNotificationSettings:g.Z.fallback(h.qO({latestAppearance:g.Z.option(g.Z.date()),wasDismissed:h.zM}),t.ungatedRenewalNotificationSettings),seenSafariExtNotification:g.Z.fallback(h.zM,t.seenSafariExtNotification),supportUkraineCardAppearanceCount:g.Z.fallback(h.ai,t.supportUkraineCardAppearanceCount),llamaDiscoverabilitySettings:g.Z.fallback(h.qO({modalDismissalTimestamp:g.Z.option(g.Z.date()),bannerDismissalTimestamp:g.Z.option(g.Z.date())}),t.llamaDiscoverabilitySettings),getStartedChecklistSettings:g.Z.fallback(h.qO({dismissal:g.Z.option(h.qO({type:g.Z.createStringEnum(W,"GetStartedChecklistDismissalType"),timestamp:g.Z.date()})),completedItems:g.Z.set(g.Z.createStringEnum(G,"GetStartedItemType"))}),t.getStartedChecklistSettings),getStartedPremiumChecklistSettings:g.Z.fallback(h.qO({dismissal:g.Z.option(h.qO({type:g.Z.createStringEnum(W,"GetStartedChecklistDismissalType"),timestamp:g.Z.date()})),completedItems:g.Z.set(g.Z.createStringEnum(j,"GetStartedPremiumItemType"))}),t.getStartedPremiumChecklistSettings)},"DN","namespacedProps"),I=g.Z.fallback(p.V.codec,p.V.State.empty),U=g.Z.properties({[Q.propertyName]:I},Q.prefix,"cheetahProps");var B=e.dapiPropsCodec=g.Z.combineProperties([T,A,M,U]);e.parse=function(...e){try{return(0,u.pipe)(B.decode(e),C.mapLeft(c.V2),C.mapLeft((e=>(m.Bx.Logging.getLogger("model.settings.parse").warn("fail",e),e))),C.getOrElse((()=>t)))}catch(e){return m.Bx.Logging.getLogger("model.settings.parse").error("fail",e),t}},e.serialize=function(e){return D.zb((()=>B.encode(e)))}}(J||(J={})),function(e){e.eq=E.OW({fontSize:E.w_,suggestionsVisualMode:E.w_,autoScrollToNextAlert:P.getEq(d.Eq)})}($||($={})),function(e){e.pruneDapiProperties=function(e){return(0,o._)((0,r._)({},e),{survey:e.survey&&(t=e.survey,l.LV((e=>Object.values(R).includes(e)))(t))});var t}}(ee||(ee={})),function(e){e.create=(e,t,i={})=>s=>({error:s,currentSettings:t,newSettings:i,source:e})}(te||(te={}));class ie{markFeatureOnboarded(e){return this.featuresOnboardingSeen.modify((t=>{const i=new Set(t);return i.add(e),i})),this._setProperty({featuresOnboardingSeen:this.featuresOnboardingSeen.get()},!1).catch((t=>{this._log.warn(`Cannot mark onboarding as complete for feature ${e}`,t)}))}getSurveyModel(e){return this._userSettings.view("survey",e).view(P.fromNullable)}setSurveyModel(e,t){return this._userSettings.lens("survey").lens(e).set(t),this._setProperty({survey:this._userSettings.lens("survey").get()},!1).catch((e=>{this._log.warn("Cannot update survey",e)}))}markNewsItemsAsSeen(e){const t=new Set(this.newsSeen.get());return e.forEach((e=>t.add(e))),this._setProperty({news:t},!1)}incrementDunningDismissCount(){return this._setProperty({dunningSettings:{dunningDismissCount:(0,N.J)(this.dunningSettings.get())?1:this.dunningSettings.view("dunningDismissCount").get()+1,latestDismissAt:P.some(T.Yr.now())}},!1)}supportUkraineCardSeen(){const e=this._userSettings.lens("supportUkraineCardAppearanceCount").get();return this._setProperty({supportUkraineCardAppearanceCount:e+1},!1)}trashBinSeen(){return this._setProperty({firstSeenTrashBin:P.some(T.xW.Timestamp.now())},!1)}_setProperty(e,t=!0,i){return y.j.modifyRemoteStateOptimistic(this._userSettings,A.JP(e),(()=>O.hq(this._sync(e,i)).catch((e=>{const{error:t}=e,i=(0,a._)(e,["error"]);throw this._log.handler("dapiError: save failed",i).warn(t),e}))),t)}firstCallDone(){return this._setProperty({firstCall:!0},!1).catch((e=>{e instanceof w.M?this._log.warn("Cannot set first call as done",e):this._log.error("Cannot set first call as done",e)}))}setDialect(e){return this._setProperty({dialectStrong:P.some(e)}).then((t=>e))}setDialectWeak(e){return this._setProperty({dialectWeak:P.some(e)}).then((t=>e))}updateFooterCounterType(e){return this._setProperty({footerCounterType:e},!1).catch((e=>this._log.warn("Cannot update footer counter type",e)))}welcomeTourSeen(){return this._setProperty({seenWelcome:!0},!1).catch((e=>this._log.warn("Cannot mark welcome tour as looked",e)))}denaliWelcomeTourSeen(){return this._setProperty({seenDenaliWelcome:!0},!1).catch((e=>this._log.warn("Cannot mark denali welcome tour as seen",e)))}markSignOutSurveySeen(){return this._setProperty({seenSignOutSurvey:!0},!1).catch((e=>this._log.warn("Cannot mark signOut survey as seen",e)))}updateBusinessBanner(e){return this._setProperty({businessBanner:e}).catch((e=>{e instanceof w.M?this._log.warn("Cannot update business banner state",e):this._log.error("Cannot update business banner state",e)}))}updateBanners(e){return this._setProperty({banners:e}).catch((t=>{t instanceof w.M?this._log.warn("Cannot update banners state",t,e):this._log.error("Cannot update banners state",t,e)}))}updateModals(e){return this._setProperty({modals:e}).catch((t=>{t instanceof w.M?this._log.warn("Cannot update modals state",t,e):this._log.error("Cannot update modals state",t,e)}))}toggleMarkAsImportant(e,t){const i=Object.assign({},this.denaliLens.get());return i[e]=Object.assign({},i[e],{important:t}),this._setProperty({denaliLens:Object.assign({},i)},!1)}dismissAll(e){var t,i;const s=Object.assign({},this.denaliLens.get());var n;return s[e]=Object.assign({},s[e],{dissmissAllCounter:Math.sqrt((n=Boolean(null===(t=s[e])||void 0===t?void 0:t.dismissAllCounter)?null===(i=s[e])||void 0===i?void 0:i.dismissAllCounter:0,1+(Boolean(n)?n*n:1)))}),this._setProperty({denaliLens:Object.assign({},s)},!1)}updateOnboardingPassed(e){const t=new Set(this._userSettings.get().onboardingPassed),i=t.size;return e.forEach((e=>t.add(e))),i===t.size?Promise.resolve():this._setProperty({onboardingPassed:t},!1)}updateCheetahOnboardingState(e){var t=this;return(0,s._)((function*(){const i=t._userSettings.get()[Q.propertyName],s=(0,r._)({},p.V.State.toClientState(i,"editor"),e),n=p.V.State.patch(s,"editor")(i);return t._setProperty({[Q.propertyName]:n},!1,{keepalive:!0}).catch((e=>{const{error:i}=e,s=(0,a._)(e,["error"]);t._log.handler("Cannot set remote Cheetah onboardingState",s).warn(i)}))}))()}updateExitNotification(e){return this._setProperty({showExitNotification:e},!1).catch((e=>{this._log.warn("Cannot set showExitNotification",e)}))}updateSetGoalsLoader(e){return this._setProperty({showSetGoalsLoader:e},!1).catch((e=>{this._log.warn("Cannot set showSetGoalsLoader",e)}))}updateEditorPreferences(e){return this._setProperty({editorPreferences:e},!1).catch((e=>{this._log.warn("Cannot update Editor Preferences",e)}))}changePlanHookSeen(){const{latestAppearances:e,latestDismissAt:t}=Object.assign({},this.changePlanHook.get());return e.push(T.Yr.now()),this._setProperty({changePlanHook:{latestDismissAt:t,latestAppearances:e.slice(-3)}},!1).catch((e=>this._log.warn("Cannot add appearance of change plan hook",e)))}dismissChangePlanHook(){const{latestAppearances:e}=Object.assign({},this.changePlanHook.get());return this._setProperty({changePlanHook:{latestDismissAt:P.some(T.Yr.now()),latestAppearances:e}},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}gbUpHookSeen(e){const t=this.gbBannersUpHook.get(),{[e]:i}=t,{latestAppearances:s}=i;return this._setProperty({gbBannersUpHook:(0,o._)((0,r._)({},t),{[e]:(0,o._)((0,r._)({},i),{latestAppearances:[...s,T.Yr.now()].slice(-3)})})},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}dismissGBUpHook(e){const t=this.gbBannersUpHook.get(),{[e]:i}=t;return this._setProperty({gbBannersUpHook:(0,o._)((0,r._)({},t),{[e]:(0,o._)((0,r._)({},i),{latestDismissAt:P.some(T.Yr.now()),dismissesCount:i.dismissesCount+1})})},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}ungatedRenewalNotificationDismissed(){return this._setProperty({ungatedRenewalNotificationSettings:{latestAppearance:P.some(T.Yr.now()),wasDismissed:!0}},!1).catch((e=>this._log.warn("Cannot set ungated notification dismiss status",e)))}ungatedRenewalNotificationSeen(){return this._setProperty({ungatedRenewalNotificationSettings:{latestAppearance:P.some(T.Yr.now()),wasDismissed:!1}},!1).catch((e=>this._log.warn("Cannot set ungated notification seen time",e)))}dismissGBBillingMigrationNotification(){return this._setProperty({gbBillingMigrationSettings:{latestDismissAt:P.some(T.Yr.now())}},!1).catch((e=>this._log.warn("Cannot update gb billing migration notification dismiss time",e)))}markSafariExtNotificationSeen(){return this._userSettings.get().seenSafariExtNotification?(this._log.error("Tried to mark SafariExtNotification as seen repeatedly."),Promise.resolve()):this._setProperty({seenSafariExtNotification:!0},!1).catch((e=>this._log.warn("Cannot set seenSafariExtNotification",e)))}updateGetStartedChecklistSettings(e){const t=this._userSettings.get().getStartedChecklistSettings,i=(0,r._)({},t,e);return this._setProperty({getStartedChecklistSettings:i},!1).catch((e=>this._log.warn("Unable to update getStartedChecklistSettings",e)))}updateGetStartedPremiumChecklistSettings(e){const t=this._userSettings.get().getStartedPremiumChecklistSettings,i=(0,r._)({},t,e);return this._setProperty({getStartedPremiumChecklistSettings:i},!1).catch((e=>this._log.warn("Unable to update getStartedPremiumChecklistSettings",e)))}updateLlamaDiscoverabilitySettings(e){const t=this._userSettings.get().llamaDiscoverabilitySettings,i=(0,r._)({},t,e);return this._setProperty({llamaDiscoverabilitySettings:i},!1).catch((e=>this._log.warn("Unable to update llamaDiscoverabilitySettings",e)))}constructor(e,t,i){(0,n._)(this,"_userSettings",void 0),(0,n._)(this,"_save",void 0),(0,n._)(this,"_userId",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"firstCall",void 0),(0,n._)(this,"dialect",void 0),(0,n._)(this,"dialectOrDefault",void 0),(0,n._)(this,"firstSeenTrashBin",void 0),(0,n._)(this,"seenWelcome",void 0),(0,n._)(this,"seenDenaliWelcome",void 0),(0,n._)(this,"seenSignOutSurvey",void 0),(0,n._)(this,"suppressedWelcome",void 0),(0,n._)(this,"banners",void 0),(0,n._)(this,"modals",void 0),(0,n._)(this,"businessBanner",void 0),(0,n._)(this,"denaliLens",void 0),(0,n._)(this,"onboardingPassed",void 0),(0,n._)(this,"showExitNotification",void 0),(0,n._)(this,"enableSetGoalsLoader",void 0),(0,n._)(this,"footerCounterType",void 0),(0,n._)(this,"editorPreferences",void 0),(0,n._)(this,"newsSeen",void 0),(0,n._)(this,"dunningSettings",void 0),(0,n._)(this,"dunningStatus",void 0),(0,n._)(this,"gbBillingMigrationSettings",void 0),(0,n._)(this,"changePlanHook",void 0),(0,n._)(this,"gbBannersUpHook",void 0),(0,n._)(this,"featuresOnboardingSeen",void 0),(0,n._)(this,"ungatedTrialEndDate",void 0),(0,n._)(this,"ungatedRenewalNotificationSettings",void 0),(0,n._)(this,"memberInviteOnboardingPassed",void 0),(0,n._)(this,"safariDeactivatedWeb",void 0),(0,n._)(this,"safariDeactivatedNative",void 0),(0,n._)(this,"seenSafariExtNotification",void 0),(0,n._)(this,"supportUkraineCardAppearanceCount",void 0),(0,n._)(this,"getStartedChecklistSettings",void 0),(0,n._)(this,"getStartedPremiumChecklistSettings",void 0),(0,n._)(this,"llamaDiscoverabilitySettings",void 0),(0,n._)(this,"cheetahOnboardingState",void 0),(0,n._)(this,"_saveToRemote",void 0),(0,n._)(this,"_syncRemote",void 0),(0,n._)(this,"_syncLocal",void 0),(0,n._)(this,"_sync",void 0),this._userSettings=e,this._save=t,this._userId=i,this._log=m.Bx.Logging.getLogger("model.settings"),this.firstCall=this._userSettings.lens("firstCall"),this.dialect=this._userSettings.view((e=>(0,u.pipe)(e.dialectStrong,M.NW(e.dialectWeak)))),this.dialectOrDefault=this.dialect.view(P.fold((()=>L.defaultDialect),(e=>e))),this.firstSeenTrashBin=this._userSettings.lens("firstSeenTrashBin"),this.seenWelcome=this._userSettings.lens("seenWelcome"),this.seenDenaliWelcome=this._userSettings.lens("seenDenaliWelcome"),this.seenSignOutSurvey=this._userSettings.lens("seenSignOutSurvey"),this.suppressedWelcome=this._userSettings.lens("suppressedWelcome"),this.banners=this._userSettings.lens("banners"),this.modals=this._userSettings.lens("modals"),this.businessBanner=this._userSettings.lens("businessBanner"),this.denaliLens=this._userSettings.lens("denaliLens"),this.onboardingPassed=this._userSettings.lens("onboardingPassed"),this.showExitNotification=this._userSettings.lens("showExitNotification"),this.enableSetGoalsLoader=this._userSettings.lens("showSetGoalsLoader"),this.footerCounterType=this._userSettings.lens("footerCounterType"),this.editorPreferences=this._userSettings.lens("editorPreferences"),this.newsSeen=this._userSettings.lens("news"),this.dunningSettings=this._userSettings.lens("dunningSettings"),this.dunningStatus=this._userSettings.lens("dunning_billing_status"),this.gbBillingMigrationSettings=this._userSettings.lens("gbBillingMigrationSettings"),this.changePlanHook=this._userSettings.lens("changePlanHook"),this.gbBannersUpHook=this._userSettings.lens("gbBannersUpHook"),this.featuresOnboardingSeen=this._userSettings.lens("featuresOnboardingSeen"),this.ungatedTrialEndDate=this._userSettings.lens("ungated_trial_end_date"),this.ungatedRenewalNotificationSettings=this._userSettings.lens("ungatedRenewalNotificationSettings"),this.memberInviteOnboardingPassed=this._userSettings.lens("memberInviteOnboardingPassed"),this.safariDeactivatedWeb=this._userSettings.view("safariDeactivatedWeb"),this.safariDeactivatedNative=this._userSettings.view("safariDeactivatedNative"),this.seenSafariExtNotification=this._userSettings.view("seenSafariExtNotification"),this.supportUkraineCardAppearanceCount=this._userSettings.view("supportUkraineCardAppearanceCount"),this.getStartedChecklistSettings=this._userSettings.lens("getStartedChecklistSettings"),this.getStartedPremiumChecklistSettings=this._userSettings.lens("getStartedPremiumChecklistSettings"),this.llamaDiscoverabilitySettings=this._userSettings.lens("llamaDiscoverabilitySettings"),this.cheetahOnboardingState=this._userSettings.lens(Q.propertyName),this._saveToRemote=(e,t)=>(0,u.pipe)(J.serialize(e),I.Mr,I.cy((e=>this._save(e,t)))),this._syncRemote=(e,t)=>(0,u.pipe)(this._saveToRemote(e),I.NW((i=>i instanceof f._d?(this._log.warn("Failed to serialize DAPI props",i),this._saveToRemote(ee.pruneDapiProperties(e),t)):I.kb(i))),I.qE(te.create("_syncRemote",this._userSettings.get(),e))),this._syncLocal=()=>(0,u.pipe)(J.serialize(this._userSettings.get()),C.bimap(te.create("_syncLocal",this._userSettings.get()),(e=>ne.write(this._userId,e)))),this._sync=(0,u.flow)(this._syncRemote,I.Q5(this._syncLocal)),(0,U.hJ)("clearFeaturesOnboarding",(()=>this._setProperty({featuresOnboardingSeen:new Set}))),(0,U.hJ)("clearNews",(()=>this._setProperty({news:new Set}))),(0,U.hJ)("clearSeenSafariExt",(()=>this._setProperty({seenSafariExtNotification:!1}))),(0,U.hJ)("clearCheetahOnboarding",(()=>this._setProperty({[Q.propertyName]:p.V.State.empty})))}}const se=`${L.userSettingsPrefix}${L.userSettingsVersion}-`;class ne{static read(e){try{const t=`${se}${e}`;return f.OA.of(JSON.parse(String(x.Qh(t)[t])))}catch(e){return f.OA.of({})}}static write(e,t){x.V_(f.OA.of({[`${se}${e}`]:JSON.stringify(t)}))}}var re;!function(e){e.Mock=class{markFeatureOnboarded(e){throw new Error("Method not implemented.")}markNewsItemsAsSeen(e){return Promise.resolve()}getSurveyModel(){throw new Error("Method not implemented.")}setSurveyModel(){throw new Error("Method not implemented.")}updateSetGoalsLoader(e){return Promise.resolve()}ungatedRenewalNotificationSeen(){return Promise.resolve()}ungatedRenewalNotificationDismissed(){return Promise.resolve()}toggleMarkAsImportant(e,t){return Promise.resolve()}dismissAll(e){return Promise.resolve()}updateOnboardingPassed(e){return Promise.resolve()}incrementDunningDismissCount(){return Promise.resolve()}updateExitNotification(e){return Promise.resolve()}denaliWelcomeTourSeen(){return Promise.resolve()}markSignOutSurveySeen(){return Promise.resolve()}updateFooterCounterType(e){return Promise.resolve()}updateEditorPreferences(e){return Promise.resolve()}changePlanHookSeen(){return Promise.resolve()}markSafariExtNotificationSeen(){return Promise.resolve()}dismissChangePlanHook(){return Promise.resolve()}gbUpHookSeen(e){return Promise.resolve()}dismissGBUpHook(e){return Promise.resolve()}premiumPreviewUnderlinesSeen(){return Promise.resolve()}dismissGBBillingMigrationNotification(){return Promise.resolve()}supportUkraineCardSeen(){return Promise.resolve()}updateGetStartedChecklistSettings(e){return Promise.resolve()}updateGetStartedPremiumChecklistSettings(e){return Promise.resolve()}updateLlamaDiscoverabilitySettings(e){return Promise.resolve()}updateCheetahOnboardingState(){return Promise.resolve()}constructor(){(0,n._)(this,"footerCounterType",_.s.create(V.wordsCount)),(0,n._)(this,"seenDenaliWelcome",_.s.create(!1)),(0,n._)(this,"seenSignOutSurvey",_.s.create(!1)),(0,n._)(this,"enableSetGoalsLoader",_.s.create(!0)),(0,n._)(this,"denaliLens",_.s.create({})),(0,n._)(this,"onboardingPassed",_.s.create(new Set)),(0,n._)(this,"cheetahOnboardingState",_.s.create(p.V.State.empty)),(0,n._)(this,"newsSeen",_.s.create(new Set)),(0,n._)(this,"showExitNotification",_.s.create(!0)),(0,n._)(this,"editorPreferences",_.s.create({autoScrollToNextAlert:P.none,fontSize:z.Normal,suggestionsVisualMode:X.Default})),(0,n._)(this,"changePlanHook",_.s.create({latestAppearances:[],latestDismissAt:P.none})),(0,n._)(this,"gbBannersUpHook",_.s.create({[Y.smbSpecificProfessionalism]:{latestAppearances:[],latestDismissAt:P.none,dismissesCount:0},[Y.styleGuides]:{latestAppearances:[],latestDismissAt:P.none,dismissesCount:0}})),(0,n._)(this,"dunningSettings",_.s.create({dunningDismissCount:0,latestDismissAt:P.none})),(0,n._)(this,"dunningStatus",_.s.create(M.Ie())),(0,n._)(this,"gbBillingMigrationSettings",_.s.create({latestDismissAt:P.none})),(0,n._)(this,"featuresOnboardingSeen",_.s.create(new Set)),(0,n._)(this,"ungatedRenewalNotificationSettings",_.s.create({wasDismissed:!1,latestAppearance:P.none})),(0,n._)(this,"ungatedTrialEndDate",_.s.create(P.none)),(0,n._)(this,"seenSafariExtNotification",_.s.create(!1)),(0,n._)(this,"supportUkraineCardAppearanceCount",_.s.create(0)),(0,n._)(this,"getStartedChecklistSettings",_.s.create({dismissal:P.none,completedItems:new Set})),(0,n._)(this,"getStartedPremiumChecklistSettings",_.s.create({dismissal:P.none,completedItems:new Set})),(0,n._)(this,"llamaDiscoverabilitySettings",_.s.create({modalDismissalTimestamp:P.none,bannerDismissalTimestamp:P.none}))}}}(re||(re={}))},92676:(e,t,i)=>{i.d(t,{U:()=>g,d:()=>s});var s,n=i(83531),r=i(23988),o=i(80074),a=i(60575),d=i(6987),l=i(36094),u=i(86562),h=i(60080);!function(e){e.UNMOUNTED="UNMOUNTED",e.MOUNTED="MOUNTED",e.MOUNTING="MOUNTING",e.READY="READY",e.LOADING="LOADING",e.CANCEL="CANCEL",e.AUTHORIZED="AUTHORIZED",e.ERROR="ERROR"}(s||(s={}));const c=(e,t)=>new Promise(((i,s)=>e(t,((e,t)=>{if(Boolean(e))return s(e);i(t)}))));var p;!function(e){e.isBlockedPopupWarn=e=>/Can not open popup window - blocked/.test(e.message)}(p||(p={}));class _{constructor(e){(0,r._)(this,"_isPaymentSandbox",void 0),(0,r._)(this,"_log",void 0),(0,r._)(this,"_checkoutInstance",void 0),(0,r._)(this,"_state",void 0),(0,r._)(this,"state",void 0),(0,r._)(this,"_isUnmounted",void 0),(0,r._)(this,"teardown",void 0),(0,r._)(this,"_shouldBlockPayPal",void 0),(0,r._)(this,"init",void 0),this._isPaymentSandbox=e,this._log=a.Bx.Logging.getLogger("model.subscription.braintree.paypal"),this._state=o.s.create({kind:s.UNMOUNTED}),this.state=this._state,this._isUnmounted=()=>this._state.view((({kind:e})=>e===s.UNMOUNTED)).get(),this.teardown=()=>{Boolean(this._checkoutInstance)&&this._checkoutInstance.teardown(),this._state.set({kind:s.UNMOUNTED})},this._shouldBlockPayPal=()=>window.name.includes("xcomponent");var t,h=this;this.init=(t=(0,n._)((function*(e,t){if(h._state.set({kind:s.MOUNTING}),h._shouldBlockPayPal())return void h._state.set({kind:s.ERROR,error:"PayPal exploit detected",recoverable:!1});const{Paypal:n}=yield Promise.all([i.e(2074),i.e(5874)]).then(i.bind(i,68606));try{if(!h._isPaymentSandbox){const t=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,32983,23));h._checkoutInstance=yield t.create({client:e})}}catch(e){h._state.set({kind:s.ERROR,error:e,recoverable:!1})}return n.Button.render({env:h._isPaymentSandbox?"sandbox":"production",style:{label:"paypal",size:"medium",shape:"pill",color:"gold"},validate:e=>{h._isPaymentSandbox?e.disable():e.enable(),h._state.set({kind:s.READY})},onClick:()=>{h._state.set({kind:s.LOADING}),h._isPaymentSandbox&&h._state.set({kind:s.AUTHORIZED,nonce:"fake-paypal-billing-agreement-nonce"})},payment:()=>h._checkoutInstance.createPayment({flow:"vault"}),onAuthorize:e=>(h._state.set({kind:s.LOADING}),h._checkoutInstance.tokenizePayment(e).then((e=>h._state.set({kind:s.AUTHORIZED,nonce:e.nonce}))).catch((e=>h._state.set({kind:s.ERROR,error:e,recoverable:!0})))),onCancel:()=>h._state.set({kind:s.CANCEL}),onError:e=>{h._isUnmounted()||(p.isBlockedPopupWarn(e)?h._log.error("Cannot open popup",e):h._state.set({kind:s.ERROR,error:e,recoverable:!0}))}},t).then((()=>{h._state.set({kind:s.MOUNTED})})).catch((e=>{h._isUnmounted()||h._state.set({kind:s.ERROR,error:e,recoverable:!1})}))})),function(e,i){return t.apply(this,arguments)}),this._state.pipe(d.n(l._F.rafScheduler)).subscribe((e=>{switch(this._log.debug("Paypal state changed",e),e.kind){case s.UNMOUNTED:case s.MOUNTING:case s.MOUNTED:break;case s.LOADING:this._log.info("Paypal button clicked");break;case s.AUTHORIZED:this._log.info("Paypal authorized"),this._state.set({kind:s.READY});break;case s.CANCEL:this._log.info("Paypal cancel"),this._state.set({kind:s.READY});break;case s.READY:break;case s.ERROR:e.recoverable?(this._log.warn("Paypal integration error, recoverable",e.error),this._state.set({kind:s.READY})):(this._log.error("Paypal integration error, fatal",e.error),this.teardown());break;default:(0,u.xb)(e)}}))}}class m{constructor(e){(0,r._)(this,"_notificationModel",void 0),(0,r._)(this,"_log",void 0),(0,r._)(this,"_teardownInProgress",void 0),(0,r._)(this,"_state",void 0),(0,r._)(this,"state",void 0),(0,r._)(this,"_hostedFields",void 0),(0,r._)(this,"updateCreditCard",void 0),(0,r._)(this,"init",void 0),(0,r._)(this,"teardown",void 0),this._notificationModel=e,this._log=a.Bx.Logging.getLogger("model.subscription.braintree.creditCard"),this._teardownInProgress=!1,this._state=o.s.create(s.UNMOUNTED),this.state=this._state,this.updateCreditCard=()=>new Promise(((e,t)=>{this._hostedFields.tokenize(((i,s)=>{if(Boolean(i)){const{fields:e}=this._hostedFields.getState();return Object.keys(e).forEach((t=>{e[t].isValid||e[t].container.classList.add("braintree-hosted-fields-invalid")})),void t(i)}return Boolean(s)||t(i),Object.keys(this._hostedFields.getState().fields).forEach((e=>this._hostedFields.clear(e))),e(s)}))})).then((e=>(this._log.info("CreditCard updated"),e))).catch((e=>{throw this._log.error("CreditCard error",e),e}));var t,d=this;this.init=(t=(0,n._)((function*(e,{styles:t,fields:n}){try{const r={client:e,styles:t,fields:n},o=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,82510,23));d._hostedFields=yield c(o.create,r),d._state.set(s.MOUNTED),d._log.info("CreditCard fields initialized")}catch(e){if(Boolean(e)&&"HOSTED_FIELDS_INVALID_FIELD_SELECTOR"!==e.code)return;d._notificationModel.setNotification(h.d.unknownError)}})),function(e,i){return t.apply(this,arguments)}),this.teardown=()=>{try{if(this._notificationModel.clearNotification(),this._teardownInProgress)return;return this._teardownInProgress=!0,Boolean(this._hostedFields)?this._hostedFields.teardown((e=>{this._teardownInProgress=!1,Boolean(e)?this._log.error("Could not tear down Hosted Fields!",e):this._state.set(s.UNMOUNTED)})):this._hostedFields}catch(e){this._log.warn("Braintree teardown error",e)}}}}class g{_generateToken(){var e=this;return(0,n._)((function*(){const{token:t}=yield e._subscriptionApi.generateClientToken();return t}))()}constructor(e,t,s){(0,r._)(this,"_notificationModel",void 0),(0,r._)(this,"_subscriptionApi",void 0),(0,r._)(this,"_isPaymentSandbox",void 0),(0,r._)(this,"_creditCard",void 0),(0,r._)(this,"_paypal",void 0),(0,r._)(this,"_braintreeClient",void 0),(0,r._)(this,"updateCreditCard",void 0),(0,r._)(this,"creditCardState",void 0),(0,r._)(this,"paypalState",void 0),(0,r._)(this,"init",void 0),(0,r._)(this,"teardown",void 0),(0,r._)(this,"_getBraintreeClient",void 0),this._notificationModel=e,this._subscriptionApi=t,this._isPaymentSandbox=s,this._creditCard=new m(this._notificationModel),this._paypal=new _(this._isPaymentSandbox),this.updateCreditCard=this._creditCard.updateCreditCard,this.creditCardState=this._creditCard.state,this.paypalState=this._paypal.state;var o,a=this;this.init=(o=(0,n._)((function*(e,t){a._notificationModel.clearNotification();const i=yield a._getBraintreeClient();a._creditCard.init(i,t),a._paypal.init(i,e)})),function(e,t){return o.apply(this,arguments)}),this.teardown=()=>{this._paypal.teardown(),this._creditCard.teardown()};var d=this;this._getBraintreeClient=(0,n._)((function*(){const e=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,33562,23));if(Boolean(d._braintreeClient))return d._braintreeClient;const t=yield d._generateToken(),s=yield c(e.create,{authorization:t});return d._braintreeClient=s,s}))}}},40464:(e,t,i)=>{i.d(t,{E2:()=>O,H0:()=>M,n6:()=>A});var s=i(83531),n=i(23988),r=i(10334),o=i(17171),a=i(94855),d=i(84647),l=i(95934),u=i(58508),h=i(80074),c=i(85791),p=i(60575),_=i(5692),m=i(6987),g=i(36094),f=i(78339),v=i(19711),b=i(15491),S=i(80837),y=i(85076),w=i(42543),x=i(82718),k=i(23121),P=i(66202),C=i(28421),D=i(65390),E=i(92676),T=i(60080);const A=_.j.defaultValue(),O=l.E$([c.it.codec,l.NW({plans:l.YO(c.yB.codec),referralInfo:c.SK.codec}),l.OH({nextPayDate:l.Yj,currentPlan:c.yB.codec,expirationDate:l.Yj})]);class M{dispose(){this._subs.dispose()}clearNotification(){this._notification.set(null)}navigateToSubscribeUrl(){document.location.href=this._config.funnel.subscribe}navigateToUpgradeUrl(e){(0,d.pipe)(k.zb((()=>this._upgradeHook.fromHome(e))),P.chain(this._platformEnvironment.actions.openUrl),P.getOrElse((e=>this._log.fatal("unexpected error on open upgrade page",e))))}renew(){var e=this;return(0,s._)((function*(){yield e._subscriptionApi.renewSubscription(),e._reloadSubscription()}))()}changePlan(e){var t=this;return(0,s._)((function*(){yield t._subscriptionApi.changePlan(e),t._reloadSubscription()}))()}getPlans(){var e=this;return(0,s._)((function*(){return e._reloadSubscription(),e.state.pipe(m.n(g._F.rafScheduler),f.p(_.j.isOk),v.$(),b.T((e=>e.value)),b.T((e=>e.plans||[]))).toPromise()}))()}_reloadSubscription(){this._subscriptionTrigger.next()}constructor(e,t,i,s,l,c){(0,n._)(this,"state",void 0),(0,n._)(this,"_subscriptionApi",void 0),(0,n._)(this,"_config",void 0),(0,n._)(this,"_platformEnvironment",void 0),(0,n._)(this,"_upgradeHook",void 0),(0,n._)(this,"_isPaymentSandbox",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_subs",void 0),(0,n._)(this,"_notification",void 0),(0,n._)(this,"_getSubscription",void 0),(0,n._)(this,"_subscriptionTrigger",void 0),(0,n._)(this,"braintreeApi",void 0),(0,n._)(this,"setNotification",void 0),this.state=e,this._subscriptionApi=t,this._config=i,this._platformEnvironment=s,this._upgradeHook=l,this._isPaymentSandbox=c,this._log=p.Bx.Logging.getLogger("model.subscription"),this._subs=new S.y.Keeper,this._notification=h.s.create(null),this._getSubscription=y.l((0,a.TX)((()=>Promise.all([this._subscriptionApi.getStatus(),this._subscriptionApi.getReferralInfo()]).then((([e,t])=>(e.plans||(e.plans=[]),(0,o._)((0,r._)({},e),{referralInfo:t}))))),d.unsafeCoerce),[(0,u.Oh)(3),I(1e3)],(e=>!("code"in e)||401!==e.code)),this._subscriptionTrigger=new w.B7,this.braintreeApi=new E.U(this,this._subscriptionApi,this._isPaymentSandbox),this.setNotification=(e,t)=>{requestAnimationFrame((()=>this._notification.set({type:e,planName:t})))},this._subs.push(this._subscriptionTrigger.pipe(x.K(this._getSubscription),f.p((e=>!(C.LT(e)&&_.j.isError(this.state.get())))),b.T(_.j.fromRD)).subscribe(g.H9(this.state)),this.state.subscribe((e=>{_.j.isError(e)&&1===e.attempt?this._log.warn("cant get user subscription",e.error):_.j.isFatal(e)&&(this._log.error("cant get user subscription",e.error),this.setNotification(T.d.unknownError))}))),_.j.isOk(e.get())||this._reloadSubscription()}}const I=e=>t=>D.some(t.iterNumber*e)},60080:(e,t,i)=>{var s;i.d(t,{d:()=>s}),function(e){e[e.updateBilling=0]="updateBilling",e[e.paymentError=1]="paymentError",e[e.subscriptionUpdated=2]="subscriptionUpdated",e[e.subscriptionCancelled=3]="subscriptionCancelled",e[e.cantUpgradeSubscription=4]="cantUpgradeSubscription",e[e.resumedSubscription=5]="resumedSubscription",e[e.cantResumeSubscription=6]="cantResumeSubscription",e[e.unknownError=7]="unknownError",e[e.unknownOrigin=8]="unknownOrigin",e[e.blobDownloadUnsupported=9]="blobDownloadUnsupported",e[e.mobileCancel=10]="mobileCancel",e[e.paypalSuccess=11]="paypalSuccess",e[e.paypalError=12]="paypalError"}(s||(s={}))},1424:(e,t,i)=>{i.d(t,{Y:()=>s});var s,n=i(23988),r=i(84647),o=i(52839),a=i(96509),d=i(60575),l=i(74416),u=i(23121),h=i(66202),c=i(76720),p=i(86562),_=i(38908),m=i(74056),g=i(92622),f=i(37107);!function(e){let t;!function(e){let i,s,n;!function(e){e.editorMenu="editorMyGrammarly",e.editorReferrals="editorReferrals",e.editorMenuBusiness="editorBusinessHomePageMenu"}(i=e.Home||(e.Home={})),e.isHome=function(e){return Object.values(t.Home).some((t=>t===e))},function(e){e.editorDenaliAdvanced="editorAdvancedIssues",e.editorDenaliSuccessState="editorSuccessState",e.editorDenaliDelivery="editorDeliveryTooltip",e.editorDenaliEngagement="editorEngagementTooltip",e.editorDenaliPlagiarism="editorPlagiarismTooltip",e.editorDenaliProofit="editorProofreadingTooltip",e.editorDenaliOverview="editorDenaliOverview",e.editorDenaliGoals="editorDenaliGoals",e.editorDenaliDocumentSettings="editorDenaliDocumentSettings",e.editorDenaliUpgradeInline="editorDenaliUpgradeInline",e.editorDenaliChecksFeed="editorDenaliChecksFeed",e.oggyPlagiarismUphook="oggyPlagiarismUphook"}(s=e.DenaliDocument||(e.DenaliDocument={})),function(e){e.gdocsSidebarCardList="gdocsSidebarCardList",e.gdocsSidebarSuccessView="gdocsSidebarSuccessView",e.gdocsGoals="gdocsGoals",e.assistantCardList="assistantCardList",e.extensionSettingsAssistant="extensionSettingsAssistant"}(n=e.Extension||(e.Extension={}))}(t=e.Place||(e.Place={}));class i{fromHome(e,t,i){return e===s.Place.Home.editorMenuBusiness?this._businessHook(t,i):this._from(e).addParams({upgradeFrom:this._env.names.funnel})}fromDenaliDocumentToPlans(e,t,s,n,o){const a=this._from(e).addParams({doc_id:t,upgradeFrom:this._env.names.funnel});return(0,r.pipe)(u.zb((()=>{const e=o?l.Q.prism.reverseGet(o.get()):0;return e>5?a.addParams({plagiarism:e.toString()}):a})),h.mapLeft((e=>this._log.error("can not append plagiarismPercent",e))),h.chain((e=>(0,r.pipe)(u.zb((()=>e.addParams(i._encodeCategorizedAlerts(s)))),h.mapLeft((e=>this._log.error("can not append encoded alertsByCategories",e)))))),h.chain((e=>(0,r.pipe)(u.zb((()=>e.addParams(i._encodeLensedAlerts(n)))),h.mapLeft((e=>this._log.error("can not append encoded alertsByLenses",e)))))),h.getOrElse((()=>a)))}fromDenaliDocumentToUpgrade(e,t){return this._from(e).addParams({doc_id:t,redirectUphookToUpgradePageExp:"1",upgrade:"1"})}fromDenaliDocumentToUpgradeTry(e,t){const i=this._from(e).addParams({doc_id:t,redirectUphookToUpgradePageExp:"1"});return new c.U(this._config.funnel.upgradeTry,i.params)}fromGbUpHookNotification(e){return new c.U(e===f.CH.styleGuides?this._config.funnel.businessStyleguideLanding:this._config.funnel.businessLanding).addParams(i._hookMeta).addParams({utm_campaign:"webEditorDocumentPopupGBp",utm_content:e})}fromGrammarlyGO(){return new c.U(this._config.funnel.plans).addParams(i._hookMeta).addParams({utm_campaign:"webEditorGrammarlyGoPrompts"})}fromGbVoxUpHookLens(){return new c.U(this._config.funnel.businessStyleguideLanding).addParams(i._hookMeta).addParams({utm_campaign:"gbDenaliVoxLens"})}_businessHook(e,t){const s=this._userType.get(),{plans:n,businessUpgradeLanding:r}=this._config.funnel,o=!0===t?r:n;return new c.U(o).addParams(i._hookMeta).addParams(i._encodeBusinessPlatform(s,this._env.platform)).addParams({utm_content:e})}_from(e){return new c.U(this._config.api.redirect).addParams({page:"free",hash:o(this._userId.get()),app_type:i._getAppType(this._env.platform)}).addParams(i._hookMeta).addParams(i._encodePlace(e,this._env.platform))}static _getAppType(e){switch(e){case m.OH.Platform.WEB:case m.OH.Platform.IPAD:case m.OH.Platform.MACEDITOR:return"app";default:return(0,p.xb)(e)}}static _encodePlace(e,i){return e===t.DenaliDocument.oggyPlagiarismUphook?{utm_campaign:`${i}Editor_plagiarism_plagiarismView_premium`}:{utm_campaign:`${i}${_.PT(e)}`}}static _encodeBusinessPlatform(e,t){return{utm_campaign:`${t}EditorMyGrammarlyGB${e===g.ut.free?"f":"p"}`}}static _encodeCategorizedAlerts(e){return e.forEach((e=>{(0,p.V1)(6===Object.keys(e).length,"alert group should had exactly six keys",(()=>JSON.stringify(e)))})),{alerts:this._compress(e)}}static _encodeLensedAlerts(e){return e.forEach((e=>{(0,p.V1)(3===Object.keys(e).length,"alert group should had exactly four keys",(()=>JSON.stringify(e)))})),{lensedAlerts:this._compress(e)}}static _compress(e){const t=a.compressToEncodedURIComponent(JSON.stringify(e));return(0,p.V1)(t.length<1500,"serialized data exceeded allowed size",(()=>JSON.stringify({size:t.length,data:e}))),t}constructor(e,t,i,s){(0,n._)(this,"_config",void 0),(0,n._)(this,"_env",void 0),(0,n._)(this,"_userId",void 0),(0,n._)(this,"_userType",void 0),(0,n._)(this,"_log",void 0),this._config=e,this._env=t,this._userId=i,this._userType=s,this._log=d.Bx.Logging.getLogger("model.UpgradeHook")}}(0,n._)(i,"_hookMeta",{utm_medium:"internal",utm_source:"upHook"}),e.Impl=i,e.Mock=class{fromHome(e){throw new Error("Method not implemented.")}fromDenaliDocumentToPlans(e,t,i){throw new Error("Method not implemented.")}fromDenaliDocumentToUpgrade(e,t){throw new Error("Method not implemented.")}fromDenaliDocumentToUpgradeTry(e,t){throw new Error("Method not implemented.")}fromGbUpHookNotification(e){throw new Error("Method not implemented.")}fromGbVoxUpHookLens(){throw new Error("Method not implemented.")}fromGrammarlyGO(){throw new Error("Method not implemented.")}}}(s||(s={}))},70932:(e,t,i)=>{i.d(t,{l:()=>l});var s=i(50659),n=i(60575),r=i(20408),o=i(74056),a=i(93712),d=i(12416);const l=()=>{const e=(0,o.W$)(new a.Qt).base.error500page,t=s.useContext(r._.Context),i=e.description(t.support.troubleshooting.diagnosticTestPath,t.support.troubleshooting.somethingWentWrong);return n.Bx.TimeSeries.rootFemetrics.getMetric("error").getCounter("500").increment(),s.createElement(d.M,{title:e.title,description:i})}},39982:(e,t,i)=>{i.d(t,{j:()=>s});var s,n=i(10334),r=i(17171),o=i(84647),a=i(90875),d=i(65390),l=i(81870);!function(e){let t,i,s,u,h,c,p;function _(e){return e.status===a.c.JobStatus.building||e.status===a.c.JobStatus.newJob}!function(e){e.new="new",e.loading="loading",e.existing="existing",e.deleted="deleted"}(t=e.Kind||(e.Kind={})),function(e){e.todayDocs="todayDocs",e.yesterdayDocs="yesterdayDocs",e.earlierDocs="earlierDocs"}(i=e.Group||(e.Group={})),function(e){e.create=()=>({kind:t.new})}(s=e.New||(e.New={})),function(e){e.create=()=>({kind:t.loading})}(u=e.Loading||(e.Loading={})),function(e){e.create=(e,i=d.none)=>p.create(t.existing)(e,i)}(h=e.Existing||(e.Existing={})),function(e){e.create=(e,i=d.none)=>p.create(t.deleted)(e,i)}(c=e.Deleted||(e.Deleted={})),function(e){e.create=e=>(t,i=d.none)=>{const s=d.fromNullable(t.proofit);return{kind:e,document:t,groupStarter:i,proofit:{result:s,inProgress:(0,o.pipe)(s,d.exists(_))}}},e.updateProofit=e=>t=>{const i=(0,o.pipe)(t,d.alt((()=>e.proofit.result)));return(0,r._)((0,n._)({},e),{proofit:{result:i,inProgress:(0,o.pipe)(i,d.exists(_))}})},e.getDestination=e=>l.Lz.routes.denali_editor.href({docId:e.document.id.toString()})}(p=e.WithDocument||(e.WithDocument={})),e.isNew=e=>e.kind===t.new,e.isLoading=e=>e.kind===t.loading,e.isExisting=e=>e.kind===t.existing,e.isDeleted=e=>e.kind===t.deleted,e.isProofitInProgress=_,e.isProofitCompleted=function(e){return e.status===a.c.JobStatus.completed}}(s||(s={}))},704:(e,t,i)=>{var s,n;i.d(t,{P:()=>s,b:()=>n}),function(e){let t,i,s,n,r;!function(e){e.GetPremiumButton="get_premium_button"}(t=e.Metrics||(e.Metrics={})),function(e){e.Click="clicks",e.Show="shows",e.Dismiss="dismisses"}(i=e.MetricsActions||(e.MetricsActions={})),function(e){e.AdvancedIssues="advancedIssues",e.Tooltip="tooltip",e.Navigation="navigation"}(s=e.UpgradeHookName||(e.UpgradeHookName={})),function(e){e.Assistant="assistant",e.Sidebar="sidebar",e.PlagiarismTooltip="plagiarismTooltip",e.ProofreadingTooltip="proofreadingTooltip"}(n=e.UpgradeHookSlot||(e.UpgradeHookSlot={})),function(e){e.premium="premium",e.premiumTrial="premiumTrial",e.pro="pro",e.discountPro="discountPro",e.discountPremium="discountPremium"}(r=e.UpgradeHookVariant||(e.UpgradeHookVariant={}))}(s||(s={})),function(e){let t,i;!function(e){e.SpecialOfferEligibility="special_offer_eligibility"}(t=e.Metrics||(e.Metrics={})),function(e){e.RequestAttemptsTotal="request_attempts_total",e.RequestSuccessTotal="request_success_total",e.RequestFailuresTotal="request_failures_total"}(i=e.MetricsActions||(e.MetricsActions={}))}(n||(n={}))},16721:(e,t,i)=>{i.d(t,{Y:()=>s});var s,n=i(50659),r=i(84647),o=i(39212),a=i.n(o),d=i(80172),l=i(59636),u=i(38908),h=i(65390),c=i(23121),p=i(66202),_=i(20739);!function(e){var t=e.Context=n.createContext(l.o.invariantContent("Telemetry.Context")),i=e.createPageSessionId=()=>u.G7(10),s=e.ContextProvider=e=>n.createElement(t.Provider,{value:Object.create({},{gnarSpec:{get:()=>e.gnarSpec},pageId:{get:()=>e.pageId},pageSessionId:{get:()=>e.pageSessionId},getSessionUuid:{get:()=>e.sessionUuidGetter},sessionUuid:{get:()=>(0,r.pipe)(e.sessionUuidGetter(),h.getOrElse((()=>"")))},docId:{get:()=>{if(null!=e.docId)return e.docId;throw new Error("docId is not specified. Please provide it thru the PageContextProvider")}},isTouchDevice:{get:()=>(0,r.pipe)(c.zb(a()),p.getOrElse((()=>!1)))}})},n.Children.only(e.children));e.ContextProviderInherited=e=>n.createElement(t.Consumer,null,(i=>n.createElement(t.Provider,{value:Object.create({},{gnarSpec:{get:()=>i.gnarSpec},pageId:{get:()=>Boolean(e.pageId)?e.pageId:i.pageId},pageSessionId:{get:()=>i.pageSessionId},docId:{get:()=>Boolean(e.docId)?e.docId:i.docId},isTouchDevice:{get:()=>(0,r.pipe)(c.zb(a()),p.getOrElse((()=>!1)))}})},n.Children.only(e.children)))),e.ContextProviderMock=e=>n.createElement(s,{gnarSpec:new _.vp(new d.Aj),pageId:Boolean(e.pageId)?e.pageId:"mockPageId",pageSessionId:i(),docId:Boolean(e.docId)?e.docId:"mockDocId",sessionUuidGetter:()=>h.none},e.children)}(s||(s={}))},31373:(e,t,i)=>{i.d(t,{J:()=>o,m:()=>a});var s=i(84647),n=i(34717),r=i(65390);function o(e){const t=n.Yr.daysAgo(n.Yr.now(),16);return(0,s.pipe)(e.latestDismissAt,r.fold((()=>!0),(e=>e.getTime()<t)))}function a(e){if(o(e))return!0;const t=n.Yr.daysAgo(n.Yr.now(),1);return e.dunningDismissCount<14&&(0,s.pipe)(e.latestDismissAt,r.fold((()=>!0),(e=>e.getTime()<t)))}}}]);