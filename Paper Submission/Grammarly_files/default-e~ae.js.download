"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[2584],{59815:(e,t,i)=>{i.d(t,{_:()=>n,q:()=>s});var n,s,o=i(84647),a=i(80074),r=i(42902),l=i(5692),d=i(65390),c=i(95008);!function(e){e.defaultInitialState={userAccount:null},e.defaultState=e=>({authentication:e.userAccount?l.j.ok(e.userAccount):c.n6,userAccount:e.userAccount,online:!0})}(n||(n={})),function(e){e.create=()=>{const e=a.s.create(n.defaultState(n.defaultInitialState)),t=(0,o.pipe)(location.search,d.fromPredicate((e=>e.startsWith("?"))),d.getOrElse((()=>"")));return{appState:e,query:new r.L(t)}}}(s||(s={}))},86780:(e,t,i)=>{i.d(t,{l:()=>d});var n=i(60575),s=i(41797),o=i(53354),a=i(6987),r=i(3346),l=i(74056);function d(e,t){const i=t.has(l.OH.Flag.useSetDataOnCopy);return(t,l)=>s.H(o.B.copy(t,i)).pipe(a.n((()=>e.enqueue("copySuccess",{copyType:l}))),r.W((t=>(o.B.copyApiAvailable.next(!1),n.Bx.Logging.getLogger("clipboard").warn("Copy to clipboard failed",t),e.enqueue("copyToClipboardFailed"))))).toPromise()}},58251:(e,t,i)=>{i.d(t,{c:()=>A});var n=i(84647),s=i(82498),o=i(63404),a=i(915),r=i(77821),l=i(64345),d=i(21317),c=i(91597),p=i(88105),h=i(76005),u=i(65873),g=i(78590),m=i(50581),_=i(94808),v=i(82874),f=i(40857),y=i(3656),b=i(17559),w=i(74056),S=i(98719),C=i(37107),M=i(80548),E=i(54872),k=i(92444),T=i(19178),x=i(90334),I=i(7662);const A=(e,t,i,A)=>{const F=i.rtfMode===S.jj.l1.FormattingMode.on,V=t.has(w.OH.Flag.pasteAsPlainTextInSafariFromMSWord)?[h.j1.MSWord]:[],L=l.A;L.className=k.x.rtfLink;const N=[d.A,L,a.A,s.A,r.A,c.A,o.A];return new _.W({modules:{history:f.U,clipboard:(0,v.g)(F,V),keyboard:y.TV.getKeyboardWithBindings(F?y.TV.Bindings.rtfBindings:y.TV.Bindings.plainTextBindings),marks:b.O},formats:N},A,F?g.pR.QuillFormatNames.is:p.E.skipAny,p.E.skipAny,{classes:e.settings.editorPreferences.view((({fontSize:e,suggestionsVisualMode:i})=>{const s=(0,T.o)(i),o=t.has(w.OH.Flag.highHighlights)?s.markHeightTall:void 0;return{containerClass:(0,n.pipe)(e,C.Z4.match("",k.x.bigSize),(e=>m.classes(e,u.iF.paper,k.x.editorContainer))),markClassesTheme:s,markExtraClass:o,editorContainer:k.x.editorContainer}})),freezeFocusFeature:!0,allowNavigationTo:e=>E.LT.isSearchInput(e)||x.t.isTitleInput(e)||M.k.isInlineCard(e)||I.TL.isInsideCheetahView(e)})}},72613:(e,t,i)=>{i.d(t,{A:()=>j});var n=i(23988),s=i(50659),o=i(84647),a=i(87574),r=i(80074),l=i(60575),d=i(52138),c=i(74393),p=i(38299),h=i(92109),u=i(11864),g=i(19772),m=i(15491),_=i(89769),v=i(6987),f=i(21216),y=i(65390),b=i(66202),w=i(81870),S=i(65141),C=i(19711),M=i(14342),E=i(95168),k=i(54988),T=i(16721),x=i(24476),I=i(41432),A=i(78254),F=i(53651),V=i(57616),L=i(19967),N=i(65873),R=i(27199);const O=u.Ks.style({display:"flex",flexDirection:"column",width:"100vw",height:"100vh",background:R.Q1.CoreNeutral1,justifyContent:"center",alignItems:"center"}),U=u.Ks.style({position:"absolute",top:u.Ks.rem(1.875),left:u.Ks.rem(2.5),width:u.Ks.rem(10),height:u.Ks.rem(2)}),B=u.Ks.style({marginTop:u.Ks.rem(4.25),letterSpacing:"-.8px",fontSize:u.Ks.rem(2.625),lineHeight:u.Ks.rem(3.5)}),P=u.Ks.style({textAlign:"center",marginTop:u.Ks.rem(1),color:R.Q1.CoreNeutral50}),D=u.Ks.style({$nest:{"&[data-textpos='everywhere']":{marginTop:u.Ks.rem(2.25),padding:`0 ${u.Ks.rem(2.5)}`,textTransform:"initial",letterSpacing:0,fontSize:u.Ks.rem(1),lineHeight:u.Ks.rem(3.125)}}}),H=u.Ks.style({marginTop:u.Ks.rem(1)}),W=({name:e,illustration:t,title:i,description:n,primaryButton:o,secondaryButton:a})=>s.createElement("div",{"data-name":e,className:O},s.createElement(F.I,{className:U,icon:V.e,accessibilityLabel:"Go to My Grammarly"}),t,s.createElement(N.H1,{className:B},i),s.createElement(N.tu,{className:P},n),s.createElement(L.$n.Primary,{name:"primary-button",className:D,onClick:o.onClick},o.title),a&&s.createElement(L.$n.Ghost,{className:H,name:"secondary-button",onClick:a.onClick},a.title)),G=u.Ks.style({margin:`${u.Ks.rem(-10)} ${u.Ks.rem(-2)} 0 0`}),K=()=>{const e=s.useContext(w.Lz.Context);return s.createElement(W,{name:"doc-not-found",illustration:s.createElement(z,{className:G}),title:"Can’t find this document",description:"It looks like this document was removed or URL is incorrect.",primaryButton:{title:"Go to your documents",onClick:()=>e.navigateAndReload(w.Lz.routes.documents.href())}})},z=({className:e})=>s.createElement("svg",{"aria-hidden":!0,width:"194",height:"128",viewBox:"0 0 194 128",className:e},s.createElement("g",{fill:"none",fillRule:"evenodd"},s.createElement("path",{d:"M44 40h64c2.2 0 4 1.8 4 4v80c0 2.2-1.8 4-4 4H45c-2.76 0-5-2.24-5-5V44c0-2.2 1.8-4 4-4z",fill:"#E4E6F2",opacity:".8"}),s.createElement("rect",{stroke:"#8189A9",strokeWidth:"1.5",fill:"#FFF",strokeLinecap:"round",strokeLinejoin:"round",x:"47",y:"33",width:"72",height:"88",rx:"1"}),s.createElement("path",{d:"M60.28 86h44.67M60.28 96h44.67M60.28 107H73",stroke:"#E4E6F2",strokeWidth:"2",fill:"#FFF",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("g",{transform:"translate(64 47)"},s.createElement("circle",{fill:"#8189A9",cx:"3",cy:"3",r:"3"}),s.createElement("circle",{fill:"#8189A9",cx:"33",cy:"3",r:"3"}),s.createElement("path",{d:"M29.46 21.54C26.66 18.74 22.78 17 18.5 17c-4.28 0-8.16 1.73-10.96 4.54",stroke:"#8189A9",strokeWidth:"2",strokeLinecap:"round"})),s.createElement("path",{d:"M188.13 106.03c.3.3.3.8-.1 1.1-.1.1-.3.2-.5.2s-.4-.1-.5-.2l-1.8-1.8c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l1.8 1.8zm3.9 4l1.7 1.8c.3.3.3.8 0 1.1-.1.1-.3.2-.5.2s-.4-.1-.5-.2l-1.8-1.8c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0zm-5 0c.3-.3.8-.3 1 0 .3.3.3.8 0 1.1l-1.8 1.8c-.1.1-.3.2-.5.2s-.4-.1-.5-.2c-.3-.3-.3-.8 0-1.1l1.8-1.8zm6.8-5.7c.3.3.3.8-.1 1.1l-1.8 1.8c-.1.1-.3.2-.5.2s-.4-.1-.5-.2c-.3-.3-.3-.8 0-1.1l1.8-1.8c.3-.3.8-.3 1.1 0zM86.03 3.13l-1.8-1.8c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l1.7 1.8c.3.3.3.8 0 1.1-.1.1-.3.2-.5.2s-.4-.1-.5-.2zm5.7 5.6l-1.9-1.8c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l1.8 1.8c.3.3.3.8 0 1.1-.1.1-.3.2-.5.2s-.4-.1-.5-.2zm-6.9.2c-.2 0-.4 0-.5-.1-.3-.3-.3-.8 0-1.1l1.7-1.9c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-1.8 1.8c-.1.1-.3.2-.5.2zm5.7-5.6c-.2 0-.4-.1-.6-.2-.3-.3-.3-.8 0-1.1l1.8-1.8c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-1.8 1.8c-.1.1-.3.2-.5.2z",fill:"#F6C2CB",fillRule:"nonzero"}),s.createElement("path",{d:"M4.6 60.2c2.2 0 3.9-1.8 3.9-3.9 0-2.2-1.8-3.9-3.9-3.9-2.2 0-3.9 1.8-3.9 3.9 0 2.1 1.7 3.9 3.9 3.9zm0-6.3C5.9 53.9 7 55 7 56.3c0 1.3-1.1 2.4-2.4 2.4-1.3 0-2.4-1.1-2.4-2.4 0-1.4 1.1-2.4 2.4-2.4z",fill:"#A1E7D7",fillRule:"nonzero"}))),$=c.E(a.F.div),J=e=>{const{userAccount:t,selfUpdate:i,notificationsManager:n,documentLoader:o,environment:a,appStream:r,slots:c}=e,u=l.Bx.Logging.getLogger("denali.editorContent"),v=s.useContext(T.Y.Context);var f;f=t.features.track3rdPartyExtensionsInjection,g.R.useSubscriptionTo(f?S.R(document.body,"click",{passive:!0,capture:!0}).pipe(C.$(),M.c(1e3),E.M((()=>{const e=[...Array.from(document.documentElement.children),...Array.from(document.body.children)].filter((e=>!e.hasAttribute("data-verified")&&"head"!==e.nodeName.toLowerCase())).map((e=>({nodeName:e.nodeName,src:e.getAttribute("src"),content:e.outerHTML.substr(0,255)})));e.length&&e.forEach((e=>{l.Bx.Logging.getLogger("3rdPartyInjections").info("found unknown element",e)}))}))):k.w);const w=s.createElement(p.W,{key:"platformNotificationsCenter",views:x.wY,manager:n,onNotificationClose:e=>v.gnarSpec.notificationCloseButtonClick(e.type,v.pageId)});return g.R.useEffectOnDidMount((()=>{document.body.classList.remove("editorTs")})),g.R.useEffectOnWillUnmount((()=>{document.body.classList.add("editorTs")})),s.createElement($,null,s.createElement(I.$,null),r.pipe(m.T(y.fold((()=>w),b.fold((e=>e.code===d.C.WsCodes.NOT_FOUND?(u.warn("document not found on init",e),s.createElement(K,{key:"404"})):(e.code===d.C.WsCodes.UNAUTHORIZED?u.warn("unauthorized on init",e):u.warn("engine init error",e),w)),(e=>{const r=c(e);return s.createElement(T.Y.ContextProvider,{gnarSpec:v.gnarSpec,docId:v.docId,pageId:e.engine.sessionModel.isDemoDocument?"demoDocument":"document",pageSessionId:v.pageSessionId,sessionUuidGetter:()=>y.fromNullable(e.denaliViewModels.capiSession.sessionUuid.get())},s.createElement(s.Fragment,null,s.createElement(A.Ss,{denaliEditorModel:e.ded,documentModel:e.engine.sessionModel,userAccount:t,selfUpdate:i,denaliViewModels:e.denaliViewModels,notificationsManager:n,documentLoader:o,environment:a,slots:r},w),s.createElement(r.BlockUnsavedChanges,null)))})))),_.Z(w)),s.createElement(h.$,{key:"tooltip"}))};class j extends s.Component{_renderPageDoc(e){const{userAccount:t,selfUpdate:i,notificationsManager:n,environment:a,appStream:r,documentLoader:l,logoutViewModel:d}=this.props;return s.createElement(w.vo,{key:`base-page-${e}`,title:r.pipe(v.n((0,o.flow)(y.chain(y.fromEither),y.map((({engine:e})=>e.sessionModel.title)),y.getOrElse((()=>f.of(void 0))))),m.T((e=>Boolean(e)?`${e} - Grammarly`:"Grammarly")))},s.createElement(s.Fragment,null,s.createElement(J,{key:"denali-editor-content",userAccount:t,selfUpdate:i,notificationsManager:n,environment:a,slots:this.props.slots,appStream:r,documentLoader:l}),s.createElement(A.aH,{key:"loader",logoutViewModel:d,documentLoader:l,userAccount:t})))}shouldComponentUpdate(){return!1}componentWillReceiveProps(e){const t=Number(e.docId);this._docId.set(y.fromNullable(t))}componentWillUnmount(){this.props.documentLoader.dispose()}render(){return s.createElement(a.F.Fragment,null,this._docId.view((0,o.flow)(y.filter((e=>!isNaN(e))),y.fold((()=>s.createElement(w.vo,{title:"Grammarly"},s.createElement(K,{key:"404"}))),(e=>this._renderPageDoc(`${e}`))))))}constructor(...e){super(...e),(0,n._)(this,"context",void 0),(0,n._)(this,"_docId",r.s.create(y.fromNullable(Number(this.props.docId))))}}(0,n._)(j,"contextType",T.Y.Context),u.Ks.setStylesTarget(document.getElementById("typestyleTarget"))},57279:(e,t,i)=>{i.d(t,{r:()=>ce});var n,s=i(84647),o=i(59443),a=i(35710),r=i(81238),l=i(80074),d=i(60575),c=i(80837),p=i(78339),h=i(15491),u=i(24946),g=i(36094),m=i(41797),_=i(83541),v=i(65390),f=i(42543),y=i(95168),b=i(80949);!function(e){e.create=e=>{const t=new f.B7,i=e.getLogger("OggyDeepLinkEvents"),n=()=>y.M((e=>i.info(e.kind,e)));return{push:t.next.bind(t),incomming:t.pipe(p.p(b.p.isIncoming),n()),outgoing:t.pipe(p.p(b.p.isOutgoing),n())}}}(n||(n={}));var w=i(23988),S=i(7432),C=i(72106),M=i(11864);const E={backgroundColor:i(27199).Q1.CoreBlue20,backgroundRepeat:"no-repeat",contain:"layout style",$nest:{"@media print":{display:"none !important"}}},k={animation:`${M.Ks.keyframes({"0%":{backgroundColor:"rgba(153, 194, 255, 1)"},"50%":{backgroundColor:"rgba(153, 194, 255, 0)"},"100%":{backgroundColor:"rgba(153, 194, 255, 1)"}})} 300ms 2 ease-out forwards !important`,animationIterationCount:"2 !important"},T=M.Ks.stylesheet({mark:[E],attention:[k]});var x;!function(e){const t="selectionContextRange";e.create=(e,i)=>S.vY.create(e,i,{type:t}),e.is=function(e){return e.meta.type===t}}(x||(x={}));class I{constructor(e,t){(0,w._)(this,"_ded",void 0),(0,w._)(this,"_rangeManager",void 0),(0,w._)(this,"_ranges",void 0),(0,w._)(this,"setContextHighlight",void 0),this._ded=e,this._rangeManager=t,this._ranges=new Set,this.setContextHighlight=(e,t)=>{const i=`selection-context-${e.start}|${e.end}`,n=this._ranges.has(i),s=x.create(e.start,e.end),o={range:()=>s,order:0,classes:[T.mark,..."attention"===t?[T.attention]:[]]};"hidden"===t?(n&&(this._ded.changeMarks([C.J.Change.getRemoveAction({range:()=>s})(i)]),this._rangeManager.deregisterRange(i)),this._ranges.delete(i)):n?this._ded.changeMarks([C.J.Change.getUpdateAction(o)(i)]):(this._rangeManager.registerRange(i,s),this._ded.changeMarks([C.J.Change.getCreateAction(o)(i)]),this._ranges.add(i))}}}var A,F=i(70823);!function(e){e.create=e=>{const t=new f.B7,i=e.getLogger("OggyLifecycleEvents");return{push:t.next.bind(t),events:t.pipe(y.M((e=>i.info(e.kind,e))))}}}(A||(A={}));var V,L=i(10334),N=i(17171),R=i(63967),O=i(45653),U=i(87275),B=i(38886),P=i(58193),D=i(66202);!function(e){let t;e.empty=()=>({selectedAlertHighlight:v.none,alertsVisibilityCollection:new Map}),e.changeAlertVisibility=(e,t,i)=>n=>{n.alertsVisibilityCollection.set(e,{alertId:t,visibility:i})},function(e){e.create=(e,t)=>{const i=l.s.create(V.empty()),n=t=>(0,s.pipe)(e.getByAlertId(t.alert.id),v.chain((e=>e.rawId))),o=t=>i=>(0,s.pipe)(e.getByRawAlertId(i.alertId),v.map((e=>[e,(0,N._)((0,L._)({},i),{source:t})]))),a=(e,t)=>(0,s.pipe)(e,B.i8((e=>"emphasized"===e.visibility)),v.chain(o(t)),v.map((([e])=>({highlightIndex:0,source:t,alert:O.A.fromModel(e)}))),v.filter((e=>(0,s.pipe)(i.get().selectedAlertHighlight,P.Lw((t=>!O.A.eq.equals(t.alert,e.alert)))))),v.alt((()=>i.get().selectedAlertHighlight))),r=(e,t)=>i=>(0,s.pipe)(e,n,D.fromOption((()=>new Error("cannot get raw alert id from highlight"))),D.map((n=>V.changeAlertVisibility(e.alert.id,n,t)(i))));return{selectedAlertId:i.view("selectedAlertHighlight").pipe(p.p(v.exists((e=>[U.nl.forceText,R.Kz.api].includes(e.source)))),h.T((0,s.flow)(v.chain(n),v.toNullable))),alertVisibilityFilter:i.view("alertsVisibilityCollection").view((e=>t=>(0,s.pipe)(e.get(t.id),v.fromNullable,v.map((e=>"hidden"!==e.visibility)),v.getOrElse(s.constFalse)))),alertHighlightChanges:i.view("selectedAlertHighlight"),setState:e=>{const n=a(e,R.Kz.sidebar);t.debug("setAlertsVisibility",{alertsVisibilityInfo:e,selectedAlertHighlight:n}),i.modify((i=>{t.debug("setAlertsVisibility —> changeAlertsVisibility",{current:i.selectedAlertHighlight,next:n});const a=new Map((0,s.pipe)(e,B.x1(o(R.Kz.sidebar)),B.Tj((([e,t])=>[e.id,t]))));return{selectedAlertHighlight:n,alertsVisibilityCollection:a}}))},updateState:e=>{const n=a(e,U.nl.forceSidebar);t.debug("updateAlertsVisibility",{alertsVisibilityInfo:e,selectedAlertHighlight:n}),i.modify((i=>{t.debug("updateAlertsVisibility —> changeAlertsVisibility",{current:i.selectedAlertHighlight,next:n});const a=(0,s.pipe)(e,B.x1(o(U.nl.forceSidebar)),B.TS(new Map(i.alertsVisibilityCollection),((e,[t,i])=>e.set(t.id,i))));return{selectedAlertHighlight:n,alertsVisibilityCollection:a}}))},updateFromAlerts:(e,t)=>{i.modify((i=>{const n=new Map(i.alertsVisibilityCollection);let o=i.selectedAlertHighlight;return t.forEach((t=>{(0,s.pipe)(n.get(t),v.fromNullable,P.Mi((a=>(0,s.pipe)(e.get(a.alertId),v.fromNullable,v.fold((()=>{n.delete(t),o=(0,s.pipe)(i.selectedAlertHighlight,v.filter((e=>e.alert.id!==t)))}),(e=>{n.delete(t),n.set(e.id,a),o=(0,s.pipe)(i.selectedAlertHighlight,v.map((i=>i.alert.id===t?{alert:O.A.fromModel(e),highlightIndex:i.highlightIndex,source:i.source}:i)))}))))))})),{selectedAlertHighlight:o,alertsVisibilityCollection:n}}))},focusAlertHighlight:e=>{const n=i.get();i.modify((i=>((0,s.pipe)(i,r(e,"emphasized"),D.fold((e=>t.error("Cannot emphasize the alert",e)),s.constVoid)),(0,s.pipe)(n.selectedAlertHighlight,P.Mi((e=>r(e,"visible")(i)))),t.debug("focusAlertHighlight",e),{selectedAlertHighlight:v.some(e),alertsVisibilityCollection:new Map(i.alertsVisibilityCollection)})))},unfocusAlertHighlight:()=>{i.modify((e=>(0,s.pipe)(e.selectedAlertHighlight,v.map((t=>(r(t,"visible")(e),{selectedAlertHighlight:v.none,alertsVisibilityCollection:new Map(e.alertsVisibilityCollection)}))),v.getOrElse((0,s.constant)(e)))))}}}}(t=e.Holder||(e.Holder={}))}(V||(V={}));var H=i(84011),W=i(46238),G=i(71195),K=i(66799),z=i(22809),$=i(89769),J=i(65621),j=i(43308),q=i(59042),Y=i(94855),Z=i(77396);const Q=W.of(void 0);var X,ee,te=i(30396),ie=i(35749),ne=i(35413),se=i(86562),oe=i(54463),ae=i(36840);!function(e){var t=e.isAssistantSDUIEvent=(0,ae.M4)((0,ae.Ub)(oe.om.is("sdui_add"),oe.om.is("sdui_update"),oe.om.is("sdui_remove")),(e=>!e.sduiRootId.endsWith("suggestion@Inline"))),i=e.isSessionEvent=(0,ae.Ub)(oe.om.is("session_started"),oe.om.is("finish")),n=e.isResetEvent=oe.om.is("connect");e.is=(0,ae.Ub)(t,i,n)}(X||(X={})),function(e){let t;function i(e,i){switch(i.kind){case"connect":return t.empty();case"session_started":return i.isNewSession?t.empty():e;case"finish":return e;case"sdui_remove":return e.delete(i.sduiRootId),e;case"sdui_add":case"sdui_update":return e.set(i.sduiRootId,(0,N._)((0,L._)({},i),{kind:"sdui_add"})),e;default:(0,se.xb)(i)}}e.create=(e,n)=>{const s=n.getLogger("SDUIBuffer"),o=new c.y.Keeper,a=l.s.create([]),r=e.pipe(p.p(X.is)),d=e=>JSON.stringify(X.isAssistantSDUIEvent(e)?{kind:e.kind,sduiRootId:e.sduiRootId}:e);return o.push(r.pipe(y.M((e=>s.trace(`sduiCapiEvent IN ${d(e)}`))),te.S(i,t.empty()),h.T((e=>Array.from(e.values()))),y.M((e=>s.trace(`sduiBuffer OUT:\n ${e.map(d).join("\n")}`))),y.M(g.H9(a))).subscribe()),{capiEvents:ie.x(ne.v((()=>m.H(a.get()))),r),dispose:()=>{a.set([]),o.dispose()}}},function(e){e.empty=()=>new Map}(t||(t={}))}(ee||(ee={}));var re,le,de,ce,pe=i(27180),he=i(94134);!function(e){e.create=(e,t,i,n,o,a)=>{const r=a.getLogger("Manager");r.debug("Creating new Oggy manager");const u=l.s.create(!1),g=new f.B7,m=V.Holder.create(t,a),_=new c.y.Keeper,b=ee.create(o,r);_.push(b);const w=((e,t,i,n,o)=>{const a=e=>R.Fc.isRemovedByTextChange(e)?"textChange":"other",r=d.Bx.Logging.getLogger("Oggy.AlertService");return{selectedAlertId:n.selectedAlertId,scrollAlertIntoView:({alertId:e})=>(0,s.pipe)(i.getByRawAlertId(e),v.fold((()=>(r.error(`Move focused mark into viewport: Alert with id ${e} not found`),Promise.resolve())),(e=>{return Promise.resolve((t={alert:O.A.fromModel(e),highlightIndex:0},g.next(t)));var t}))),alertCollectionChanges:e.state.pipe($.Z(z.A.empty),J.J(),h.T((([e,t])=>z.A.diff(t,e))),h.T(z.A.Diff.toRegistered),h.T(q.b.reduce({changes:[],toAdd:new Map,toRemove:new Set},((e,t)=>((0,s.pipe)(t.alert.rawId,P.Mi((i=>{e.changes.push((0,G.BG)(i)),e.toAdd.set(i,t.alert)}))),e)),((e,t,i)=>(e.toRemove.add(t.id),(0,s.pipe)(t.alert.rawId,P.Mi((i=>e.changes.push((0,G.rc)(i,a(t)))))),(0,s.pipe)(i.alert.rawId,P.Mi((t=>{e.changes.push((0,G.BG)(t)),e.toAdd.set(t,i.alert)}))),e)),((e,t)=>(e.toRemove.add(t.id),(0,s.pipe)(t.alert.rawId,P.Mi((i=>e.changes.push((0,G.rc)(i,a(t)))))),e)))),y.M((({toAdd:e,toRemove:t})=>n.updateFromAlerts(e,t))),j.E("changes"),p.p((e=>e.length>0))),applyAlerts:(0,s.flow)(B.x1((e=>(0,s.pipe)(i.getByRawAlertId(e.alertId),v.map((t=>[t.id,{alternativeIndex:e.alternativeIndex,source:R.Kz.sidebar,feedbackSubtype:K.U3.Sidebar}]))))),Y._c((([e,i])=>(0,s.pipe)(t.apply(e,i),Y.Mr))),Y.Tj(s.constVoid),Z.hq),removeAlerts:(0,s.flow)(B.x1((e=>(0,s.pipe)(i.getByRawAlertId(e.alertId),v.map((t=>({alert:t,reason:e.removalReason})))))),Y._c((({alert:e,reason:n})=>"alertApplied"===n?(0,s.pipe)(H.of(i.remove(e)),Y.L9):(0,s.pipe)(t.dismissBatch([e.id],K.U3.Sidebar),Y.Mr))),Y.Tj(s.constVoid),Z.hq),setAlertsVisibility:(0,s.flow)(n.setState,Q),updateAlertsVisibility:(0,s.flow)(n.updateState,Q)}})(e,i,t,m),S=((e,t)=>({sduiItemCollectionChanges:e,supportedForms:["longForm"],autofocusNextLongFormCardOnApplyOrDismiss:t}))(b.capiEvents.pipe(p.p((0,ae.Ub)(X.isAssistantSDUIEvent,X.isResetEvent)),h.T((e=>{switch(e.kind){case"sdui_add":return(0,pe.ws)(e.sduiRootId,e.sdui);case"sdui_update":return(0,pe.wq)(e.sduiRootId,e.sdui);case"sdui_remove":return(0,pe.jw)(e.sduiRootId);case"connect":return(0,pe.hp)();default:return(0,s.absurd)(e)}})),he.w(0),p.p((e=>e.length>0)),h.T((e=>({changes:e,pendingChangesCount:0})))),u);return(0,N._)((0,L._)({},m),{alertService:w,sduiService:S,lifecycleEvents:n,scrollIntoViewChanges:g,toggleAutoScroll:e=>u.set(e),dispose(){r.debug("Disposing Oggy manager"),_.dispose()}})}}(re||(re={})),function(e){e.create=e=>{const t=l.s.create(!1),i=l.s.create(!1),n=new c.y.Keeper;return n.push(e.incomming.pipe(p.p((e=>e.source===b.p.Source.Plagiarism)),y.M((e=>{t.set(e.available),i.set(e.focused)}))).subscribe()),{isAvailable:t,isFocused:i,requestPlagiarism:()=>t.pipe(p.p(Boolean),u.s(1),h.T((()=>e.push({kind:b.p.Kind.FocusRequested,source:b.p.Source.Plagiarism})))),dispose:()=>n.dispose()}}}(le||(le={})),function(e){e.create=e=>{const t=l.s.create(!1),i=l.s.create(!1),n=new c.y.Keeper;return n.push(e.incomming.pipe(p.p((e=>e.source===b.p.Source.PremiumSuggestionsUphook)),y.M((e=>{t.set(e.available),i.set(e.focused)}))).subscribe()),{isAvailable:t,isFocused:i,requestUphook:()=>t.pipe(p.p(Boolean),u.s(1),h.T((()=>e.push({kind:b.p.Kind.FocusRequested,source:b.p.Source.PremiumSuggestionsUphook})))),dispose:()=>n.dispose()}}}(de||(de={})),function(e){e.create=({checkingDomain:e,alertsRepository:t,alertsService:i,observableCapi:f,latestCAPIMessageByActionName:y,telemetry:b,environment:w,platformEnvironment:S,ded:C,positionManager:M})=>{const E=new c.y.Keeper,k=d.Bx.Logging.getLogger("CheetahEngine"),{capiService:T,capiMessages:x}=(0,F.Fi)(f,y),V=l.s.create({enabled:!1});E.push(x.pipe(p.p((({action:e})=>"start"===e)),p.p((e=>{var t;return null===(t=e.allowedFeatures)||void 0===t?void 0:t.includes(o.t)})),h.T((0,s.flow)((e=>v.fromNullable(e.cheetahState)),v.fold((()=>({enabled:!1})),(e=>({enabled:!0,userState:e}))))),u.s(1)).subscribe(g.H9(V)));const L=new a.v(T,V);E.push(L);const N=A.create(k),R=n.create(k),O=(0,F.ii)(R),U=m.H(b.getContainerId().catch((()=>(k.warn("Failed to retrieve container ID for Cheetah Web"),"")))).pipe(h.T((e=>(0,F.C)(N,e,w,S))),_.shareReplay({refCount:!0,bufferSize:1})),B=de.create(R),P=le.create(R);E.push(B,P);const D=new I(C,M),H=re.create(e,t,i,N.events,f.events,k.getLogger("OggyManager"));return null!=performance&&"function"==typeof performance.mark&&performance.mark(r.F.preStartServicesReady),{oggyManager:H,oggyUphookModel:B,oggyPlagiarismModel:P,cheetahCapiService:T,genAiAvailabilityService:L,oggyLifecycleService:U,oggyDeepLinkService:O,capiMessages:x,oggyLifecycleEvents:N,selectionContextManager:D,dispose:E.dispose.bind(E)}}}(ce||(ce={}))},14e3:(e,t,i)=>{i.d(t,{A:()=>s,B:()=>n});var n,s,o=i(10334),a=i(17171),r=i(84647),l=i(80074),d=i(66799),c=i(54463),p=i(74416),h=i(78339),u=i(15491),g=i(36094),m=i(86562),_=i(66202),v=i(65390),f=i(55172),y=i(23121);!function(e){let t;!function(e){e.Like="Like",e.Dislike="Dislike"}(t=e.FeedbackType||(e.FeedbackType={}))}(n||(n={})),function(e){function t(e){switch(e){case n.FeedbackType.Like:return d.Zq.EMOTION_LIKE;case n.FeedbackType.Dislike:return d.Zq.EMOTION_DISLIKE;default:return(0,m.xb)(e)}}function i(e){return(0,r.pipe)(p.w.fromNumber(e.confidence),_.map((t=>({emoji:e.emoji,name:e.name,confidence:t,feedback:v.none}))))}function s(e){return e.reduce(((e,t)=>(e[t.name]=t,e)),{})}e.toCapiFeedback=t,e.create=function(e,n,d){const m=l.s.create({}),b=[e.pipe(h.p(c.om.is("emotions")),u.T((e=>(0,r.pipe)(function(e){const[t,n]=f.jB(e.map(i),_.isRight);return t.length===e.length?_.right(t.map(y.$v)):_.left((0,r.pipe)(n.map(_.swap).map(y.$v).join(";")))}(e.emotions),_.map(s),_.fold((e=>(d.error("Failed to parse emotions from capi",{rejectionReason:e}),{})),r.identity))))).subscribe(g.H9(m))];return{emotions:m.view((e=>Object.values(e).sort(((e,t)=>p.w.ord.compare(t.confidence,e.confidence))))),sendEmotionFeedback:(e,i)=>(0,r.pipe)(function(e,t){return void 0===e[t]?_.left(new Error("Tried to send feedback for non-existing emotion")):(0,r.pipe)(e[t].feedback,v.fold((()=>_.right(void 0)),(()=>_.left(new Error("Tried to send feedback for an emotion which already has one")))))}(m.get(),e),_.map((()=>{n.sendFeedback({emotionName:e,kind:t(i)})(),m.modify((t=>(0,a._)((0,o._)({},t),{[e]:(0,a._)((0,o._)({},t[e]),{feedback:v.some(i)})})))}))),dispose:()=>b.forEach((e=>e.unsubscribe()))}}}(s||(s={}))},52444:(e,t,i)=>{i.d(t,{A:()=>je,X:()=>qe});var n,s=i(83531),o=i(23988),a=i(10334),r=i(17171),l=i(67739),d=i(39427),c=i(60336),p=i(55365),h=i(39061),u=i(84647),g=i(73144),m=i(89547),_=i(80074),v=i(32955),f=i(35240),y=i(70174),b=i(60575),w=i(30720),S=i(54463),C=i(91242),M=i(62228),E=i(93910),k=i(58526),T=i(79622),x=i(65772),I=i(71883),A=i(78044),F=i(66799),V=i(12704),L=i(46013),N=i(99854),R=i(9637),O=i(64014),U=i(89211),B=i(77338),P=i(21138),D=i(11555),H=i(19805),W=i(61606),G=i(80837),K=i(42543),z=i(78339),$=i(24946),J=i(68594),j=i(95168),q=i(71372),Y=i(52869),Z=i(30396),Q=i(30744),X=i(83541),ee=i(6987),te=i(21216),ie=i(54988),ne=i(83194),se=i(36094),oe=i(11298),ae=i(65390),re=i(36840),le=i(58193),de=i(86284),ce=i(36644),pe=i(98719),he=i(92622),ue=i(7245),ge=i(15491),me=i(65141),_e=i(89769),ve=i(60269),fe=i(62822),ye=i(38427);!function(e){let t,i;!function(e){e.TabClosed="tab closed",e.TabHidden="tab hidden"}(t=e.SessionEndReason||(e.SessionEndReason={})),function(e){let t;!function(e){e.fromValue=e=>(0,u.pipe)(e,ue.v(),ge.T((({timestamp:e,value:t})=>(0,r._)((0,a._)({},t),{timestamp:e}))))}(t=e.WithTimeStamp||(e.WithTimeStamp={}))}(i=e.Event||(e.Event={})),e.create=(e,n=me.R(window,"beforeunload"),s=me.R(window,"visibilitychange").pipe(ge.T((()=>window.document.hidden)),_e.Z(!1)))=>{const o=b.Bx.Logging.getLogger("ClientSession",b.y7.$.INFO,b.y7.I.Manager.getColor("ClientSession")),a=e.pipe(z.p(S.om.is("session_started")),$.s(1)),r=e.pipe(z.p(S.om.is("disconnect")),$.s(1)),l=a.pipe(ee.n((()=>ve.h(n.pipe(fe.u({reason:t.TabClosed})),ye.zV([r,s.pipe(z.p(Boolean))]).pipe($.s(1),fe.u({reason:t.TabHidden}))))),i.WithTimeStamp.fromValue,j.M((e=>o.info("Session ended",e))),oe.u()),d=ve.h(a,l.pipe(ee.n((()=>a)))).pipe(i.WithTimeStamp.fromValue,j.M((e=>o.info("Session started",e))),oe.u()),c=d.pipe(ee.n((({timestamp:e,sessionUuid:t})=>l.pipe(ge.T((({timestamp:i})=>({duration:Math.ceil((i-e)/1e3),sessionUuid:t})))))),j.M((e=>o.info("Session stats",e))),oe.u());return{sessionEnd:l,sessionStart:d,sessionStats:c}}}(n||(n={}));var be=i(78018),we=i(38908);class Se{_decodeCacheItem(e){const t=e.match(/([^;]+);([^;]+);([^;]+);(.*)/);if(!t)throw new TypeError("unexpected value content");const[i,n,s,o]=t.splice(1,5).map((e=>JSON.parse(e)));if(void 0!==i&&"number"==typeof i&&void 0!==n&&void 0!==s&&"boolean"==typeof s&&void 0!==o&&Array.isArray(o)){const e=(0,re.RZ)((()=>this._deserializeData(o)));return{timeStamp:i,context:n,isFreeUser:s,get data(){return e.value}}}throw new TypeError("unexpected value content")}_encodeCacheItem({timeStamp:e,context:t,isFreeUser:i,data:n}){return[e,t,i,this._serializeData(n)].map((e=>JSON.stringify(e))).join(";")}_getStorageKeyVersionedPrefix(){return this._storageNamePrefix+this._storageDataVersion}_getStorageKeyForDoc(e){return`${this._getStorageKeyVersionedPrefix()}-${e}`}_save(e,t,i,n){const s=this._encodeCacheItem({timeStamp:Date.now(),context:t,isFreeUser:i,data:n});this._storage.setItem(this._getStorageKeyForDoc(e),s)}_loadCache(e,t,i){const n=this._storage.getItem(this._getStorageKeyForDoc(e));if(ae.isSome(n)){let s;try{s=this._decodeCacheItem(le.$v(n))}catch(t){try{this._removeCacheItem(e)}catch(e){this._log.debug("could not remove broken cache item",e)}return null}if(s.isFreeUser===i&&s.context===t)return s.data;try{this._removeCacheItem(e)}catch(e){this._log.debug("could not remove cache for a user of different type",e)}return null}return null}_removeCacheItem(e){this._storage.removeItem(this._getStorageKeyForDoc(e))}_pruneOldEditor(){this._storage.getKeys().filter((e=>/matches_\d+/.test(e))).forEach((e=>this._storage.removeItem(e)))}get _cacheKeys(){return this._storage.getKeys().filter(this._isСacheKey)}_pruneOld(){const e=Date.now();this._cacheKeys.forEach((t=>{const i=this._storage.getItem(t);if(ae.isSome(i)){let n;try{n=this._decodeCacheItem(le.$v(i))}catch(e){return void this._storage.removeItem(t)}e-n.timeStamp>this._maxCacheAgeMs&&this._storage.removeItem(t)}}))}_pruneAll(){this._cacheKeys.forEach((e=>this._storage.removeItem(e)))}_pruneOldVersions(){this._storage.getKeys().filter(this._isOldCacheKey).forEach((e=>this._storage.removeItem(e)))}load(e,t,i){return this._loadCache(e,t,i)}hasCache(e,t,i){const n=this._getStorageKeyForDoc(e);return(0,u.pipe)(this._storage.getItem(n),ae.chain((e=>{try{const t=this._decodeCacheItem(e);return ae.some(t)}catch(e){return this._log.error("Error decoding cache"),this._storage.safeRemoveItem(n),ae.none}})),ae.filter((e=>e.context===t&&e.isFreeUser===i)),ae.fold((()=>!1),(()=>!0)))}save(e,t,i,n){try{return s=()=>this._save(e,t,i,n),o=[()=>this._pruneOldEditor(),()=>this._pruneOld(),()=>this._pruneAll()],function e(t){try{return s()}catch(i){if(t<o.length)return o[t](),e(t+1);throw i}}(0)}catch(e){this._log.warn("Cannot write to localStorage",e)}var s,o}remove(e){this._removeCacheItem(e)}constructor(e,t,i,n,s=ne.hQ.fromLocalStorage(ne.ls),a=12096e5){(0,o._)(this,"_deserializeData",void 0),(0,o._)(this,"_serializeData",void 0),(0,o._)(this,"_storageNamePrefix",void 0),(0,o._)(this,"_storageDataVersion",void 0),(0,o._)(this,"_storage",void 0),(0,o._)(this,"_maxCacheAgeMs",void 0),(0,o._)(this,"_log",void 0),(0,o._)(this,"_сacheKeyRe",void 0),(0,o._)(this,"_isСacheKey",void 0),(0,o._)(this,"_isOldCacheKey",void 0),this._deserializeData=e,this._serializeData=t,this._storageNamePrefix=i,this._storageDataVersion=n,this._storage=s,this._maxCacheAgeMs=a,this._log=b.Bx.Logging.getLogger("model.editor.document_cache"),this._сacheKeyRe=new RegExp(`${we.Nt(this._getStorageKeyVersionedPrefix())}-.+`),this._isСacheKey=e=>this._сacheKeyRe.test(e),this._isOldCacheKey=e=>e.startsWith(this._storageNamePrefix)&&!e.startsWith(this._getStorageKeyVersionedPrefix()),requestAnimationFrame((()=>{try{this._pruneOldVersions()}catch(e){this._log.debug("could not clean old caches",e)}}))}}var Ce=i(58251);const Me="mutedCategoriesDocumentId",Ee="mutedCategoriesContextId";class ke{getMutedCategories(){const e=this._mutedCategoriesCache.load(Me,Ee,this._isFree);return(0,u.pipe)(ae.fromNullable(e),ae.map((e=>new Map(e.map((e=>[e.id,e]))))))}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}constructor(e,t,i){(0,o._)(this,"_mutedCategoriesModel",void 0),(0,o._)(this,"_isFree",void 0),(0,o._)(this,"_mutedCategoriesCache",void 0),(0,o._)(this,"_subs",void 0),(0,o._)(this,"_saveMutedCategories",void 0),this._mutedCategoriesModel=e,this._isFree=t,this._mutedCategoriesCache=i,this._saveMutedCategories=e=>{this._mutedCategoriesCache.save(Me,Ee,this._isFree,Array.from(e.values()))},this._subs=[this._mutedCategoriesModel.events.pipe(z.p(H.x.CategoriesModel.Events.isChangedEvent),j.M((()=>{this._saveMutedCategories(this._mutedCategoriesModel.mutedCategories.get())}))).subscribe()]}}var Te=i(52138),xe=i(85199),Ie=i(58347),Ae=i(46669),Fe=i(66202);function Ve(e,t){const i=(0,xe.U)(e),n=new K.B7;return n.pipe(Ie.B(1e3),Ae.F()).subscribe((e=>t.setState({type:"wsCapi",state:{type:e}}))),(0,r._)((0,a._)({},i),{onFinish:e=>{n.next("online"),i.onFinish&&i.onFinish(e)},onDisconnect:e=>{e.reason.code===Te.C.WsCodes.UNAUTHORIZED?n.next("unauthorized"):(e.reconnectCounter>1||Fe.isLeft(e.reconnectResult))&&n.next("offline"),i.onDisconnect&&i.onDisconnect(e)}})}var Le,Ne=i(57279),Re=i(45181),Oe=i(27645),Ue=i(28986),Be=i(76005),Pe=i(7432),De=i(23121);!function(e){e.create=e=>{const t=new K.B7;function i(e){t.next(Oe.lY.flush()),t.next(e)}return{changes:t,insertLink:function(t,n){return De.zb((()=>{i(Oe.lY.delta((new Ue.R).retain(t.start).retain(Pe.vY.size(t),{[Be.M_.Type.link]:n}),e.getTextLength()))}))},insertLinkWithCaption:function(t,n,s){return(0,u.pipe)(De.zb((()=>{i(Oe.lY.delta((new Ue.R).retain(t).insert(s,{[Be.M_.Type.link]:n}),e.getTextLength()))})))},removeLink:function(t){return De.zb((()=>{i(Oe.lY.delta((new Ue.R).retain(t.start).retain(Pe.vY.size(t),{[Be.M_.Type.link]:null}),e.getTextLength()))}))},pushChanges:t.next.bind(t)}}}(Le||(Le={}));var He=i(91283),We=i(53143),Ge=i(82094),Ke=i(31044);const ze={"":{supportedComponents:(0,u.pipe)({text:!0,clickableText:!0,button:!0,alternativeChoice:!0,count:!0,icon:!0,block:!0,box:!0,row:!0,column:!0,slider:!0,alternativeSlider:!0,transition:!0,openSettings:!0,openToneDetector:!0,openFeedback:!0,openLearnMore:!1,notify:!0,closeCard:!0,nextCard:!0,prevCard:!0,selectAlternative:!0,upgradeToPremium:!0,strongAlertRef:!0,openLink:!0,scroll:!0,list:!0,image:!0,assistantFeed:!0,assistantCard:!0,gButton:!0,"gButton:default":!1,"gButton:tone":!1,"gButton:proofit":!1,"gButton:get-started":!1,nativePerformanceScoreButton:!1,stopApplyingAlerts:!1,alertsCount:!0,applyAlerts:!0,removeAlerts:!0,removeRoot:!0,nativeToneInsightsModal:!1,nativeLearnMoreModal:!1,nativeSettingsModal:!1,nativeFeedbackModal:!1,viewStack:!0,switchView:!0,dropDownMenuButton:!0,radioButtonsGroup:!0,proofitButton:!1,nativeProofitModal:!1,nativeKeyTakeawaysAssistantCard:!1,nativeExperimentalGBConsistencyUpsellFooter:!1,nativeExperimentalGBToneInsightsUpsellFooter:!1,nativeSkillsModal:!1,openCreateSnippetModal:!1,showHighlights:!1,hideHighlights:!1,pushAssistantFeed:!0,popAssistantFeed:!0,focusAssistantCard:!0,lensesSwitchPanel:!0,newRevision:!1,shortFormCard:!1,longFormCard:!0,collapsedCard:!0,inlineCard:!0,nativeSkillsList:!1,nativeSkillsView:!1,nativeGetStartedChecklistModal:!1,nativeInlineCardContent:!1,nativeOpenAssistant:!1,"behavior:strongAlertRef":!0,"behavior:animation:fadeIn":!0,"behavior:animation:fadeOut":!0,"behavior:popoverAnchor":!1,"behavior:lifecycle":!0,progressBar:!0,highlightAlert:!0,horizontalRule:!0,copyToClipboard:!0,popoverStack:!1,closePopover:!1,interactPopover:!1,openGrammarlyGo:!1,tooltip:!0,"gButton:plagiarism":!0,"gButton:writingExpert":!0,enablePlagiarismCheck:!0,disablePlagiarismCheck:!0,enableWritingExpertCheck:!0,disableWritingExpertCheck:!0,selectableDropDownMenu:!0,globalPart:!0,globalPartPlaceholder:!0,openPerformanceScore:!1,nativeOpenUserSatisfactionFeedback:!0,sticker:!0,overlay:!0},Ge.pb(u.identity),Ge.Fo(u.identity)),supportedForms:[Ke.Z.Long,Ke.Z.Inline],dslParser:He.cK.dslRootParser,dslSchema:We.r}};var $e=i(58538);const Je=12e4;class je{static createBase(e,t,i,n,s,o,a,r,l,d,c){const p=new G.y.Keeper,h=new K.B7;p.push(h.pipe(z.p((e=>"session_inbound"===e.kind)),$.s(1)).subscribe((()=>(0,ce.TE)("capiSessionInbound"))),je._createCAPIEventsForAlertsCount(h).subscribe((e=>Q.warn("CAPI finish didn't happen within timeout",{suggestionsReceived:e,timeout:Je}))),je._trackSessionEnd(h,d,i).subscribe());const g=be.l1.FormattingMode.on,m=je._createCAPIWS({userAccount:o,accessToken:l,createWSInstance:c,capiEvents:h,wsConnectivity:n,environment:a,context:w.T0.unset,rtfMode:g,isDemoDoc:!0,config:t}),_=new N.F(h,m.client,s,m),v=new B._(h,_),f=je._getBaseDocumentModel("Demo document",e,s,v.requestDocStats,g),{observableCapi:y,latestCAPIMessageByActionName:C,capiWatcher:M,capi:E}=je._createCAPI(h,v,f,o,i,e.length);let k=ae.none;const T=()=>(0,u.pipe)(k,ae.fold((()=>e.delta),(e=>e()))),{alertManager:x,alertsService:I,alertsReader:A,alertsRepository:F,positionManager:V,altManager:R}=(0,L.h)(T,u.identity,y,h,f.counters);(0,re.hJ)("alertManager",x);const{changesSources:O,dedSync:U,formattingModel:H,synonymsModel:W}=je._createModels(V,T,y,s,f,x),q=ae.none;p.push(D.d.init(U,h,P.vr.ignoreTEResult(y),P.vr.ignoreResult(P.vr.pushDeleteThenInsert(V)),R,O).subscribe(je._getChangesDispatcherFailHandler()));const{cacheManager:Y,mutedAlertsModel:Z}=je._createMutedCategoriesWithCache(h,y,x,I,t,o.features),Q=b.Bx.Logging.getLogger("StEngine");try{(0,u.pipe)(Y.getMutedCategories(),le.Mi((e=>{Q.debug("Loading muted alerts categories from cache..."),Z.loadCachedMutedCategories(e)})))}catch(e){Q.warn("Cannot read alerts OR muted categories cache",e)}k=ae.some((()=>s.getContents().delta));const{sduiFactory:X,sduiInlineFactory:ee}=je._createSDUI(h,x,F),te=Ne.r.create({checkingDomain:x,alertsRepository:F,alertsService:I,observableCapi:y,latestCAPIMessageByActionName:C,telemetry:i,environment:a,platformEnvironment:r,ded:s,positionManager:V}),ie=new je(te,y,C,f,V,R,x,I,A,F,W,H,q,Z,X,ee,(()=>p.dispose()),m,M);return p.push(h.pipe(z.p(S.om.is("connect")),J.i(1),j.M(ie.resetSDUI("CAPI reconnect"))).subscribe()),(0,re.hJ)("engine",ie),(0,re.hJ)("text",(()=>{E.getText().then((e=>{const t=s.getText();t!==e?console.log("Text DIFF",{capiText:e,capiLen:e.length,dedText:t,dedTextLen:t.length}):console.log("Texts are the same, len: "+t.length)})).catch((e=>{throw e}))})),ie}shutdown(){var e=this;return(0,s._)((function*(){b.Bx.Logging.getLogger("StEngine").debug("shutdown"),e._onShutdown(),yield e._capiConnection.close(void 0,"StEngine shutdown"),null!=e._capiConManager&&e._capiConManager.dispose(),e.checkingDomain.dispose(),e._capiWatcher.dispose(),e.sessionModel.dispose(),e.sduiManager.get().dispose(),e.sduiInlineManager.get().dispose(),e.cheetah.dispose(),(0,u.pipe)(e.emotionsModel,ae.map((e=>e.dispose())))}))()}static _getBaseDocumentModel(e,t,i,n,s){return new Re.c(e,t,w.T0.unset,i,n,s)}static _getChangesDispatcherFailHandler(){const e=b.Bx.Logging.getLogger("ChangesDispatcher");return t=>{"UnsubscriptionError"===t.exception.name?e.warn("shutdown error",t):t.details.to===D.d.Receiver.CAPI&&Boolean(v.Xb.isNotConnectedError(t.exception))?e.warn("tried to send change to not connected CAPI",t):t.details.to===D.d.Receiver.CAPI&&Boolean(C.r1.isNotReadyError(t.exception))?e.warn("tried to send delta change to CAPI that expected a reset",t):t.details.to===D.d.Receiver.CAPI?e.warn("failed pushing changes to CAPI",t):e.error("can not dispatch changes",t.exception,t.details)}}static _getCapiWsUrl(e,t){if(e.api.capiWsUrl===e.api.defaultCapiWsUrl){if(t.features.denali.trafficThroughGatewayForCapi&&t.features.denali.trafficThroughInternalCapi)return e.api.internalCapiWsUrl;if(t.features.denali.trafficThroughGatewayForCapi&&!t.features.denali.trafficThroughInternalCapi)return e.api.gatewayCapiWsUrl;if(!t.features.denali.trafficThroughGatewayForCapi&&t.features.denali.trafficThroughInternalCapi)return e.api.k8sCapiWsUrl}return e.api.capiWsUrl}static _getClientSupports(e,t){const i=[M.k9.textInfo,M.k9.freeAdvancedChecks,M.k9.readability,M.k9.sentenceVariety,M.k9.fillerWords,M.k9.alertsUpdate,M.k9.alertsChanges,M.k9.freeClarityChecks,M.k9.superAlerts,M.k9.consistency,M.k9.setGoalsLink,M.k9.voxCheck,M.k9.toneCards,M.k9.plagiarismAlertsUpdate,M.k9.alternativeDeletesCard,M.k9.fullSentenceRewrite,M.k9.listCard,M.k9.muteQuotedAlerts,M.k9.userMutes,M.k9.supportsButtonTransformCards,M.k9.gapTransformCard,M.k9.enclosingHighlight,M.k9.drilldownCard,M.k9.ideasGalleryLink,M.k9.freeOccasionalPremiumAlerts,M.k9.ethicalAI,M.k9.citations,M.k9.citation_detection_card,M.k9.citation_gap,M.k9.toneAI];return e.features.denali.toneDetector&&i.push(M.k9.emogenieCheck),t===be.l1.FormattingMode.on&&i.push(M.k9.supportsFormatting),e.features.denali.writingExpertVbarsEnabled&&i.push(M.k9.vbarAlerts),e.features.denali.gDebugger&&i.push(M.k9.gDebugger),i}static _getCAPIClientConfigs(e,t){return{sdui:{version:f.r,config:ze},cheetah:e.features.denali.cheetah?{version:g.r}:void 0,storage:e.features.denali.backendManagedStorageEnabled&&void 0!==t?{version:y.version}:void 0}}static _prepareCAPIWSHandler(e,t,i,n){return new x.G(i.features.denali.dlp?(()=>{const n=new de.G(ae.toUndefined(he.kz.getDLPConfig(i)),[m.Js.Message]);return n.sanitizeWSHandler(new E.Mk(n.sanitizeWS(k.WS.create(t),T.z7),e,10))})():new E.Mk(k.WS.create(t).writer(T.z7),e,10),n)}static _prepareCAPI(e,t,i,n){const s=new I.E(i,(e=>e.connect(je._getCapiWsUrl(n,t))),e);return(0,re.hJ)("capi",s.client),s}static _trackSessionEnd(e,t,i){return n.create(e).sessionStats.pipe(j.M((e=>t.send({kind:"session_end",session_id:e.sessionUuid,integration_id:i.pageSessionId,session_duration:e.duration},{sendSessionInfo:!0,sendUserInfo:!0}))))}static _createCAPIEventsForAlertsCount(e){return q.O4(e.pipe(Y.j((e=>"session_inbound"!==e.kind)),Z.S(((e,t)=>"alert_received"===t.kind?e+1:e),0),Q.U(X.timer(Je).pipe($.s(1)))),e.pipe(z.p((e=>"finish"===e.kind)))).pipe(ee.n((e=>"number"==typeof e?te.of(e):ie.w)),$.s(1))}static _createCAPIWS({userAccount:e,accessToken:t,createWSInstance:i,capiEvents:n,environment:s,context:o,rtfMode:a,isDemoDoc:r,config:l,docid:d,wsConnectivity:c,backendManagedStorageManager:p}){const h=new A.C(M.to,0,!1),g=(0,u.pipe)(e.settings.dialect.get(),ae.getOrElse((()=>"undefined")));return je._prepareCAPI(je._prepareCAPIWSHandler(h,i,e,t),e,{client:s.names.capi,clientVersion:s.buildVersion.toString(),context:o,handler:Ve(n,c),docid:d,dialect:g,clientSupports:je._getClientSupports(e,a),clientConfigs:je._getCAPIClientConfigs(e,p),isDemoDoc:r,idGenerator:h,shouldSendFeedback:e=>!0!==W.g.disabledFeedbacks.some((t=>t===e.kind))||"subtype"in e&&(e.subtype===F.U3.Vbar||e.subtype===F.U3.UnderlineWithTeaser)},l)}static _createMutedCategoriesWithCache(e,t,i,n,s,o){const a=new Se(u.identity,u.identity,s.mutedCategoriesCache.prefix,s.mutedCategoriesCache.version,ne.hQ.fromLocalStorage(ne.ls),12096e5),r=H.x.CategoriesModel.create(e,t,i.state,n,o.demoMode?F.xD.ScopeType.DOCUMENT:F.xD.ScopeType.GLOBAL);return{cacheManager:new ke(r,o.isFree.get(),a),mutedAlertsModel:r}}static _createSDUI(e,t,i){const n=(e=>()=>{const n=new l.c(t.state,e,i.getByRawAlertId.bind(i));return(0,re.hJ)("sduiManager",n),n})((0,u.pipe)(e,z.p((e=>"sdui_add"!==e.kind&&"sdui_update"!==e.kind&&"sdui_remove"!==e.kind||!(!c.Q.isSduiEvent(e)||"sdui_remove"===e.kind||!p.X2.isGlobalPart(e.sdui))||e.sduiRootId.toLowerCase().endsWith("@inline")))));return{sduiFactory:n,sduiInlineFactory:e=>{const t=new d.s(e.state);return(0,re.hJ)("sduiInlineManager",t),t}}}static _createModels(e,t,i,n,s,o){const a=new $e.uL(e,t,i,n),r=(0,u.pipe)(ae.fromNullable(s.rtfMode===pe.jj.l1.FormattingMode.on),ae.filter(Boolean),ae.map((()=>Le.create(n)))),l=D.d.UserTextChangesSync.create(n);return{changesSources:P.pH.merge((0,u.pipe)(r,ae.fold((()=>[o,a]),(e=>[o,a,e])))),dedSync:l,formattingModel:r,synonymsModel:a}}static _createCAPI(e,t,i,n,s,o){const l=new O.$(t,e,i,!1,o),d=new R.u(e,(()=>{const e=new Set;return"off"!==n.features.denali.recordCapiMessages&&e.add("captureCapiMessages"),e})()),c=new U.E(l,e,i,n.settings,s),p=_.s.create({});return c.registerExternalMessageHandler((e=>(p.modify((t=>(0,r._)((0,a._)({},t),{[e.action]:e}))),V.Q.Result.CONTINUE_HANDLING))),{capiWatcher:d,observableCapi:c,latestCAPIMessageByActionName:p,capi:l}}constructor(e,t,i,n,s,a,r,l,d,c,p,g,m,v,f,y,w,S,C,M){(0,o._)(this,"cheetah",void 0),(0,o._)(this,"obsCapiClient",void 0),(0,o._)(this,"latestCAPIMessageByActionName",void 0),(0,o._)(this,"sessionModel",void 0),(0,o._)(this,"positionManager",void 0),(0,o._)(this,"alternativeManager",void 0),(0,o._)(this,"checkingDomain",void 0),(0,o._)(this,"alertsService",void 0),(0,o._)(this,"alertsReader",void 0),(0,o._)(this,"alertsRepository",void 0),(0,o._)(this,"synonymsModel",void 0),(0,o._)(this,"formattingModel",void 0),(0,o._)(this,"emotionsModel",void 0),(0,o._)(this,"mutedAlertsModel",void 0),(0,o._)(this,"_sduiFactory",void 0),(0,o._)(this,"_sduiInlineFactory",void 0),(0,o._)(this,"_onShutdown",void 0),(0,o._)(this,"_capiConnection",void 0),(0,o._)(this,"_capiWatcher",void 0),(0,o._)(this,"_capiConManager",void 0),(0,o._)(this,"hasAlertsCache",void 0),(0,o._)(this,"sduiManager",void 0),(0,o._)(this,"sduiInlineManager",void 0),(0,o._)(this,"sduiService",void 0),(0,o._)(this,"resetSDUI",void 0),this.cheetah=e,this.obsCapiClient=t,this.latestCAPIMessageByActionName=i,this.sessionModel=n,this.positionManager=s,this.alternativeManager=a,this.checkingDomain=r,this.alertsService=l,this.alertsReader=d,this.alertsRepository=c,this.synonymsModel=p,this.formattingModel=g,this.emotionsModel=m,this.mutedAlertsModel=v,this._sduiFactory=f,this._sduiInlineFactory=y,this._onShutdown=w,this._capiConnection=S,this._capiWatcher=C,this._capiConManager=M,this.hasAlertsCache=!1,this.resetSDUI=e=>()=>{b.Bx.Logging.getLogger("StEngine").debug(`resetting SDUI managers, reason: ${e}`),(0,u.pipe)(le.CO(ae.fromNullable(this.sduiManager),ae.fromNullable(this.sduiInlineManager)),le.jw((()=>{const e=this._sduiFactory();this.sduiManager=_.s.create(e),this.sduiInlineManager=_.s.create(this._sduiInlineFactory(e))})),le.Mi((([e,t])=>{e.get().dispose(),e.set(this._sduiFactory()),t.get().dispose(),t.set(this._sduiInlineFactory(e.get()))})))},this.sduiService=new h.G(t),this.resetSDUI("engine init")()}}const qe=(e,t,i,n,s,o)=>se.RF((()=>Promise.resolve().then((()=>{const a=(0,Ce.c)(t.userAccount,i,{rtfMode:be.l1.FormattingMode.on},P.MA.noopSync(e));return[a,je.createBase(e,s,t.telemetry,t.wsConnectivity,a,t.userAccount,i,n,t.fingerprints.accessToken,o)]})))).pipe(oe.u())},63790:(e,t,i)=>{i.d(t,{M:()=>hi});var n,s=i(23988),o=i(10334),a=i(17171),r=i(84647),l=i(80074),d=i(60575),c=i(76005),p=i(61198),h=i(63967),u=i(62597),g=i(53717),m=i(69774),_=i(42543),v=i(80837),f=i(36094),y=i(68594),b=i(38427),w=i(15491),S=i(78339),C=i(54988),M=i(60269),E=i(29862),k=i(65141),T=i(46669),x=i(89769),I=i(65621),A=i(69701),F=i(83541),V=i(28600),L=i(82718),N=i(95168),R=i(68101),O=i(21662),U=i(90405),B=i(62822),P=i(98514),D=i(22814),H=i(32260),W=i(6471),G=i(52267),K=i(37262),z=i(26251),$=i(79365),J=i(65390),j=i(36840),q=i(66202),Y=i(86562),Z=i(94855),Q=i(58193),X=i(41831),ee=i(98719),te=i(40884);!function(e){e.create=()=>({doubleClickedWord:new _.B7})}(n||(n={}));var ie,ne=i(5731),se=i(91956),oe=i(92802),ae=i(45653),re=i(78884),le=i(87275),de=i(6987),ce=i(61586),pe=i(24946),he=i(80949);!function(e){let t;e.focusAlertByClickedMark=e=>t=>({name:"focus alert by clicked mark",source:e.pipe(U.oE,S.p((e=>h.Fc.State.isRegistered(e.alert.state)&&!ae.A.isPremiumPreviewPlagiarism(e.alert))),N.M((e=>t.focusAlertHighlight((0,a._)((0,o._)({},e),{source:le.nl.forceText})))),w.T(q.right))}),e.highlightMark=(e,t,i,n,s,o)=>a=>{const l=i.pipe(w.T(J.exists((e=>e.id===ne.B.Id.editor))),de.n((e=>M.h(n.pipe(B.u(!0)),s.pipe(S.p((0,oe.AU)(r.identity)),B.u(!1))).pipe(w.T((t=>!t&&e)),T.F(),x.Z(!0)))));return{name:"highlight mark",source:a.alertHighlightChanges.pipe(de.n(f._F.rafScheduler),F.skipBy(J.getEq(re.z.getEq())),w.T(J.filter((t=>J.isSome(e.getRegistered(t.alert.id))))),O.E(l,o),de.n((([e,i,n])=>(0,r.pipe)(e,J.filter((e=>n||e.source===le.nl.forceText)),J.fold((()=>C.w),(e=>new ce.c((s=>(i&&n&&[le.nl.forceSidebar,h.Kz.api].includes(e.source)&&!ae.A.isPremium(e.alert)&&t.moveCursorToHighlight(e,"start"),(0,r.pipe)(t.focusAlertHighlight(e),q.fold((t=>(s.next(q.left({message:"Cannot focus mark",error:t,data:{alertId:e.alert.id,highlightIndex:e.highlightIndex}})),j.Yi)),(t=>(s.next(q.right(e)),()=>t.dispose())))))))))))))}},e.unfocusAlertHighlightOnSidebarClose=e=>t=>({name:"unfocus alert highlight on sidebar close",source:e.pipe(S.p((0,oe.AU)(r.identity)),N.M(t.unfocusAlertHighlight),w.T(q.right))}),e.openInlineAlerts=(e,t)=>i=>({name:"open inline alert",source:e.state.pipe(de.n((n=>n.isSidebarOpen?C.w:t.pipe(N.M((t=>{i.focusAlertHighlight({alert:t.alert,highlightIndex:t.highlightIndex,source:le.nl.forceText}),e.toggleSidebar(!0,h.Kz.text)})),w.T(q.right)))))}),e.openAssistantWithActiveCard=(e,t)=>i=>({name:"open assistant with an active card",source:M.h(e.alertSwitchChanges.pipe(N.M((t=>{i.focusAlertHighlight((0,a._)((0,o._)({},t),{source:h.Kz.api})),t.source!==h.Kz.api&&e.toggleSidebar(!0,h.Kz.api)}))),e.activeLensId.pipe(O.E(e.state.view("isSidebarOpen")),de.n((([n,s])=>(0,j.Ub)(u.J.isPremiumId,u.J.isFreePremiumId)(n)?s?t.requestUphook():(e.toggleSidebar(!0,h.Kz.api),i.lifecycleEvents.pipe(S.p(he.f.isVisuallyReady),pe.s(1),de.n(t.requestUphook))):C.w)))).pipe(w.T(q.right))}),e.openAssistantWithPlagiarism=(e,t)=>i=>({name:"open assistant with plagiarism",source:e.activeLensId.pipe(O.E(e.state.view("isSidebarOpen")),de.n((([n,s])=>u.J.isPlagiarismId(n)?s?t.requestPlagiarism():(e.toggleSidebar(!0,h.Kz.api),i.lifecycleEvents.pipe(S.p(he.f.isVisuallyReady),pe.s(1),de.n(t.requestPlagiarism))):C.w)),w.T(q.right))}),e.updateLoaderStateOnReady=e=>t=>({name:"update loader state on ready",source:t.lifecycleEvents.pipe(S.p(he.f.isVisuallyReady),N.M((()=>e.state.modify((e=>(0,a._)((0,o._)({},e),{lens:J.none}))))),B.u(q.right(void 0)))}),e.scrollAlertIntoView=(e,t)=>i=>({name:"scrollAlertIntoView",source:t.pipe(de.n((t=>t?i.scrollIntoViewChanges.pipe(O.E(i.alertVisibilityFilter),S.p((([e,t])=>t(e.alert))),de.n((([t])=>e.ensureAlertHighlightInViewport(t,200,c.nA.initial).pipe(w.T(q.bimap((e=>({message:"Move focused mark into viewport: Cannot ensure alertHighlight in viewport",error:e,data:t})),(0,r.constant)(t))))))):C.w)))}),e.toggleAutoScroll=e=>t=>({name:"toggleAutoScroll",source:e.pipe(N.M(t.toggleAutoScroll),w.T(q.right))}),function(e){e.create=(e,...t)=>i=>{const n=new v.y.Keeper,s=e.getLogger("Integration",d.y7.$.DEBUG,d.y7.I.ViewModel.base);return n.push(M.h(...t.map((e=>{const{name:t,source:n}=e(i);return n.pipe(N.M(q.fold((e=>s.error(`${t}: ${e.message}`,e.error,e.data)),(e=>s.debug(t,e)))))}))).subscribe()),n}}(t=e.Factory||(e.Factory={}))}(ie||(ie={}));var ue=i(83531),ge=i(78323),me=i(62723),_e=i(58347),ve=i(48368),fe=i(89011),ye=i(21216),be=i(41797),we=i(19711),Se=i(68533),Ce=i(30744),Me=i(38886);function Ee(e,t){return b.zV([e,t]).pipe(w.T((([e,t])=>e&&!t)))}function ke(){return ye.of(!0)}function Te(){return ye.of(!0)}function xe(e){const t=e.getText();return(0,r.pipe)(["Grammarly Premium can give you very helpful feedback on your writing. Passive voice can be fixed by Grammarly, and it can handle classical word-choice mistakes.","Grammarly Premium can give you very helpful feedback on your writing.","Passive voice can be fixed by Grammarly, and it can handle classical word-choice mistakes.","You'll find suggestions that can possibly help you revise a wordy sentence in an effortless manner."],Me.CX((e=>{const i=t.indexOf(e);return i>-1?J.some({index:i,length:e.length}):J.none})))}const Ie=[ve.f.Popup,ve.f.Popover];function Ae(e,t,i){e.modify((e=>{const n=e.slice(0);return n[t]=i,n}))}class Fe{_initSteps(e=new Set){this._stepsSubscriptions.forEach((e=>e.unsubscribe())),this._stepsSubscriptions=[],function(e,t,i,n,s,o,a,d){if(te.vI.isHidden(s))return[];const c=d.denali.showOnboardingTourA11yUpdates,p=c?function(e){return e.onboardingViewModels.pipe(de.n((e=>(0,r.pipe)(e,J.fold((()=>ye.of(J.none)),(e=>e.onboarding.activeStep)))))).pipe(w.T((e=>(0,r.pipe)(e,J.fold((()=>!1),(e=>{var t;return"initial"===e.name||"initialBTS"===(null===(t=e)||void 0===t?void 0:t.name)}))))))}(o):ye.of(!1),h={id:fe.E.StepId.Step11,switch:()=>function(e,t){return l.s.combine(t,e,((e,t)=>t&&J.isNone(e))).pipe(we.$())}(a.state.view("isSidebarOpen"),n),gnarName:"Step 1: Select active card",skipDot:c},u={id:fe.E.StepId.Step4,switch:()=>{const e=function(e,t){return e.view(J.exists((e=>t.isRegistered(e.alert.id)&&ae.A.isDefault(e.alert)&&J.isSome(e.alert.getTransform()))))}(n,i);return Ee(e,p)},gnarName:"Step 2: Apply alert",skipDot:c},g={id:fe.E.StepId.GrammarlyGORewrite,switch:()=>function(e,t){return e.navigation.isGGOLensActive.pipe(Ce.U(e.isGenAiAvailable.pipe(S.p(r.identity))),w.T((e=>(0,r.pipe)(t,J.fromPredicate((()=>!e)),J.chain(xe),J.fold(r.constFalse,r.constTrue)))))}(o,e),gnarName:"Step 3: Click GrammarlyGO Rewrite",skipDot:c,prepareStep:()=>(0,r.pipe)(o.navigation,J.fromPredicate((e=>!e.isGGOLensActive.get())),J.chain((()=>xe(e))),Q.Mi((({index:t,length:i})=>{e.setCursor(t,i)})),J.fold(r.constFalse,r.constTrue))},m={id:fe.E.StepId.GrammarlyGOIdeationAssistant,switch:()=>Ee(function(e){return e.navigation.isGGOLensActive.pipe(w.T((e=>!e)))}(o),p),gnarName:"Step 4: Open GrammarlyGO Ideation Assistant",skipDot:c},_={id:fe.E.StepId.Step1,switch:()=>Ee(ye.of(!0),p),gnarName:"Step 5: Open Set Goals",skipDot:c},v={id:fe.E.StepId.Step8,switch:()=>Ee(ye.of(!0),p),gnarName:"Step 6: Open Performance",skipDot:c},y={id:fe.E.StepId.Step9,switch:()=>{return i=e.contentUpdated.pipe(B.u(f.q6)),n=t.checkingState,be.H(n.pipe(S.p((e=>"idle"===e)),we.$(),B.u(!0))).pipe(Se.h(i.pipe(we.$(),B.u(!1))));var i,n},gnarName:"Step 7: See synonyms",skipDot:c},b={id:fe.E.StepId.Step10,switch:ke,gnarName:"Step 8: Open left sidebar",skipDot:c},C={id:fe.E.StepId.DocumentTitle,switch:Te,gnarName:"Step 9: Edit title",skipDot:c};switch(s.content){case te.vI.Content.Oggy:return[u,_,v,b,C];case te.vI.Content.OggySplit:case te.vI.Content.WithoutInlineCards:return[u,g,m,_,v,b,C];case te.vI.Content.Full:return[h,u,g,m,_,v,y,b,C];default:return(0,Y.xb)(s)}}(this._ded,this._sessionChecksModel,this._alertsReader,this._activeAlertHighlight,this._mode,this._cheetahViewModel,this._navigationViewModel,this._features).forEach(((t,i)=>this._addStep(t,i,e)))}isLastStep(e){return Boolean(this._steps[e].isLastStep)}isStepEnabled(e){return void 0!==this._steps[e]}subscribeForStep(e){const{state:t,gnarName:i}=this._steps[e];if(void 0===t)throw new Error("Illegal onboarding step id "+e);return{id:e,state:t,dotShown:()=>{this._telemetry.gnarSpec.onboardingStepDotOnboardingShow(this._telemetry.pageId,i)},dotClicked:()=>{(0,Y.V1)(t.get()===ve.f.Dot,"Should be in dot state"),this._log.info("Dot clicked for: "+e),t.set(ve.f.Popup),this._telemetry.gnarSpec.onboardingStepOnboardingPass(this._telemetry.pageId,i)},popupIgnored:()=>{(0,Y.V1)(this._isPopup(t.get()),"Should be in popup state"),this._log.info("Popup ignored for: "+e),t.set(ve.f.Hidden),this._updateStates()},popupClosed:()=>{(0,Y.V1)(this._isPopup(t.get()),"Should be in popup state"),this._log.info("Popup closed for: "+e),t.set(ve.f.Passed),this._updateStates()},actionTaken:()=>{(0,Y.V1)(this._isPopup(t.get())||t.get()===ve.f.Dot,"Should be in popup or dot state"),this._log.info("Action taken for: "+e),t.set(ve.f.Passed),this._updateStates(),this._telemetry.gnarSpec.onboardingStepOnboardingPass(this._telemetry.pageId,i)}}}unsubscribe(){this._subs.forEach((e=>e.unsubscribe())),this._stepsSubscriptions.forEach((e=>e.unsubscribe()))}getStepCompletionCallback(e){return()=>{if(this.isStepEnabled(e)){const t=this.subscribeForStep(e),i=t.state.get();(i===ve.f.Dot||this._isPopup(i))&&t.actionTaken()}}}changeState(e){this._enableState.set(e)}relaunchAllSteps(){this._initSteps()}_updateStates(){var e=this;return(0,ue._)((function*(){yield(0,j.yy)(500);const t=e._switches.get();e._log.debug("Onboarding switches updated "+t);const i=e._states.get().slice();t.forEach(((e,t)=>{e||i[t]===ve.f.Hidden||i[t]===ve.f.Passed||(i[t]=ve.f.Hidden)}));const n=i.filter((t=>e._isPopup(t)||t===ve.f.Dot)).length;let s=Math.max(0,1-n);for(let n=0;n<i.length&&!(s<=0);++n)if(i[n]===ve.f.Hidden&&t[n]){var o,a,r;if(null!==(r=null===(o=(a=e._stepsByIdx[n]).prepareStep)||void 0===o?void 0:o.call(a))&&void 0!==r&&!r){i[n]=ve.f.Hidden;continue}e._stepsByIdx[n].skipDot?i[n]=e._features.denali.showOnboardingTourA11yUpdates?ve.f.Popover:ve.f.Popup:i[n]=ve.f.Dot,s--}const l=i.filter((t=>e._isPopup(t)||t===ve.f.Dot)).length;(0,Y.V1)(l<=1,`Should be only 1 popups and dots visible, now ${l}`),e._states.set(i)}))()}constructor(e,t,i,n,o,a,c,p,h,u,g){(0,s._)(this,"_settings",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"_sessionChecksModel",void 0),(0,s._)(this,"_alertsReader",void 0),(0,s._)(this,"_mode",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_activeAlertHighlight",void 0),(0,s._)(this,"_getFirstTargetRect",void 0),(0,s._)(this,"_cheetahViewModel",void 0),(0,s._)(this,"_navigationViewModel",void 0),(0,s._)(this,"_features",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_steps",void 0),(0,s._)(this,"_stepsByIdx",void 0),(0,s._)(this,"_switches",void 0),(0,s._)(this,"_states",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_stepsSubscriptions",void 0),(0,s._)(this,"_enableState",void 0),(0,s._)(this,"getFirstTargetRect",void 0),(0,s._)(this,"completionTrigger",void 0),(0,s._)(this,"_isPopup",void 0),(0,s._)(this,"_addStep",void 0),this._settings=e,this._ded=t,this._sessionChecksModel=i,this._alertsReader=n,this._mode=o,this._telemetry=a,this._activeAlertHighlight=c,this._getFirstTargetRect=p,this._cheetahViewModel=h,this._navigationViewModel=u,this._features=g,this._log=d.Bx.Logging.getLogger("OnboardingViewModelImpl",d.y7.$.TRACE),this._steps={},this._stepsByIdx=new Array,this._switches=l.s.create([]),this._states=l.s.create([]),this._subs=[],this._stepsSubscriptions=[],this._enableState=l.s.create(!0),this.getFirstTargetRect=this._getFirstTargetRect,this.completionTrigger=this._activeAlertHighlight.view(J.isSome),this._isPopup=e=>Ie.includes(e),this._addStep=(e,t,i)=>{Ae(this._switches,t,!1);const n=this._states.lens(ge.J2.index(t).compose(ge.J2.withDefault("dummy")));Ae(this._states,t,i.has(e.id)?ve.f.Passed:ve.f.Hidden),this._steps[e.id]={state:n,idx:t,gnarName:e.gnarName,isLastStep:e.isLastStep},this._stepsByIdx[t]=e,this._stepsSubscriptions.push(e.switch().pipe(me.z(this._enableState,((e,t)=>e&&t))).subscribe((e=>Ae(this._switches,t,e)),(e=>{this._log.error("onboarding malfunction",e),Ae(this._states,t,ve.f.Passed)})))};const m=te.vI.isForced(o)?new Set:new Set(this._settings.onboardingPassed.get());this._initSteps(m),this._subs.push(this._switches.pipe(_e.B(500)).subscribe((e=>this._updateStates()))),this._subs.push(this._states.pipe(y.i(1)).subscribe((e=>this._settings.updateOnboardingPassed(Object.keys(this._steps).filter((t=>e[this._steps[t].idx]===ve.f.Passed)))))),this._log.isEnabled(d.y7.$.TRACE)&&this._subs.push(this._states.subscribe((e=>this._log.debug("Onboarding states updated: "+e.join(", "))))),(0,j.hJ)("fireOnboardingStep",((e,t)=>(0,r.pipe)(J.fromNullable(this._steps[e]),J.fold((()=>console.info("No such step "+e)),(e=>e.state.set(t)))))),(0,j.hJ)("onboardingState",this)}}var Ve=i(7432),Le=i(55340),Ne=i(72106),Re=i(889),Oe=i(40808),Ue=i(58538),Be=i(26730);class Pe{getFirstSynonymRect(){return this.getFirstSynonym().pipe(w.T(J.chain((e=>J.fromEither(e.getRect())))))}getSynonymMarkRect(e){return Z.Mr(this._ded.getMarkRect(e))}scrollToMark(e,t,i){return this._ded.scrollToMark(e,{animate:i,paddingTop:t})}onPopupOpen(){(0,r.pipe)(this.viewState.get(),J.map((e=>e.synonymsState)),J.filter((0,j.Ub)(Ue._g.isReady,Ue._g.isEmpty)),J.map((({stats:e,pname:t})=>({stats:e,pname:t}))),J.getOrElse((()=>({stats:Ue.yp.emptySynonymsStats,pname:"unknown"}))),(({pname:e,stats:t})=>{this._trackSynonymPopupOpen(e,t)}))}getFirstSynonym(){return ce.c.create((e=>{let t=J.none;const i=De(this._ded.getText()),n=i.length?J.some(Ve.vY.create(i[0].start,i[i.length-1].end)):J.none,s=(0,r.pipe)(n,J.fold((()=>[]),(e=>this._positionManager.findRanges((t=>Re.l.isVisible(t)&&Ve.vY.isOverlap(t,e)))))),o=be.H(Promise.all(He(i,s).map(this.query))).pipe(w.T((0,r.flow)((0,Me.i8)(Ue._g.isReady),J.chain((e=>{const t=Le.C.SynonymMark.generateSynonymOnboardingId(e.synonyms.id),i=Ve.vY.create(e.query.start,e.query.start+e.query.word.length),n=this._synonymsModel.positionManager.registerRange(t,i);return(0,r.pipe)(this._ded.changeMarks([Ne.J.Change.getCreateAction({range:()=>n,order:0,classes:[]})(t)]),(e=>e.created.get(t)),J.fromNullable,J.chain(J.fromEither))})))),we.$()).subscribe((i=>{t=i,e.next(i)}));return()=>{J.map(this.disposeFirstSynonym)(t),o.unsubscribe()}}))}apply(e){const t=this.viewState.get();(0,r.pipe)(t,J.map((({synonymsState:t,activeWord:i})=>{if(!Ue._g.isReady(t))throw new Y.zU("Synonym should exist.");this._trackSynonymAccept(t.pname,(0,o._)({},t.stats,Ue.yp.getSynonymStats(e,t.synonyms.synonymsOrGroups)),Ue.yp.getTimeToClose(t.readyAt));const n=this._synonymsModel.applySynonym({id:t.synonyms.id,dispose:j.Yi,range:i},e);(0,Oe.M7)((()=>this._notificationsManager.enqueue("alertUndo",{params:(0,Oe.cm)([n])})),this._trackUndoCloseButton,(()=>(this._ded.flushChanges(),this._ded.contentUpdated))).subscribe((e=>"commit"===e?n.commit():n.undo()))}))),this.close("apply")}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}_request(e){return this.query({start:e.start,word:e.meta.value}).then(J.some).catch((e=>(this._log.error("Error querying synonyms",e),J.none)))}_canShowPopup(e){return Ue._g.isReady(e)||Ue._g.isEmpty(e)}_deregisterRange(e){(0,r.pipe)(this._synonymsModel.positionManager.findById(e),J.fold(j.Yi,(t=>{this._ded.flushChanges(),this._synonymsModel.positionManager.deregisterRange(e)})))}_handleState(){this._subs.push(this._inlineManager.doubleClickedWord.pipe(de.n(this._emitCloseWhen),w.T(J.filter(this._isOnline)),U.cy((e=>(this._ded.flushChanges(),this._withRegisteredWord(e,(0,r.flow)(this._listenQuery,de.n(this._createSynonymsState),w.T(J.some))))))).subscribe(f.H9(this.viewState),(e=>this._log.error("can not change syns state",e))))}constructor(e,t,i,n,o,a,c,p,h,u,g){(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"_positionManager",void 0),(0,s._)(this,"_synonymsModel",void 0),(0,s._)(this,"_networkState",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"_activeAlertChanges",void 0),(0,s._)(this,"_trackUndoCloseButton",void 0),(0,s._)(this,"_trackSynonymPopupOpen",void 0),(0,s._)(this,"_trackSynonymPopupDismiss",void 0),(0,s._)(this,"_trackSynonymAccept",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_style",void 0),(0,s._)(this,"viewState",void 0),(0,s._)(this,"popupShown",void 0),(0,s._)(this,"_defaultClassName",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"disposeFirstSynonym",void 0),(0,s._)(this,"query",void 0),(0,s._)(this,"close",void 0),(0,s._)(this,"_withRegisteredWord",void 0),(0,s._)(this,"_listenQuery",void 0),(0,s._)(this,"_createSynonymsState",void 0),(0,s._)(this,"_removeMark",void 0),(0,s._)(this,"_createMark",void 0),(0,s._)(this,"_emitCloseWhen",void 0),(0,s._)(this,"_isOnline",void 0),this._inlineManager=e,this._positionManager=t,this._synonymsModel=i,this._networkState=n,this._ded=o,this._notificationsManager=a,this._activeAlertChanges=c,this._trackUndoCloseButton=p,this._trackSynonymPopupOpen=h,this._trackSynonymPopupDismiss=u,this._trackSynonymAccept=g,this._log=d.Bx.Logging.getLogger("LegacySynonymsViewModel"),this.viewState=l.s.create(J.none),this.popupShown=this.viewState.view(J.fold((()=>!1),(e=>e.popupVisible))),this._defaultClassName="defaultSynonymClass",this._subs=[],this.disposeFirstSynonym=e=>{this._ded.changeMarks([Ne.J.Change.getRemoveAction({range:()=>q.getOrElse((e=>e))(e.range())},Ne.J.Change.RemoveType.full)(e.id)]),this._deregisterRange(e.id)},this.query=e=>(this._ded.flushChanges(),this._synonymsModel.query(e)),this.close=e=>{"closedByUser"===e&&(0,r.pipe)(this.viewState.get(),J.map((e=>e.synonymsState)),J.filter((0,j.Ub)(Ue._g.isReady,Ue._g.isEmpty)),Q.Mi((e=>{this._synonymsModel.ignore(e.synonyms.id),this._trackSynonymPopupDismiss(e.pname,e.stats,Ue.yp.getTimeToClose(e.readyAt))}))),this._inlineManager.closeSynonyms.next()},this._withRegisteredWord=(e,t)=>ce.c.create((i=>{const n=this._synonymsModel.positionManager.registerRange(Le.C.SynonymMark.generateActiveWordRandomId(),e),s=t(n).subscribe(i);return()=>{s.unsubscribe(),this._deregisterRange(n.meta.id)}})),this._listenQuery=e=>ce.c.create((t=>(this._request(e).then((i=>{var n;null!==(n=t.closed)&&void 0!==n&&n||(0,r.pipe)(i,J.fold((()=>this.close("error")),(i=>t.next([e,i]))))})),()=>{this._synonymsModel.abortQuery()}))),this._createSynonymsState=([e,t])=>ce.c.create((i=>{const n=this._canShowPopup(t);return(0,r.pipe)(this._createMark(e,n),(s=>(0,r.pipe)(s.range(),q.fold((e=>{this._log.error("Error creating Synonym state",e)}),(o=>{const a=this._synonymsModel.positionManager.registerRange(s.id,o),r={synonymsState:t,activeWord:e,activeMark:a,popupVisible:n};return i.next(r),()=>{this._deregisterRange(r.activeMark.meta.id),setTimeout((()=>this._removeMark(r)),10)}})))))})),this._removeMark=e=>{try{this._ded.flushChanges(),(0,r.pipe)(this._ded.getMarkById(e.activeMark.meta.id),q.map((t=>{this._ded.changeMarks([Ne.J.Change.getRemoveAction({range:()=>(0,r.pipe)(t.range(),q.getOrElse((e=>e)))},Ne.J.Change.RemoveType.full)(e.activeMark.meta.id)])})))}catch(e){this._log.error("Cannot remove synonym",e)}},this._createMark=(e,t)=>(0,r.pipe)(this._ded.changeMarks([Ne.J.Change.getCreateAction({range:()=>e,classes:t?[this._defaultClassName,this._style.synonym,this._style.markSelected]:[this._defaultClassName,this._style.markHidden],order:0})(Le.C.SynonymMark.id)]),(e=>e.created.get(Le.C.SynonymMark.id)),q.fold((()=>null),r.identity)),this._emitCloseWhen=U.MA((()=>M.h(this._ded.contentUpdated,this._activeAlertChanges.pipe(y.i(1)),k.R(document,"keydown")).pipe(B.u(f.q6),N.M((()=>this.close("closedByUser")))))),this._isOnline=()=>"offline"!==this._networkState.getOnlineStatus(),this._style=(0,Be.ID)(),this._handleState()}}const De=(e,t=10)=>{const i=/( |^)[a-z]{3,}\b/gim,n=[];let s;for(let o=0;(s=i.exec(e))&&o<t;o++){const e=s[0].replace(" ",""),t=i.lastIndex-e.length,o=t+e.length;n.push({start:t,word:e,end:o})}return n},He=(e,t)=>0===t.length||0===e.length?e:(()=>{const i=e[e.length-1].end,n=t.findIndex((e=>e.start>i)),s=n>=0?t.slice(0,n):t;return e.filter((e=>s.every((t=>!(e.start<=t.end&&t.start<=e.end)))))})();var We=i(9654),Ge=i(86780),Ke=i(74056),ze=i(11864);const $e="denali-a11y-log-container",Je="denali-a11y-alert-container",je="denali-a11y-status-container-",qe=ze.Ks.style({position:"absolute",width:"1px",height:"1px",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0,0,0,0)",border:0});function Ye(e){const t=document.getElementById(e);if(t)return t;{const t=document.createElement("div");return t.id=e,document.body.appendChild(t),t}}function Ze(e,t){const i=document.createElement("div");i.textContent=e,t.appendChild(i),setTimeout((()=>{i.remove()}),5e3)}function Qe(e){e.setAttribute("class",qe),e.setAttribute("data-verified","true")}class Xe{constructor(e){(0,s._)(this,"sessionUuid",l.s.create("")),e.pipe(S.p((({action:e})=>"start"===e)),w.T((({sessionUuid:e})=>e)),pe.s(1)).subscribe(f.H9(this.sessionUuid))}}var et,tt=i(71652),it=i(79239);!function(e){const t=/([^\s]+\s+[^\s]+)/;e.create=function(e,i,n,s){const o=n.pipe(w.T((0,oe.AU)(tt.y.isUnavailable))),a=ye.of(s.cheetahInlineRewrite||s.cheetahMagicRewrite),l=e.activeLensId.view((e=>e!==u.J.SpecialId.Cheetah)),d=i.pipe(w.T((e=>e.type===it.VV.Collapsed)));return{isAvailable(e){const i=e.pipe(w.T((e=>e.length<=5e3&&t.test(e))));return b.zV([o,a,l,d,i]).pipe(w.T(Me.Si(r.identity)))}}},e.mock=function(e=ye.of(!1)){return{isAvailable:()=>e}}}(et||(et={}));var nt=i(38315),st=i(9619),ot=i(85982),at=i(28986),rt=i(27645),lt=i(31866);class dt{get selectedRange(){const e=this._ded.getCursor();return{start:e.index,end:e.length+e.index}}replaceCurrentSelectionWith(e){return this.insertContent(e,{onNewLine:!1,replace:!0,preserveSelection:!1})}insertContent(e,t){return(0,r.pipe)(Z.L9(this._ded.flushChanges),Z.g$((0,r.pipe)(Z.L9((()=>{const{start:e,end:i}=this.selectedRange;return{start:e,deleteDelta:t.replace&&i>e?(new at.R).delete(i-e):new at.R}})),Z.Tj(Boolean(t.onNewLine)?pt:ct),Z.ap(this._getContents))),Z.W6((0,r.flow)((t=>(new at.R).retain(t.start).concat(e).concat(t.deleteDelta)),this._pushChanges,Z.oF)),Z.cy((({start:i})=>()=>new Promise((n=>requestAnimationFrame((()=>n(this._ded.setCursor(i,Boolean(t.preserveSelection)?e.length():0)))))))))}constructor(e){(0,s._)(this,"_ded",void 0),(0,s._)(this,"_pushChanges",void 0),(0,s._)(this,"_getContents",void 0),this._ded=e,this._pushChanges=e=>ot.TX((()=>this._ded.pushChanges(rt.lY.delta(e,this._ded.getTextLength()),"user")),q.toError),this._getContents=(0,r.pipe)(ot.TX(this._ded.getContents,q.toError),Z.oF)}}function ct(e){return()=>e}function pt(e){const t=e.start,i=e=>lt.E.isInsertString(e)&&e.insert.includes("\n"),n=lt.E.findInDelta(i,(e=>e.insert.indexOf("\n")));return s=>(0,r.pipe)(s,(({delta:e})=>e.slice(t)),n,J.getOrElse((()=>s.delta.length())),((e,n)=>s=>{const o=n.delta;let a=1;if(0===t)1===o.length()&&(a=0);else if(t>0&&i(o.slice(t-1,t).ops[0])){const e=o.slice(t,t+1).ops[0];Boolean(e)?i(e)&&(a=0):a=0}return e+s+a})(t,s),(t=>(0,a._)((0,o._)({},e),{start:t})))}var ht=i(23121);class ut{constructor(e,t,i){(0,s._)(this,"_ded",void 0),(0,s._)(this,"_features",void 0),(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"inlineButtonState",void 0),(0,s._)(this,"magicRewriteEnabled",void 0),(0,s._)(this,"inlineRewriteEnabled",void 0),(0,s._)(this,"showOnboardingTourA11yUpdates",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_inlineButtonState",void 0),(0,s._)(this,"dispose",void 0),this._ded=e,this._features=t,this._inlineManager=i,this.inlineButtonState=l.s.create(J.none),this._subs=new v.y.Keeper,this._inlineButtonState=b.zV([this._ded.viewport,this._ded.scrollPosition,this._inlineManager.cheetahInlineButtonState]).pipe(w.T((([e,t,i])=>(0,r.pipe)(i,J.fold((()=>J.none),(()=>{const{text:{left:i}}=e;return(0,r.pipe)(this._ded.getSelectionRect(),ht.qI((e=>e.getRect())),q.map((e=>e.clientRects)),J.fromEither,J.filter(Me.J_),J.map((e=>{const n=e[e.length-1],s=e.length>1;return{top:n.bottom+t,left:s?i:n.left}})))})))))),this.dispose=()=>{this._subs.dispose()};const n=this._features.oggy===te.kH.splitSharedAssistants;this.magicRewriteEnabled=n&&this._features.cheetahMagicRewrite,this.inlineRewriteEnabled=n&&this._features.cheetahInlineRewrite,this.showOnboardingTourA11yUpdates=this._features.showOnboardingTourA11yUpdates,this._subs.push(this._inlineButtonState.subscribe((e=>this.inlineButtonState.set(e))))}}var gt=i(65011),mt=i(81238),_t=i(45413),vt=i(37223),ft=i(40005),yt=i(70823);class bt{constructor(e,t,i,n,c,p,h,u,g,m,y,C,M,E,k,T,x,A,F,V,L){switch((0,s._)(this,"_oggyManager",void 0),(0,s._)(this,"_lifecycleService",void 0),(0,s._)(this,"_lifecycleEvents",void 0),(0,s._)(this,"_textEditorService",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"_navigation",void 0),(0,s._)(this,"_userService",void 0),(0,s._)(this,"_capiService",void 0),(0,s._)(this,"_availabilityService",void 0),(0,s._)(this,"_uphookService",void 0),(0,s._)(this,"_deepLinkService",void 0),(0,s._)(this,"_feedbackService",void 0),(0,s._)(this,"_onboardingViewModelsFactory",void 0),(0,s._)(this,"_experimentService",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_features",void 0),(0,s._)(this,"_sessionModel",void 0),(0,s._)(this,"_modalManager",void 0),(0,s._)(this,"_selectionRange",void 0),(0,s._)(this,"_usedDuringSession",void 0),(0,s._)(this,"_selectionContextAvailabilityService",void 0),(0,s._)(this,"assistantUI",void 0),(0,s._)(this,"ggoUI",void 0),(0,s._)(this,"onboardingViewModels",void 0),(0,s._)(this,"usedDuringSession",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_assistantUIActions",void 0),(0,s._)(this,"_selectionOnLensEnter",void 0),(0,s._)(this,"_onboardingUIActions",void 0),(0,s._)(this,"_isInSplitMode",void 0),(0,s._)(this,"_genAISession",void 0),(0,s._)(this,"_commonAssistantDependencies",void 0),(0,s._)(this,"_disposed",void 0),(0,s._)(this,"dispose",void 0),(0,s._)(this,"_initUI",void 0),(0,s._)(this,"_initOnboarding",void 0),(0,s._)(this,"_manageGgo",void 0),(0,s._)(this,"_manageAssistant",void 0),(0,s._)(this,"_disposeAssistant",void 0),(0,s._)(this,"_disposeGgo",void 0),(0,s._)(this,"_getRevisionAssistantDependencies",void 0),(0,s._)(this,"_getGenAIAssistantDependencies",void 0),(0,s._)(this,"_getGenAIAndRevisionAssistantDependencies",void 0),(0,s._)(this,"_createAssistant",void 0),(0,s._)(this,"_createGgo",void 0),this._oggyManager=e,this._lifecycleService=t,this._lifecycleEvents=i,this._textEditorService=n,this._ded=c,this._navigation=p,this._userService=h,this._capiService=u,this._availabilityService=g,this._uphookService=m,this._deepLinkService=y,this._feedbackService=C,this._onboardingViewModelsFactory=M,this._experimentService=E,this._telemetry=k,this._features=T,this._sessionModel=x,this._modalManager=A,this._selectionRange=F,this._usedDuringSession=V,this._selectionContextAvailabilityService=L,this.assistantUI=l.s.create(J.none),this.ggoUI=l.s.create(J.none),this.onboardingViewModels=l.s.create(J.none),this.usedDuringSession=this._usedDuringSession.view(),this._log=d.Bx.Logging.getLogger("Cheetah.CheetahWebLifecycleManagerImpl"),this._subs=new v.y.Keeper,this._assistantUIActions=new _.B7,this._selectionOnLensEnter=this._navigation.isGGOLensActive.pipe(S.p(Boolean),O.E(this._ded.selection),w.T(gt.gp)),this._onboardingUIActions=new _.B7,this._isInSplitMode=this._features.oggy===te.kH.splitSharedAssistants,this._genAISession=l.s.create(J.none),this._disposed=new _.B7,this.dispose=()=>{this._disposed.next(!0),this._disposeAssistant(),this._disposeGgo(),this._subs.dispose()},this._initUI=({kind:e,oggyManager:t,lifecycleService:i})=>{performance.mark(mt.F.assistantOpenAttempt);const n={mode:this._navigation.mode.get(),metadata:(0,r.pipe)(this._features.cheetahPromptsUsed,J.map((e=>({setPromptsUsed:e}))),J.toUndefined)};switch(this._log.info(`Init UI for ${e}`),e){case"oggy":const s=(0,r.pipe)(n,this._createAssistant(i,t));this.assistantUI.set(J.some(s)),this._log.info("Inited Oggy Assistant UI",s);break;case"ggo":const o=this._createGgo(i)(n);this.ggoUI.set(J.some(o)),this._log.info("Inited GGO Assistant UI",o);break;case"ggoWithRevision":const a=this._createGgo(i,t)(n);this.ggoUI.set(J.some(a)),this._log.info("Inited GGO with Revision Assistant UI",a);break;default:(0,Y.xb)(e)}},this._initOnboarding=()=>{const e=this._sessionModel.defaultContext.pipe(w.T(J.chain((e=>e.writingIntent)))),t=this._availabilityService.availability.pipe(S.p(tt.y.isVisible),pe.s(1)),i=this._modalManager.state.view(J.exists((e=>e.instance.type===We.zz.Tour)));!this._sessionModel.isDemoDocument&&this._features.cheetahOnboarding&&b.zV([t,e,i]).pipe(S.p((([e,t,i])=>tt.y.isVisible(e)&&!i))).subscribe((([e,t])=>{const i=this._onboardingViewModelsFactory({intent:t,disposed:this._disposed,assistantUIActions:this._assistantUIActions,onboardingUIActions:this._onboardingUIActions,cheetahButton:this._navigation.cheetahButton,genAiSession:this._genAISession});this._subs.push((0,r.pipe)(i.onboarding.uiActions,S.p(_t.K.is(_t.K.Kind.tryItOut)),N.M((()=>this._navigation.toCheetahLens(!1,!1)))).subscribe()),this._subs.push(i.onboarding),this.onboardingViewModels.set(J.some(i))}))},this._manageGgo=()=>this._subs.push(b.zV([this._navigation.isGGOLensActive.pipe(I.J()),this._lifecycleService]).pipe(N.M((([[e,t],i])=>{!1===e&&!0===t?this._initUI({kind:"ggo",lifecycleService:i}):!0===e&&!1===t&&this._disposeGgo()}))).subscribe()),this._manageAssistant=e=>{this._subs.push(b.zV([this._navigation.isSidebarOpened,this._lifecycleService]).pipe(N.M((([t,i])=>t?this._initUI({kind:"oggy",oggyManager:e,lifecycleService:i}):this._disposeAssistant()))).subscribe())},this._disposeAssistant=()=>{this._log.info("Disposing Assistant..."),this.assistantUI.set(J.none)},this._disposeGgo=()=>{this._log.info("Disposing GGO..."),this.ggoUI.set(J.none)},this._getRevisionAssistantDependencies=(e,t)=>{return i=(0,a._)((0,o._)({},this._commonAssistantDependencies(e)),{alertService:t.alertService,sduiService:t.sduiService}),()=>(0,a._)((0,o._)({kind:"revision"},i),{isPlagiarismEnabled:!0,isAiDetectorEnabled:i.features.isAiDetectorEnabled,isWritingExpertEnabled:i.features.writingExpertPullMode,trackingService:(0,yt.H4)(i.telemetry,i.features),toneDetectorService:void 0});var i},this._getGenAIAssistantDependencies=({kind:e,oggyManager:t,lifecycleService:i})=>{return"withOggy"===e?(n=(0,a._)((0,o._)({},this._commonAssistantDependencies(i)),{genAIAvailabilityService:this._availabilityService,selectionContextAvailabilityService:this._selectionContextAvailabilityService,lifecycleService:(0,a._)((0,o._)({},i),{sizeBehavior:ft.w.fitContent(document.documentElement)}),notifyGenAISessionStateChanged:e=>this._genAISession.set(e),alertService:t.alertService,sduiService:t.sduiService}),e=>(0,a._)((0,o._)({kind:"genAIAndWritingExpert"},n),{genAIStartSessionOptions:e,isPlagiarismEnabled:!0,isWritingExpertEnabled:n.features.writingExpertPullMode,trackingService:(0,yt.H4)(n.telemetry,n.features)})):"withoutOggy"===e?(e=>t=>(0,a._)((0,o._)({kind:"genAI"},e),{genAIStartSessionOptions:t,trackingService:(0,yt.H4)(e.telemetry,e.features)}))((0,a._)((0,o._)({},this._commonAssistantDependencies(i)),{genAIAvailabilityService:this._availabilityService,selectionContextAvailabilityService:this._selectionContextAvailabilityService,lifecycleService:(0,a._)((0,o._)({},i),{sizeBehavior:ft.w.fitContent(document.documentElement)}),notifyGenAISessionStateChanged:e=>this._genAISession.set(e)})):(0,Y.xb)(e);var n},this._getGenAIAndRevisionAssistantDependencies=(e,t)=>{return i=(0,a._)((0,o._)({},this._commonAssistantDependencies(e)),{alertService:t.alertService,sduiService:t.sduiService,genAIAvailabilityService:this._availabilityService,selectionContextAvailabilityService:this._selectionContextAvailabilityService,notifyGenAISessionStateChanged:e=>this._genAISession.set(e)}),e=>(0,a._)((0,o._)({kind:"genAIAndRevision"},i),{genAIStartSessionOptions:e,isPlagiarismEnabled:!0,isWritingExpertEnabled:i.features.writingExpertPullMode,trackingService:(0,yt.H4)(i.telemetry,i.features)});var i},this._createAssistant=(e,t)=>(0,r.flow)(this._isInSplitMode?this._getRevisionAssistantDependencies(e,t):this._getGenAIAndRevisionAssistantDependencies(e,t),vt.v),this._createGgo=(e,t)=>(0,r.flow)(this._getGenAIAssistantDependencies(void 0===t?{kind:"withoutOggy",lifecycleService:e}:{kind:"withOggy",oggyManager:t,lifecycleService:e}),vt.v),this._commonAssistantDependencies=e=>({lifecycleService:e,userService:this._userService,capiService:this._capiService,textEditorService:this._textEditorService,uphookService:this._uphookService,deepLinkService:this._deepLinkService,feedbackService:this._feedbackService,experimentService:this._experimentService,telemetry:this._telemetry,notifyAssistantUIAction:e=>this._assistantUIActions.next(e),features:this._features,theme:l.s.create({useIframeTextfieldWrapper:!0})}),this._subs.push(this._lifecycleEvents.events.pipe(S.p(he.f.isClose),N.M((()=>this._navigation.closeCheetahLens()))).subscribe()),this._isInSplitMode?this._subs.push(this._ded.dontFreezeWhen(this._navigation.isGGOLensActive,"cheetah-lens")):this._subs.push(this._assistantUIActions.pipe(S.p((e=>"promptFieldFocusChange"===e.kind&&e.focused)),pe.s(1),N.M((()=>this._ded.restoreFocus("promptFieldFocusChange")))).subscribe()),this._subs.push(this._selectionOnLensEnter.pipe(f._F.inRaf).subscribe((e=>this._ded.setCursor(e.index,e.length,"api"))),this._ded.selection.subscribe((e=>{this._selectionRange.set(J.some({start:e.index,end:e.index+e.length,meta:void 0}))}))),this._features.oggy){case te.kH.splitSharedAssistants:this._manageAssistant(this._oggyManager),this._manageGgo();break;case te.kH.mergedSharedAssistant:this._manageAssistant(this._oggyManager);break;default:(0,Y.xb)(this._features.oggy)}this._initOnboarding()}}class wt{constructor(e,t){(0,s._)(this,"_navigationVM",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"cheetahButton",void 0),(0,s._)(this,"isGGOLensActive",void 0),(0,s._)(this,"isSidebarOpened",void 0),(0,s._)(this,"mode",void 0),(0,s._)(this,"toCheetahLens",void 0),(0,s._)(this,"closeCheetahLens",void 0),(0,s._)(this,"handleCheetahButtonClick",void 0),(0,s._)(this,"cheetahButtonRef",void 0),this._navigationVM=e,this._ded=t,this._log=d.Bx.Logging.getLogger("Cheetah.Navigation"),this.cheetahButton=l.s.create(null),this.isGGOLensActive=this._navigationVM.activeLensId.view((e=>e===u.J.SpecialId.Cheetah)),this.isSidebarOpened=this._navigationVM.state.view("isSidebarOpen"),this.mode=l.s.create("rewrite"),this.toCheetahLens=(e=!1,t=!1)=>{this._log.info("Opening lens...",{fromInline:e,withQuickRewrite:t});const i=0===this._ded.selection.getValue().length?"ideation":t?"quickRewrite":"rewrite";this.mode.set(i),this._navigationVM.events.next({type:"switchToLens",id:u.J.SpecialId.Cheetah,focusFirst:!1,actionSource:e?h.Kz.text:h.Kz.sidebar})},this.closeCheetahLens=()=>{this._log.info("Closing lens..."),this._navigationVM.events.next({type:"switchToLens",id:u.J.SpecialId.AllAlerts,focusFirst:!1,actionSource:h.Kz.api})},this.handleCheetahButtonClick=()=>{!0===this.isGGOLensActive.get()?this.closeCheetahLens():this.toCheetahLens()},this.cheetahButtonRef=e=>{this.cheetahButton.set(e)}}}var St,Ct=i(29577),Mt=i(91605),Et=i(18182),kt=i(54463),Tt=i(22835),xt=i(74168),It=i(36735);function At(e=500){return M.h(xt.L5.pipe(It.c(e/2),B.u(!0)),xt.L5.pipe(_e.B(e),B.u(!1))).pipe(T.F())}!function(e){e.create=({engine:e,denaliEditorModel:t,upgradeVM:i,navigationVM:n,userAccount:s,telemetry:o,inlineManager:a,modalManager:c,experimentClient:p,environment:h,platformEnvironment:u,notificationsManager:g,config:m})=>{const _=d.Bx.Logging.getLogger("Cheetah.CheetahViewModel");_.info("Creating CheetahViewModel");const f=new v.y.Keeper,y=l.s.create(J.none),b=(0,yt.F2)(s),C=s.features.denali.showOnboardingTourA11yUpdates,M=(0,yt.Nc)(o),E=l.s.create({contextUpdatesClient:s.features.denali.selectionContextUpdatesClient,contextUpdatesServer:s.features.denali.selectionContextUpdatesServer}),k=new nt.w(E),T=new wt(n,t),I=new dt(t),A=l.s.create(!1),F=(0,yt.n$)(t,I,e.cheetah.selectionContextManager,(()=>{A.set(!0)}),y,(0,Ge.l)(g,h)),V=(0,yt.Ip)(o,u,m,i),L=new bt(e.cheetah.oggyManager,e.cheetah.oggyLifecycleService,e.cheetah.oggyLifecycleEvents,F,t,T,b,e.cheetah.cheetahCapiService,e.cheetah.genAiAvailabilityService,V,e.cheetah.oggyDeepLinkService,M,(N={capi:e.obsCapiClient,settings:s.settings,availabilityService:e.cheetah.genAiAvailabilityService,features:s.features.denali,capiService:e.cheetah.cheetahCapiService},e=>{const t=new Set;return N.features.cheetahOrgContextEnabled||t.add(Ct.M.StepName.knowledgeHub),N.features.cheetahBTSOnboardingEnabled&&Q.gR("ASSIGNMENT_WRITING")(e.intent)||t.add(Ct.M.StepName.initialBTS),(0,Mt.K)({client:"editor",textStats:N.capi.events.pipe(S.p(kt.om.is("text_info")),w.T((e=>J.some({wordCount:e.data.wordsCount}))),x.Z(J.none)),capiService:N.capiService,upstreamOnboardingState:N.settings.cheetahOnboardingState,completeOnboardingStep:e=>{N.settings.cheetahOnboardingState.get()[e].editor.completed||N.settings.updateCheetahOnboardingState({[e]:{completed:!0,lastSeen:Date.now()}})},session:e.genAiSession,assistantUIActions:e.assistantUIActions,forceDisabledOnboardingSteps:t,externalElements:e.cheetahButton.pipe(w.T((e=>(0,r.pipe)(e,J.fromNullable,J.fold((()=>({})),(e=>({[Et.Z.initialPopupAnchor]:{reference:e,placement:"left",offset:8,boundaryAreaPadding:10},[Et.Z.initialBTSPopupAnchor]:{reference:e,placement:"left",offset:8,boundaryAreaPadding:10}}))))))),disposed:e.disposed,promptsAllocated:N.availabilityService.availability.view((0,r.flow)(J.fromPredicate(tt.y.isActiveOrPassive),J.map(Tt.Up("promptsAllocated")))),hideAssistantOnboardingTooltips:At()})}),(0,yt.xs)(p),o,s.features.denali,e.sessionModel,c,y,A,k);var N;const R=new ut(t,s.features.denali,a);return{assistantUI:L.assistantUI,ggoUI:L.ggoUI,onboardingViewModels:L.onboardingViewModels,inlineViewModel:R,usedDuringSession:L.usedDuringSession,navigation:T,isInOnboardingTourA11yExperiment:C,oggyMode:s.features.denali.oggy,isGenAiAvailable:e.cheetah.genAiAvailabilityService.availability.view(tt.y.isVisible),dispose:()=>{_.info("Disposing CheetahViewModel"),L.dispose(),R.dispose(),f.dispose()},acquireFocusWhen:e=>t.dontFreezeWhen(e,"Cheetah View")}},e.mock=()=>({assistantUI:ye.of(J.none),ggoUI:ye.of(J.none),onboardingViewModels:l.s.create(J.none),inlineViewModel:{inlineButtonState:l.s.create(J.none),magicRewriteEnabled:!1,inlineRewriteEnabled:!1,showOnboardingTourA11yUpdates:!1,dispose:r.constVoid},navigation:{cheetahButton:l.s.create(null),isGGOLensActive:l.s.create(!1),isSidebarOpened:l.s.create(!1),mode:l.s.create("rewrite"),toCheetahLens:r.constVoid,closeCheetahLens:r.constVoid,handleCheetahButtonClick:r.constVoid,cheetahButtonRef:r.constVoid},usedDuringSession:l.s.create(!1),isInOnboardingTourA11yExperiment:!1,oggyMode:te.kH.splitSharedAssistants,isGenAiAvailable:l.s.create(!1),acquireFocusWhen:()=>st.y.EMPTY,dispose:r.constVoid})}(St||(St={}));var Ft=i(88105);class Vt{constructor(e,t,i,n,o,a){(0,s._)(this,"_uploadViewModel",void 0),(0,s._)(this,"_denaliEditorModel",void 0),(0,s._)(this,"_userAccount",void 0),(0,s._)(this,"_environment",void 0),(0,s._)(this,"strings",void 0),(0,s._)(this,"uploadSection",void 0),(0,s._)(this,"visible",void 0),(0,s._)(this,"size",void 0),this._uploadViewModel=e,this._denaliEditorModel=t,this._userAccount=i,this._environment=n,this.visible=this._denaliEditorModel.contentUpdated.pipe(x.Z(void 0),w.T((()=>!Lt(this._denaliEditorModel))),T.F()),this.size=this._userAccount.settings.editorPreferences.view("fontSize");const l=this._userAccount.features.denali.showUploadInPlaceholderText&&J.isSome(this._uploadViewModel);this.strings=l?o===ee.jj.l1.FormattingMode.on?a.placeholderRTF:a.placeholder:a.placehoderWithoutUpload,this.uploadSection=(0,r.pipe)(this._uploadViewModel,J.map((e=>({uploadInputAccept:this._environment.has(Ke.OH.Flag.acceptUploadByMimeTypes)?ee.jj.Pm.join(","):ee.jj.$G.join(","),label:this.strings.upload,upload:t=>e.uploadModel.upload({files:t,notify:!1,allowMultiple:!1,isDragNDrop:!1})}))))}}const Lt=e=>e.getTextLength()>1||(()=>{const t=e.getContents().delta.ops[0];return Boolean(t)&&J.isSome(Ft.E.getAttrs(t))})();var Nt,Rt=i(72404),Ot=i(3346);class Ut{constructor(e,t){(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"_sendFeedback",void 0),(0,s._)(this,"currentText",void 0),(0,s._)(this,"modalShown",void 0),(0,s._)(this,"sendFeedback",void 0),this._notificationsManager=e,this._sendFeedback=t,this.currentText=l.s.create({brief:"",detailed:""}),this.modalShown=new _.B7,this.sendFeedback=()=>this.currentText.pipe(we.$(),de.n(this._sendFeedback),de.n((()=>this._notificationsManager.enqueue("feedbackSend").pipe(S.p((e=>"shown"===e)),N.M((()=>this.currentText.set({brief:"",detailed:""}))),V.Q(this.modalShown)))),Ot.W((()=>this._notificationsManager.enqueue("error")))).toPromise()}}!function(e){e.Mock=class{constructor(){(0,s._)(this,"modalShown",new _.B7),(0,s._)(this,"currentText",l.s.create({brief:"",detailed:""})),(0,s._)(this,"sendFeedback",(()=>new Promise(j.Yi)))}}}(Nt||(Nt={}));class Bt{dispose(){this._subs.dispose()}constructor(e,t,i,n){(0,s._)(this,"_config",void 0),(0,s._)(this,"_obsCapiClient",void 0),(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_subs",void 0),this._config=e,this._obsCapiClient=t,this._notificationsManager=i,this._telemetry=n,this._subs=new v.y.Keeper,this._subs.push(this._obsCapiClient.events.pipe(S.p(kt.om.is("gb_rule_created")),N.M((({categoryTitle:e,descriptionLength:t})=>{"Vox"===e?this._telemetry.gnarSpec.gbPromptCreateVoxRuleSubmit(t,this._telemetry.pageId):this._telemetry.gnarSpec.gbPromptLockWritingStyleSettingSubmit(this._telemetry.pageId)})),de.n((({categoryTitle:e,styleGuideId:t})=>this._notificationsManager.enqueue("gbRuleCreated",{link:"Vox"===e?`${this._config.account.styleGuide}/${t}`:`${this._config.account.writingStyle}?categoryTitle=${e}`})))).subscribe())}}var Pt,Dt=i(55638),Ht=i(80548),Wt=i(53397),Gt=i(11298),Kt=i(30396),zt=i(18515),$t=i(1404),Jt=i(80019);function jt(e){const[t,i]=zt.j(e.pipe(Gt.u()),J.isSome);return[t.pipe(w.T(Q.$v)),i.pipe(B.u(f.q6))]}!function(e){let t,i;!function(e){e.idle="idle",e.inlineCard="inline-card",e.synonymsCard="synonyms-card",e.formattingLink="formatting-link",e.upgradeHook="upgrade-hook",e.cheetahInlineButton="cheetah-inline-button",e.vbarCard="vbar-card",e.teaserCard="teaser-card"}(t=e.Type||(e.Type={})),e.idle={type:Pt.Type.idle},function(e){e.monoid=Wt.getStructMonoid({[Pt.Type.idle]:Me.JI(),[Pt.Type.formattingLink]:Me.JI(),[Pt.Type.upgradeHook]:Me.JI(),[Pt.Type.synonymsCard]:Me.JI(),[Pt.Type.inlineCard]:Me.JI(),[Pt.Type.cheetahInlineButton]:Me.JI(),[Pt.Type.vbarCard]:Me.JI(),[Pt.Type.teaserCard]:Me.JI()}),e.forCardState=function(e,t,i){const n=jt(e.alertHovered.pipe(S.p(Q.Lw((0,r.not)(ae.A.isWritingExpertWithTeaser))),w.T(J.filter((e=>t.isInteractable(e.id)&&ae.A.isHoverableInline(e)))))),s=n[0].pipe(w.T(((e,t)=>()=>[`fromDed:markAlertHover:set(${t})`,{type:Pt.Type.inlineCard,alert:e}]))),o=n[1].pipe(w.T(qt(Pt.Type.inlineCard,"Ded"))),a=i.pipe(w.T(qt(Pt.Type.inlineCard,"Ext")));return{[Pt.Type.idle]:[s],[Pt.Type.formattingLink]:[],[Pt.Type.upgradeHook]:[],[Pt.Type.synonymsCard]:[],[Pt.Type.inlineCard]:[s,o,a],[Pt.Type.cheetahInlineButton]:[],[Pt.Type.vbarCard]:[],[Pt.Type.teaserCard]:[]}},e.forSynonymsState=function(e,t){const i=e.doubleClickedWord.pipe(w.T(((e,t)=>()=>[`fromDed:synonyms:set(${t})`,{type:Pt.Type.synonymsCard,word:e}]))),n=t.pipe(w.T(qt(Pt.Type.synonymsCard,"Ext")));return{[Pt.Type.idle]:[i],[Pt.Type.formattingLink]:[i],[Pt.Type.upgradeHook]:[i],[Pt.Type.synonymsCard]:[i,n],[Pt.Type.inlineCard]:[i],[Pt.Type.cheetahInlineButton]:[i],[Pt.Type.vbarCard]:[i],[Pt.Type.teaserCard]:[]}},e.forFormattingLink=function(e,t,i){const n=t.pipe(w.T(((e,t)=>()=>[`fromUI:links:set(${t})`,{type:Pt.Type.formattingLink,link:e}]))),s=jt(Jt.uY.fromDenaliEditor(e.selectedFormatting)),o=s[0].pipe(w.T(((e,t)=>()=>[`fromDed:links:set(${t})`,{type:Pt.Type.formattingLink,link:e}]))),a=s[1].pipe(w.T(qt(Pt.Type.formattingLink,"Ded"))),r=i.pipe(w.T(qt(Pt.Type.formattingLink,"Ext")));return{[Pt.Type.idle]:[n,o],[Pt.Type.formattingLink]:[n,o,a,r],[Pt.Type.upgradeHook]:[n,o,a,r],[Pt.Type.synonymsCard]:[n],[Pt.Type.inlineCard]:[n],[Pt.Type.cheetahInlineButton]:[n],[Pt.Type.vbarCard]:[n],[Pt.Type.teaserCard]:[n]}},e.forUpgradeHook=function(e,t,i){const[n,s]=jt(e.alertClicked.pipe(w.T(J.filter((({alert:e})=>t.isRegistered(e.id)&&h.Fc.isInPremiumLens(e)&&!ae.A.isLockedUIAlert(e)))))),o=n.pipe(w.T(((e,t)=>()=>[`fromDed:markAlertClick:set(${t})`,{type:Pt.Type.upgradeHook,alert:e}]))),a=s.pipe(w.T(qt(Pt.Type.upgradeHook,"Ded"))),r=i.pipe(w.T(qt(Pt.Type.upgradeHook,"Ext")));return{[Pt.Type.idle]:[o],[Pt.Type.formattingLink]:[o],[Pt.Type.upgradeHook]:[o,a,r],[Pt.Type.synonymsCard]:[o],[Pt.Type.inlineCard]:[o],[Pt.Type.cheetahInlineButton]:[o],[Pt.Type.vbarCard]:[o],[Pt.Type.teaserCard]:[o]}},e.forCheetahInlineButton=function(e,t,i){const n=e.selection.pipe(T.F(c.LN.eqRange.equals),w.T((t=>e.getText().slice(t.index,t.index+t.length)))),[s,o]=zt.j(t.isAvailable(n),r.identity),a=s.pipe(w.T(((e,t)=>()=>[`fromDed:cheetah:set(${t})`,{type:Pt.Type.cheetahInlineButton}]))),l=o.pipe(w.T(qt(Pt.Type.cheetahInlineButton,"Ded"))),d=i.pipe(w.T(qt(Pt.Type.cheetahInlineButton,"Ext")));return{[Pt.Type.idle]:[a],[Pt.Type.formattingLink]:[],[Pt.Type.upgradeHook]:[],[Pt.Type.synonymsCard]:[],[Pt.Type.inlineCard]:[],[Pt.Type.cheetahInlineButton]:[a,l,d],[Pt.Type.vbarCard]:[],[Pt.Type.teaserCard]:[]}},e.forVbarCard=function(e){const[t,i]=jt(e),n=t.pipe(w.T(((e,t)=>()=>[`fromDed:activeVbar:set(${t})`,{type:Pt.Type.vbarCard,vbar:J.some(e)}]))),s=i.pipe(w.T(qt(Pt.Type.vbarCard,"Ded")));return{[Pt.Type.idle]:[n],[Pt.Type.formattingLink]:[],[Pt.Type.upgradeHook]:[],[Pt.Type.synonymsCard]:[],[Pt.Type.inlineCard]:[],[Pt.Type.cheetahInlineButton]:[],[Pt.Type.vbarCard]:[n,s],[Pt.Type.teaserCard]:[]}},e.forTeaserCard=function(e,t,i,n){const[s,o]=jt(e.alertHovered.pipe(w.T(J.filter((e=>t.isInteractable(e.id)&&ae.A.isHoverableInline(e)&&ae.A.isWritingExpertWithTeaser(e)))))),a=n.pipe(w.T(J.chain((e=>(0,r.pipe)(t.getById(e),J.map(ae.A.fromModel))))),F.skipBy(J.getEq(ae.A.eq)),Gt.u()),l=M.h(s,a.pipe(U.oE)).pipe(w.T(((e,t)=>()=>[`fromDed:teaserCardHover:set(${t})`,{type:Pt.Type.teaserCard,alert:e}]))),d=b.zV(a,o).pipe(S.p((([e])=>J.isNone(e))),w.T(qt(Pt.Type.teaserCard,"Ded"))),c=i.pipe(w.T(qt(Pt.Type.teaserCard,"Ext")));return{[Pt.Type.idle]:[l],[Pt.Type.formattingLink]:[],[Pt.Type.upgradeHook]:[],[Pt.Type.synonymsCard]:[],[Pt.Type.inlineCard]:[],[Pt.Type.cheetahInlineButton]:[],[Pt.Type.vbarCard]:[],[Pt.Type.teaserCard]:[d,c]}}}(i=e.Scheme||(e.Scheme={}))}(Pt||(Pt={}));const qt=(e,t)=>(i,n)=>i=>i.type===e?[`from${t}:${e}:reset(${n})`,Pt.idle]:[`from${t}:${e}:skipReset(${n})`,i];var Yt=i(74416),Zt=i(80993);class Qt{constructor(e,t){(0,s._)(this,"_lensesList",void 0),(0,s._)(this,"_alertsFilterService",void 0),(0,s._)(this,"getLens",void 0),(0,s._)(this,"_getPlagiarismLens",void 0),this._lensesList=e,this._alertsFilterService=t,this.getLens=(0,j.Bj)((function(e){switch(e){case u.J.SpecialId.Plagiarism:return this._lensesList.view(this._getPlagiarismLens);case u.J.SpecialId.Premium:return this._lensesList.view(Xt(u.J.Info.premium,u.J.Meta.group.empty,this._alertsFilterService.getLensesFilter(u.J.SpecialId.Premium)));default:return(0,Y.xb)(e)}})),this._getPlagiarismLens=(0,r.flow)(Xt(u.J.Info.plagiarism,(0,a._)((0,o._)({},u.J.Meta.group.empty),{percentile:Yt.w.MAX}),this._alertsFilterService.getLensesFilter(u.J.SpecialId.Plagiarism)),u.J.WithAlerts.modifyMeta((e=>(0,a._)((0,o._)({},e),{percentile:Yt.w.groupSum.concat(Yt.w.MAX,Yt.w.groupSum.inverse(e.percentile))}))))}}function Xt(e,t,i){return n=>{return new u.J.LensImpl(e,(s=e.id,o=t,e=>(0,r.pipe)(Zt.$I(u.J.Id.ord)(s,e),J.getOrElse((()=>o))))(n),i);var s,o}}var ei=i(93959),ti=i(63849),ii=i(91796);const ni=d.Bx.Logging.getLogger("pageTelemetry");class si{dispose(){this._subs.dispose()}trackSidebarState(e){return e.pipe(y.i(1),de.n((e=>e?be.H(this._telemetry.gnarSpec.assistantSidebarShow(this._telemetry.pageId)):be.H(this._telemetry.gnarSpec.assistantSidebarClose(this._telemetry.pageId)))))}constructor(e,t){(0,s._)(this,"_isSidebarOpened",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_subs",void 0),this._isSidebarOpened=e,this._telemetry=t,this._subs=new v.y.Keeper,this._subs.push(M.h(this.trackSidebarState(this._isSidebarOpened)).pipe(Ot.W((e=>(ni.warn("Page telemetry error",e),C.w)))).subscribe())}}var oi=i(54872),ai=i(45032),ri=i(38260),li=i(66799),di=i(22809),ci=i(27004);class pi{applyAlert(e){setTimeout((()=>this.onVbarClose()),0),(0,r.pipe)(this._alertsService.apply(e,{alternativeIndex:0,source:h.Kz.text,feedbackSubtype:li.U3.Inline}),q.fold((e=>this._log.error("error applying alert",e)),r.constVoid))}dismissAlert(e){setTimeout((()=>this.onVbarClose()),0),(0,r.pipe)(this._alertsService.dismissBatch([e],li.U3.Inline),q.fold((e=>this._log.error("error dismissing alert",e)),r.constVoid))}toggleVbarHighlighting(e,t){const i=this.items.get().find((t=>t.alert.id===e));t?i&&this.highlightedVbarAlert.next(J.some(i.alert)):this.highlightedVbarAlert.next(J.none)}onVbarClick(e){var t;this._sendFeedback(e,{kind:li.yp.ACCEPTED,subtype:li.U3.Vbar,alternativeIndex:0}),this._isAssistantMode.get()?((0,r.pipe)(this.items.get(),Me.i8((t=>t.alert.id===e)),J.fold((()=>this._log.error("Vbar item not found on click in assistant mode")),(e=>this.alertClickedInAssistantMode.next(J.some({highlightIndex:0,alert:e.alert}))))),this._inlineManager.changeActiveVbar.next(J.none)):this._inlineManager.changeActiveVbar.next(J.some({alertId:e,state:"opened"})),null===(t=this.items.get().find((t=>t.alert.id===e)))||void 0===t||t.hoveringService.reset()}onVbarMount(e){const t=this.items.get().find((t=>t.alert.id===e));t&&!this._mountedFeedbacks.has(e)&&(this._sendFeedback(t.alert.id,{kind:li.yp.RENDERED,subtype:li.U3.Vbar}),this._mountedFeedbacks.add(e))}onInlineCardMount(e){this.items.get().find((t=>t.alert.id===e))&&this._sendFeedback(e,{kind:li.yp.LOOKED,subtype:li.U3.Inline})}onStickerMount(e){this._sendFeedback(e,{kind:li.yp.LOOKED,subtype:li.U3.Vbar})}onVbarMouseEnter(e){const t=this.items.get().find((t=>t.alert.id===e));t&&t.hoveringService.htmlElementHandlers.onMouseEnter()}onVbarMouseLeave(e){const t=this.items.get().find((t=>t.alert.id===e));t&&t.hoveringService.htmlElementHandlers.onMouseLeave()}onVbarClose(){this._inlineManager.changeActiveVbar.next(J.none)}onGiveFeedbackClick(e){const t=J.fromNullable(this.items.get().find((t=>t.alert.id===e)));this.isVisibleFeedbackModal.set((0,r.pipe)(t,J.map((e=>e.alert))))}onCloseFeedbackModal(){this.isVisibleFeedbackModal.set(J.none)}submitFeedback(e,t){return this.isVisibleFeedbackModal.set(J.none),(0,r.pipe)(this._sendFeedback(e,{kind:li.yp.USER_SATISFACTION_FEEDBACK,subtype:li.U3.Vbar,userSatisfactionDescription:t.detailed}),q.fold(r.constFalse,r.constTrue),this._notifyFeedbackSent,w.T(r.constVoid),we.$()).toPromise()}dispose(){this.highlightedVbarAlert.complete(),this._sub.unsubscribe(),this.items.get().forEach((e=>e.hoveringService.reset()))}_createVbarActivationSub(){return this._inlineManager.activeVbar.subscribe((e=>{(0,r.pipe)(e,J.fold((()=>{this.highlightedVbarAlert.next(J.none),this.items.modify((e=>e.map((e=>(0,a._)((0,o._)({},e),{state:"visible"})))))}),(e=>{const t=this.items.get().findIndex((t=>t.alert.id===e.alertId)),i=this.items.get()[t];t>-1&&(this.highlightedVbarAlert.next(J.some(i.alert)),this.items.modify((i=>i.map(((i,n)=>n===t?(0,a._)((0,o._)({},i),{state:e.state}):(0,a._)((0,o._)({},i),{state:"visible"}))))))})))}))}_updateItems(e,t){(0,r.pipe)(this._denaliEditorModel.contentRect,Q.Mi((i=>{const n=function(e,t,i,n){return(0,r.pipe)(e,(0,ri.Tj)((e=>(0,r.pipe)(e.highlightTexts,(0,ri.rO)((i=>t.getMarkByAlert({alert:e,highlightIndex:i}))),(i=>i.concat(t.getEnclosingMarkByAlert(e))),ri.oE,(e=>{const t={left:Number.MAX_SAFE_INTEGER,top:Number.MAX_SAFE_INTEGER,bottom:Number.MIN_SAFE_INTEGER};return(0,r.pipe)(e,(0,ri.Tj)((e=>J.fromEither(e.getRect()))),ri.oE,(0,ri.cy)((e=>e.clientRects)),(0,ri.TS)(t,((e,t)=>({left:Math.min(t.left-i.left,e.left),top:Math.min(t.top-i.top,e.top),bottom:Math.max(t.top-i.top+t.height,e.bottom)}))))}),(t=>(0,a._)((0,o._)({},t),{alert:e,state:"visible",mode:"replacement",withSticker:n}))))))}(e,this._marksVM,i,!t);var s,l,d;this.items.modify((s=n,l=this._inlineManager,d=this._activeVbarProxy.view(),e=>{const t=[];return s.forEach((i=>{const n=e.find((e=>e.alert.id===i.alert.id));n?t.push((0,a._)((0,o._)({},i),{state:n.state,hoveringService:n.hoveringService})):t.push((0,a._)((0,o._)({},i),{hoveringService:(0,ci.m)({onHover:()=>{(0,r.pipe)(d.get(),Q.Lw((e=>"opened"!==e.state)))&&l.changeActiveVbar.next(J.some({alertId:i.alert.id,state:"hovered"}))},onBlur:()=>{(0,r.pipe)(d.get(),J.fold((()=>l.changeActiveVbar.next(J.none)),(e=>{e.alertId===i.alert.id&&l.changeActiveVbar.next(J.none)})))}},100,300)}))})),t}))})))}_createVbarItemsSub(){return b.zV([(e=this._checkingState,t=this._alertVisibleFilter,b.zV([e,t]).pipe(w.T((([e,t])=>(0,r.pipe)(e,di.A.reduce([],((e,{alert:i})=>(0,j.M4)(h.Fc.isVbar,t)(i)?[...e,i]:e)),(e=>e.sort(h.HJ.ord.compare)),(0,ri.Tj)(ae.A.fromModel)))))),this._isAssistantMode,this._denaliEditorModel.changes.pipe(x.Z(null)),this._denaliEditorModel.viewport]).subscribe((([e,t,i,n])=>this._updateItems(e,t)));var e,t}_createCAPISub(){return this._capiEvents.pipe(S.p((e=>"session_started"===e.kind))).subscribe((()=>{this._mountedFeedbacks.clear()}))}constructor(e,t,i,n,o,a,c,p,u){(0,s._)(this,"_capiEvents",void 0),(0,s._)(this,"_denaliEditorModel",void 0),(0,s._)(this,"_alertsService",void 0),(0,s._)(this,"_checkingState",void 0),(0,s._)(this,"_alertVisibleFilter",void 0),(0,s._)(this,"_marksVM",void 0),(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"_isAssistantMode",void 0),(0,s._)(this,"_notifyFeedbackSent",void 0),(0,s._)(this,"items",void 0),(0,s._)(this,"highlightedVbarAlert",void 0),(0,s._)(this,"alertClickedInAssistantMode",void 0),(0,s._)(this,"isVisibleFeedbackModal",void 0),(0,s._)(this,"_sub",void 0),(0,s._)(this,"_mountedFeedbacks",void 0),(0,s._)(this,"_sendFeedback",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_activeVbarProxy",void 0),this._capiEvents=e,this._denaliEditorModel=t,this._alertsService=i,this._checkingState=n,this._alertVisibleFilter=o,this._marksVM=a,this._inlineManager=c,this._isAssistantMode=p,this._notifyFeedbackSent=u,this.items=l.s.create([]),this.highlightedVbarAlert=new _.B7,this.alertClickedInAssistantMode=new _.B7,this.isVisibleFeedbackModal=l.s.create(J.none),this._sub=new st.y,this._mountedFeedbacks=new Set,this._sendFeedback=(e,t)=>(0,r.pipe)(this._alertsService.applyFeedback(e,t,h.Kz.text),q.mapLeft((e=>(this._log.error("error sending alert feedback",e),e)))),this._log=d.Bx.Logging.getLogger("VbarsViewModelImpl",d.y7.$.DEBUG),this._activeVbarProxy=l.s.create(J.none),this._sub.add(this._inlineManager.activeVbar.subscribe(f.H9(this._activeVbarProxy))),this._sub.add(this._createVbarActivationSub()),this._sub.add(this._createVbarItemsSub()),this._sub.add(this._createCAPISub())}}class hi{dispose(){this._engine.shutdown(),this.searchViewModel.dispose(),this.marksViewModel.dispose(),this.synonymsViewModel.dispose(),this.documentSettingsViewModel.dispose(),this._pageTelemetry.dispose(),this._gbRuleCreatedViewModel.dispose(),this.inlineCardViewModel.dispose(),this.hotkeyManager.dispose(),this.cheetahViewModel.dispose(),this.sduiInlineViewModel.get().dispose(),this._subs.dispose(),this.a11yNotificationManager.dispose(),this.loaderViewModel.dispose()}constructor(e,t,i,oe,ae,le,pe,he,ue,ge,me,_e,ve,fe,ye,be,we,Se,Ce,Ee){(0,s._)(this,"_engine",void 0),(0,s._)(this,"_denaliEditorModel",void 0),(0,s._)(this,"_upgradeHook",void 0),(0,s._)(this,"_environment",void 0),(0,s._)(this,"_platformEnvironment",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_remSizeObs",void 0),(0,s._)(this,"_networkState",void 0),(0,s._)(this,"_docId",void 0),(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"documentLoader",void 0),(0,s._)(this,"_textResources",void 0),(0,s._)(this,"_config",void 0),(0,s._)(this,"_experimentClient",void 0),(0,s._)(this,"_userAccount",void 0),(0,s._)(this,"_router",void 0),(0,s._)(this,"_downloadViewModel",void 0),(0,s._)(this,"_uploadViewModel",void 0),(0,s._)(this,"logout",void 0),(0,s._)(this,"inlineCardViewModel",void 0),(0,s._)(this,"lensPreviewViewModel",void 0),(0,s._)(this,"marksViewModel",void 0),(0,s._)(this,"alertUserEvents",void 0),(0,s._)(this,"synonymsViewModel",void 0),(0,s._)(this,"onboardingViewModel",void 0),(0,s._)(this,"upgradeViewModel",void 0),(0,s._)(this,"searchViewModel",void 0),(0,s._)(this,"feedbackViewModel",void 0),(0,s._)(this,"navigationViewModel",void 0),(0,s._)(this,"modalManager",void 0),(0,s._)(this,"hotkeyManager",void 0),(0,s._)(this,"formattingViewModel",void 0),(0,s._)(this,"emotionsViewModel",void 0),(0,s._)(this,"documentSettingsViewModel",void 0),(0,s._)(this,"autofocusListener",void 0),(0,s._)(this,"documentPlaceholderViewModel",void 0),(0,s._)(this,"focus",void 0),(0,s._)(this,"cheetahViewModel",void 0),(0,s._)(this,"capiSession",void 0),(0,s._)(this,"notificationsManager",void 0),(0,s._)(this,"vbarsViewModel",void 0),(0,s._)(this,"a11yNotificationManager",void 0),(0,s._)(this,"loaderViewModel",void 0),(0,s._)(this,"sduiInlineViewModel",void 0),(0,s._)(this,"_getAlertClosestToCursor",void 0),(0,s._)(this,"_cheetahInlineAvailabilityProvider",void 0),(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"_pageTelemetry",void 0),(0,s._)(this,"_gbRuleCreatedViewModel",void 0),(0,s._)(this,"_openInlineAlert",void 0),(0,s._)(this,"_inlineAlertHovered",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_reportViewModel",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_editorWrapperViewport",void 0),(0,s._)(this,"_remSize",void 0),(0,s._)(this,"_lensesState",void 0),this._engine=e,this._denaliEditorModel=t,this._upgradeHook=i,this._environment=oe,this._platformEnvironment=ae,this._telemetry=le,this._remSizeObs=pe,this._networkState=he,this._docId=ue,this._notificationsManager=ge,this.documentLoader=me,this._textResources=_e,this._config=ve,this._experimentClient=fe,this._userAccount=ye,this._router=we,this._downloadViewModel=Se,this._uploadViewModel=Ce,this.logout=Ee,this.formattingViewModel=J.none,this.emotionsViewModel=J.none,this._openInlineAlert=new _.B7,this._inlineAlertHovered=new _.B7,this._log=d.Bx.Logging.getLogger("ViewModels"),this._subs=new v.y.Keeper,this._editorWrapperViewport=l.s.create(this._denaliEditorModel.viewport.value.wrapper),this._remSize=l.s.create(16),this._lensesState=l.s.create(m.K.defaultState);const ke=n.create();this.focus=W.B.create({contentFocusChanges:ne.r.create(this._denaliEditorModel),eq:ne.B.eq,ord:ne.B.ord,show:ne.B.show,contentSection:J.some(ne.B.create(ne.B.Id.editor))}),this.notificationsManager=ge;const Te=this._log.getLogger("Oggy"),xe=new H.o.Impl(this._engine.checkingDomain.state,this._engine.positionManager,this._engine.alertsReader,(0,j.M4)(h.Fc.isRegistered,(0,j.AU)(h.Fc.isMuted)));this._getAlertClosestToCursor=(0,K.h_)((e=>{switch(e){case"cursor":return ui(this._denaliEditorModel)();case"middleOfTheViewport":return(0,r.pipe)(this._denaliEditorModel.getPossibleCursorPosition(q.left(c.Yd.X.middle),q.left(c.Yd.Y.middle)),q.getOrElse(ui(this._denaliEditorModel)));default:return(0,Y.xb)(e)}}),xe);const Ie=(0,r.pipe)(this._userAccount.features.denali.mutedAlerts,J.fromPredicate(r.identity),J.map((()=>this._engine.mutedAlertsModel))),Ae=D.v.create(D.v.defaultLensFilters,D.v.defaultTextFilters);this.lensPreviewViewModel=new Qt(this._lensesState.view("lenses"),Ae),this.upgradeViewModel=new ai.t(this._engine.checkingDomain,this.lensPreviewViewModel,this._docId,this._platformEnvironment,this._upgradeHook,this._config,this._userAccount.features.denali.uphookFormat,this._userAccount.features.denali.uphookDestination,this._userAccount.features.isSmartPlagiarismUphookEnabled,this._experimentClient,(()=>this._userAccount.features.isEligibleForFreeTrial),(()=>this._userAccount.features.isEligibleForFreeTrialEuUk),this._userAccount.features.proVsPremiumExperiment,this._userAccount.features.assignProVsPremiumExperiment,this._userAccount.features.inProductDiscountsExperiment,this._userAccount.features.assignInProductDiscountExperiment),this.feedbackViewModel=new Ut(this._notificationsManager,(e=>(d.Bx.Logging.getLogger("userFeedback").info("Submit form feedback",{briefDescription:e.brief,detailedFeedback:e.detailed}),this._telemetry.gnarSpec.feedbackFormSubmit(e.brief,e.detailed,this._telemetry.pageId)))),this._subs.push(this._engine.checkingDomain.state.pipe((e=>m.K.get(e,this._engine.checkingDomain.lensesScores,Ae))).subscribe(f.H9(this._lensesState))),this.a11yNotificationManager=(()=>{const e=function(){const e=new Map;return{registerStatus:t=>{const i=je+t,n=Ye(i);return n.setAttribute("role","status"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),Qe(n),document.body.appendChild(n),e.set(i,n),{change:e=>function(e,t,i){const n=document.getElementById(t);if(n)return""===e?(n.innerHTML="&nbsp;",void setTimeout((()=>n.innerHTML=""),1e3)):void(n.textContent=e);{const n=document.createElement("div");n.id=t,n.textContent=e,i.appendChild(n)}}(e,i,n),dispose:()=>n.remove()}},dispose:()=>{e.forEach((e=>e.remove()))}}}(),t=function(){const e=Ye(Je);e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive"),e.setAttribute("aria-relevant","additions"),Qe(e);const t=Ye($e);return t.setAttribute("role","log"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-relevant","additions"),Qe(t),{announceMessage:i=>{switch(i.type){case"alert":Ze(i.text,e);break;case"log":Ze(i.text,t);break;default:(0,Y.AS)(i.type)}},dispose:()=>{e.remove(),t.remove()}}}();return{announceMessage:t.announceMessage,registerStatus:e.registerStatus,dispose:()=>{e.dispose(),t.dispose()}}})(),this._reportViewModel=be(this._lensesState),this.modalManager=new p.jM(new We.JG(this._userAccount,this._textResources,this._engine.sessionModel,this.upgradeViewModel,this._config,this._platformEnvironment,this.feedbackViewModel,this._notificationsManager,this._engine.sessionModel,this._reportViewModel,this._telemetry,this._engine.mutedAlertsModel,Ee,this.a11yNotificationManager.registerStatus("set-goals-modal"))),this.navigationViewModel=new se.xK(this._telemetry,this.modalManager,this._userAccount.features,this._getAlertClosestToCursor,this._engine.sessionModel,Ie,l.s.create(z.p.CardVisualMode.ContrastLightMode),l.s.create(!0),this._lensesState.view("lenses").view((0,r.flow)(g.x.lookup(u.J.SpecialId.Premium),J.map((e=>e.count)),J.getOrElse((0,r.constant)(0)),(e=>({title:"Premium",count:e})))),this._engine.cheetah.oggyUphookModel,this._engine.cheetah.oggyPlagiarismModel),this._pageTelemetry=new si(this.navigationViewModel.state.view("isSidebarOpen"),this._telemetry);const Le=this.navigationViewModel.state.view("isSidebarOpen");this.searchViewModel=new oi.XS(this._denaliEditorModel,this._engine.positionManager,this._editorWrapperViewport),this.documentSettingsViewModel=(0,ii.N1)(this._denaliEditorModel,this._router,this._textResources.denali,this._userAccount,Ee,this._userAccount.settings,this._downloadViewModel,this.upgradeViewModel,this.modalManager,this._uploadViewModel,this._environment,this._notificationsManager,this.searchViewModel,this._telemetry,this._engine.sessionModel,this.navigationViewModel.state.pipe(y.i(1))),this._cheetahInlineAvailabilityProvider=et.create(this.navigationViewModel,this.documentSettingsViewModel.viewModel.visualState,this._engine.cheetah.genAiAvailabilityService.availability,this._userAccount.features.denali);const Ne=this._engine.sessionModel.rtfMode===ee.jj.l1.FormattingMode.on?J.some((0,Jt.hn)(this._denaliEditorModel.getCursor.bind(this._denaliEditorModel),(e=>{this._denaliEditorModel.setFormatting((0,a._)((0,o._)({},e),{meta:(0,a._)((0,o._)({},e.meta),{formatting:(0,o._)({},e.meta.formatting)})}))}),this._denaliEditorModel.selectedFormatting,this._denaliEditorModel.isEditorFocused,this._textResources.denali,this._telemetry.gnarSpec,this._telemetry.pageId,this._environment)):J.none,Re=b.zV([this._engine.cheetah.oggyManager.alertVisibilityFilter,this.navigationViewModel.state]).pipe(w.T((([e,{isSidebarOpen:t,isGgoOpen:i}])=>this._userAccount.features.denali.oggy===te.kH.splitSharedAssistants&&i?r.constFalse:t?e:h.Fc.isInline))),Oe=Re.pipe(w.T((e=>({filter:e,lensId:u.J.SpecialId.AllAlerts}))));this.marksViewModel=new ti.t(this._denaliEditorModel,this._engine.checkingDomain,this._engine.alertsReader,this._engine.alertsService,this._engine.alertsService,this._environment.has(Ke.OH.Flag.highHighlights),new $.a(this._engine.cheetah.oggyManager.alertHighlightChanges),Ae,Oe,this._userAccount.settings.editorPreferences.view("suggestionsVisualMode"),this._engine.cheetah.oggyManager.alertHighlightChanges,this._userAccount.features.denali.lockedUIUXExperimentTreatment,this._userAccount.features.isFree),this.alertUserEvents=new P.Jc(this._denaliEditorModel,this.marksViewModel,this._engine.alertsReader,this._engine.cheetah.oggyManager.alertHighlightChanges,Re),this._inlineManager=function(e,t,i,n,s,o){const a=l.s.create(Pt.idle),c=l.s.create(new Set([Pt.Type.idle])),p=d.Bx.Logging.getLogger("inlineManager");p.isEnabled(d.y7.$.DEBUG)&&a.subscribe((e=>p.debug("state change to",e)));const u=new _.B7,g=new _.B7,m=new _.B7,v=new _.B7,y=new _.B7,S=new _.B7,E=l.s.create(J.none),k=(0,r.pipe)(n,J.fold((()=>C.w),(e=>Jt.uY.fromToolbar(e.linkEvents))),Gt.u()),I={[Pt.Type.idle]:Pt.Scheme.monoid.empty,[Pt.Type.formattingLink]:Pt.Scheme.forFormattingLink(e,k,m),[Pt.Type.upgradeHook]:Pt.Scheme.forUpgradeHook(t,i,v),[Pt.Type.synonymsCard]:Pt.Scheme.forSynonymsState(s,g),[Pt.Type.inlineCard]:Pt.Scheme.forCardState(t,i,u),[Pt.Type.cheetahInlineButton]:Pt.Scheme.forCheetahInlineButton(e,o,y),[Pt.Type.vbarCard]:Pt.Scheme.forVbarCard(S),[Pt.Type.teaserCard]:Pt.Scheme.forTeaserCard(t,i,u,E)},A=c.view(Array.from).view(Me.ue(Pt.Scheme.monoid)((e=>I[e]))),F=b.zV([A,a.view("type")]).pipe(de.n((([e,t])=>M.h(...e[t]))),Kt.S(((e,t)=>{const[i,n]=t(e);return p.debug("state change",{prevState:e,changeReason:i,nextState:n}),n}),Pt.idle),N.M(f.H9(a)),x.Z(Pt.idle),Gt.u()),V=e=>ce.c.create((()=>(c.modify((t=>new Set(t).add(e))),()=>c.modify((t=>{const i=new Set(t);return i.delete(e),i}))))).pipe(x.Z(f.q6));return{doubleClickedWord:V(Pt.Type.synonymsCard).pipe(L.K(F.pipe(w.T((e=>e.type===Pt.Type.synonymsCard?J.some(e.word):J.none)))),T.F(J.getEq(Ve.h0.ord).equals),Gt.u()),closeSynonyms:g,hoveredMarkAlert:M.h(V(Pt.Type.inlineCard),V(Pt.Type.teaserCard)).pipe(L.K(F.pipe(w.T((e=>e.type===Pt.Type.inlineCard||e.type===Pt.Type.teaserCard?J.some(e.alert):J.none)))),T.F(J.getEq(h.HJ.ord).equals),Gt.u()),closeCards:u,formattingLinkState:V(Pt.Type.formattingLink).pipe(L.K(F.pipe(w.T((e=>e.type===Pt.Type.formattingLink?J.some(e.link):J.none)))),T.F(J.getEq($t.W.LinkState.eq).equals),Gt.u()),closeLinks:m,upgradeHookState:V(Pt.Type.upgradeHook).pipe(L.K(F.pipe(w.T((e=>e.type===Pt.Type.upgradeHook?J.some(e.alert):J.none)))),T.F(J.getEq(re.z.eq).equals),Gt.u()),closeUpgradeHooks:v,cheetahInlineButtonState:V(Pt.Type.cheetahInlineButton).pipe(L.K(F.pipe(w.T((e=>e.type===Pt.Type.cheetahInlineButton?J.some((0,j.Yi)()):J.none)),Gt.u()))),closeCheetahInlineButton:y,activeVbar:V(Pt.Type.vbarCard).pipe(L.K(F.pipe(w.T((e=>e.type===Pt.Type.vbarCard?e.vbar:J.none)))),Gt.u()),changeActiveVbar:S,currentTeaser:E,changeTeaserExpanded:e=>E.set(e)}}(this._denaliEditorModel,this.alertUserEvents,this._engine.alertsReader,Ne,ke,this._cheetahInlineAvailabilityProvider);const Ue=b.zV([Le,Re]).pipe(w.T((([e,t])=>e?t:r.constTrue)));this.vbarsViewModel=this._userAccount.features.denali.writingExpertVbarsEnabled?J.some(new pi(this._engine.obsCapiClient.events,this._denaliEditorModel,this._engine.alertsService,this._engine.checkingDomain.state,Ue,this.marksViewModel,this._inlineManager,Le,(e=>this.notificationsManager.enqueue(e?"feedbackSend":"error").pipe(S.p((e=>"shown"===e)))))):J.none;const Be=(0,r.pipe)(this.vbarsViewModel,J.map((e=>e.highlightedVbarAlert.pipe(w.T(J.map((e=>({alert:e,highlightIndex:0,source:h.Kz.text}))))))),J.getOrElse((()=>C.w))),De=this.navigationViewModel.state.view("isSidebarOpen");this._subs.push((0,r.pipe)(this._engine.cheetah.oggyManager,ie.Factory.create(Te,ie.focusAlertByClickedMark(M.h(M.h(this.alertUserEvents.alertClicked,Be),(0,r.pipe)(this.vbarsViewModel,J.map((e=>e.alertClickedInAssistantMode)),J.getOrElse((()=>C.w))))),ie.highlightMark(this._engine.alertsReader,this.marksViewModel,this.focus.state,this._denaliEditorModel.contentUpdated.pipe(S.p((e=>"user"===e.source))),this._denaliEditorModel.isEditorFocused,De),ie.openInlineAlerts(this.navigationViewModel,this._openInlineAlert),ie.updateLoaderStateOnReady(this.documentLoader),ie.openAssistantWithActiveCard(this.navigationViewModel,this._engine.cheetah.oggyUphookModel),ie.openAssistantWithPlagiarism(this.navigationViewModel,this._engine.cheetah.oggyPlagiarismModel),ie.unfocusAlertHighlightOnSidebarClose(De),ie.scrollAlertIntoView(this.marksViewModel,De),ie.toggleAutoScroll(this._userAccount.settings.editorPreferences.view("autoScrollToNextAlert").view(E.O.unwrap(!this._userAccount.features.denali.autoJumpSettings.isDisabledByDefault)))))),this.cheetahViewModel=St.create({engine:this._engine,denaliEditorModel:this._denaliEditorModel,userAccount:this._userAccount,upgradeVM:this.upgradeViewModel,navigationVM:this.navigationViewModel,telemetry:this._telemetry,inlineManager:this._inlineManager,modalManager:this.modalManager,experimentClient:this._experimentClient,environment:this._environment,platformEnvironment:this._platformEnvironment,config:this._config,notificationsManager:this._notificationsManager}),this._subs.push(k.R(window,"beforeunload").subscribe((()=>this.cheetahViewModel.dispose()))),this.vbarsViewModel=J.none,this._subs.push(this._denaliEditorModel.viewport.pipe(T.F(),w.T((e=>e.wrapper))).subscribe(f.H9(this._editorWrapperViewport)),this._remSizeObs.subscribe(f.H9(this._remSize)),ne.B.initTracking(this.focus,this._telemetry),this._denaliEditorModel.dontFreezeWhen(this.focus.state.pipe(w.T(J.exists((e=>e.id!==ne.B.Id.editor)))),"focus-manager"),this._denaliEditorModel.contentUpdated.pipe(S.p(c.D_.isTextMaybeWithFormatting),w.T((()=>this._denaliEditorModel.getTextLength())),x.Z(this._denaliEditorModel.getTextLength()),I.J(),S.p((([e,t])=>e-t>500)),A.p((()=>F.timer(1e3).pipe(V.Q(this._denaliEditorModel.shortcutUsed),L.K(this.notificationsManager.enqueue("textRemoved").pipe(V.Q(this._denaliEditorModel.shortcutUsed.pipe(N.M((()=>this._telemetry.gnarSpec.undoTextRemovedHotkeyPress())))),N.M((e=>{"shown"===e?this._telemetry.gnarSpec.undoTextRemovedNotificationShow(this._telemetry.pageId):"undo"===e&&(this._denaliEditorModel.undo(),this._telemetry.gnarSpec.undoTextRemovedButtonClick(this._telemetry.pageId))})),R.v((e=>"undo"!==e)))))))).subscribe()),this.capiSession=new Xe(this._engine.cheetah.capiMessages),this._gbRuleCreatedViewModel=new Bt(this._config,this._engine.obsCapiClient,this._notificationsManager,this._telemetry),this._subs.push(this._denaliEditorModel.clickedWord.pipe(w.T(J.filter((e=>2===e.meta.clicks))),O.E(this.alertUserEvents.alertClicked.pipe(x.Z(J.none)),((e,t)=>J.isNone(t)?e:J.none)),U.oE).subscribe(ke.doubleClickedWord));const He=Ht.k.ViewModel.getInlineHighlightFilter(Le),ze=(0,r.flow)(this.marksViewModel.getMarkByAlert,q.fromOption((()=>new Error("mark not found"))),q.chain((e=>e.getRect())),Z.Mr);this.inlineCardViewModel=new Ht.e(this._inlineManager,ze,M.h(this._denaliEditorModel.contentUpdated.pipe(B.u(f.q6))),this._engine.checkingDomain,this._engine.alertsReader,this._engine.alertsService,this._telemetry,this._openInlineAlert,this._inlineAlertHovered,He,this.notificationsManager),(()=>{this._subs.push(this._engine.sduiInlineManager.pipe(N.M((e=>{const t=new Dt.b9(this._engine.sduiService,this._engine.sduiManager.get(),e,this.inlineCardViewModel,this._engine.alertsReader,this._engine.obsCapiClient,this._platformEnvironment,(0,Ge.l)(this.notificationsManager,this._environment));(0,r.pipe)(J.fromNullable(this.sduiInlineViewModel),Q.Mi((e=>{e.get().dispose(),this.sduiInlineViewModel.set(t)})),Q.jw((()=>this.sduiInlineViewModel=l.s.create(t))))}))).subscribe())})(),this.synonymsViewModel=new Pe(this._inlineManager,this._engine.positionManager,this._engine.synonymsModel,this._networkState,this._denaliEditorModel,this._notificationsManager,this._engine.cheetah.oggyManager.alertHighlightChanges,(()=>this._telemetry.gnarSpec.notificationCloseButtonClick("alertUndo",this._telemetry.pageId)),((e,t)=>{this._telemetry.gnarSpec.synonymsPopupShow(t.numberOfMeanings,t.numberOfSynonymsByMeanings,t.numberOfSynonymsTotal,this._telemetry.pageId,e)}),((e,t,i)=>{this._telemetry.gnarSpec.synonymsPopupClose(t.numberOfMeanings,t.numberOfSynonymsByMeanings,t.numberOfSynonymsTotal,i,this._telemetry.pageId,e)}),((e,t,i)=>{this._telemetry.gnarSpec.synonymsAcceptButtonClick(t.meaningIndex,t.synonymIndexInGroup,t.synonymIndexAbs,t.numberOfMeanings,t.numberOfSynonymsByMeanings,t.numberOfSynonymsTotal,i,this._telemetry.pageId,e)})),this.formattingViewModel=(0,r.pipe)(Q.CO(Ne,this._engine.formattingModel),J.map((([e,t])=>{const i=$t.W.createManager(this._denaliEditorModel,t,this._inlineManager);return this._subs.push(e,i),{toolbarViewModel:e.viewModel,linksManager:i}}))),this.documentPlaceholderViewModel=new Vt(this._uploadViewModel,this._denaliEditorModel,this._userAccount,this._environment,this._engine.sessionModel.rtfMode,this._textResources.denali),this.emotionsViewModel=(0,r.pipe)(this._engine.emotionsModel,J.map((e=>Rt.H.ViewModel.create(e,this._engine.sessionModel,this._textResources.denali))));const qe=(0,r.pipe)(Ne,J.map((e=>[e.viewModel,this.searchViewModel,this.documentSettingsViewModel.viewModel])),J.getOrElse((()=>[this.searchViewModel,this.documentSettingsViewModel.viewModel])));this.hotkeyManager=new G.ai(X.th.from(qe),this._environment.has(Ke.OH.Flag.isAppleSystem),this._environment.platform===Ke.OH.Platform.IPAD),this.onboardingViewModel=new Fe(this._userAccount.settings,this._denaliEditorModel,this._engine.sessionModel,this._engine.alertsReader,this._userAccount.features.onboardingMode(),this._telemetry,this._engine.cheetah.oggyManager.alertHighlightChanges,(()=>this.marksViewModel.getFirstMark().pipe(U.oE,w.T((e=>J.fromEither(e.getRect()))))),this.cheetahViewModel,this.navigationViewModel,this._userAccount.features),this.loaderViewModel=new ei.C(this.documentLoader.state,this.navigationViewModel,this._engine.sessionModel,(0,r.pipe)(this._uploadViewModel,J.map((e=>e.state)),J.getOrElse((()=>C.w))),this._denaliEditorModel)}}const ui=e=>()=>e.getCursor().index},80949:(e,t,i)=>{var n,s;i.d(t,{f:()=>n,p:()=>s}),function(e){let t;!function(e){e.starting="starting",e.visuallyReady="visuallyReady",e.interactionReady="interactionReady",e.readyToDrag="readyToDrag",e.close="close",e.focusStateChanged="focusStateChanged"}(t=e.Kind||(e.Kind={})),e.isStarting=e=>e.kind===t.starting,e.isVisuallyReady=e=>e.kind===t.visuallyReady,e.isInteractionReady=e=>e.kind===t.interactionReady,e.isReadyToDrag=e=>e.kind===t.readyToDrag,e.isClose=e=>e.kind===t.close,e.isFocusStateChanged=e=>e.kind===t.focusStateChanged}(n||(n={})),function(e){let t,i;!function(e){e.FocusRequested="focusRequested",e.StatusChanged="statusChanged"}(t=e.Kind||(e.Kind={})),function(e){e.PremiumSuggestionsUphook="PremiumSuggestionsUphook",e.Plagiarism="Plagiarism"}(i=e.Source||(e.Source={}));var n=e.isStatusChanged=e=>e.kind===t.StatusChanged,s=e.isFocusRequested=e=>e.kind===t.FocusRequested;e.isIncoming=e=>n(e),e.isOutgoing=e=>s(e)}(s||(s={}))},70823:(e,t,i)=>{i.d(t,{C:()=>W,F2:()=>U,Fi:()=>O,H4:()=>K,Ip:()=>P,Nc:()=>H,ii:()=>B,n$:()=>R,xs:()=>G});var n=i(83531),s=i(10334),o=i(17171),a=i(84647),r=i(90700),l=i(46838),d=i(7962),c=i(80074),p=i(60575),h=i(12704),u=i(28986),g=i(62822),m=i(42543),_=i(35749),v=i(35413),f=i(41797),y=i(78339),b=i(15491),w=i(23121),S=i(94855),C=i(66202),M=i(36840),E=i(65390),k=i(86562),T=i(77396),x=i(76720),I=i(80029),A=i(98719),F=i(40884),V=i(40005),L=i(18286),N=i(80949);const R=(e,t,i,n,s,o)=>{const r=p.Bx.Logging.getLogger("Cheetah.TextInsertion");return{getText:t=>(0,a.pipe)(w.zb((()=>e.getText().substring(t.start,t.end))),S.Mr),flush:()=>S.TX((()=>Promise.resolve(e.flushChanges())),C.toError),insertText:e=>(r.info("Inserting text"),(0,a.pipe)((new u.R).insert(e),(e=>t.replaceCurrentSelectionWith(e)),S.wu((e=>(r.error("Text insertion error",e),e)),(()=>{n(),r.info("Text inserted")})))),copyText:e=>o(e,"somethingCopied").then(M.Yi),setContextHighlight:(e,t)=>{i.setContextHighlight(e,t)},selectedRange:s,textUpdated:e.contentUpdated.pipe(g.u(void 0))}},O=(e,t)=>{const i=new m.B7;return e.registerExternalMessageHandler((e=>(i.next(e),(0,r.El)(e)?h.Q.Result.STOP_HANDLING:h.Q.Result.CONTINUE_HANDLING))),{capiService:new l.V({inboundCAPIMessages:_.x(v.v((()=>f.H(Object.values(t.get())))).pipe(y.p(r.Uv)),i),sendCAPIMessage:({action:t,data:i,shouldInjectRev:n,shouldInjectSessionId:a})=>{if("user_action"===t){const{componentId:t,userAction:n}=i;return e.sendUserAction(t,n)}return e.enqueueExternalCommand((({id:e,sessionId:r,currentRevision:l})=>(0,o._)((0,s._)({action:t,id:e},i),{rev:!0===n?l:void 0,sessionId:!0===a?r:void 0})))}}),capiMessages:i}},U=e=>({user:c.s.combine(e.profile,e.settings.dialectOrDefault,((t,i)=>({kind:"signed-in",id:t.id,isPremium:F.DY.isPremium(e.features.denaliUserType),dialect:i,institution:(0,a.pipe)(t.institutionInfo,E.map((e=>({id:e.id,name:e.name,logoUrl:(0,a.pipe)(e.vox,E.chain((e=>e.logoUrl)),E.toUndefined),styleGuideEnabled:E.isSome(e.vox)})))),email:t.email,editorFeatures:{plagiarismDisabled:e.features.plagiarism.get()===F.Fh.disabled}}))),setDialect:t=>(0,a.pipe)(S.TX((()=>e.settings.setDialect(t)),C.toError),S.Tj(M.Yi))}),B=e=>({deepLinkRequests:e.outgoing.pipe(b.T((e=>{switch(e.source){case N.p.Source.PremiumSuggestionsUphook:return"premiumSuggestionsUphook";case N.p.Source.Plagiarism:return"plagiarismView";default:return(0,k.AS)(e.source)}}))),notifyStatusChanged:(t,i)=>{switch(t){case"plagiarismView":e.push({kind:N.p.Kind.StatusChanged,source:N.p.Source.Plagiarism,available:i.available,focused:i.active});break;case"premiumSuggestionsUphook":e.push({kind:N.p.Kind.StatusChanged,source:N.p.Source.PremiumSuggestionsUphook,available:i.available,focused:i.active});break;case"performanceScoreView":break;default:(0,k.AS)(t)}}}),P=(e,t,i,n)=>{const r=L.J.create(e.gnarSpec),l={pageId:e.pageId,upgradeHookVariant:n.upgradeHookVariant};return{trackUphookShown:t=>(0,a.pipe)(S.Gg((()=>{switch(t.name){case"grammarlyGoPrompts":return r.countShow((0,o._)((0,s._)({},l),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),r.trackShow((0,o._)((0,s._)({},l),{sessionUuid:e.sessionUuid,placement:"grammarlyGoPrompts",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));case"plagiarism":return r.countShow((0,o._)((0,s._)({},l),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),r.trackShow((0,o._)((0,s._)({},l),{sessionUuid:e.sessionUuid,placement:"plagiarismView",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));case"toneDetector":return r.countShow((0,o._)((0,s._)({},l),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),r.trackShow((0,o._)((0,s._)({},l),{sessionUuid:e.sessionUuid,placement:"toneDetector",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));case"successState":return r.countShow((0,o._)((0,s._)({},l),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),r.trackShow((0,o._)((0,s._)({},l),{sessionUuid:e.sessionUuid,placement:"successState",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));default:(0,k.xb)(t.name)}})),T.hq),trackUphookClicked:t=>(0,a.pipe)(S.Gg((()=>{switch(t.name){case"grammarlyGoPrompts":return r.countClick((0,o._)((0,s._)({},l),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),r.trackClick({pageId:e.pageId,sessionUuid:e.sessionUuid,placement:"grammarlyGoPrompts",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant});case"plagiarism":return r.countClick((0,o._)((0,s._)({},l),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),r.trackClick((0,o._)((0,s._)({},l),{sessionUuid:e.sessionUuid,placement:"plagiarismView",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));case"toneDetector":return r.countClick((0,o._)((0,s._)({},l),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),r.trackClick((0,o._)((0,s._)({},l),{sessionUuid:e.sessionUuid,placement:"toneDetector",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));case"successState":return r.countClick((0,o._)((0,s._)({},l),{upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant})),r.trackClick((0,o._)((0,s._)({},l),{sessionUuid:e.sessionUuid,placement:"successState",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}));default:(0,k.xb)(t.name)}})),T.hq),trackUphookDismissed:t=>"plagiarism"===t.name?r.trackDismiss({pageId:e.pageId,sessionUuid:e.sessionUuid,placement:"plagiarismView",upgradeHookName:t.name,upgradeHookSlot:t.slot,upgradeHookVariant:t.variant}):(0,k.AS)(t.name),executeUphook:e=>(0,a.pipe)(S.L9((()=>{switch(e.name){case"grammarlyGoPrompts":return n.fromGrammarlyGO();case"advancedIssues":return n.openUpgradeUrl(A.YT.Place.DenaliDocument.editorDenaliAdvanced);case"successState":return n.openUpgradeUrl(A.YT.Place.DenaliDocument.editorDenaliSuccessState);case"plagiarism":case"toneDetector":return n.openUpgradeUrl(A.YT.Place.DenaliDocument.oggyPlagiarismUphook);default:(0,k.xb)(e.name)}})),T.hq),isEligibleForFreeTrial:n.isEligibleForFreeTrial}};var D;const H=e=>({domain:c.s.create(null),submitFeedback:t=>S.Gg((()=>e.gnarSpec.feedbackFormSubmit("",null!==(D=t.message)&&void 0!==D?D:"",e.pageId,t.mood)))}),W=(e,t,i,s)=>{const{env:o}=(0,I.W)();return{hostInfo:{clientType:i.names.tracking,clientVersion:i.buildVersion.toString(),containerId:t,environment:"fb"===o||"dev"===o?"dev":o},sizeBehavior:V.w.fitContainer,dragBehavior:c.s.create({kind:"notDraggable"}),openUrl:(a=(0,n._)((function*(e){return w.$v(s.actions.openUrl(new x.U(e)))})),function(e){return a.apply(this,arguments)}),visuallyReady:()=>(e.push({kind:N.f.Kind.visuallyReady}),Promise.resolve()),interactionReady:t=>(e.push({kind:N.f.Kind.interactionReady,interactionReadyInfo:t}),Promise.resolve()),readyToDrag:t=>(e.push({kind:N.f.Kind.readyToDrag,readyToDragInfo:t}),Promise.resolve(void 0)),focusStateChanged:t=>(e.push({kind:N.f.Kind.focusStateChanged,focusState:t}),Promise.resolve()),starting:()=>(e.push({kind:N.f.Kind.starting}),Promise.resolve()),close:()=>(e.push({kind:N.f.Kind.close}),Promise.resolve())};var a},G=e=>({gates:d.V,experiments:d.r,getTreatment:(0,a.flow)(e.getTreatment,S.pG),peekTreatment:(0,a.flow)(e.peekTreatment,S.pG),logTreatment:(t,i)=>S.TX((()=>e.logTreatment(t,i)),(e=>String(e))),isGateEnabled:(0,a.flow)(e.isGateEnabled,S.pG)}),K=(e,t)=>{const i=t.sendProfuseGnarEvents;return{performanceScoreReportShown:M.Yi,feedSuccessStateShown:t=>e.gnarSpec.sidebarSuccessStateShow(t,e.pageId,"applied",e.sessionUuid),feedFormChanged:(t,i,n)=>{switch(t){case"shortForm":e.gnarSpec.assistantSwitchToShortFormClick(e.pageId,null!=i?i:void 0,null!=n?n:void 0,e.sessionUuid);break;case"longForm":e.gnarSpec.assistantSwitchToLongFormClick(e.pageId,null!=i?i:void 0,null!=n?n:void 0,e.sessionUuid);break;default:(0,k.AS)(t)}},feedLensShown:t=>{e.gnarSpec.assistantLensShow(t,e.pageId,e.sessionUuid)},feedLensButtonClicked:t=>{e.gnarSpec.assistantLensButtonClick(t,e.pageId,e.sessionUuid)},actionButtonClicked:(t,i,n,s,o)=>{e.gnarSpec.assistantActionButtonClick(i,t,e.pageId,n,s,o,e.sessionUuid)},moreActionsButtonClicked:(t,i,n)=>{e.gnarSpec.assistantMoreActionsButtonClick(e.pageId,t,i,n,e.sessionUuid)},actionButtonRendered:(t,n,s,o,a)=>{i&&e.gnarSpec.assistantActionButtonRender(n,t,e.pageId,s,o,a,e.sessionUuid)},actionButtonShown:(n,s,o,a,r)=>{const l=t.isSmartPlagiarismUphookEnabled&&"plagiarism"===s;(i||l)&&e.gnarSpec.assistantActionButtonImpression(s,n,e.pageId,o,a,r,e.sessionUuid)},plagiarismCitationsStyleChanged:t=>{e.gnarSpec.assistantPlagiarismCitationsStyleChange(t,e.pageId,e.sessionUuid)},plagiarismCitationsStyleDropdownOpened:t=>{e.gnarSpec.assistantPlagiarismCitationsStyleDropdownOpen(e.pageId,t,e.sessionUuid)},toneReportShown:M.Yi,selectionContextHovered:()=>{e.gnarSpec.assistantSelectionContextHover(e.pageId,e.sessionUuid)},selectionContextClicked:()=>{e.gnarSpec.assistantSelectionContextClick(e.pageId,e.sessionUuid)},selectionContextRemoveButtonClicked:()=>{e.gnarSpec.assistantSelectionContextRemoveButtonClick(e.pageId,e.sessionUuid)},partialPageModeNotificationDismissed:M.Yi}}},40005:(e,t,i)=>{i.d(t,{w:()=>n});var n,s=i(21216),o=i(74168),a=i(43308),r=i(15491),l=i(58347),d=i(89769);!function(e){e.fitContainer=s.of({heightBehavior:{kind:"fitContainer"},widthBehavior:{kind:"fitContainer"}}),e.fitContent=e=>o.sc(e).pipe(a.E("height"),r.T((e=>e-100)),l.B(100),d.Z(550),r.T((e=>({heightBehavior:{kind:"fitContent",maxHeight:e},widthBehavior:{kind:"fitContainer"}}))))}(n||(n={}))},769:(e,t,i)=>{i.d(t,{X:()=>s});var n,s,o=i(10334),a=i(69384),r=i(84647),l=i(15491),d=i(11298),c=i(65390),p=i(66202);!function(e){e.map=(e,t,i)=>l.T((0,r.flow)(c.map(p.fold(null!=i?i:t,e)),c.getOrElse(t)))}(n||(n={})),function(e){e.create=e=>t=>{var{engineDedStream:i}=t,n=(0,a._)(t,["engineDedStream"]);return i.pipe(l.T(c.map(p.bimap((e=>(n.documentLoader.onEngineError(),e)),(([t,i])=>(0,o._)({ded:t,engine:i,denaliViewModels:e((0,o._)({ded:t,engine:i},n))},n))))),d.u())}}(s||(s={}))},60083:(e,t,i)=>{i.d(t,{J:()=>b,x:()=>n});var n,s=i(23988),o=i(10334),a=i(17171),r=i(84647),l=i(99002),d=i(80074),c=i(60575),p=i(68594),h=i(15491),u=i(46669),g=i(65621),m=i(80837),_=i(44869),v=i(65390),f=i(58193),y=i(36840);!function(e){let t,i,s;!function(e){e.checking="checking",e.checkingIn="checkingIn",e.checkingOut="checkingOut"}(t=e.Type||(e.Type={})),function(e){e.loading="loading",e.processing="processing"}(i=e.TextType||(e.TextType={})),function(e){var t=e.eq=_.OW({text:v.getEq(l.Eq),lens:v.getEq(l.Eq),navigation:v.getEq(l.Eq)}),i=(e.isIdle=e=>t.equals(e,i),e.idle={text:v.none,lens:v.none,navigation:v.none});e.text={text:v.some(n.TextType.loading),lens:v.none,navigation:v.none},e.processing={text:v.some(n.TextType.processing),lens:v.some(n.Type.checking),navigation:v.some(n.Type.checking)},e.navigationProcessing=(0,a._)((0,o._)({},i),{navigation:v.some(n.Type.checking)}),e.loading={text:v.some(n.TextType.loading),lens:v.some(n.Type.checking),navigation:v.some(n.Type.checking)},e.toString=function(e){const t=(0,r.pipe)(e.lens,v.filter((e=>"checkingOut"!==e)),v.fold((()=>"on"),(()=>"off"))),i=(0,r.pipe)(e.navigation,v.filter((e=>"checkingOut"!==e)),v.fold((()=>"on"),(()=>"off")));return`text: ${(0,r.pipe)(e.text,v.getOrElse((()=>"off")))}; lens: ${t}; nav: ${i}`}}(s=e.State||(e.State={}))}(n||(n={}));class b{dispose(){this._subs.dispose()}_listenLoading(){this._subs.push(this.state.subscribe((e=>{this._log.debug(`State is changed to ${n.State.toString(e)}`)})),this._listenTimeseries("text",(e=>(0,r.pipe)(e.text,f.y0)),!0),this._listenTimeseries("lens",(e=>(0,r.pipe)(e.lens,v.filter((e=>"checkingOut"!==e)),v.map((()=>"checking")),f.y0))),this._listenTimeseries("navigation",(e=>(0,r.pipe)(e.navigation,v.filter((e=>"checkingOut"!==e)),v.map((()=>"checking")),f.y0))))}_listenTimeseries(e,t,i=!1){return this.state.pipe(p.i(1),h.T((e=>t(e))),u.F(),h.T((t=>{if(void 0!==t)return i&&this._metric.getCounter(`${e}.${t}.start.counter`).increment(),{time:this._metric.getTimer(`${e}.${t}.time`).start(),counter:i?this._metric.getCounter(`${e}.${t}.stop.counter`):void 0}})),g.J()).subscribe((([e])=>{e&&(e.time.stop(),e.counter&&e.counter.increment())}))}constructor(e,t){(0,s._)(this,"_router",void 0),(0,s._)(this,"_features",void 0),(0,s._)(this,"state",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_metric",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"onEngineError",void 0),this._router=e,this._features=t,this.state=d.s.create(n.State.idle),this._log=c.Bx.Logging.getLogger("denali_loader"),this._metric=c.Bx.TimeSeries.rootFemetrics.getMetric("denali_loader"),this._subs=new m.y.Keeper,this.onEngineError=()=>this.state.set(n.State.idle),this._listenLoading(),(0,r.pipe)(this._router.locationState,v.exists((e=>!0===e.openSidebar)))||this._features.sidebarOpenedByDefault?this.state.set(n.State.processing):this.state.set(n.State.text),(0,y.hJ)("setLoader",(e=>{switch(e){case"idle":return this.state.set(n.State.idle);case"text":return this.state.set(n.State.text);case"navigation":return this.state.set(n.State.navigationProcessing);case"all":return this.state.set(n.State.processing);default:return(0,r.absurd)(e)}}))}}},72404:(e,t,i)=>{i.d(t,{H:()=>n});var n,s=i(84647),o=i(80074),a=i(74416),r=i(22835),l=i(65390),d=i(36840),c=i(86562),p=i(14e3);!function(e){let t,i,n,h,u,g;function m(e,{emogenie:{popup:{intensities:i}}}){switch(e){case t.VeryStrong:return i.veryStrong;case t.Strong:return i.strong;case t.Moderate:return i.moderate;case t.Slight:return i.slight;default:return(0,c.xb)(e)}}!function(e){e[e.Low=1]="Low",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate",e[e.Strong=4]="Strong",e[e.VeryStrong=5]="VeryStrong"}(t||(t={})),e.intensitiesOrder=r.HP(t).map((e=>t[e])).filter((e=>"number"==typeof e)).sort(),function(e){e.fromConfidence=function(e,i){const n=a.w.unwrap(e);return n<.25?t.Slight:n<.5?t.Moderate:n/i>.5?t.VeryStrong:t.Strong}}(i||(i={})),function(e){e.fromModel=function({name:e,confidence:t,feedback:n,emoji:o},a,r,d){const c=i.fromConfidence(t,r);return{emoji:o,name:e,intensity:c,intensityCaption:m(c,d),feedback:n,actions:{like:{name:`${e}-like`,tooltip:d.emogenie.popup.actions.like,active:(0,s.pipe)(n,l.exists((e=>e===p.B.FeedbackType.Like))),disabled:l.isSome(n),handler:()=>a(e,p.B.FeedbackType.Like)},dislike:{name:`${e}-dislike`,tooltip:d.emogenie.popup.actions.dislike,active:(0,s.pipe)(n,l.exists((e=>e===p.B.FeedbackType.Dislike))),disabled:l.isSome(n),handler:()=>a(e,p.B.FeedbackType.Dislike)}}}}}(n=e.Item||(e.Item={})),function(e){let t;!function(e){e.Report="Report",e.ZeroState="ZeroState"}(t=e.Type||(e.Type={})),e.isReport=e=>e.type===h.Type.Report}(h=e.View||(e.View={})),function(e){e.fromModel=function(e,t,i){const s=e.reduce(((e,t)=>e+a.w.unwrap(t.confidence)),0),[o,...r]=e.map((e=>n.fromModel(e,t,s,i)));return{type:h.Type.Report,primaryItem:o,secondaryItems:r,onPopupClose:d.Yi,onPopupOpen:d.Yi}}}(u||(u={})),function(e){e.create=function(e,t,i){return{visualState:o.s.combine(e.emotions,t.documentLength.view("trimmed").view((e=>e<120)),((t,n)=>n||0===t.length?{type:h.Type.ZeroState,tooltipText:n?l.some(i.emogenie.popup.textIsTooShortMessage):l.none}:u.fromModel(t,e.sendEmotionFeedback,i)))}}}(g=e.ViewModel||(e.ViewModel={})),e.getIntensityTitle=m}(n||(n={}))},80548:(e,t,i)=>{i.d(t,{e:()=>K,k:()=>n});var n,s=i(23988),o=i(10334),a=i(17171),r=i(84647),l=i(80074),d=i(60575),c=i(66799),p=i(63967),h=i(62597),u=i(22809),g=i(80159),m=i(82718),_=i(7323),v=i(78339),f=i(95168),y=i(6987),b=i(80837),w=i(68745),S=i(89769),C=i(65621),M=i(83541),E=i(62822),k=i(21216),T=i(90405),x=i(15491),I=i(68533),A=i(38427),F=i(34078),V=i(54988),L=i(36094),N=i(46669),R=i(11298),O=i(45653),U=i(87275),B=i(93584),P=i(65390),D=i(36840),H=i(66202),W=i(86562),G=i(58193);!function(e){let t,i;!function(e){e.getInlineHighlightFilter=e=>t=>!e.get()||(0,r.pipe)(t,P.map((e=>p.Fc.State.isBulkApplied(e.state))),P.getOrElse(r.constTrue))}(t=e.ViewModel||(e.ViewModel={})),function(e){e.highlightMarkByInlineAlert=(e,t,i,n)=>({id:n,when:(0,D.Ub)(h.J.isClosedId,h.J.isMainLens),what:U.os.Effect.Applicator.create(B.FA.getHighlightSubscription(e,t,i).pipe(m.K(_.t)))})}(i=e.Effects||(e.Effects={}))}(n||(n={}));class K{_openAlert(e){this._openInlineAlert.next(e)}_listenAlertIgnores(){var e;return this.events.pipe(v.p(g.G.isAlertIgnoreAction)).subscribe((t=>this._sendFeedback(t.alertId,{kind:c.yp.IGNORE,subtype:null!==(e=t.subtype)&&void 0!==e?e:c.U3.Inline})))}_listenAlertAddedToDictionary(){return this.events.pipe(v.p(g.G.isAlertAddToDictionaryAction)).subscribe((e=>this._sendFeedback(e.alertId,{kind:c.yp.ADD_TO_DICTIONARY,subtype:c.U3.Inline})))}_listenAlertOpenings(){return this.events.pipe(v.p(g.G.isAlertOpenAction)).subscribe((e=>{this._openAlert(e.alert)}))}_listenAlertClose(){return this.events.pipe(v.p(g.G.isCardCloseAction)).subscribe((()=>{this._inlineManager.changeTeaserExpanded(P.none)}))}_listenAlertApplies(){return this.events.pipe(v.p(g.G.isAlertApplyAction)).subscribe((e=>{(0,r.pipe)(this._alertsService.apply(e.alertId,{alternativeIndex:e.alternativeIndex,source:p.Kz.text,feedbackSubtype:c.U3.Inline}),H.fold((e=>this._log.error("error applying alert",e)),(()=>{const t=(0,r.pipe)(this._alertsReader.getById(e.alertId),P.chain((e=>e.extraProperties.freePremium)),P.exists((e=>"unlocked"===e)));this._telemetry.gnarSpec.suggestedReplacementButtonClick(t,this._telemetry.pageId,"defaultCard","assistantOff",this._telemetry.pageSessionId)})))}))}_listenCardLooks(){return this.events.pipe(v.p(g.G.isLookedAction),v.p((e=>this._alertsReader.isValidForFeedback(e.alertId)))).subscribe((({alertId:e,kind:t})=>this._sendFeedback(e,{kind:c.yp.LOOKED,subtype:"card"===t?c.U3.Inline:c.U3.UnderlineWithTeaser})))}_listenFeedbackModalStateChanges(){return this.events.pipe(v.p((0,D.Ub)(g.G.isFeedbackOpenAction,g.G.isFeedbackCloseAction)),f.M((e=>this.feedbackModalOpen.set(g.G.isFeedbackOpenAction(e))))).subscribe()}_listenUserFeedbackSubmissions(){return this.events.pipe(v.p(g.G.isFeedbackSubmitAction),y.n((e=>(0,r.pipe)(this._sendFeedback(e.alertId,{kind:c.yp.USER_SATISFACTION_FEEDBACK,subtype:e.source,userSatisfactionDescription:e.feedback}),H.fold((()=>this._notificationsManager.enqueue("error")),(()=>(this.feedbackModalOpen.set(!1),this._notificationsManager.enqueue("feedbackSend")))))))).subscribe()}_listenTeaserExpands(){return this.events.pipe(v.p(g.G.isTeaserExpandAction),f.M((({alertId:e})=>{this._inlineManager.changeTeaserExpanded(P.some(e)),this._sendFeedback(e,{kind:c.yp.ACCEPTED,subtype:c.U3.UnderlineWithTeaser,alternativeIndex:0})}))).subscribe()}dispose(){this._subs.dispose()}constructor(e,t,i,n,c,h,m,_,U,B,D){(0,s._)(this,"_inlineManager",void 0),(0,s._)(this,"_alertMarkRectGetter",void 0),(0,s._)(this,"_closeEvent",void 0),(0,s._)(this,"_checkingDomain",void 0),(0,s._)(this,"_alertsReader",void 0),(0,s._)(this,"_alertsService",void 0),(0,s._)(this,"_telemetry",void 0),(0,s._)(this,"_openInlineAlert",void 0),(0,s._)(this,"_hovered",void 0),(0,s._)(this,"_inlineHighlightFilter",void 0),(0,s._)(this,"_notificationsManager",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"events",void 0),(0,s._)(this,"feedbackModalOpen",void 0),(0,s._)(this,"teaserExpanded",void 0),(0,s._)(this,"_emitCloseWhen",void 0),(0,s._)(this,"_toMarkAndAlert",void 0),(0,s._)(this,"state",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"_sendFeedback",void 0),this._inlineManager=e,this._alertMarkRectGetter=t,this._closeEvent=i,this._checkingDomain=n,this._alertsReader=c,this._alertsService=h,this._telemetry=m,this._openInlineAlert=_,this._hovered=U,this._inlineHighlightFilter=B,this._notificationsManager=D,this._subs=new b.y.Keeper,this.events=new w.t({type:g.G.Type.closed}),this.feedbackModalOpen=l.s.create(!1),this.teaserExpanded=this._inlineManager.currentTeaser.pipe(S.Z(P.none),C.J(),y.n((([e,t])=>P.isSome(e)&&P.isNone(t)?M.timer(300).pipe(E.u(!1),S.Z(!0)):k.of(P.isSome(t)))),M.shareReplay({bufferSize:1,refCount:!0})),this._emitCloseWhen=T.MA((e=>this._checkingDomain.state.pipe(x.T(u.A.get(e.id)),v.p(P.isNone),I.h(this._closeEvent),f.M(this._inlineManager.closeCards)))),this._toMarkAndAlert=(0,r.flow)(P.filter((e=>P.isSome(this._alertsReader.getInteractable(e.id)))),P.map((e=>{(0,W.V1)(!p.Fc.isInPremiumLens(e)||O.A.isLockedUIAlert(e),"Can't hover plagiarism alert");const t={alert:e,highlightIndex:0};return(0,a._)((0,o._)({},t),{getMarkRect:this._alertMarkRectGetter(t)})}))),this.state=A.zV(this._inlineManager.hoveredMarkAlert.pipe(v.p(this._inlineHighlightFilter),y.n(this._emitCloseWhen)),this.events.pipe(f.M((e=>{"unhovered"===e.type&&this._telemetry.gnarSpec.alertUnderlineHover(this._telemetry.pageId,"assistantOff",this._telemetry.pageSessionId)})))).pipe(F.s((([e,t])=>M.timer(P.isNone(e)&&"closed"!==t.type?300:0))),y.n((([e,t])=>(0,r.pipe)(e,P.fold((()=>"hovered"===t.type?V.w:(this._hovered.next(G.Ie()),k.of(P.none))),(e=>{switch(this._hovered.next(P.some(e)),t.type){case g.G.Type.closed:return L.cb(P.some(e),300);case g.G.Type.opened:case g.G.Type.unhovered:case g.G.Type.hovered:case g.G.Type.addedToDictionary:case g.G.Type.ignored:case g.G.Type.applied:case g.G.Type.confirmed:case g.G.Type.undone:case g.G.Type.mounted:case g.G.Type.looked:case g.G.Type.feedbackModalOpen:case g.G.Type.feedbackModalClose:case g.G.Type.feedbackModalSubmit:case g.G.Type.teaserExpand:return k.of(P.some(e));default:return(0,W.xb)(t)}}))))),N.F(P.getEq(p.HJ.ordId).equals),x.T(this._toMarkAndAlert),R.u()),this._log=d.Bx.Logging.getLogger("InlineCardViewModelImpl",d.y7.$.DEBUG),this._sendFeedback=(e,t)=>(0,r.pipe)(this._alertsService.applyFeedback(e,t,p.Kz.text),H.mapLeft((e=>(this._log.error("error sending feedback",e),e)))),this._subs.push(this._listenAlertOpenings(),this._listenAlertIgnores(),this._listenAlertAddedToDictionary(),this._listenAlertApplies(),this._listenCardLooks(),this._listenFeedbackModalStateChanges(),this._listenUserFeedbackSubmissions(),this._listenTeaserExpands(),this._listenAlertClose())}}!function(e){var t=e.DATA_NAME="inline-card";e.isInlineCard=e=>!!e&&e.getAttribute("data-name")===t}(n||(n={}))},93959:(e,t,i)=>{i.d(t,{C:()=>M,H:()=>n});var n,s=i(23988),o=i(10334),a=i(17171),r=i(84647),l=i(80074),d=i(41949),c=i(68594),p=i(5692),h=i(6987),u=i(36094),g=i(15491),m=i(14342),_=i(89769),v=i(46669),f=i(95168),y=i(38427),b=i(65390),w=i(86562),S=i(36840),C=i(60083);!function(e){e[e.Checking=0]="Checking",e[e.CheckingOut=1]="CheckingOut",e[e.Idle=2]="Idle"}(n||(n={}));class M{init(){this._isLocked.set(!1)}_listenExternalLoadingState(){return this._externalLoadingState.pipe(c.i(1)).subscribe((e=>{this._state.set(e===p.j.Status.idle?C.x.State.idle:C.x.State.loading)}))}_listenProcessingState(){return this._ded.dontFreezeWhen(this._state.view((({text:e})=>b.isSome(e))),"loader")}_listenFullRecheckingState(){const e=(0,r.flow)(b.filter((e=>e===C.x.Type.checkingIn||e===C.x.Type.checking)),b.map((()=>C.x.Type.checkingOut))),t=e=>e.kind===d.kr.CheckingKind.Plagiarism||"full"!==e.type;return(e=>this._loadingStateLock.pipe(h.n(u.$x(e))))(this._lensCheckingData).pipe(h.n((([e,i])=>{const s=e.get();return e.pipe(c.i(1),g.T((e=>t(e)||!i?n.Idle:n.Checking)),m.c(200),_.Z(t(s)?n.Idle:i?n.Checking:n.CheckingOut))})),v.F(),f.M((e=>this.loaderState.set(b.some(e))))).subscribe((t=>{switch(t){case n.Idle:return this._state.set(C.x.State.idle);case n.Checking:return this._state.modify((e=>(0,a._)((0,o._)({},e),{text:b.none})));case n.CheckingOut:return this._state.modify((t=>(0,a._)((0,o._)({},t),{text:b.none,navigation:e(t.navigation)})));default:(0,w.xb)(t)}}))}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}constructor(e,t,i,n,o){(0,s._)(this,"_state",void 0),(0,s._)(this,"_externalLoadingState",void 0),(0,s._)(this,"_ded",void 0),(0,s._)(this,"loaderState",void 0),(0,s._)(this,"_subs",void 0),(0,s._)(this,"_isLocked",void 0),(0,s._)(this,"_loadingStateLock",void 0),(0,s._)(this,"_lensCheckingData",void 0),this._state=e,this._externalLoadingState=n,this._ded=o,this.loaderState=l.s.create(b.none),this._subs=[],this._isLocked=l.s.create(!0),this._loadingStateLock=y.zV([this._isLocked,this._externalLoadingState.pipe(_.Z(p.j.Status.idle))],((e,t)=>e||t!==p.j.Status.idle)).pipe(v.F()),this._lensCheckingData=l.s.combine(t.activeLensId.view(i.getCheckingForState),t.state.view("isSidebarOpen"),r.tuple),this._subs.push(this._listenExternalLoadingState(),this._listenProcessingState(),this._listenFullRecheckingState()),(0,S.hJ)("loader",((e,t,i)=>{this._state.set({text:(0,r.pipe)(b.fromNullable(e),b.filter((e=>e in C.x.TextType))),lens:(0,r.pipe)(b.fromNullable(t),b.filter((e=>e in C.x.Type))),navigation:(0,r.pipe)(b.fromNullable(i),b.filter((e=>e in C.x.Type)))})}))}}},90334:(e,t,i)=>{i.d(t,{t:()=>gt});var n,s=i(50659),o=i(84647),a=i(80074),r=i(87574),l=i(41548),d=i(86922),c=i(19772),p=i(38427),h=i(90405),u=i(15491),g=i(65390),m=i(58193),_=i(80300),v=i(61098),f=i(16721),y=i(78018),b=i(5731),w=i(10334),S=i(17171),C=i(19840),M=i(40046),E=i(82608),k=i(89011),T=i(36094),x=i(11089),I=i(82315),A=i(68745),F=i(40027),V=i(68594),L=i(89769),N=i(46669),R=i(95168),O=i(38908);!function(e){e.HEADER_TITLE_INPUT_NAME="header-title-input",e.TOOLTIP_DURATION=2e3,e.TITLE_MAX_LENGTH=5e3,e.TITLE_WIDTH_BUFFER=10,e.TITLE_WIDTH_BUFFER_DELAY=500;var t=e.TITLE_VISIBILITY_OFFSET=3.45;e.create=(e,i,n,s,a)=>{const r=new A.t(0),l=new A.t(!1),d=p.zV([i.scrollPosition,i.viewport.pipe(u.T((({text:e})=>e))),n]).pipe(u.T((([e,t,i])=>({textTop:t.top-e,remSize:i}))),F.Z(100),V.i(1),u.T((({textTop:e,remSize:i})=>e<i*t)),L.Z(!1),N.F(),R.M((e=>e||l.next(!1)))),c=t=>e.title.set(t);return{title:e.title,isSidebarOpened:s,isFocused:l,isVisible:d,isSaved:e.saved,inputWidth:r,setInputWidth:e=>r.next(e),setFocus:e=>l.next(e),trackTitleClick:()=>a.gnarSpec.newTitleButtonClick(a.pageId),setTitle:c,setPastedTitle:e=>{var t;const i=O.aj(e,{allowedTags:[]}),n=window.getSelection();null!=(null===(t=n)||void 0===t?void 0:t.rangeCount)&&(n.deleteFromDocument(),n.getRangeAt(0).insertNode(document.createTextNode(i)));const s=(0,o.pipe)(n,g.fromNullable,g.chain((e=>g.fromNullable(e.focusNode))),g.map((e=>e.textContent)),g.getOrElse((0,o.constant)(i)));c(s)}}}}(n||(n={}));var U=i(65873),B=i(30702),P=i(83541),D=i(11864),H=i(4885);const W=D.Ks.keyframes({"5%":{opacity:1},"95%":{opacity:1},"100%":{opacity:0}}),G={display:"inline-block",marginTop:D.Ks.rem(1),color:H.aD,verticalAlign:"top",fontSize:D.Ks.rem(.6875),lineHeight:D.Ks.rem(2),opacity:0,pointerEvents:"none",flexShrink:0},K={animation:`${W} 2s linear`},z=D.Ks.stylesheet({notSaved:[G],saved:[G,K]}),$=({isSaved:e,className:t})=>s.createElement(U.Oc,(0,w._)({key:"saved-wrapper","data-name":"save-status"},(0,C.Ly)(e.pipe(B.s((e=>P.timer(e?1e3:0))),L.Z(!1),u.T((e=>e?z.saved:z.notSaved))),t)),s.createElement(r.F.span,{"data-saved":e.pipe(L.Z(!0))}),"Saved");var J=i(13607),j=i(92825),q=i(27199),Y=i(57014);const Z={position:"absolute",top:0,right:D.Ks.rem(1),left:0,zIndex:J.ry,marginLeft:D.Ks.rem(-3),paddingLeft:D.Ks.rem(3),height:D.Ks.rem(J.xl+.5),background:j.kn,textAlign:"center",lineHeight:D.Ks.rem(J.xl),pointerEvents:"all",$nest:{"@media print":{display:"none"}}},Q={position:"relative",display:"inline-block",marginTop:D.Ks.rem(1),marginRight:D.Ks.rem(.5),maxWidth:`calc(100% - ${D.Ks.rem(3)})`},X={$nest:{"&:before":{position:"absolute",top:0,left:D.Ks.rem(-.375),zIndex:-1,width:D.Ks.percent(100),height:D.Ks.rem(2),borderRadius:D.Ks.rem(J.H0),background:q.Q1.CoreNeutral10,content:'""',opacity:0,transition:"all .2s"},"&:hover:before":{opacity:1}}},ee={$nest:{[Y.$U.normal]:{maxWidth:"calc(100% - 5rem)"},[Y.$U.small]:{maxWidth:"calc(100% -10rem)"},[Y.$U.tiny]:{maxWidth:"calc(100% - 12rem)"},[Y.$U.xs]:{maxWidth:"calc(100% - 15rem)"},[Y.$U.xsLower]:{maxWidth:"calc(100% - 21rem)"},[Y.$U.xssUpper]:{marginRight:D.Ks.rem(.5),maxWidth:"calc(100% - 24rem)"}}},te={display:"inline-block",overflow:"hidden",padding:".25rem 0",maxWidth:"calc(100% - .5rem)",outline:"none",border:"none",background:"transparent",verticalAlign:"top",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:"bold",cursor:"pointer",transition:"all .2s",pointerEvents:"all",$nest:{"&[placeholder]:empty:before":{color:q.Q1.CoreNeutral50,opacity:1,content:"attr(placeholder)"},"&:focus":{textOverflow:"unset"}}},ie={opacity:1,transition:"opacity .2s",pointerEvents:"none"},ne={opacity:0},se={position:"absolute",left:0,opacity:1},oe={fontSize:D.Ks.rem(.75)},ae={position:"relative",padding:0,letterSpacing:D.Ks.rem(.05),minWidth:D.Ks.px(250),maxWidth:D.Ks.rem(46),width:D.Ks.percent(100),$nest:{[Y.$U.xs]:{padding:0}}},re={position:"relative",width:D.Ks.percent(100),height:D.Ks.vh(100),pointerEvents:"none"},le={position:"relative",zIndex:J.kf,display:"flex",width:D.Ks.percent(100),justifyContent:"center"},de={width:D.Ks.percent(100)},ce={position:"absolute",top:0,zIndex:J.ry,width:D.Ks.percent(100),height:D.Ks.percent(100)},pe={position:"relative",height:D.Ks.percent(100)},he={marginLeft:D.Ks.rem(-.75),$nest:{[Y.$U.xs]:{marginLeft:D.Ks.rem(-1.5)}}},ue={marginRight:D.Ks.rem(2.25),padding:`0 ${D.Ks.rem(.125)} 0 0`,background:q.Q1.CoreNeutral0,$nest:{[Y.$U.xs]:{marginRight:D.Ks.rem(1.75)},[Y.$U.xsLower]:{marginRight:D.Ks.rem(1.75)}}},ge={left:D.Ks.important(0)},me={right:D.Ks.important(0)},_e=D.Ks.prefixedStylesheet("toolbar",{toolbarTitleContainer:[Z],titleWrapper:[{position:"relative"}],headerTitleContainer:[Q],headerTitleHighlight:[X],headerTitleContainerFull:[Q,ee],headerTitleContainerFocused:[X,{$nest:{"&:before":{opacity:1}}}],savedContainer:[ie],savedContainerHidden:[ie,ne],savedContainerAbsolute:[ie,se],savedContainerAbsoluteHidden:[ne,se],savedIndicator:[oe],headerContainer:[ae],toolbarWrapperTier:[re],headerWrapper:[le],headerWrapperSqueezed:[le,{paddingLeft:0}],headerOnboardingWrapper:[de],absoluteWrapper:[ce],toolbarContainer:[pe],formattingShiftedLeft:[he],wordCounter:[ue],footerEmotions:[{position:"absolute",right:0}],flex:[{display:"flex"}],dropdownContainer:[{lineHeight:"normal"}],dropdownListRight:[ge],dropdownListLeft:[me]}),ve=D.Ks.style({position:"absolute",visibility:"hidden",paddingLeft:D.Ks.important(D.Ks.rem(1)),maxWidth:D.Ks.important(`calc(100% - ${D.Ks.rem(3)})`),width:"auto",height:0,whiteSpace:D.Ks.important("pre")}),fe=D.Ks.style(te),ye=D.Ks.style({opacity:0,pointerEvents:"none"}),be=D.Ks.joinClasses([E.Typography.style.base,fe,ve]),we=D.Ks.joinClasses([E.Typography.style.base,fe]),Se=D.Ks.joinClasses([we,ye]),Ce=(0,S._)((0,w._)({},_e),{shadow:be,headerTitle:we,headerTitleHidden:Se});var Me=i(92723);const Ee=e=>(0,o.flow)(g.fromNullable,m.Mi((t=>e({kind:"mount",element:t})()))),ke=_.UI.Grid.make((({slots:e,state:t,view:i,notify:o})=>{const a=s.useContext(d.S.Context),{withSelectionEffect:l}=s.useContext(v.z.Context),c=b.B.createComponent({component:r.F.div,section:b.B.create(b.B.Id.title),behavior:x.a.FocusBehavior.captureTab}),p=l(v.z.Effect.PlainContainer,v.z.Effect.collapse),h=T.wd(i("isOpened")),g=T.wd(i("isFocused"));return s.createElement(r.F.Fragment,null,s.createElement(p,(0,S._)((0,w._)({},(0,C.Ly)(Ce.toolbarTitleContainer)),{onMount:Ee(o)})),s.createElement("div",{className:Ce.absoluteWrapper},s.createElement(Me.A,{selectionEffect:v.z.Effect.prevent},s.createElement(r.F.div,(0,C.Ly)(h(Ce.headerWrapperSqueezed,Ce.headerWrapper)),s.createElement("div",{className:Ce.headerContainer},s.createElement(r.F.div,{className:Ce.titleWrapper},s.createElement(c,(0,C.Ly)(Ce.headerTitleHighlight,h(Ce.headerTitleContainer,Ce.headerTitleContainerFull),g(Ce.headerTitleContainerFocused,void 0)),s.createElement(r.F.Fragment,null,t.pipe(u.T((({showOnboardingTourA11yUpdates:t})=>s.createElement(I.M7,{alignment:"bottom",eventType:"onclick",themes:{containerWrapperClassName:Ce.headerOnboardingWrapper},stepId:k.E.StepId.DocumentTitle,title:t?a.toolbar.title.detailedOnboarding.title:void 0,message:t?a.toolbar.title.detailedOnboarding.message:a.toolbar.title.onboarding.message},s.createElement(M.m_,{title:a.toolbar.title.rename,align:"bottomCenter",duration:n.TOOLTIP_DURATION},e.input))))))),e.savedIndicator))))),e.measurer)})),Te=_.UI.Node.make((({view:e})=>s.createElement(r.F.span,{"data-name":"saved-container",className:Ce.savedContainer},s.createElement($,{className:Ce.savedIndicator,isSaved:e("saved")})))),xe=_.UI.Node.make((({view:e,notify:t})=>{const i=s.useContext(d.S.Context);return s.createElement("span",{ref:Ee(t),className:Ce.shadow},s.createElement(r.F.Fragment,null,e("title").pipe(u.T((e=>Boolean(e)?e:i.toolbar.title.untitledDocument)))))})),Ie=_.UI.Node.make((({state:e,view:t,notify:i})=>{const o=s.useContext(d.S.Context);return s.createElement(r.F.Fragment,null,t("key").pipe(u.T((a=>s.createElement(E.Typography.H1,{key:a,style:t("inputWidth").pipe(u.T((e=>({width:e})))),"data-name":n.HEADER_TITLE_INPUT_NAME,mount:Ee(i),contentEditable:!0,spellCheck:!1,maxLength:n.TITLE_MAX_LENGTH,onClick:i({kind:"click"}),onFocus:i({kind:"focus"}),onBlur:i({kind:"blur"}),onKeyDown:e=>(e.persist(),i({kind:"keydown",event:e})()),onPaste:e=>{e.preventDefault(),i({kind:"paste",value:e.clipboardData.getData("text")})()},onDrop:e=>e.preventDefault(),placeholder:o.toolbar.title.untitledDocument,className:Ce.headerTitle,"aria-label":e.pipe(u.T((({title:e})=>Boolean(e)?o.toolbar.title.renameLabel(e):o.toolbar.title.untitledDocumentLabel))),onInput:e=>i({kind:"input",element:e.currentTarget})()})))))})),Ae=_.UI.Knot.make(ke,{input:Ie,measurer:xe,savedIndicator:Te});var Fe=i(6987),Ve=i(30396),Le=i(24946),Ne=i(82718),Re=i(7813),Oe=i(86562);const Ue=(e,t,i)=>_.n.fromSideEffect((e=>t(e.element)),p.zV([e.isSidebarOpened,e.isFocused]).pipe(u.T((([e,t])=>({isOpened:e,isFocused:t,showOnboardingTourA11yUpdates:i.denali.showOnboardingTourA11yUpdates}))))),Be=e=>(0,o.flow)(Fe.n((({element:t})=>e.title.pipe(Ve.S(((e,t)=>[e[1],Boolean(t)?t.length:0]),[0,0]),Fe.n((([e,i])=>P.timer(0,n.TITLE_WIDTH_BUFFER_DELAY).pipe(u.T((s=>t.offsetWidth+(Boolean(s)||!Boolean(i)||e>i?0:n.TITLE_WIDTH_BUFFER))),Le.s(2)))),L.Z(0),N.F(),R.M(e.setInputWidth)))),Ne.K(e.title),L.Z(e.title.get()),N.F(),u.T((e=>({title:e})))),Pe=e=>_.n.fromSideEffect(o.constVoid,e.isSaved.pipe(L.Z(!0),u.T((e=>({saved:e}))))),De=e=>{const t=new A.t(O.G7(5));return _.n.fromSideEffect((i=>{switch(i.kind){case"mount":var n;return i.element.textContent=null!==(n=e.title.get())&&void 0!==n?n:"";case"input":const s=Boolean(i.element.textContent)?O.aj(i.element.textContent,{allowedTags:[]}):"";return Boolean(s)||(i.element.innerHTML=""),s!==i.element.textContent&&(i.element.textContent=s,function(e){var t,i;const n=document.createRange();n.selectNodeContents(e),n.collapse(!1);const s=window.getSelection();null===(t=s)||void 0===t||t.removeAllRanges(),null===(i=s)||void 0===i||i.addRange(n)}(i.element)),e.setTitle(s);case"click":return e.trackTitleClick();case"focus":return e.setFocus(!0);case"blur":return t.next(O.G7(5)),e.setFocus(!1);case"keydown":return void(i.event.keyCode===Re.D.ENTER_CODE&&i.event.preventDefault());case"paste":return e.setPastedTitle(i.value);default:return(0,Oe.xb)(i)}}),p.zV([e.title,e.inputWidth,t]).pipe(u.T((([e,t,i])=>({inputWidth:t,title:e,key:i})))))},He=(e,t,i)=>_.n.composeKnot({root:Ue(e,t,i),input:De(e),measurer:Be(e),savedIndicator:Pe(e)});var We;!function(e){e.UI=Ae,e.Flow=He}(We||(We={}));var Ge=i(23988),Ke=i(69384),ze=i(21607),$e=i(27917),Je=i(78339),je=i(19711),qe=i(62723),Ye=i(34717),Ze=i(36840),Qe=i(37107);const Xe=JSON.parse('{"bL":"_f0f464d7-footer-footerWrapper","kn":"_b08aac52-footer-footerLabel","Le":"_66527578-footer-footerArrow","Q0":"_811d30fc-footer-footerWordCounter _66527578-footer-footerArrow","LK":"_eb089b1d-footer-footerLabelContainer","OP":"_1a6d279b-footer-footerSqueezed _f0f464d7-footer-footerWrapper","cB":"_de72bac6-footer-fContainer","o0":"_5db10d62-footer-fItem","w3":"_2ff99833-footer-fItemResponsive","AE":"_7ee76d74-footer-counterWrapperStart _096b72d8-footer-counterWrapper","dx":"_f25f5d2a-footer-counterWrapperEnd _096b72d8-footer-counterWrapper","xX":"_cacd8c39-footer-counterLabelContainerFull","vk":"_4ddea5d3-footer-counterLabelShadow","Ym":"_1fc5b99a-footer-counterContainer","xQ":"_5c65879c-footer-footerContainer"}'),et=(e,{footer:t})=>{switch(e[0]){case Qe.Jf.wordsCount:return`${e[1].toLocaleString()} ${O.td(e[1],t.word,t.words)}`;case Qe.Jf.charsCount:return`${e[1].toLocaleString()} ${O.td(e[1],t.character,t.characters)}`;case Qe.Jf.readingTime:return`${Ye.Xq(e[1])} ${t.readingTime}`;case Qe.Jf.speakingTime:return`${Ye.Xq(e[1])} ${t.speakingTime}`;case Qe.Jf.readabilityScore:return(0,o.pipe)(e[1],g.fold((()=>t.disabledReadabilityScore),(e=>`${e} ${t.readabilityScore}`)));default:return(0,Oe.xb)(e[1])}},tt=(e,t)=>t===Qe.Jf.readabilityScore&&g.isNone(e[t]);class it extends s.Component{render(){const{isSidebarOpen:e,className:t,children:i,mount:n}=this.props;return s.createElement(d.S.Context.Consumer,null,(o=>s.createElement(r.F.aside,(0,S._)((0,w._)({},(0,C.Ly)(e.view((0,Ze.Sw)(Xe.OP,Xe.bL)),t)),{"aria-label":o.toolbar.label,mount:n}),s.createElement(Me.A,{selectionEffect:v.z.Effect.collapse},i))))}}!function(e){e.Container=({children:e,mount:t})=>s.createElement(r.F.div,(0,S._)((0,w._)({},(0,C.Ly)(Xe.xQ,Xe.cB)),{mount:t}),e),e.Item=({children:e,order:t,className:i,ariaLabel:n,responsive:o=!1})=>s.createElement("section",(0,w._)({style:{zIndex:t},"aria-label":n},(0,C.Ly)(i,Xe.o0,o&&Xe.w3)),e),e.IconCounters=({counterTuple:e})=>s.createElement(r.F.div,null,e.view((0,o.flow)(g.map((e=>s.createElement($e.In.WordCounter,{key:e[0],className:Xe.Q0}))),g.toNullable))),e.Counters=({counterTuple:e})=>{const t=s.useContext(d.S.Context);return s.createElement(r.F.div,{className:Xe.LK},e.view((0,o.flow)(g.map((e=>s.createElement("div",{key:e[0],className:Xe.Ym},s.createElement("div",{className:Xe.kn},et(e,t)),s.createElement($e.In.TriangleArrow,{className:Xe.Le})))),g.toNullable)))};class t extends s.Component{componentDidMount(){this._subs.push(this.props.documentModel.checkingState.pipe(Je.p((e=>"idle"===e)),je.$(),Ne.K(this.props.documentModel.score),qe.z(this.props.documentModel.textInfo)).subscribe((([e,t])=>this._counters.set((0,o.pipe)(t,g.map((t=>({wordsCount:t.wordsCount,charsCount:t.charsCount,readingTime:t.readingTime,speakingTime:t.speakingTime,readabilityScore:(0,o.pipe)(e,g.map((()=>t.readabilityScore)))}))))))))}componentWillUnmount(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}render(){const{renderLabel:e,id:t,theme:i}=this.props,{footer:n}=this.context,r=a.s.combine(this._counters,this._currentCounter,((e,t)=>(0,o.pipe)(e,g.map((e=>[t,e[t]])))));return s.createElement(ze.W.DropdownLifted,{id:t,name:"footer-stats",placement:"top end",onAction:this._setCounter,selectionMode:"single",selectedKeys:(0,o.pipe)(this._currentCounter,u.T((e=>new Set([e])))),theme:i,"aria-label":r.view((0,o.flow)(g.map((e=>et(e,{footer:n}))),g.getOrElse((()=>"Statistics unavailable")))),label:e(r),items:a.s.combine(this._counters,this._currentCounter,((e,t)=>(0,o.pipe)(e,g.fold((()=>[]),(e=>Object.keys(e).map((i=>({type:i,key:i,isDisabled:tt(e,i),currentCounter:t,label:et([i,e[i]],this.context)}))))))))},(e=>s.createElement(ze.W.Item,{key:e.key,textValue:e.type},e.label)))}constructor(...e){super(...e),(0,Ge._)(this,"context",void 0),(0,Ge._)(this,"_subs",[]),(0,Ge._)(this,"_counters",a.s.create(g.none)),(0,Ge._)(this,"_currentCounter",this.props.settingsModel.footerCounterType),(0,Ge._)(this,"_setCounter",(e=>this.props.settingsModel.updateFooterCounterType(e)))}}(0,Ge._)(t,"contextType",d.S.Context),e.WordCounter=t,e.ResponsiveWordCounter=e=>{var{alignToEnd:i,renderLabel:n,renderCompactLabel:o}=e,a=(0,Ke._)(e,["alignToEnd","renderLabel","renderCompactLabel"]);const{rect:l,onMount:d}=c.R.useRectWatcher(),{rect:g,onMount:m}=c.R.useRectWatcher(),_=p.zV([l.pipe(h.oE),g.pipe(h.oE)]).pipe(u.T((([e,t])=>e.width<t.width)),L.Z(!1));return s.createElement(r.F.div,(0,w._)({mount:d},(0,C.Ly)(i?Xe.dx:Xe.AE)),s.createElement(t,(0,S._)((0,w._)({},a),{renderLabel:(...e)=>s.createElement(s.Fragment,null,s.createElement(r.F.div,(0,w._)({mount:m},(0,C.Ly)(Xe.xX,_.pipe(u.T((0,Ze.Sw)(Xe.vk,null))))),n(...e)),s.createElement(r.F.div,(0,C.Ly)(_.pipe(u.T((0,Ze.Sw)(null,Xe.vk)))),o(...e)))})))}}(it||(it={}));var nt=i(19967),st=i(14737),ot=i(41425),at=i(37099),rt=i(72404);const lt=JSON.parse('{"iE":"_3f5ee219-emotions-wrapper","Fn":"_0536cacd-emotions-primaryItemIcon","Y_":"_b3d009af-emotions-primaryItem _0536cacd-emotions-primaryItemIcon","tk":"_3c2f96cf-emotions-primaryItemWrapper","z8":"_2d80add7-emotions-report","qw":"_3e628060-emotions-reportItem","EW":"_b197dea7-emotions-reportItemEmoji _ed268e94-emotions-reportItemAttribute","jI":"_02fed82b-emotions-reportItemName _ed268e94-emotions-reportItemAttribute","Bk":"_f7e646ea-emotions-reportItemIntensity _ed268e94-emotions-reportItemAttribute","n0":"_daae9b4a-emotions-reportItemActions _ed268e94-emotions-reportItemAttribute","nH":"_6a026c7a-emotions-intensityItem","z9":"_926b0ef1-emotions-intensityColor","cJ":"_3cddd399-emotions-intensityNoColor","x6":"_1ca8451a-emotions-button","Nz":"_72398b9b-emotions-zeroStateTooltip"}'),dt=({view:e})=>{const{emogenie:{popup:{title:t,subtitle:i}}}=s.useContext(d.S.Context),{gnarSpec:n,pageId:a}=s.useContext(f.Y.Context);return s.useEffect((()=>{const t=e.subscribe((e=>{if(rt.H.View.isReport(e)){const t=e.primaryItem.name;n.emotionsPopupShow(t,a)}}));return()=>t.unsubscribe()}),[e,n,a]),s.createElement(r.F.Fragment,null,e.view((l=>rt.H.View.isReport(l)?s.createElement(ot.m,{key:"emogenie-dropdown",name:"emotions",align:"right",appearanceBehavior:"mouseHover",dontCloseOnClickInside:!0,theme:{dropdownList:lt.iE},onVisibilityChange:e=>{if(e){const e=l.primaryItem.name;n.emotionsPopupClick(e,a)}},label:s.createElement(r.F.Fragment,null,e.view((e=>e)).view((({primaryItem:e})=>s.createElement("div",{className:lt.tk},s.createElement(at.zT,{className:lt.Y_},e.emoji)))))},s.createElement(s.Fragment,null,s.createElement(U.H3,null,t),s.createElement(U.C6,null,i),s.createElement(r.F.div,{className:lt.z8},e.view((e=>e)).view((({primaryItem:e,secondaryItems:t})=>s.createElement(s.Fragment,null,s.createElement(ct,{item:e}),t.map((e=>s.createElement(ct,{item:e,key:e.name}))))))))):s.createElement(nt.$n.Ghost,{name:"emogenie-zero",disabled:!0,title:(0,o.pipe)(l.tooltipText,g.map((e=>s.createElement("div",{className:lt.Nz},e))),m.y0)},s.createElement($e.In.NoTone,{className:lt.Fn})))))},ct=({item:e})=>s.createElement("div",{className:lt.qw},s.createElement(at.zT,{className:lt.EW},e.emoji),s.createElement(U.C6,{className:lt.jI},e.name),s.createElement(pt,{className:lt.Bk,intensity:e.intensity,caption:e.intensityCaption}),s.createElement("div",{className:lt.n0},s.createElement(nt.$n.Ghost,{className:lt.x6,animationMode:st.g.None,title:e.actions.like.tooltip,name:e.actions.like.name,onClick:e.actions.like.handler,disabled:e.actions.like.disabled,active:e.actions.like.active},s.createElement($e.In.VotedUp,null)),s.createElement(nt.$n.Ghost,{className:lt.x6,animationMode:st.g.None,disabled:e.actions.dislike.disabled,title:e.actions.dislike.tooltip,name:e.actions.dislike.name,onClick:e.actions.dislike.handler,active:e.actions.dislike.active},s.createElement($e.In.VotedDown,null)))),pt=({intensity:e,caption:t,className:i})=>s.createElement("span",{className:i},s.createElement(M.m_,{title:t,align:"topCenter"},s.createElement("span",null,rt.H.intensitiesOrder.map((t=>s.createElement("span",(0,w._)({key:t},(0,C.Ly)(lt.nH,t<=e?lt.z9:lt.cJ)))))))),ht=JSON.parse('{"DG":"_d2767f2d-formatting-toolbar-rtfDisabled","_z":"_022927cb-formatting-toolbar-rtfTooltip","mD":"_0495527e-formatting-toolbar-rtfDisabledMessage"}'),ut=()=>{const{footer:{rtfCompatibilityInfo:e}}=s.useContext(d.S.Context),{gnarSpec:t,pageId:i}=s.useContext(f.Y.Context);return s.useEffect((()=>{t.rtfCompatibilityViewBlockShow(i)})),s.createElement(U.Oc,{className:ht.mD},s.createElement(at.zT,null,e.message.plainText),s.createElement(M.m_,{align:"topCenter",title:s.createElement("div",{className:ht._z},e.tooltip)},s.createElement("span",{className:ht.DG},e.message.textWithTooltip)),".")};var gt,mt=i(73566),_t=i(29009);!function(e){e.isTitleInput=function(e){return Boolean(e)&&e.dataset.name===n.HEADER_TITLE_INPUT_NAME},e.Component=({denaliEditor:e,documentModel:t,settingsModel:d,formattingViewModel:m,emotionsViewModel:v,viewportPadding:y,navigationViewModel:b,features:w})=>{const S=s.useContext(l.q.Context),C=s.useContext(f.Y.Context),{ref:M,onMount:E}=c.R.useElWatcher(),k=a.s.create(g.none);return c.R.useSubscriptionTo(p.zV([k,M.pipe(h.oE),S]).pipe(u.T((([e,t])=>y.set({top:t.offsetHeight,bottom:(0,o.pipe)(e,g.fold((()=>0),(e=>e.offsetHeight)))}))))),s.createElement(r.F.div,{className:Ce.toolbarWrapperTier},_.UI.mount(We.UI,We.Flow(n.create(t,e,S,b.state.view("isSidebarOpen"),C),E,w)),s.createElement(r.F.div,{className:Ce.toolbarContainer},s.createElement(i,{footerEl:k,formattingViewModel:m,documentModel:t,settingsModel:d,emotionsViewModel:v,navigationViewModel:b})))};const t=b.B.createComponent({component:it.Container,section:b.B.create(b.B.Id.formatting)}),i=({footerEl:e,navigationViewModel:i,formattingViewModel:n,documentModel:a,settingsModel:l,emotionsViewModel:d})=>s.createElement(it,{className:_t.k7,mount:t=>e.set(g.fromNullable(t)),isSidebarOpen:i.state.view("isSidebarOpen")},s.createElement(t,null,s.createElement(w,{rtfMode:a.rtfMode,toolbarViewModel:(0,o.pipe)(n,g.map((({toolbarViewModel:e})=>e)))}),s.createElement(it.Item,{className:Ce.wordCounter,order:2,responsive:!0},s.createElement(it.ResponsiveWordCounter,{id:"big-word-counter",alignToEnd:a.rtfMode!==y.l1.FormattingMode.off,theme:{button:Ce.dropdownContainer,list:a.rtfMode!==y.l1.FormattingMode.off?Ce.dropdownListLeft:Ce.dropdownListRight},documentModel:a,settingsModel:l,renderLabel:e=>s.createElement(it.Counters,{counterTuple:e}),renderCompactLabel:e=>s.createElement(it.IconCounters,{counterTuple:e})})),s.createElement(r.F.Fragment,null,(0,o.pipe)(d,g.map((e=>s.createElement(it.Item,{className:Ce.footerEmotions,order:2},s.createElement(dt,{view:e.visualState})))),m.Xd)))),w=({rtfMode:e,toolbarViewModel:t})=>{const{withSelectionEffect:i}=s.useContext(v.z.Context),n=s.useContext(d.S.Context),a=i(v.z.Effect.PlainContainer,v.z.Effect.resetAsap),r=e===y.l1.FormattingMode.compatibility;return s.createElement(s.Fragment,null,r?s.createElement(it.Item,{order:0},s.createElement(ut,null)):(0,o.pipe)(t,g.fold(o.constNull,(e=>s.createElement(it.Item,{className:Ce.formattingShiftedLeft,order:0,ariaLabel:n.toolbar.formatting.head},s.createElement(a,null,s.createElement(mt.NI,{viewModel:e})))))))}}(gt||(gt={}))},92723:(e,t,i)=>{i.d(t,{A:()=>d,j:()=>l});var n=i(50659),s=i(19840),o=i(91177),a=i(61098),r=i(29009);const l=({position:e,children:t,className:i})=>{const o="top"===e;return n.createElement("div",(0,s.Ly)(r.kL,i),n.createElement("div",{className:r.ms},n.createElement("div",{className:o?r.GO:r.T$},n.createElement("div",{className:o?r.sN:r.zT},t))))},d=({children:e,selectionEffect:t})=>{const{withSelectionEffect:i}=n.useContext(a.z.Context),s=i(o._,t);return n.createElement(s,{theme:{editorContent:r.o7,editorContentWrap:r.kX}},e)}},78254:(e,t,i)=>{i.d(t,{TX:()=>fn,aH:()=>vn,Ss:()=>mn});var n=i(23988),s=i(10334),o=i(17171),a=i(50659),r=i(84647),l=i(80074),d=i(19840),c=i(87574),p=i(60575),h=i(26228),u=i(80926),g=i(14973),m=i(62597),_=i(12061),v=i(19772),f=i(89769),y=i(6987),b=i(36094),w=i(90405),S=i(15491),C=i(65141),M=i(21662),E=i(78339),k=i(82315),T=i(65390),x=i(66202),I=i(61098),A=i(16721),F=i(74056),V=i(5731),L=i(86780),N=i(41548),R=i(76005),O=i(35098),U=i(76099),B=i(92391),P=i(51707),D=i(89011),H=i(12070),W=i(95168),G=i(71010),K=i(68594),z=i(93712),$=i(21216),J=i(60269),j=i(40027),q=i(74168),Y=i(62822),Z=i(98814),Q=i(11298),X=i(50581),ee=i(36840);class te{constructor(e,t){(0,n._)(this,"_ded",void 0),(0,n._)(this,"_env",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"state",void 0),this._ded=e,this._env=t,this._log=p.Bx.Logging.root.getLogger("GraySelection"),this.state=this._ded.isEditorFocused.pipe(y.n((0,ee.Sw)($.of(!1),J.h(this._ded.contentUpdated.pipe(j.Z(50)),q.L5.pipe(j.Z(50))).pipe(f.Z(b.al()),Y.u(!0)))),y.n((e=>{return e?$.of((0,r.pipe)(this._ded.getSelectionRect(),x.chain((t=this._env.has(z.OH.Flag.supportsMixBlendMode),e=>(0,r.pipe)(e.getRect(),x.map((({clientRects:e,rootClientRect:t})=>e.map((e=>X.absToRelative(e,t))))),x.map((e=>e.map((e=>({top:e.top,left:e.left,width:Math.max(e.width,2),height:e.height,zIndex:t?"inherit":"-1",mixBlendMode:t?"darken":"inherit"})))))))),T.fromEither)):$.of(T.none);var t})),W.M((e=>{T.isSome(e)&&!document.hasFocus()&&(0,r.pipe)(Z.C(),x.mapLeft((e=>{this._log.info("Cannot collapse selection",e)})))})),Q.u())}}var ie=i(19101);const ne=({ded:e})=>{const t=a.useContext(z.OH.Context);return a.createElement(c.F.Fragment,null,new te(e,t).state.pipe(S.T((e=>a.createElement(a.Fragment,null,(0,r.pipe)(e,T.fold((()=>null),(e=>e.map(((e,t)=>a.createElement("div",{"data-name":"gray-selection",key:`gray-selection-${t}`,style:e,className:ie.UH}))))))))),f.Z(null)))};var se=i(46669),oe=i(54988),ae=i(60946),re=i(38427),le=i(83541),de=i(58347),ce=i(58193),pe=i(54610);const he=(e,t)=>{const i={root:e,rootMargin:"0px",threshold:[0,1]};return q.ht(t,i).pipe(E.p(ee.z2),S.T((e=>1!==e[0].intersectionRatio)),f.Z(t.offsetHeight>e.offsetHeight))};class ue{constructor(){(0,n._)(this,"_log",p.Bx.Logging.getLogger("DocumentView")),(0,n._)(this,"_nativeScrollbarState",(0,r.pipe)(X.Scrollbar.getState(),x.getOrElse((e=>(this._log.error("Cannot get scrollbar width",e),X.Scrollbar.UNKNOWN_SCROLLBAR))))),(0,n._)(this,"detector",l.s.create(T.none)),(0,n._)(this,"target",l.s.create(T.none)),(0,n._)(this,"_xssWindowSize",q.sc(document.body).pipe(S.T((e=>e.width<=pe.v.navigationHideWidthThreshold)),se.F(),f.Z(!1))),(0,n._)(this,"_visible","visible"===this._nativeScrollbarState.type?l.s.combine(this.target,this.detector,ce.fP(he)).pipe(y.n(T.fold((()=>oe.w),r.identity)),ae.g($.of(!0))):l.s.create(!0)),(0,n._)(this,"width",re.zV([this._visible,this._xssWindowSize]).pipe(S.T((([e,t])=>!t&&e?this._nativeScrollbarState.width:0)),f.Z(0),le.shareReplay({bufferSize:1,refCount:!0}))),(0,n._)(this,"scrollTop",this.target.pipe(w.oE,y.n((e=>C.R(e,"scroll").pipe(de.B(50),S.T((e=>e.target.scrollTop))))),f.Z(0))),(0,n._)(this,"fakeWidth",this._xssWindowSize.pipe(S.T((e=>e||"hidden"!==this._nativeScrollbarState.type?0:this._nativeScrollbarState.width))))}}var ge=i(96504),me=i(90334),_e=i(65873),ve=i(37107),fe=i(92444),ye=i(11864),be=i(27199);const we={color:be.Q1.CoreNeutral50},Se={borderBottom:`1px solid ${be.Q1.CoreNeutral30}`,cursor:"pointer",pointerEvents:"auto"},Ce=ye.Ks.stylesheet({placeholder:[we],hiddenPlaceholder:[{display:"none"}],label:[Se],input:[{display:"none"}]}),Me=({viewModel:e,className:t})=>a.createElement(c.F.div,(0,d.Ly)(t,_e.iF.paper,e.visible.pipe(S.T((0,ee.Sw)(Ce.placeholder,Ce.hiddenPlaceholder))),e.size.view(ve.Z4.match("",fe.x.bigSize))),e.strings.typeOrPasteText,(0,r.pipe)(e.uploadSection,T.fold((()=>null),(t=>a.createElement(a.Fragment,null,a.createElement("label",{className:Ce.label},e.strings.upload,a.createElement("input",{className:Ce.input,onChange:({target:e})=>e.files&&t.upload(e.files),type:"file",accept:t.uploadInputAccept})))))),e.strings.ending);var Ee=i(91283),ke=i(96955),Te=i(3202),xe=i(82541),Ie=i(92802),Ae=i(53651),Fe=i(12783),Ve=i(34980),Le=i(97390),Ne=i(80159),Re=i(65621),Oe=i(41797),Ue=i(45653),Be=i(86562),Pe=i(55638),De=i(80548),He=i(83531),We=i(66799),Ge=i(17772),Ke=i(86922),ze=i(19967),$e=i(10486);const Je=JSON.parse('{"iE":"_fc36500a-vbars-wrapper","h_":"_c2ea3f61-vbars-description","cG":"_2386cde3-vbars-feedbackInput","oB":"_6ff7ea12-vbars-feedbackPopupBody","F1":"_ff8c6c8f-vbars-feedbackPopupFooter"}'),je=()=>{const e=a.useContext(g.aF.TitleIdContext);return a.createElement(_e.H1,{id:e},"Give Feedback")},qe=({submitFeedback:e,close:t,visible:i,ModalsPortal:n})=>{const s=l.s.create(""),{writingExpert:o}=a.useContext(Ke.S.Context);return a.createElement(n,null,a.createElement(g.hJ,{positionType:"fixed",visible:i,preventClose:!0,animate:!0},a.createElement(g.aF,{className:Je.iE},a.createElement(g.aF.Header,null,a.createElement(je,null)),a.createElement(g.aF.Body,{className:Je.oB,name:"feedbackBody"},a.createElement(_e.P1,{className:Je.h_},o.feedback.description),a.createElement($e.fs,{placeholder:"Type your feedback",className:Je.cG,value:s}),a.createElement(_e.C6,null,o.feedback.instructions)),a.createElement(g.aF.Footer,{className:Je.F1},a.createElement(ze.$n.Ghost,{name:"cancel",onClick:t},o.feedback.cancel),a.createElement(ze.$n.Primary,{name:"send",disabled:s.view((e=>""===e)),onClick:()=>e({detailed:s.get()})},o.feedback.send)))))},Ye=(e,t)=>{return{feedbackModalSubmit:(i=(0,He._)((function*({detailed:i}){return e.next({type:Ne.G.Type.feedbackModalSubmit,feedback:i,alertId:t,source:We.U3.UnderlineWithTeaser})})),function(e){return i.apply(this,arguments)}),feedBackModalClose:()=>e.next({type:Ne.G.Type.feedbackModalClose}),teaserMount:()=>e.next({type:Ne.G.Type.looked,kind:"teaser",alertId:t}),teaserDismiss:()=>e.next({type:Ne.G.Type.ignored,alertId:t,subtype:We.U3.UnderlineWithTeaser}),teaserExpand:()=>e.next({type:Ne.G.Type.teaserExpand,alertId:t})};var i},Ze=({isExpanded:e,children:t,events:i,ModalsPortal:n,alert:s,feedbackModalVisible:o,placement:l})=>{const d=Ye(i,s.id);return a.createElement(a.Fragment,null,a.createElement(c.F.Fragment,null,b.wd(o)(a.createElement(qe,{alert:(0,r.unsafeCoerce)(s),ModalsPortal:n,visible:o,submitFeedback:d.feedbackModalSubmit,close:d.feedBackModalClose}),null)),a.createElement(Ge.f,{text:s.miniCardTitle,onMount:d.teaserMount,onDismiss:d.teaserDismiss,onExpand:d.teaserExpand,placement:l,state:e.pipe(S.T((e=>e?"expanded":"visible")))},t))};var Qe=i(56488),Xe=i(72763);const et=8;function tt(e,t,i){const n=a.useRef(null),[d]=a.useState((()=>l.s.create({visibility:"visible",position:{top:0,left:0},direction:"down"}))),c=a.useContext(O.L.Context),[p]=a.useState((()=>re.zV([c.pipe(S.T((e=>e.rect))),i,d.pipe(E.p((({visibility:e})=>"visible"===e)))]).pipe(W.M((([e,i])=>((e,i)=>{const a=n.current;a&&function(e,t,i,n,a){(0,r.pipe)(e,T.map((({abs:e,relative:r})=>{const l=t.offsetHeight,d=function(e,t,i,n,s){const o=e.height+e.top+n;switch(s){case"up":return e.top-n>i.top?"up":"down";case"down":return o>i.height+i.top&&t.height<i.height?"up":"down";default:(0,Be.xb)(s)}}(e,r,i,l,a);n.modify((e=>(0,o._)((0,s._)({},e),{direction:d,position:{top:"up"===d?r.top-l-et:r.top+r.height,left:r.left}})))})))}(t,a,e,d,i)})(e,i))))));return v.R.useSubscriptionTo(p),a.useEffect((()=>{switch(e){case"removed":d.modify((e=>(0,o._)((0,s._)({},e),{visibility:"invisible"})));break;case"added":requestAnimationFrame((()=>d.modify((e=>(0,o._)((0,s._)({},e),{visibility:"visible"})))));break;default:(0,Be.xb)(e)}}),[e,d]),{_el:n,_state:d}}const it=({card:e,position:t,mode:i,name:n,placement:o,onMouseEnter:r=ee.Yi,onMouseLeave:l=ee.Yi})=>{a.useEffect((()=>{"added"===i&&l()}),[i]);const p={onMouseEnter:r,onMouseLeave:l,"data-name":n},{_el:h,_state:u}=tt(i,t,o);return a.createElement(c.F.div,(0,s._)({tabIndex:-1,mount:e=>h.current=e,style:u.view("position")},(0,d.Ly)(Xe.YI.container,u.view((({visibility:e,direction:t})=>((e,t)=>X.classes((e=>{switch(e){case"invisible":return Xe.YI.invisible;case"visible":return Xe.YI.visible;default:return(0,Be.xb)(e)}})(e),"up"===t&&Xe.YI.directionUp))(e,t)))),p),u.view("direction").view(e))},nt=(e,t,i)=>{const{key:n,card:s,onMouseEnter:o,onMouseLeave:l,name:d,isExpanded:c}=t(e),p=function(e,t){return"added"===t?(0,r.pipe)(e.rect,Ve.W.relativeAndAbs,T.fromNullable):T.some({abs:X.Rect.empty,relative:X.Rect.empty})}(i,e),h=c.pipe(S.T((e=>Ue.A.isWritingExpertWithTeaser(i.alert)&&!e?"up":"down")));return a.createElement(it,{key:n,position:p,mode:e,card:s,name:d,onMouseEnter:o,onMouseLeave:l,placement:h})},st=(0,ee.Bj)(((e,t,i)=>(p.Bx.Logging.getLogger("InlineCardView.inlineCardProps").warn(e,{reason:t,alert:i}),e))),ot=a.memo((({className:e,inlineCardVM:t,sduiInlineCardVM:i,features:n,modalsPortal:l})=>{const d=a.useMemo((()=>Le.e.emptyWithName("inline-card")),[]);return a.createElement(Le.e.Context.Provider,{value:d},a.createElement(c.F.div,{className:e},function(e,t,i,n,a){return(0,r.pipe)(t.state,w.cy((e=>(0,r.pipe)(Oe.H(e.getMarkRect()),W.M(x.mapLeft((t=>console.error("Could not get mark rect",{error:t,entry:e})))),S.T(T.fromEither),S.T(T.map((t=>(0,o._)((0,s._)({},e),{rect:t}))))))),f.Z(T.none),Re.J(),W.M((([e,t])=>T.isNone(t)&&a&&a())),S.T((([s,o],a)=>[(0,r.pipe)(s,T.map((s=>nt("removed",e({viewModel:t,entry:s,sdui:i,features:n,index:a}),s))),T.toNullable),(0,r.pipe)(o,T.map((s=>nt("added",e({viewModel:t,entry:s,sdui:i,features:n,index:a}),s))),T.toNullable)])),f.Z(null))}((e=>({viewModel:t,entry:i,sdui:n,index:l})=>d=>{const p="added"===d?l+1:l,h=De.k.DATA_NAME,u=(0,r.pipe)(n,y.n((e=>(0,r.pipe)(e.getInlineItemForAlert(i.alert.id),f.Z(x.left(Pe.Jr.NoSDUIReason.Initial)),Re.J(),E.p((([e,t])=>{return n=e,s=t,!(x.isLeft(n)&&x.isLeft(s))||(e=>"removed"===e?r.constFalse:(0,Ie.AU)(Ue.A.isLockedUIAlert))(d)(i.alert);var n,s})),S.T((([e,t])=>(0,r.pipe)(t,x.alt((()=>e))))),S.T(x.map((t=>({item:t,vm:e}))))))),S.T((e=>(0,r.pipe)(e,x.chain((e=>T.isNone(Ee.cK.findFirst(e.item.content,"nativeInlineCardContent"))?x.right(e):x.left(Pe.Jr.NoSDUIReason.NativeInlineCardContent))),x.fold((e=>{switch(e){case Pe.Jr.NoSDUIReason.Initial:case Pe.Jr.NoSDUIReason.EmptyStateOnReconnect:return null;case Pe.Jr.NoSDUIReason.RemovedFromCAPIMapping:case Pe.Jr.NoSDUIReason.IdNotResolved:case Pe.Jr.NoSDUIReason.NotFound:case Pe.Jr.NoSDUIReason.NativeInlineCardContent:return st(`Cannot render an inline card: ${Ue.A.isWritingExpert(i.alert)?"Writing Expert":i.alert.patternName}`,e,i.alert),null;default:return(0,Be.xb)(e)}}),(({item:e,vm:t})=>a.createElement(Qe.GN,{viewModel:t,item:e,highlightIndex:i.highlightIndex,events:t.events,designSystem:(0,o._)((0,s._)({},ke.J),{icon:(0,o._)((0,s._)({},Te.s),{[xe.yg.GButtonSmall]:e=>a.createElement(Ae.I,{icon:Fe.c,accessibilityLabel:"Open in Grammarly",className:Xe.YI.inlineCardUpdatedLogo})})})})))))));return{key:p,card:n=>Ue.A.isWritingExpertWithTeaser(i.alert)?a.createElement(Ze,{events:t.events,alert:i.alert,ModalsPortal:e,feedbackModalVisible:t.feedbackModalOpen,placement:n,isExpanded:t.teaserExpanded},u):a.createElement(c.F.Fragment,null,u),onMouseEnter:()=>t.events.next({type:Ne.G.Type.hovered}),onMouseLeave:()=>t.events.next({type:Ne.G.Type.unhovered}),name:h,isExpanded:t.teaserExpanded}})(l),t,i,n,(()=>t.events.next({type:Ne.G.Type.closed})))))}));var at=i(27917),rt=i(96011),lt=i(87275),dt=i(49470),ct=i(22835),pt=i(35426),ht=i(40884),ut=i(81930),gt=i(60083);class mt extends a.Component{componentDidMount(){const{theme:e,state:t}=this.props;this._subs.push(this._state.pipe(Re.J(),S.T((([t,i])=>(0,r.pipe)(i,T.fold((()=>(0,r.pipe)(t,T.fold((()=>{throw new Be.zU("Cannot animate sidebar loader from None to None")}),(t=>{switch(t){case gt.x.Type.checkingOut:return[e.checkingOutEnd+" "+e.hideEnd];case gt.x.Type.checkingIn:return[e.checkingInEnd+" "+e.hideEnd];case gt.x.Type.checking:return[e.hideStart,e.hideEnd];default:return(0,Be.xb)(t)}})))),(i=>{switch(i){case gt.x.Type.checkingOut:return(0,r.pipe)(t,ce.gR(gt.x.Type.checkingIn))?[e.checkingOutEnd]:T.isNone(t)?[e.hideEnd]:[e.checkingOutStart,e.checkingOutEnd];case gt.x.Type.checkingIn:return(0,r.pipe)(t,ce.gR(gt.x.Type.checkingOut))?[e.checkingInEnd]:(0,r.pipe)(t,ce.gR(gt.x.Type.checking))?[]:[e.checkingInStart,e.checkingInEnd];case gt.x.Type.checking:return[e.checkingStart,e.checkingEnd];default:return(0,Be.xb)(i)}}))))),y.n((e=>ut.X.rafSequence(e,!0)))).subscribe(b.H9(this._classes)),t.subscribe((e=>{this._state.set(e),null===this._content.get()&&T.isSome(e)&&this._content.set(this.props.children)})),t.pipe(y.n((()=>le.timer(500)))).subscribe(this._onTransitionEnd))}componentWillUnmount(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}render(){return a.createElement(c.F.div,{"data-role":"loader-content",key:"content",className:this._classes,mount:e=>e&&(this._el=e),onTransitionEnd:e=>e.target===this._el&&this._onTransitionEnd()},this._content)}constructor(...e){super(...e),(0,n._)(this,"_subs",[]),(0,n._)(this,"_el",void 0),(0,n._)(this,"_classes",l.s.create("")),(0,n._)(this,"_state",l.s.create(T.none)),(0,n._)(this,"_content",l.s.create(null)),(0,n._)(this,"_onTransitionEnd",(()=>{const e=this._state.get();(0,r.pipe)(e,ce.gR(gt.x.Type.checkingOut))&&this._state.set(T.none),T.isNone(e)&&this._content.set(null)}))}}var _t=i(97291),vt=i(16117),ft=i(63967),yt=i(74416),bt=i(84714),wt=i(30186),St=i(83288),Ct=i(48732),Mt=i(944);const Et=({lensPreviewVM:e,navigationViewModel:t,features:i,slots:n})=>{const{gnarSpec:s,pageId:o}=a.useContext(A.Y.Context),r=a.useContext(Ke.S.Context),d=t.state.view("isSidebarOpen"),p=i.isFree.get(),h=i.isSmartPlagiarismUphookEnabled,u=t.activeLensId.view(m.J.isPlagiarismId),g=()=>{t.events.next({type:"switchToLens",id:m.J.SpecialId.Plagiarism,focusFirst:!0,actionSource:ft.Kz.sidebar}),s.plagiarismButtonClick(o,d.get()?"wiritingAssistant":"writingMode"),i.assignSmartPlagiarismUphookExperiment()},_=e=>"disabled"===e.kind&&e.reason===bt.GJ.EmptyDocument,v=e.getLens(m.J.SpecialId.Plagiarism).view("percentile").view(yt.Q.fromRatio),f=a.createElement(c.F.Fragment,null,l.s.combine(u,v,((e,s)=>{const o=(0,wt.c)(St.geq(yt.Q.ord))(s),l=!yt.Q.isMin(s),c=o(yt.Q.fromNumber(5)),m=p&&h&&(l&&e||c),f=m?`${r.plagiarism.title} detected`:i.denali.isAiDetectorEnabled?r.plagiarism.titleAriaLabelWithAiDetectorVariant:r.plagiarism.titleAriaLabel;return a.createElement(Ct.C,{onClick:g,name:"plagiarism",isActive:u,isDisabled:t.documentActions.view((e=>e.plagiarism)).view(_),tooltipAlignment:"left",tooltip:t.documentActions.view((e=>e.plagiarism)).view((e=>i.denali.isAiDetectorEnabled?(0,ee.Sw)(r.documentActions.plagiarism.tooltip.emptyDocumentWithAiDetectorVariant,r.documentActions.plagiarism.tooltip.availableWithAiDetectorVariant)(_(e)):(0,ee.Sw)(r.documentActions.plagiarism.tooltip.emptyDocument,r.documentActions.plagiarism.tooltip.available)(_(e)))),title:d.view(i.denali.isAiDetectorEnabled?(0,ee.Sw)(r.plagiarism.titleWithAiDetectorVariant,a.createElement(a.Fragment,null)):(0,ee.Sw)(r.plagiarism.title,"")),"aria-label":f,className:d.view((0,ee.Sw)(ye.Ks.joinClasses([i.denali.isAiDetectorEnabled?Mt.hj:Mt.yZ,Mt.Eb]),Mt.ES))},m?a.createElement(at.In.PlagiarismOutcomeActive,{className:d.view((0,ee.Sw)(ye.Ks.joinClasses([Mt._B,Mt.j_]),Mt.gE)),key:"plagiarism-active-icon"}):p||!e||i.denali.isAiDetectorEnabled?a.createElement(at.In.PlagiarismOutcomes,{className:d.view((0,ee.Sw)(ye.Ks.joinClasses([Mt._B,Mt.j_]),Mt.gE)),key:"plagiarism-icon"}):n.PlagiarismCounter(v))})));return a.createElement(c.F.Fragment,null,t.documentActions.view((e=>{return a.createElement(c.F.div,{className:d.view((0,ee.Sw)(Mt.K0,Mt.h6))},i.denali.isLockedUIEnabled?null:a.createElement(c.F.Fragment,null,a.createElement(kt,{navigationViewModel:t,isSidebarOpen:d}),d.view((e=>e&&a.createElement("div",{className:Mt.pf})))),("available"===(s=e.proofit).kind||s.reason!==bt.M7.NotAvailable)&&a.createElement(c.F.Fragment,null,a.createElement(n.ProofitButton,null),d.view((e=>e&&a.createElement("div",{className:Mt.pf})))),(e=>"available"===e.kind||e.reason===bt.GJ.EmptyDocument)(e.plagiarism)&&f);var s})))},kt=({isSidebarOpen:e,navigationViewModel:t})=>{const i=()=>{t.events.next({type:"switchToLens",id:m.J.SpecialId.Premium,focusFirst:!0,actionSource:ft.Kz.sidebar})},n=e.view((0,ee.Sw)(Ct.m,xt));return a.createElement(c.F.Fragment,null,n.view((e=>a.createElement(e,{id:m.J.SpecialId.Premium,name:"lens-premium",activeLensId:t.activeLensId,data:t.premiumButtonData,onClick:i}))))},Tt={counterWrapper:Mt.xo,counterContent:Mt.X6},xt=({id:e,data:t,name:i,onClick:n})=>a.createElement(c.F.Fragment,null,t.view((0,r.flow)(T.map((t=>a.createElement(Ct.C,{className:Mt.Sn,id:e,key:t.id,name:i,onClick:n},a.createElement(c.F.Fragment,null,t.alerts.view((e=>a.createElement(vt.Q.OutcomeCounter,{theme:Tt,count:e}))))))),T.toNullable))),It={opacity:1},At=ye.Ks.stylesheet({baseNavigationLoader:[It],checkingInStart:[ge.hF,It],checkingInEnd:[ge.vY,It],checkingOutStart:[ge.$3,It],checkingOutEnd:[ge.F_,It],checkingStart:[{opacity:.99}],checkingEnd:[{opacity:1,transition:"opacity .01s"}],hideStart:[{pointerEvents:"none"}],hideEnd:[{opacity:0,transition:"opacity .01s",pointerEvents:"none"}]});var Ft=i(1884),Vt=i(13607),Lt=i(95366),Nt=i(57014);const Rt={overflowY:"hidden"},Ot={marginLeft:ye.Ks.rem(-4),paddingLeft:ye.Ks.rem(4),height:ye.Ks.percent(100)},Ut={zIndex:Vt.do},Bt={background:be.Q1.CoreNeutral0,color:be.Q1.CoreNeutral90},Pt={width:ye.Ks.rem(Vt.xS),boxShadow:Lt.c.z100,$nest:{[Nt.$U.xs]:{width:ye.Ks.rem(Vt.wn)}}},Dt={boxShadow:"0px 0px 0px 1px rgba(0, 0, 0, .05), 0px 1px 3px rgba(0, 0, 0, .15)"},Ht={marginTop:ye.Ks.rem(-4),paddingTop:ye.Ks.rem(4),height:`calc(100% + ${ye.Ks.rem(4)})`,boxShadow:"none"},Wt={padding:ye.Ks.rem(1)},Gt={zIndex:Vt.do},Kt={position:"relative",zIndex:Vt.do,display:"grid",gridTemplateRows:"auto auto 5fr auto",width:ye.Ks.rem(Vt.xS),height:ye.Ks.vh(100),$nest:{[Nt.$U.xs]:{width:ye.Ks.rem(Vt.wn)},[Nt.$U.maxWidth(pe.v.navigationHideWidthThreshold)]:{"& > *":{paddingRight:ye.Ks.rem(1)}}}},zt=ye.Ks.stylesheet({mainWrapper:[Kt],fullHeightLoaderNavigation:[Rt],fullHeightLoader:[Rt,Ot],navigationWrapper:[Ut],navigationWrapperHidden:[{width:0,pointerEvents:"none"}],navigationLoaderWrapper:[Ut,{position:"absolute",right:0}],oggyWrapper:[Bt,Pt,Dt],oggyLoaderWrapperNoShadow:[Bt,Pt,Ht,Wt,{boxShadow:"none"}],oggyNarrowWrapper:[Bt,Pt,Gt,Dt]});class $t extends rt.kp{}function Jt(e,t){var i;return e&&e.isSidebarOpen!==t.isSidebarOpen&&t.navigationSource!==lt.nl.forceSidebar?(null===(i=e)||void 0===i?void 0:i.isSidebarOpen)?{prev:{start:{base:ge.vF.navigationLeaveRightStart},end:{base:ge.vF.navigationLeaveRight}},next:{start:{},end:{}}}:{prev:{start:{},end:{}},next:{start:{base:ge.vF.navigationEnterLeftStart},end:{base:ge.vF.navigationEnterLeft}}}:{prev:{start:{},end:{}},next:{start:{},end:{}}}}function jt({navigationViewModel:e,children:t}){const{ref:i,onMount:n}=v.R.useElWatcher(),o=e.state.view("isSidebarOpen");return v.R.useSubscriptionTo((0,r.pipe)(i,w.oE,y.n((t=>e.state.view("isSidebarOpen").pipe(W.M((e=>e?t.removeAttribute("inert"):t.setAttribute("inert","true")))))))),a.createElement($t,{state:e.state.pipe(se.F(((e,t)=>e.isSidebarOpen===t.isSidebarOpen))),stateToClassMapper:Jt,onMount:n,className:b.wd(o)(zt.navigationWrapper,zt.navigationWrapperHidden)},(({state:e,view:i})=>e.isSidebarOpen?a.createElement(c.F.div,(0,s._)({key:"sidebar","data-name":"oggy-wrapper"},(0,d.Ly)(i.pipe(S.T((e=>e.base))),o.view((e=>e?zt.oggyWrapper:zt.oggyNarrowWrapper)))),t):null))}!function(e){e.Loader=({baseLoaderClass:e,state:t})=>a.createElement(mt,{state:t.view("navigation"),theme:At},a.createElement(c.F.div,(0,d.Ly)(zt.navigationLoaderWrapper,e),a.createElement(c.F.div,{className:t.view("lens").view(T.fold((()=>zt.fullHeightLoader),(e=>e===gt.x.Type.checkingOut?zt.fullHeightLoaderNavigation:zt.fullHeightLoader)))},a.createElement("div",{className:zt.oggyLoaderWrapperNoShadow},a.createElement(_t.Be,null))))),e.Content=({denaliViewModels:{lensPreviewViewModel:e,cheetahViewModel:t,navigationViewModel:i,documentLoader:n},documentModel:s,modalManager:o,features:r,slots:l})=>a.createElement(c.F.div,{className:zt.mainWrapper},a.createElement(Ft.gq,{documentModel:s,isIdle:n.state.view(gt.x.State.isIdle),modalManager:o,navigationViewModel:i,cheetahViewModel:t,features:r}),a.createElement("div",{style:{height:"100%"}}),i.state.view("isSidebarOpen").view((0,ee.Sw)(a.createElement(Et,{lensPreviewVM:e,features:r,navigationViewModel:i,slots:l}),null)))}(jt||(jt={}));var qt=i(39902),Yt=i(20015),Zt=i(38908),Qt=i(79025);const Xt=JSON.parse('{"aN":"_1f1d41d9-sidebar-sidebarHeader","GI":"_7d9b9794-sidebar-togglerWrapper","yi":"_cebc0093-sidebar-overviewBtnOggy"}'),ei=({navigationViewModel:e})=>{const{gnarSpec:t,pageId:i}=a.useContext(A.Y.Context),n=a.useContext(Ke.S.Context);return a.createElement("div",{className:Xt.yi},a.createElement(qt.$,{accessibilityLabel:"Hide assistant panel",variant:"tertiary",onClick:()=>{e.events.next({type:"toggleSidebar",actionSource:ft.Kz.sidebar}),t.assistantCloseButtonClick(i,lt.Ir.fromLensId(e.activeLensId.get()))},text:Zt.ZH(n.hideAssistant.toLocaleLowerCase()),iconEnd:Yt.R}))},ti=({documentModel:e,features:t,navigationViewModel:i})=>a.createElement(c.F.div,{className:Xt.aN},i.state.view("isSidebarOpen").view((n=>n?a.createElement(ei,{key:"hide-assistant",navigationViewModel:i}):a.createElement("div",{"data-name":"toggler",key:"toggle-wrapper",className:Xt.GI},a.createElement(Qt.v,{documentModel:e,features:t,navigationViewModel:i})))));var ii,ni,si=i(35384),oi=i(7662),ai=i(91956),ri=i(69779),li=i(11089);!function(e){const t=e=>X.Guardians.isButton(e)&&"button"===e.type&&e.className.startsWith("button_"),i=e=>{var t;return Boolean(null===(t=e.dataset.name)||void 0===t?void 0:t.includes("button:"))},n=e=>(0,ri.pipe)(e,T.chain((e=>e.dataset.testid&&/^\d+_F#S_suggestion@Long$/.test(e.dataset.testid)?T.some(e):(0,ri.pipe)(e.parentElement,T.fromNullable,n))));e.create=()=>{let e=T.none;return{strategy:s=>(0,ri.pipe)(s.querySelector("input"),T.fromNullable,T.fold((()=>(0,ri.pipe)(s,li.a.FocusStrategy.focusByPredicate(i),(i=>s=>(0,ri.pipe)((e=>(0,ri.pipe)(e,n,T.chain((e=>(0,ri.pipe)(T.fromNullable(e.parentElement),T.map((t=>Array.from(t.children).indexOf(e))))))))(s),ce.Mi((t=>e=T.some(t))),T.chain((0,r.constant)(s)),T.alt((()=>(0,ri.pipe)(e,T.fold((()=>li.a.FocusStrategy.focusRootOrFirstFocusable(i)),(e=>(0,ri.pipe)(i,li.a.FocusStrategy.focusNthByPredicateOrFirstFocusable(Math.max(0,e-1))(t)))))))))(s))),li.a.FocusStrategy.focusRootOrFirstFocusable)),reset:()=>e=T.none}}}(ii||(ii={})),function(e){const t=()=>a.useContext(z.OH.Context).platform===z.OH.Platform.IPAD?ge.vF.iPadWrapper:ge.vF.oggyWrapper,i=e=>"prev"===e.type?e.done:r.constVoid;e.OggyView=e=>{const n=t(),s=e.oggyMode===ht.kH.splitSharedAssistants,o=e.navigationViewModel.state.pipe(le.skipBy(ai.kt.UIState.eq)),r=ii.create(),l=V.B.createComponent({section:V.B.create(V.B.Id.checksFeed),component:c.F.div,focusStrategy:r.strategy,onActive:r.reset});return a.createElement(l,null,a.createElement(rt.kp,{key:"animationWrapper",className:n,state:o,stateToClassMapper:ni.ogglyStateToClassMapper},(t=>s&&Boolean(t.state.isGgoOpen)?a.createElement(oi.Gc,{cheetahViewModel:e.cheetahViewModel,onTransitionEnd:i(t),transition:t.view,oggyMode:e.oggyMode}):a.createElement(oi.ss,{cheetahViewModel:e.cheetahViewModel,transition:t.view,onTransitionEnd:i(t)}))))};const n=V.B.createComponent({component:c.F.nav,section:V.B.create(V.B.Id.navigation),refocusOnMutation:!1}),o=({expand:e})=>{const{sidebar:t}=a.useContext(pt.k.Context),i=b.wd(e);return a.createElement(c.F.button,{onClick:()=>e.modify((e=>!e)),"aria-label":i(t.toggle.collapse,t.toggle.expand),className:i(ge.vF.navExpandButton,ge.vF.navCollapseButton),"aria-controls":"navbar-right","aria-expanded":e},a.createElement(at.In.Arrow,null))};var p=e.NavigationWrapper=({isSidebarOpened:e,onMount:t,onMouseDown:i,children:s})=>{const d=l.s.create(!1),{state:p}=a.useContext(V.B.Context),{ref:h,onMount:u}=v.R.useElWatcher(),g=re.zV([d,e]).pipe(S.T((([e,t])=>t?e?ge.vF.expandedNavWrapperTier:ge.vF.collapsedNavWrapperTier:ge.vF.hiddenNavigationWrapperTier))),m=pe.v.useCollapsibleNavbarThreshold();return v.R.useSubscriptionTo(J.h(p.pipe(S.T((0,r.flow)(T.map(ct.Up("id")),ce.gR(V.B.Id.navigation))),se.F(),W.M(b.H9(d))),h.pipe(w.oE,y.n((t=>re.zV([d,m,e]).pipe(W.M((([e,i,n])=>{!e&&i&&n?t.setAttribute("inert","true"):t.removeAttribute("inert")})))))))),a.createElement(n,{id:"navbar-right","data-name":"navigation-view",mount:t,onMouseDown:i,className:g},a.createElement(c.F.Fragment,null,re.zV([m,e]).pipe(S.T((([e,t])=>e&&t?a.createElement(o,{expand:d}):null)))),a.createElement("div",{ref:u},s))},h=(e.NavigationView=e=>{const{withNeutralForSelection:t}=a.useContext(I.z.Context),i=t(p);return a.createElement(i,{onMouseDown:e.onMouseDown,isSidebarOpened:e.denaliViewModels.navigationViewModel.state.view("isSidebarOpen")},a.createElement(h,e,a.createElement(u,e),a.createElement(c.F.Fragment,null,e.features.isFree.view((t=>t||ht.DY.isBusinessAdmin(e.features.denaliUserType)?a.createElement(si.gw,{key:"freemium-notification-host",isSidebarOpen:e.denaliViewModels.navigationViewModel.state.view("isSidebarOpen"),upgradeViewModel:e.denaliViewModels.upgradeViewModel,navigationViewModel:e.denaliViewModels.navigationViewModel}):null)))))},e.TheViewPlaceholder=()=>{const e=t();return a.createElement("div",{className:e})},e.Grid=({name:e,className:t,opened:i,children:n})=>a.createElement(c.F.div,(0,s._)({key:"sidebar-tier","data-name":"sidebar-tier"},(0,d.Ly)(ge.vF.sidebarTier,i.view((e=>!e&&ge.vF.hiddenWrapper)),t)),a.createElement("div",{key:"sidebar-wrapper","data-name":e,className:ge.vF.sidebarWrapper},n)),e.Aside=({opened:e,children:t,className:i})=>{const{landmark:n}=a.useContext(Ke.S.Context);return a.createElement(c.F.aside,(0,s._)({"data-name":"sidebar-tier","arial-label":n.sidebar},(0,d.Ly)(ge.vF.sidebarTier,e.view((e=>!e&&ge.vF.hiddenWrapper)),i)),a.createElement("div",{key:"sidebar-wrapper","data-name":"sidebar",className:ge.vF.sidebarWrapper},t))},e.ogglyStateToClassMapper=(e,t)=>{const i=void 0!==e&&e,n=t;if(0!=i){if(i.isGgoOpen&&!n.isGgoOpen)return i.isSidebarOpen&&!n.isSidebarOpen?{prev:{start:{base:ge.vF.sidebarLeaveRightStart},end:{base:ge.vF.sidebarLeaveRight}},next:{start:{},end:{}}}:{prev:{start:{base:ge.vF.ggoEnterStart},end:{base:ge.vF.ggoEnterStart}},next:{start:{base:ge.vF.oggyEnterLeftStart},end:{base:ge.vF.oggyEnterLeft}}};if(!i.isGgoOpen&&n.isGgoOpen)return!i.isSidebarOpen&&n.isSidebarOpen?{prev:{start:{},end:{}},next:{start:{base:ge.vF.ggoEnterStart},end:{base:ge.vF.ggoEnter}}}:{prev:{start:{base:ge.vF.oggyLeaveRightStart},end:{base:ge.vF.oggyLeaveRight}},next:{start:{base:ge.vF.ggoEnterStart},end:{base:ge.vF.ggoEnter}}}}return!1===i&&n.isSidebarOpen?{prev:{start:{},end:{}},next:{start:{base:ge.vF.oggyEnterLeft},end:{base:ge.vF.oggyEnterLeft}}}:!1===i||i.isSidebarOpen?n.isSidebarOpen?n.navigationSource===lt.nl.forceSidebar||n.navigationSource===lt.nl.forceText?{prev:{start:{base:ge.vF.lensHideStart},end:{base:ge.vF.lensHide}},next:{start:{},end:{}}}:{prev:{start:{},end:{}},next:{start:{},end:{}}}:{prev:{start:{base:ge.vF.oggyLeaveRightStart},end:{base:ge.vF.oggyLeaveRight}},next:{start:{},end:{}}}:{prev:{start:{},end:{}},next:{start:{base:ge.vF.oggyEnterLeftStart},end:{base:ge.vF.oggyEnterLeft}}}},e.Loader=({state:e,baseLoaderClass:t,showToolbar:i})=>a.createElement(ni.Grid,{name:"sidebar-loader",opened:l.s.create(!0)},a.createElement(mt,{state:e.view("lens"),theme:ge.cX},a.createElement(c.F.div,(0,d.Ly)(ge.vF.oggyLoaderWrapper,t),a.createElement(dt.kr.Rechecking,{"data-name":"lensviewRechecking",key:"lensview-rechecking"}))),a.createElement(jt.Loader,{baseLoaderClass:t,state:e,showToolbar:i})),e.ActionsView=({denaliViewModels:{navigationViewModel:e,lensPreviewViewModel:t},documentModel:i,features:n,children:s,JSXPortal:o,slots:r})=>a.createElement(c.F.div,(0,d.Ly)(ge.vF.actionsWrapper),a.createElement(ti,{documentModel:i,features:n,navigationViewModel:e}),s,e.state.view("isSidebarOpen").view((0,ee.Sw)(null,a.createElement(Et,{lensPreviewVM:t,features:n,navigationViewModel:e,slots:r}))),r.ProofitModals(o))),u=e.LensNavigationView=({denaliViewModels:e,documentModel:t,features:i,slots:n})=>a.createElement(jt,{navigationViewModel:e.navigationViewModel},a.createElement(jt.Content,{documentModel:t,modalManager:e.modalManager,denaliViewModels:e,features:i,slots:n}))}(ni||(ni={}));var di=i(29517),ci=i(80152),pi=i(24497);const hi=ye.Ks.rem(2),ui={opacity:0,pointerEvents:"none",position:"absolute",bottom:0,zIndex:Vt.ry},gi={display:"flex",flexDirection:"row",width:"auto",height:ye.Ks.rem(2),borderRadius:hi,backgroundColor:ci.Q.Background.Base.Default,boxShadow:"0 0 .5px rgba(0, 0, 0, .4), 0 1px 3px rgba(0, 0, 0, .09), 0 4px 8px rgba(0, 0, 0, .09)",alignItems:"center"},mi={position:"relative",boxSizing:"border-box",minWidth:ye.Ks.rem(2),height:ye.Ks.rem(2),border:"none",background:"none",fontSize:ye.Ks.rem(.75),cursor:"pointer",$nest:{svg:(0,o._)((0,s._)({},{"--path-fill-1":"#018374","--path-fill-2":"#018374","--path-fill-3":"#00FFCE","--path-fill-4":"#018374"}),{fill:"none",stroke:"none"}),"&:hover":{backgroundColor:pi.BlueGray10},"&:first-child":{borderTopLeftRadius:hi,borderBottomLeftRadius:hi,paddingLeft:ye.Ks.rem(.25),paddingRight:0},"&:last-child":{borderTopRightRadius:hi,borderBottomRightRadius:hi,paddingLeft:0}}},_i=ye.Ks.rem(1.5),vi={width:_i,height:_i,backgroundPosition:"center",backgroundSize:_i},fi=ye.Ks.prefixedStylesheet("cheetah_inline_button",{buttonWrapper:[ui],button:[gi],buttonItem:[mi],icon:[vi]}),yi="Select any text to rewrite it with GrammarlyGO.",bi="Rewrite your text",wi="You can also select any text to quickly improve or rewrite it with generative AI.",Si=({inlineViewModel:e,cheetahNavigation:t})=>a.createElement(c.F.div,{style:e.inlineButtonState.view(Ci),className:fi.buttonWrapper,"aria-hidden":e.inlineButtonState.view(T.isNone)},a.createElement(k.M7,{message:e.showOnboardingTourA11yUpdates?wi:yi,title:e.showOnboardingTourA11yUpdates?bi:void 0,eventType:"onclick",stepId:D.E.StepId.GrammarlyGORewrite,alignment:"right",dotPosition:{kind:"dotAtPosition",position:k.p3.leftCenter},dismissalTrigger:e.inlineButtonState.pipe(S.T(T.isNone))},a.createElement("div",{className:fi.button},e.magicRewriteEnabled&&a.createElement(ze.$n,{className:fi.buttonItem,name:"inline-magic-rewrite","aria-label":"Improve it by Grammarly",onClick:()=>{p.Bx.Logging.getLogger("Cheetah").info("Inline button clicked: magic rewrite"),t.toCheetahLens(!0,!0)},title:"Improve it"},a.createElement(di.B.Rewrite,{className:fi.icon})),e.inlineRewriteEnabled&&a.createElement(ze.$n,{className:fi.buttonItem,onClick:()=>{p.Bx.Logging.getLogger("Cheetah").info("Inline button clicked: GrammarlyGO"),t.toCheetahLens(!0,!1)},name:"inline-grammarly-go",title:"Rewrite with Grammarly","aria-label":"Rewrite with Grammarly"},a.createElement(di.B.GrammarlyGO,{className:fi.icon}))))),Ci=e=>(0,r.pipe)(e,T.fold((0,r.constant)(Ei),Mi)),Mi=({top:e,left:t})=>({top:e+ki,left:t,bottom:"auto",opacity:1,transition:"opacity .1s linear",pointerEvents:"auto"}),Ei={},ki=8;var Ti=i(42543),xi=i(94808),Ii=i(92723),Ai=i(29009);class Fi extends a.Component{shouldComponentUpdate(){return!1}render(){const{denaliEditor:e,scrollbarViewModel:t,children:i,scrollEl:n,navigationViewModel:s}=this.props,o=O.L.withViewportContainer(Ri(Ni,{isSidebarOpen:s.state.view("isSidebarOpen")}),{type:O.L.ContainerType.inherit});return a.createElement(o,{name:"editorComponent",className:Ai.A6},a.createElement(xi.H,{denaliEditor:e,theme:{editorContent:Ai.zT,editorContentWrap:Ai.T$,printTitle:Ai.eH,titleWrap:Ai.di},scrollEl:n,editorHeight:this._editorHeight,scrollTop:t.scrollTop},i(new Ti.B7,this._editorHeight)))}constructor(...e){super(...e),(0,n._)(this,"_editorHeight",l.s.create(0))}}class Vi extends a.Component{render(){const{isSidebarOpen:e,children:t}=this.props,i=Ri(Li,{isSidebarOpen:e});return a.createElement(i,{name:"editorComponent",className:Ai.A6},a.createElement(a.Fragment,null,a.createElement(Ii.A,{selectionEffect:I.z.Effect.collapse},a.createElement("div",{className:Ai.P_})),t))}}const Li=({className:e,onMount:t,children:i,name:n})=>a.createElement(c.F.div,{"data-name":n,name:"text",key:"denaliEditorWrapper",className:e,mount:t},i),Ni=({className:e,onMount:t,children:i,name:n})=>a.createElement(c.F.main,{role:"main","data-name":n,name:"text",key:"denaliEditorWrapper",className:e,mount:t},i);function Ri(e,t){return class extends a.Component{shouldComponentUpdate(){return!1}render(){const{className:t}=this.props;return a.createElement(e,(0,s._)({},this.props,(0,d.Ly)(t,Ai.EY,Ai.kL,this._textTransition)))}constructor(...e){super(...e),(0,n._)(this,"_textTransition",t.isSidebarOpen.pipe(K.i(1),y.n((e=>ut.X.rafSequence(e?[Ai._M,Ai._M,Ai.Vs]:[Ai.iM,Ai.iM,Ai.VK],!0))),f.Z(void 0)))}}}var Oi=i(35300),Ui=i(62723),Bi=i(14342),Pi=i(35413),Di=i(94855),Hi=i(58538),Wi=i(70490),Gi=i(54730);class Ki extends a.Component{componentDidMount(){const{synonyms:e,synonymsInfo:t,editorHeight:i}=this.props;this._sub=this.context.pipe(S.T((e=>e.rect)),Ui.z(i),Bi.c(1),y.n((0,r.flow)(this._getPosition,Pi.v))).subscribe((i=>{this._rendered||(this._rendered=!0,(0,r.pipe)(i,x.map(T.chain((({markOffset:e})=>e))),x.map(T.map((i=>{e.scrollToMark(t.activeMark.meta.id,i,R.nA.fast).subscribe({error:e=>this._log.error("Cannot scroll to synonym",e)})}))))),(0,r.pipe)(i,x.fold((e=>this._log.error("Cannot get position",e)),(e=>this._state.set(T.map((({card:e})=>e))(e)))))}))}componentWillUnmount(){this._sub&&(this._sub.unsubscribe(),this._sub=null)}render(){const{synonyms:e,synonymsInfo:t}=this.props;return a.createElement(c.F.div,{mount:e=>this._el=e,key:"synonymsPopupWrapper",style:this._state.view((e=>T.getOrElse((()=>({visibility:"hidden",pointerEvents:"none"})))(e))),className:Gi.AA},a.createElement(Oi.Q,{hide:()=>e.close("closedByUser")},a.createElement(Wi.F,{synonymsInfo:t,apply:t=>()=>e.apply(t)})))}constructor(...e){super(...e),(0,n._)(this,"context",void 0),(0,n._)(this,"_log",p.Bx.Logging.getLogger("SynonymsPopup")),(0,n._)(this,"_el",void 0),(0,n._)(this,"_state",l.s.create(T.none)),(0,n._)(this,"_getPosition",(([e,t])=>this._el?(0,r.pipe)(this.props.synonyms.getSynonymMarkRect(this.props.synonymsInfo.activeMark.meta.id),Di.wu((e=>(this._log.info("Cannot get synonym popup position",e),e)),(i=>{const n=Ve.W.relativeToRoot(i),s=Ve.W.relativeToViewport(i),{width:o,height:a}=this._el.getBoundingClientRect(),r=t<n.bottom+a+32&&a<n.top+150,l=r?n.top-a:n.bottom,d=s.left+o,c=d<e.right?0:d-e.right+32,p=n.left-c,h=(r?s.top-e.top-a:e.bottom-s.bottom-a)<70?T.some(r?Math.min(e.top+a+70,e.bottom-n.height):Math.max(e.bottom-a-70,n.height+70)):T.none;return T.some({card:{top:l,left:p},markOffset:h})}))):Di.pG(T.none))),(0,n._)(this,"_sub",null),(0,n._)(this,"_rendered",!1)}}(0,n._)(Ki,"contextType",O.L.Context);class zi extends a.Component{render(){const{markRect:e,className:t,children:i}=this.props;return a.createElement(c.F.div,{className:t,style:this.context.pipe(W.M((e=>this._log.debug("Update tooltip position",e.rect))),S.T((()=>(0,r.pipe)(e,x.map((e=>P.Tl(e.left+e.width,e.top))),T.fromEither,T.getOrElse((()=>({visibility:"hidden"})))))))},i)}constructor(...e){super(...e),(0,n._)(this,"context",void 0),(0,n._)(this,"_log",p.Bx.Logging.getLogger("SynonymIconWrapper"))}}(0,n._)(zi,"contextType",O.L.Context);class $i extends a.Component{shouldComponentUpdate(){return!1}renderLoader(e){return Pi.v(this.props.synonyms.getSynonymMarkRect(e.activeMark.meta.id)).pipe(S.T(x.map(Ve.W.relativeToRoot)),S.T((e=>a.createElement(zi,{className:Gi.P0,markRect:e},a.createElement(at.In.SynonymLoader,{className:Gi.wG})))),Bi.c(1e3),f.Z(null))}renderPopup(e){return this.props.synonyms.onPopupOpen(),$.of(a.createElement(Ki,{synonyms:this.props.synonyms,synonymsInfo:e,editorHeight:this.props.editorHeight,features:this.props.features}))}render(){const{synonyms:e}=this.props;return a.createElement(c.F.div,{className:Gi.FG},e.viewState.pipe(W.M((e=>this._log.debug("Synonym state changed",(0,r.pipe)(e,T.fold((()=>null),(e=>({kind:e.synonymsState.kind,popupVisible:e.popupVisible}))))))),y.n(ce.dQ((e=>Hi._g.isQuerying(e.synonymsState)?this.renderLoader(e):(Hi._g.isReady(e.synonymsState)||Hi._g.isEmpty(e.synonymsState))&&e.popupVisible?this.renderPopup(e):$.of(null)),$.of(null)))))}constructor(...e){super(...e),(0,n._)(this,"_log",p.Bx.Logging.getLogger("SynonymsView"))}}var Ji=i(16140),ji=i(41933),qi=i(14737),Yi=i(81870),Zi=i(57791);const Qi=({onClick:e,tooltip:t})=>a.createElement(ze.$n.Ghost,{name:"to-home",onClick:e,title:t.view(ce.y0),className:Zi.yu,animationMode:qi.g.FromCenter},a.createElement(at.In.Arrow,{className:Zi.j2})),Xi=({logout:e})=>{const t=a.useContext(Ke.S.Context);return a.createElement(Qi,{tooltip:l.s.create(T.some(t.toolbar.signOut)),onClick:e})},en=({type:e,logoutViewModel:t,userAccount:i})=>{const n=a.useContext(Yi.Lz.Context),s=a.useContext(Ke.S.Context);return a.createElement("div",{className:Zi.yJ,"data-name":"document-tools"},i.features.isMacEditor?null:i.features.demoMode?(0,r.pipe)(t,T.map((e=>a.createElement(Xi,{logout:e.logout}))),T.toNullable):a.createElement(Qi,{tooltip:l.s.create(T.some(s.toolbar.backToMyGrammarly)),onClick:()=>n.navigateAndReload(Yi.Lz.routes.documents.href())}),a.createElement(_e.Tc,{className:i.features.isMacEditor?Zi.hl:Zi.Vv,"data-name":"toolbar-title"},e===gt.x.TextType.loading?s.toolbar.loading:s.toolbar.processing))},tn=JSON.parse('{"dO":"_fff97a92-document-view-secondTier","cm":"_28c5f0ad-document-view-secondTierLoader _fff97a92-document-view-secondTier","xM":"_4a6e6106-document-view-horizontal","Z$":"_62489cd6-document-view-horizontalEditorWrapper","LN":"_b15ab221-document-view-fixedHorizontal","rr":"_3d817d93-document-view-inlineCardWrapper","Pr":"_6a85d163-document-view-baseLoaderClass","jF":"_23159c5b-document-view-textLoaderWrap","e9":"_fcc28cfc-document-view-fixedLoader","vG":"_27da620b-document-view-overlayVisible","TG":"_085dcda9-document-view-fixedOverlay","J$":"_0981226d-document-view-withPlaceForScrollbar","J1":"_f95a18f5-document-view-documentContainer","fn":"_ab1c6375-document-view-documentPlaceholder"}');var nn;!function(e){e.Loader=({logoutViewModel:e,documentLoader:i,className:n,userAccount:o})=>a.createElement(c.F.Fragment,null,i.state.view("text").view(ce.dQ((r=>a.createElement("div",{key:"with-text-loader",className:n},a.createElement("div",(0,s._)({key:"editor"},(0,d.Ly)(tn.cm,tn.Pr)),a.createElement(en,{type:r,logoutViewModel:e,userAccount:o}),a.createElement(Ii.j,{position:"top"},a.createElement("div",{className:tn.jF},a.createElement(_t.rp,null)))),a.createElement(t,{documentLoader:i}))),null))),e.AssistantOnlyLoader=({documentLoader:e,className:i})=>a.createElement("div",{className:i},a.createElement(t,{documentLoader:e}));const t=({documentLoader:e})=>a.createElement(ni.Loader,{key:"sidebar-loader",state:e.state,baseLoaderClass:tn.Pr,showToolbar:e.state.view("text").view(T.isNone)})}(nn||(nn={}));const sn=JSON.parse('{"yJ":"_74937657-document-view-invisibleScrollbar","m$":"_074f1316-document-view-scrollDetector","cK":"_260b91aa-document-view-preventOverscroll"}'),on=({width:e,className:t,children:i})=>a.createElement(c.F.div,(0,o._)((0,s._)({},(0,d.Ly)(sn.yJ,t)),{style:e.pipe(S.T((e=>({width:`calc(100vw - ${e}px)`}))))}),i),an=({onMount:e})=>a.createElement("div",{className:sn.m$,ref:e}),rn=()=>{const e=a.useContext(z.OH.Context);return v.R.useSubscriptionTo(e.has(z.OH.Flag.preventNavigationByOverscrollWithJS)?C.R(document,"wheel").pipe(W.M((e=>{Math.abs(e.deltaX)>=Math.abs(e.deltaY)&&e.preventDefault()}))):oe.w),a.useEffect((()=>(document.body.classList.add(sn.cK),()=>document.body.classList.remove(sn.cK)))),a.createElement(a.Fragment,null)},ln=e=>{const{denaliEditorModel:t,documentModel:i,userAccount:n,denaliViewModels:s,documentLoader:o,loaderClassName:r,slots:d}=e,p=l.s.create(T.none),h=new ue;v.R.useSubscriptionTo(p.pipe(W.M(b.H9(h.target)))),v.R.useSubscriptionTo(s.modalManager.state.pipe(S.T(T.isSome),M.E(p.pipe(w.oE)),S.T((([e,t])=>e?t.setAttribute("inert","true"):t.removeAttribute("inert")))));const{withSelectionEffect:u}=a.useContext(I.z.Context),g=u((({onMouseDown:e})=>a.createElement("div",{className:tn.Z$,onMouseDown:e},a.createElement(O.L.InheritVirtualContainer,{name:"withPadding",viewportPadding:f},a.createElement(Fi,{denaliEditor:t,settingsModel:n.settings,scrollbarViewModel:h,navigationViewModel:s.navigationViewModel,scrollEl:p,viewportPadding:f},((e,i)=>a.createElement(pn,{denaliViewModels:s,denaliEditorModel:t,editorHeight:i,features:n.features.denali,ModalsPortal:y.Source})))),a.createElement(an,{key:"scroll-detector",onMount:e=>h.detector.set(T.fromNullable(e))}))),I.z.Effect.collapse),m=u((()=>a.createElement(ni.OggyView,{cheetahViewModel:s.cheetahViewModel,navigationViewModel:s.navigationViewModel,oggyMode:n.features.denali.oggy})),I.z.Effect.collapse),_=u(ni.NavigationView,I.z.Effect.collapse),f=l.s.create(R.EN.empty),y=P.ZL.create("modals-portal");return a.createElement(a.Fragment,null,a.createElement(rn,null),a.createElement(y.Destination,null),a.createElement(c.F.div,{"data-name":"document-content",className:tn.dO,style:h.fakeWidth.pipe(S.T((e=>({paddingRight:e})))),mount:e=>p.set(T.fromNullable(e))},o.state.view("text").view(T.fold((()=>a.createElement(U.D.Top,{className:tn.e9,key:"navigation-loader"},a.createElement(on,{width:h.width,className:tn.J$},a.createElement(nn.AssistantOnlyLoader,{documentLoader:o,className:r})))),(()=>null))),a.createElement(dn,{scrollbarWidth:h.width,sidebarOpen:s.navigationViewModel.state.view("isSidebarOpen"),editor:a.createElement(Vi,{isSidebarOpen:s.navigationViewModel.state.view("isSidebarOpen"),features:n.features},a.createElement(me.t.Component,{denaliEditor:t,documentModel:i,settingsModel:n.settings,viewportPadding:f,formattingViewModel:s.formattingViewModel,emotionsViewModel:s.emotionsViewModel,navigationViewModel:s.navigationViewModel,features:n.features})),assistant:a.createElement(a.Fragment,null,a.createElement(ni.TheViewPlaceholder,null),a.createElement(_,{denaliViewModels:s,documentModel:i,features:n.features,scrollEl:p,JSXPortal:y.Source,slots:d}))},a.createElement(d.DocumentToolbar,null)),a.createElement(cn,{opened:s.navigationViewModel.state.view("isSidebarOpen"),editor:a.createElement(g,null),assistant:a.createElement(m,null)}),a.createElement(Si,{cheetahNavigation:s.cheetahViewModel.navigation,inlineViewModel:s.cheetahViewModel.inlineViewModel})))},dn=({sidebarOpen:e,editor:t,assistant:i,scrollbarWidth:n,children:s})=>a.createElement(U.D.Top,{className:tn.LN},a.createElement(on,{width:n,className:tn.J$},t,a.createElement(ni.Grid,{name:"sidebar-placeholder",opened:e,className:ge.vF.sidebarTierOggy},i),s)),cn=({opened:e,editor:t,assistant:i})=>a.createElement("div",{className:tn.xM},t,a.createElement(ni.Aside,{opened:e,className:ge.vF.sidebarTierOggy},i)),pn=({denaliViewModels:e,denaliEditorModel:t,editorHeight:i,features:n,ModalsPortal:l})=>{const d=n.showOnboardingTourA11yUpdates,p={denaliEditorModel:t,onboardingViewModel:e.onboardingViewModel},h=(0,o._)((0,s._)({},p),{alignment:"bottomCenter",overlay:e=>a.createElement(U.D.Top,{className:tn.TG},a.createElement(c.F.div,{className:e.view((e=>e?tn.vG:""))},a.createElement(g.hJ,{positionType:"fixed",visible:e,alignment:"none",overlayType:"transparent"}))),getFirstTargetRect:()=>e.onboardingViewModel.getFirstTargetRect()}),{withSelectionEffect:m}=a.useContext(I.z.Context),_=m(I.z.Effect.PlainContainer,I.z.Effect.prevent),v=a.useContext(N.q.Context),f=G.yU(t.viewport,v).pipe(S.T((([e,t])=>e.text.width+B.PA*t)));return a.createElement(c.F.Fragment,null,e.navigationViewModel.state.view("isSidebarOpen").view((t=>t&&a.createElement(H.h,(0,o._)((0,s._)({key:"sidebar-opened"},h),{stepId:D.E.StepId.Step11,message:"Click underlined words to see more details about what Grammarly has found.",completionTrigger:e.onboardingViewModel.completionTrigger.pipe(K.i(1)),eventType:"onclick"})))),(0,r.pipe)(e.vbarsViewModel,T.map((t=>a.createElement(B.yz,{model:t,InlineCard:t=>a.createElement(u.$.Context.Consumer,null,(i=>a.createElement(c.F.Fragment,null,e.sduiInlineViewModel.pipe(S.T((e=>(0,ji.M)(f,e,(e=>i(e,"somethingCopied")))(t))))))),suggestionFeedback:e=>a.createElement(qe,(0,s._)({ModalsPortal:l},e))}))),T.toNullable),a.createElement(ot,{className:tn.rr,inlineCardVM:e.inlineCardViewModel,features:n,sduiInlineCardVM:e.sduiInlineViewModel,modalsPortal:l}),a.createElement(H.h,(0,o._)((0,s._)({},p),{stepId:D.E.StepId.Step9,alignment:"bottomRight",eventType:"onhover",title:d?"Synonyms":void 0,message:"Click on a word twice to see the synonyms.",getFirstTargetRect:()=>e.synonymsViewModel.getFirstSynonymRect(),completionTrigger:e.synonymsViewModel.popupShown.pipe(K.i(1))})),(0,r.pipe)(e.formattingViewModel,T.map((e=>a.createElement(_,null,a.createElement(Ji.V4,{vm:e.linksManager})))),T.toNullable),a.createElement($i,{synonyms:e.synonymsViewModel,editorHeight:i,features:n}),a.createElement("div",{className:tn.J1},a.createElement(ne,{ded:t}),a.createElement(Me,{className:tn.fn,viewModel:e.documentPlaceholderViewModel})))};var hn=i(50760),un=i(28882);const gn="The changes in your document may be lost if you leave this page.",mn=e=>{const t=a.useContext(A.Y.Context);return v.R.useEffectOnWillMount((()=>p.Bx.Logging.root.context.add({denali:!0}))),v.R.useEffectOnDidMount((()=>{t.gnarSpec.denaliDocumentPageShow(t.pageId,document.location.toString(),t.isTouchDevice)})),v.R.useEffectOnWillUnmount((()=>{try{e.denaliViewModels.modalManager.hideAll(),e.denaliViewModels.dispose()}catch(e){p.Bx.Logging.getLogger("Main").error("Cannot shutdown the engine",e)}})),v.R.useSubscription(e.selfUpdate.watch(e.documentModel.saved.pipe(f.Z(!0)),"saved"),e.denaliEditorModel.dontFreezeWhen(l.s.combine(g.hJ.activeCount,h.A.activeCount,((e,t)=>e+t>0)),"overlay"),e.denaliViewModels.navigationViewModel.state.view("isSidebarOpen").pipe(y.n(b.vh(e.denaliViewModels.alertUserEvents.alertClicked)),w.oE).subscribe((e=>{t.gnarSpec.alertUnderlineClick(t.pageId,"assistantOn",t.pageSessionId,m.J.isPremiumId(e.alert.lensId)?"premiumUphookPreview":e.alert.lensId)}))),a.createElement(a.Fragment,null,a.createElement(k.M7.Context.Provider,{value:e.denaliViewModels.onboardingViewModel},a.createElement(u.$.Context.Provider,{value:(0,L.l)(e.notificationsManager,e.environment)},a.createElement(V.B.Context.Provider,{value:e.denaliViewModels.focus},a.createElement(I.z.Context.Provider,{value:I.z.getSelectionHOCs(e.denaliEditorModel)},a.createElement("div",(0,d.Ly)(un.Td),a.createElement(e.slots.StartupManager,null),e.children,a.createElement(hn.I,{searchViewModel:e.denaliViewModels.searchViewModel,key:"search-bar"}),a.createElement(ln,(0,o._)((0,s._)({},e),{loaderClassName:un.m$})),a.createElement(_n,{modalManager:e.denaliViewModels.modalManager})))))),a.createElement(e.slots.Dropzone,null))},_n=({modalManager:e})=>a.createElement(c.F.Fragment,null,e.state.view((0,r.flow)(T.map((({component:e})=>e)),T.toNullable))),vn=({documentLoader:e,logoutViewModel:t,userAccount:i})=>a.createElement(nn.Loader,{className:un.m$,logoutViewModel:t,userAccount:i,documentLoader:e});class fn extends a.Component{render(){return a.createElement(F.v0,{onMount:this._handleUnsavedChanges},a.createElement(_.a.Block,{when:this.props.documentModel.saved.pipe(f.Z(!0),S.T((e=>!e))),message:()=>(this.props.documentModel.flush().catch((e=>this._log.error("Could not flush document before exit",e))),this._log.warn("unsaved changes prompt before navigate"),"You may have unsaved changes in your document that will be lost if you leave the page.")}))}constructor(...e){super(...e),(0,n._)(this,"_log",p.Bx.Logging.getLogger("block_unsaved_changes")),(0,n._)(this,"_blockNavigationWhenUnsavedChanges",(()=>C.R(window,"beforeunload").pipe(M.E(this.props.documentModel.saved,((e,t)=>t?null:e)),E.p(Boolean)).subscribe((e=>(e.returnValue=gn,gn))))),(0,n._)(this,"_notifyAboutDocumentStateChange",(()=>this.props.documentModel.saved.pipe(f.Z(!0)).subscribe((e=>{(0,r.pipe)(this.props.actions.documentStateChanged(e?F.OH.DocumentState.SAVED:F.OH.DocumentState.NOT_SAVED),x.mapLeft((e=>this._log.warn("Could not perform documentStateChanged action.",e))))})))),(0,n._)(this,"_handleUnsavedChanges",(()=>this._blockNavigationWhenUnsavedChanges().add(this._notifyAboutDocumentStateChange())))}}},7662:(e,t,i)=>{i.d(t,{TL:()=>H,Gc:()=>D,ss:()=>P});var n=i(10334),s=i(17171),o=i(50659),a=i(82541),r=i(84647),l=i(87574),d=i(19840),c=i(19772),p=i(76099),h=i(62597),u=i(89011),g=i(49470),m=i(70751),_=i(82315),v=i(15491),f=i(90405),y=i(6987),b=i(74168),w=i(78339),S=i(89769),C=i(65390),M=i(38886),E=i(40884),k=i(24497),T=i(38107),x=i(11864);const I=e=>x.Ks.color(k.BlueGray40).toRGBA().fade(e).toString(),A={boxShadow:`0px 0px 0px 0.5px ${k.BlueGray40}, 0px 0px 2px 0.5px ${I(.5)}, 0px 1px 8px 0.5px ${I(.1)}, 0px 2px 12px 0.5px ${I(.1)}, 0px 4px 20px 0.5px ${I(.25)}`,borderRadius:x.Ks.rem(T.Dk),marginRight:x.Ks.rem(2),marginBottom:x.Ks.rem(2),marginLeft:x.Ks.rem(1),$nest:{"& input[type='radio']":{display:"unset"},iframe:{boxSizing:"content-box"}}},F=x.Ks.prefixedStylesheet("cheetah_lens",{assistantContainer:[A]});var V=i(39606),L=i(96504);const N=(0,s._)((0,n._)({height:x.Ks.vh(100)},L.j7.root),{$nest:(0,s._)((0,n._)({},L.j7.$nest),{"& > div":(0,n._)({width:x.Ks.important("inherit"),borderRadius:0,borderRight:"none",borderTop:"none",borderBottom:"none"},V.R$),'& [data-name*="headerClose"]':{display:x.Ks.important("none")}})}),R=x.Ks.prefixedStylesheet("oggy",{oggyWrapper:[N]}),O="aria-expanded",U=v.T((0,r.flow)(C.map((e=>o.createElement(e,null))),C.toNullable)),B=({cheetahViewModel:e,mode:t})=>{const{ref:i,onMount:a}=c.R.useElWatcher();return c.R.useSubscription((0,r.pipe)(i.pipe(f.oE,y.n((e=>b.vB(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[O]}).pipe(v.T(M.pb((e=>e.attributeName===O))),w.p(M.J_),v.T((e=>e.some((e=>"true"===e.target.getAttribute(O)))))))),S.Z(!1)),e.acquireFocusWhen)),o.createElement(l.F.div,(0,s._)((0,n._)({"data-name":"cheetah-view"},(0,d.Ly)("oggy"===t?R.oggyWrapper:F.assistantContainer)),{mount:a}),U("oggy"===t?e.assistantUI:e.ggoUI))},P=e=>{const t=e.transition.pipe(v.T((e=>e.base)));return o.createElement(l.F.div,(0,s._)((0,n._)({},(0,d.Ly)(t)),{onTransitionEnd:e.onTransitionEnd}),t.pipe(v.T((t=>null!=t?o.createElement(_.M7,{alignment:"bottom",eventType:"onclick",stepId:u.E.StepId.Step4,title:"Review suggestions",message:"Grammarly checks for mistakes and suggests ways to improve your text.",dotPosition:{kind:"findFirstButton",position:_.p3.center,selector:`[data-name*="${a.A7.ButtonAccept}"]`,buttonOrder:0}},o.createElement(B,{mode:"oggy",cheetahViewModel:e.cheetahViewModel})):null))))},D=({onTransitionEnd:e,transition:t,cheetahViewModel:i,oggyMode:s})=>o.createElement(l.F.div,(0,n._)({key:h.J.SpecialId.Cheetah},(0,d.Ly)(t.pipe(v.T((e=>e.base))))),o.createElement(p.D.Bottom,{className:(0,r.pipe)(s,C.fromPredicate((e=>e===E.kH.splitSharedAssistants)),C.map((()=>m.j.splitSharedAssistantsLensContent)),C.getOrElse((()=>m.j.fixedLensContent))),"aria-label":"Grammarly GO",role:"region",onTransitionEnd:e},o.createElement(g.uF.Consumer,null,(()=>o.createElement(B,{mode:"ggo",cheetahViewModel:i})))));var H;!function(e){const t="cheetah-view";e.isCheetahView=e=>!!e&&e.getAttribute("data-name")===t,e.isInsideCheetahView=e=>{var i;return Boolean(null===(i=e)||void 0===i?void 0:i.closest(`[data-name='${t}']`))}}(H||(H={}))},82937:(e,t,i)=>{i.d(t,{h:()=>F});var n=i(10334),s=i(17171),o=i(69384),a=i(50659),r=i(84647),l=i(87574),d=i(19772),c=i(5692),p=i(35413),h=i(19711),u=i(83541),g=i(95168),m=i(15491),_=i(89769),v=i(78339),f=i(24946),y=i(65390),b=i(86562),w=i(94855);const S=e=>{const{isEligible:t,children:i}=e;return a.useEffect((()=>{if(t){var e;const t=document.createElement("script");t.type="text/javascript",t.innerHTML="(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-NPLPZQ89');",null===(e=document.querySelector("head"))||void 0===e||e.appendChild(t)}}),[t]),a.createElement(a.Fragment,null,i)};var C,M=i(11213),E=i(70932),k=i(16721),T=i(60575);!function(e){e.measure=function(){const e=T.Bx.Logging.getLogger("web_vitals"),t=T.Bx.TimeSeries.rootFemetrics;i.e(4233).then(i.bind(i,91849)).then((({onFCP:e,onFID:t,onLCP:i,onTTFB:n})=>{const s=new Promise((t=>e(t))),o=new Promise((e=>i(e))),a=new Promise((e=>t(e))),r=new Promise((e=>n(e)));return Promise.all([s,o,a,r])})).then((([i,n,s,o])=>{const a=window.location.href.includes("grammarly.com/ddocs/")?"editor":"myGrammarly";e.info("Web vitals",{fcp:i,lcp:n,fid:s,ttfb:o,page:a}),t.getTimer("webVitals_fcp").setContext({page:a}).recordTime(i.value),t.getTimer("webVitals_lcp").setContext({page:a}).recordTime(n.value),t.getTimer("webVitals_fid").setContext({page:a}).recordTime(s.value),t.getTimer("webVitals_ttfb").setContext({page:a}).recordTime(o.value)})).catch((t=>e.error("Couldn't measure web-vitals",t)))}}(C||(C={}));var x=i(74056),I=i(95008),A=i(22409);function F(e,t,i,o,r){return(l,d,c)=>(0,s._)((0,n._)({},d.route),{component:n=>a.createElement(V,{type:l,isPrivate:!0===d.route.private,modelFactory:e,telemetryContext:i,config:o,router:t,globalExperiment:r},(e=>c(e)(n)))})}function V(e){var{router:t,telemetryContext:i,config:l,children:d,globalExperiment:c=(0,r.constant)(y.none)}=e,p=(0,o._)(e,["router","telemetryContext","config","children","globalExperiment"]);return a.createElement(L,p,(e=>a.createElement(k.Y.ContextProvider,(0,s._)((0,n._)({gnarSpec:e.telemetry.gnarSpec},i),{sessionUuidGetter:()=>y.none}),!0===p.isPrivate?a.createElement("div",null,a.createElement(N,{authentication:e.authentication,onUserReady:()=>(0,r.pipe)(c(e,t),R(e),y.getOrElse((()=>a.createElement(S,{isEligible:"prod"===l.env&&e.userAccount.features.denali.isEligibleForGtm},d(e))))),config:l,model:e})):d(e))))}function L({type:e,modelFactory:t,children:n}){const s=p.v((()=>(0,r.pipe)(L.models.get(e),y.fromNullable,y.fold((()=>{switch(e){case"my-grammarly":return Promise.all([i.e(1622),i.e(8928),i.e(1901),i.e(7861),i.e(6352),i.e(5504),i.e(271)]).then(i.bind(i,68945)).then((({createMyGrammarlyAppModel:e})=>t(e)));case"editor":return Promise.all([i.e(1622),i.e(8928),i.e(1901),i.e(7861),i.e(6352),i.e(5504),i.e(6669)]).then(i.bind(i,51394)).then((({createEditorAppModel:e})=>t(e)));case"anonymous-editor":return Promise.all([i.e(8928),i.e(5504),i.e(4643)]).then(i.bind(i,8491)).then((({createAnonymousEditorAppModel:e})=>t(e)));default:return(0,b.xb)(e)}}),(e=>Promise.resolve(e)))))).pipe(h.$(),u.shareReplay({refCount:!0,bufferSize:1}));return d.R.useSubscriptionTo(s.pipe(g.M((t=>L.models.set(e,t))))),a.createElement(l.F.Fragment,null,s.pipe(m.T(n),_.Z(a.createElement(A.y,{className:M.A.spinner}))))}function N({authentication:e,onUserReady:t,model:i}){const n=a.useContext(x.OH.Context),s=e.status.get();if(c.j.isIdle(s))throw(0,r.pipe)(e.ensureAuthenticated(),w.qE((e=>{e===I.lR.UnauthorizedError&&n.actions.showSigninView()})))();if(c.j.isTerminated(s)){if(c.j.isFatal(s))return a.createElement(E.l,null);if(c.j.isOk(s)){if(i.isReady.get())return t();throw i.isReady.pipe(v.p(Boolean),f.s(1)).toPromise()}return(0,b.xb)(s)}throw e.status.pipe(v.p(c.j.isTerminated),h.$()).toPromise()}L.models=new Map;const R=e=>(e.userAccount.features.trackWebVitals&&C.measure(),r.identity)},95008:(e,t,i)=>{i.d(t,{bb:()=>V,lR:()=>n,n6:()=>F,pJ:()=>R,u7:()=>L});var n,s=i(23988),o=i(10334),a=i(17171),r=i(45819),l=i(46238),d=i(69779),c=i(95934),p=i(58508),h=i(11550),u=i(60575),g=i(5692),m=i(85076),_=i(6987),v=i(7323),f=i(21216),y=i(19711),b=i(65390),w=i(94855),S=i(77396),C=i(86562),M=i(10117),E=i(66202),k=i(98969),T=i(39781),x=i(92622),I=i(37107),A=i(40464);!function(e){e.CannotUseEditorError="CannotUseEditorError",e.UnknownNetworkError="UnknownNetworkError",e.UnauthorizedError="UserUnauthorizedError",e.UnknownClientError="UnknownClientError",e.UnknownServerError="UnknownServerError"}(n||(n={})),(n||(n={})).fromAjaxErr=function(e){return e instanceof h.GI?n.UnknownNetworkError:401===e.code||403===e.code?n.UnauthorizedError:e.code>=400||e.code<500?n.UnknownClientError:n.UnknownServerError};const F=g.j.defaultValue();var V;function L(e,t,i,n,s,r){var l;const c=new Set(e.groups.filter(Boolean)),p="Free"===e.type?T.ut.free:"Premium"===e.type?T.ut.premium:(()=>{throw new Error(`Unknown user type ${e.type}`)})();var h;return{userProfile:{isPaymentSandbox:Boolean(Boolean(e.customFields)&&e.customFields["sandbox.payments"]),id:e.id,anonymous:e.anonymous,confirmed:e.confirmed,email:e.email,newEmail:e.newEmail,fullName:e.name,isTest:e.isTest||!1,canUseEditor:"Premium"===e.type||e.freemium||!1,groups:c,type:p,role:(0,d.pipe)(e.customFields.frontend_role,b.fromNullable),roles:(0,d.pipe)(null!==(h=null===(l=e)||void 0===l?void 0:l.roles)&&void 0!==h?h:[]),loginType:e.loginType,registrationDate:(0,d.pipe)(e.registrationDate,b.fromNullable,b.map((e=>new Date(e)))),editorFeatures:e.editorFeatures,institutionInfo:(0,d.pipe)(b.fromNullable(e.institutionInfo),b.map((e=>(0,a._)((0,o._)({},e),{trueUpSchedule:s}))))},subscription:A.n6,settings:t,experiments:i,clientControls:n,entitlements:(0,d.pipe)(r,b.map(k.b.fromPassport))}}!function(e){e.sharedCodec=c.E$([x.x.sharedCodec,c.NW({clientControls:x.kz.codec})])}(V||(V={}));class N extends h.Hl{constructor(){super({code:0,status:"error",message:"User cannot use editor"})}}class R{ensureAuthenticated(){return g.j.isIdle(this._state.get())?(this._state.modify(g.j.begin),(0,d.pipe)(this._getUserSession(),S.qI((e=>(setTimeout((()=>{this._onUserAvailable(e),this._state.modify(g.j.success(e))}),0),e.userProfile.canUseEditor?w.pG(void 0):w.kb(new N)))),w.qE(this._handleAuthError))):w.pG(void 0)}_getUserSession(){let e=1;const t=m.l(this._authApi.orAnonymous("sandbox.payments","frontend_role"),[p.Oh(5),p.Ed(5e3)],(t=>{this._log.error("authError: getUser failed",t,{attempt:e++});const i=n.fromAjaxErr(t);switch(i){case n.CannotUseEditorError:case n.UnauthorizedError:return!1;case n.UnknownNetworkError:case n.UnknownClientError:case n.UnknownServerError:return!0;default:return(0,C.xb)(i)}}));return(0,d.pipe)(t,_.n(M.AU({onInProgress:()=>v.t,onSuccess:e=>f.of(E.right(e)),onError:()=>v.t,onFatal:e=>f.of(E.left(e))})),y.$(),(e=>()=>e.toPromise()),w.cy((e=>(0,d.pipe)(r.CO(l.ApplicativePar)(this._getTreatments),w.M1,w.Tj((()=>({authData:e})))))),w.Tj((({authData:e})=>L(e,I.tl.empty,new Set,b.none,b.none,b.none))))}constructor(e,t,i,o,a){(0,s._)(this,"_state",void 0),(0,s._)(this,"_authApi",void 0),(0,s._)(this,"_experimentClient",void 0),(0,s._)(this,"_onUserAvailable",void 0),(0,s._)(this,"_onAuthError",void 0),(0,s._)(this,"_log",void 0),(0,s._)(this,"status",void 0),(0,s._)(this,"_handleAuthError",void 0),(0,s._)(this,"_getTreatments",void 0),this._state=e,this._authApi=t,this._experimentClient=i,this._onUserAvailable=o,this._onAuthError=a,this._log=u.Bx.Logging.getLogger("model.authentication"),this.status=this._state.view((e=>g.j.map(e,(e=>e)))),this._handleAuthError=e=>{this._onAuthError();const t=e instanceof N?n.CannotUseEditorError:n.fromAjaxErr(e);switch(t){case n.CannotUseEditorError:this._log.info("authError: Cannot use editor",e,t),this._state.modify(g.j.error(t));break;case n.UnauthorizedError:this._log.warn("authError: Bad user session",e,t),this._state.modify(g.j.error(t));break;case n.UnknownNetworkError:case n.UnknownClientError:case n.UnknownServerError:this._log.fatal("authError: Failed to get user session",e,t),this._state.modify(g.j.fatal(t));break;default:return(0,C.xb)(t)}return t},this._getTreatments=()=>this._experimentClient.fetchTreatments().catch((e=>{this._log.warn("Failed to fetch treatments",e)}))}}},29009:e=>{e.exports=JSON.parse('{"kL":"_1da21af2-editor-container","EY":"_9c352f06-editor-editorComponentWrapper","GO":"_5735c025-editor-editorTopContentWrap","sN":"_598d7b3a-editor-editorTopContent","di":"_eebaed4f-editor-titleWrap","eH":"_60802792-editor-printTitle _063f6639-editor-title","VK":"_87ac22d6-editor-toEditingEnd","iM":"_80610d7e-editor-toEditingStart","Vs":"_b60a06ef-editor-toWritingEnd","_M":"_21b7610b-editor-toWritingStart","ms":"_0a39c7f0-editor-scrollWrap","T$":"_9ebf40eb-editor-editorContentWrap","kX":"_10119ad8-editor-editorContentWrapFullWidth _9ebf40eb-editor-editorContentWrap","zT":"_ea8975e7-editor-editorContent","o7":"_3565fd9e-editor-editorContentFullWidth _ea8975e7-editor-editorContent","P_":"_f05b624d-editor-textContent","k7":"_afc84c44-editor-overlayClickableEl","A6":"_82aee97c-editor-scrollWrapFixed"}')},944:e=>{e.exports=JSON.parse('{"gE":"_5392178d-document_actions-actionIcon","R":"_41bffc2f-document_actions-hidden","_B":"_386f754f-document_actions-actionIconTeaser","j_":"_ada07639-document_actions-actionIconTeaserLeft","Eb":"_c906cb60-document_actions-outcomeBtnLeft","U5":"_b13f9ea7-document_actions-proofitBtn","hj":"_151f8bc5-document_actions-plagiarismBtnWithAiDetectorVariant","ot":"_2b490ca1-document_actions-proofitBtnTeaser _41b9a167-document_actions-blockTeaser","ES":"_919cfcf1-document_actions-plagiarismBtnTeaser _41b9a167-document_actions-blockTeaser","yZ":"_703fe7c6-document_actions-plagiarismBtn","K0":"_1d9f2970-document_actions-outcomeDocumentActionsFull","h6":"_edd05aa2-document_actions-outcomeDocumentActionsTeaser _332adcf8-document_actions-documentActionsTeaser","mw":"_a293d6de-document_actions-plagiarismScore","pf":"_125f994b-document_actions-buttonsDelimiter","Sn":"_aa7b2c07-document_actions-premiumButton","xo":"_bc868f52-document_actions-premiumCounterWrapper","X6":"_061603fd-document_actions-premiumCounterContent"}')}}]);