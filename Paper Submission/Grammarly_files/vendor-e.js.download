"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[5335],{76035:(e,r,t)=>{t.d(r,{T:()=>f});var n=t(19147),a=t(6922),o=t(23988),i=t(10334),s=t(17171),g=t(66202),u=t(65390),c=t(46238),d=t(94855),_=t(84647),S=t(46059),l=t(38791),h=t(49984),m=t(45559),p=t(48690),f=function(){function e(r,t,a,i,s){(0,n._)(this,e),(0,o._)(this,"_storage",void 0),(0,o._)(this,"_sendStorageMessage",void 0),(0,o._)(this,"_canSaveEntryToStorage",void 0),(0,o._)(this,"getCAPIWSMessageSizeLimit",void 0),(0,o._)(this,"_monitoringHandler",void 0),(0,o._)(this,"_guardStorageServerMessage",void 0),this._storage=r,this._sendStorageMessage=t,this._canSaveEntryToStorage=a,this.getCAPIWSMessageSizeLimit=i,this._monitoringHandler=s,this._guardStorageServerMessage=l.n(S.Schemable)(m.FA.ServerMessageImplementations)}return(0,a._)(e,[{key:"handleMessage",value:function(e){return this._guardStorageServerMessage.is(e)?(this._handleStorageMessage(e),!0):!!m.Hi.is(e)}},{key:"_handleStorageMessage",value:function(e){var r=this;switch(e.action){case"storage:get":return(0,_.pipe)(this._storage.get((0,s._)((0,i._)({},e),{maxResponseSize:(0,_.pipe)(this.getCAPIWSMessageSizeLimit(),u.map((function(e){return e-1e3})),u.toUndefined)})),d.bK((function(t){return(0,_.pipe)(r._sendStorageMessage({id:e.id,action:"storage:entries",data:t.entries}),d.wu((function(e){return new h.aq("Error sending storage:entries",e)}),(function(){return{data:t}})))})),c.map(g.fold((function(t){return r._monitoringHandler.onStorageGetError({request:e,error:t})}),(function(t){var n=t.data;r._monitoringHandler.onStorageGetSuccess({request:e,entriesCount:n.entries.length,entriesDropped:n.entriesDropped})}))))().catch((function(t){return r._monitoringHandler.onStorageGetError({request:e,error:new h.aq("Promise rejection",t)})}));case"storage:clear":return(0,_.pipe)(this._storage.clear(e),c.map(g.fold((function(t){return r._monitoringHandler.onStorageClearError({request:e,error:t})}),(function(){return r._monitoringHandler.onStorageClearSuccess({request:e})}))))().catch((function(t){return r._monitoringHandler.onStorageClearError({request:e,error:new h.aq("Promise rejection",t)})}));case"storage:save":return this._canSaveEntryToStorage.catch((function(){return!1})).then((function(t){return t?(0,_.pipe)(r._storage.save(e),c.map(g.fold((function(t){return r._monitoringHandler.onStorageSaveError({request:e,error:t})}),(function(){return r._monitoringHandler.onStorageSaveSuccess({request:e,bytesCount:(0,p.d)(e.data)})}))))().catch((function(t){return r._monitoringHandler.onStorageSaveError({request:e,error:new h.aq("Promise rejection",t)})})):r._monitoringHandler.onCannotSaveEntry({request:e})}));default:return(0,_.absurd)(e)}}}]),e}()}}]);